// Xbox Project Shim Services
var EnableXboxLiveServices=!0

// Verizon-VX360-3D.js
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},MVRK,PROJECT,BABYLON;(function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.mainCamera=!1,n.cameraType=0,n.cameraInertia=.5,n.cameraController=null,n.virtualReality=null,n.arcRotateConfig=null,n.multiPlayerSetup=null,n.editorPostProcessing=null,n.m_cameraRig=null,n}return __extends(i,t),i.GetRenderingPipeline=function(){return n.UniversalCameraSystem.renderingPipeline},i.IsCameraSystemReady=function(){return n.UniversalCameraSystem.cameraReady},i.prototype.isMainCamera=function(){return this.mainCamera},i.prototype.getCameraType=function(){return this.cameraType},i.prototype.awake=function(){this.awakeCameraSystemState()},i.prototype.start=function(){this.startCameraSystemState()},i.prototype.update=function(){this.updateCameraSystemState()},i.prototype.destroy=function(){this.destroyCameraSystemState()},i.prototype.awakeCameraSystemState=function(){this.mainCamera=this.getTransformTag()==="MainCamera";this.cameraType=this.getProperty("mainCameraType",this.cameraType);this.cameraInertia=this.getProperty("setCameraInertia",this.cameraInertia);this.virtualReality=this.getProperty("virtualRealityRig",this.virtualReality);this.arcRotateConfig=this.getProperty("arcRotateConfig",this.arcRotateConfig);this.multiPlayerSetup=this.getProperty("multiPlayerSetup",this.multiPlayerSetup);this.cameraController=this.getProperty("cameraController",this.cameraController);this.editorPostProcessing=this.getProperty("renderingPipeline",this.editorPostProcessing)},i.prototype.startCameraSystemState=function(){return __awaiter(this,void 0,void 0,function(){var a,y,w,r,nt,v,s,b,u,h,k,f,c,d,e,l,g,o,tt,t,p,i;return __generator(this,function(it){switch(it.label){case 0:return(BABYLON.Utilities.ValidateTransformQuaternion(this.transform),this.multiPlayerSetup!=null&&(n.UniversalCameraSystem.startupMode=this.multiPlayerSetup.playerStartupMode,n.UniversalCameraSystem.stereoCameras=this.multiPlayerSetup.stereoSideBySide),this.m_cameraRig=this.getCameraRig(),!(this.m_cameraRig!=null))?[3,5]:(this.m_cameraRig.inertia=this.cameraInertia,this.cameraController.attachControl===!0&&(this.m_cameraRig.parent=null,this.m_cameraRig.position.copyFrom(this.transform.position),this.m_cameraRig.rotationQuaternion=this.transform.rotationQuaternion!=null?this.transform.rotationQuaternion.clone():BABYLON.Quaternion.FromEulerAngles(this.transform.rotation.x,this.transform.rotation.y,this.transform.rotation.z),this.m_cameraRig instanceof BABYLON.FreeCamera&&(this.m_cameraRig.checkCollisions=this.cameraController.checkCollisions,this.m_cameraRig.applyGravity=this.cameraController.setApplyGravity),this.m_cameraRig.attachControl(this.cameraController.preventDefault)),!(this.cameraType===0))?[3,1]:(n.UniversalCameraSystem.PlayerOneCamera=this.m_cameraRig,n.UniversalCameraSystem.PlayerOneCamera.inertia=this.cameraInertia,n.UniversalCameraSystem.PlayerOneCamera.transform=this.transform,[3,5]);case 1:if(!(this.cameraType===1))return[3,4];if(!(this.virtualReality!=null))return[3,3];a=null;y=null;w=this.virtualReality.immersiveExperience===1?"immersive-ar":"immersive-vr";r="local-floor";switch(this.virtualReality.referenceSpaceType){case 0:r="viewer";break;case 1:r="local";break;case 2:r="local-floor";break;case 3:r="bounded-floor";break;case 4:r="unbounded";break;default:r="local-floor"}return(this.virtualReality.setFloorMeshesTags==null||this.virtualReality.setFloorMeshesTags==="")&&(this.virtualReality.setFloorMeshesTags="Navigation"),this.virtualReality.enableTeleportation===!0&&(a=this.scene.getMeshesByTags(this.virtualReality.setFloorMeshesTags)),y=this.virtualReality.enableTeleportation===!0&&a!=null&&a.length>0?{floorMeshes:a,renderingGroupId:this.virtualReality.renderingGroupNum,disableDefaultUI:this.virtualReality.disableUserInterface,disableTeleportation:this.virtualReality.enableTeleportation===!1,ignoreNativeCameraTransformation:this.virtualReality.ignoreNativeCamera,inputOptions:{doNotLoadControllerMeshes:this.virtualReality.experienceInputOptions.disableMeshLoad,forceInputProfile:this.virtualReality.experienceInputOptions.forceInputProfile,disableOnlineControllerRepository:this.virtualReality.experienceInputOptions.disableRepository,customControllersRepositoryURL:this.virtualReality.experienceInputOptions.customRepository,disableControllerAnimation:this.virtualReality.experienceInputOptions.disableModelAnim,controllerOptions:{disableMotionControllerAnimation:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlAnim,doNotLoadControllerMesh:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlMesh,forceControllerProfile:this.virtualReality.experienceInputOptions.controllerOptions.forceCtrlProfile,renderingGroupId:this.virtualReality.experienceInputOptions.controllerOptions.renderingGroup}},uiOptions:{sessionMode:w,referenceSpaceType:r}}:{renderingGroupId:this.virtualReality.renderingGroupNum,disableDefaultUI:this.virtualReality.disableUserInterface,disableTeleportation:this.virtualReality.enableTeleportation===!1,ignoreNativeCameraTransformation:this.virtualReality.ignoreNativeCamera,inputOptions:{doNotLoadControllerMeshes:this.virtualReality.experienceInputOptions.disableMeshLoad,forceInputProfile:this.virtualReality.experienceInputOptions.forceInputProfile,disableOnlineControllerRepository:this.virtualReality.experienceInputOptions.disableRepository,customControllersRepositoryURL:this.virtualReality.experienceInputOptions.customRepository,disableControllerAnimation:this.virtualReality.experienceInputOptions.disableModelAnim,controllerOptions:{disableMotionControllerAnimation:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlAnim,doNotLoadControllerMesh:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlMesh,forceControllerProfile:this.virtualReality.experienceInputOptions.controllerOptions.forceCtrlProfile,renderingGroupId:this.virtualReality.experienceInputOptions.controllerOptions.renderingGroup}},uiOptions:{sessionMode:w,referenceSpaceType:r}},nt=n.UniversalCameraSystem,[4,this.scene.createDefaultXRExperienceAsync(y)];case 2:nt.XRExperienceHelper=it.sent();n.UniversalCameraSystem.XRExperienceHelper.baseExperience||BABYLON.Tools.Warn("WebXR not supported in current browser.");it.label=3;case 3:return[3,5];case 4:this.cameraType===2?(v=this.m_cameraRig.name,s=new BABYLON.TransformNode("Player Camera 1",this.scene),s.rotationQuaternion=this.transform.rotationQuaternion.clone(),s.position=this.transform.position.clone(),s.parent=this.transform.parent,b=v+".1",u=this.m_cameraRig.clone(b),u.name=b,u.parent=s,u.position=new BABYLON.Vector3(0,0,0),u.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),u.viewport=new BABYLON.Viewport(0,0,0,0),u.setEnabled(!1),n.UniversalCameraSystem.PlayerOneCamera=u,n.UniversalCameraSystem.PlayerOneCamera.inertia=this.cameraInertia,n.UniversalCameraSystem.PlayerOneCamera.transform=s,s.cameraRig=n.UniversalCameraSystem.PlayerOneCamera,h=new BABYLON.TransformNode("Player Camera 2",this.scene),h.rotationQuaternion=this.transform.rotationQuaternion.clone(),h.position=this.transform.position.clone(),h.parent=this.transform.parent,k=v+".2",f=this.m_cameraRig.clone(k),f.name=k,f.parent=h,f.position=new BABYLON.Vector3(0,0,0),f.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),f.viewport=new BABYLON.Viewport(0,0,0,0),f.setEnabled(!1),n.UniversalCameraSystem.PlayerTwoCamera=f,n.UniversalCameraSystem.PlayerTwoCamera.inertia=this.cameraInertia,n.UniversalCameraSystem.PlayerTwoCamera.transform=h,h.cameraRig=n.UniversalCameraSystem.PlayerTwoCamera,c=new BABYLON.TransformNode("Player Camera 3",this.scene),c.rotationQuaternion=this.transform.rotationQuaternion.clone(),c.position=this.transform.position.clone(),c.parent=this.transform.parent,d=v+".3",e=this.m_cameraRig.clone(d),e.name=d,e.parent=c,e.position=new BABYLON.Vector3(0,0,0),e.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),e.viewport=new BABYLON.Viewport(0,0,0,0),e.setEnabled(!1),n.UniversalCameraSystem.PlayerThreeCamera=e,n.UniversalCameraSystem.PlayerThreeCamera.inertia=this.cameraInertia,n.UniversalCameraSystem.PlayerThreeCamera.transform=c,c.cameraRig=n.UniversalCameraSystem.PlayerThreeCamera,l=new BABYLON.TransformNode("Player Camera 4",this.scene),l.rotationQuaternion=this.transform.rotationQuaternion.clone(),l.position=this.transform.position.clone(),l.parent=this.transform.parent,g=v+".4",o=this.m_cameraRig.clone(g),o.name=g,o.parent=l,o.position=new BABYLON.Vector3(0,0,0),o.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),o.viewport=new BABYLON.Viewport(0,0,0,0),o.setEnabled(!1),n.UniversalCameraSystem.PlayerFourCamera=o,n.UniversalCameraSystem.PlayerFourCamera.inertia=this.cameraInertia,n.UniversalCameraSystem.PlayerFourCamera.transform=l,l.cameraRig=n.UniversalCameraSystem.PlayerFourCamera,n.UniversalCameraSystem.multiPlayerView=!0,n.UniversalCameraSystem.SetMultiPlayerViewLayout(this.scene,n.UniversalCameraSystem.startupMode)):this.cameraType===3&&(tt=BABYLON.Utilities.ParseVector3(this.arcRotateConfig.target),this.m_cameraRig=new BABYLON.ArcRotateCamera(this.transform.name+".ArcRotate",this.arcRotateConfig.alpha,this.arcRotateConfig.beta,this.arcRotateConfig.radius,tt,this.scene),this.m_cameraRig.wheelPrecision=this.arcRotateConfig.wheel,this.scene.switchActiveCamera(this.m_cameraRig,!0));it.label=5;case 5:return this.editorPostProcessing!=null&&this.editorPostProcessing.usePostProcessing===!0&&(n.UniversalCameraSystem.renderingPipeline=new BABYLON.DefaultRenderingPipeline("UniversalCameraSystem",this.editorPostProcessing.highDynamicRange,this.scene,this.scene.cameras,!0),n.UniversalCameraSystem.renderingPipeline.isSupported===!0?(t=n.UniversalCameraSystem.renderingPipeline,t.samples=this.editorPostProcessing.screenAntiAliasing.multiAntiAliasing,t.imageProcessingEnabled=this.editorPostProcessing.imageProcessingConfig.imageProcessing,t.imageProcessingEnabled&&(t.imageProcessing.contrast=this.editorPostProcessing.imageProcessingConfig.imageContrast,t.imageProcessing.exposure=this.editorPostProcessing.imageProcessingConfig.imageExposure,t.imageProcessing.colorGradingEnabled=this.editorPostProcessing.imageProcessingConfig.useColorGrading,t.imageProcessing.colorGradingEnabled&&this.editorPostProcessing.imageProcessingConfig.setGradingTexture!=null&&(p=BABYLON.Utilities.ParseTexture(this.editorPostProcessing.imageProcessingConfig.setGradingTexture,this.scene,!0,!1),p.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,p.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,t.imageProcessing.colorGradingTexture=p,t.imageProcessing.colorGradingWithGreenDepth=!1),t.imageProcessing.colorCurvesEnabled=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.curvesEnabled,t.imageProcessing.colorCurvesEnabled&&(i=new BABYLON.ColorCurves,i.globalDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalDen,i.globalExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalExp,i.globalHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalHue,i.globalSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalSat,i.highlightsDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsDen,i.highlightsExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsExp,i.highlightsHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsHue,i.highlightsSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsSat,i.midtonesDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesDen,i.midtonesExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesExp,i.midtonesHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesHue,i.midtonesSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesSat,i.shadowsDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsDen,i.shadowsExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsExp,i.shadowsHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsHue,i.shadowsSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsSat,t.imageProcessing.colorCurves=i)),t.bloomEnabled=this.editorPostProcessing.bloomEffectProperties.bloomEnabled,t.bloomEnabled&&(t.bloomKernel=this.editorPostProcessing.bloomEffectProperties.bloomKernel,t.bloomScale=this.editorPostProcessing.bloomEffectProperties.bloomScale,t.bloomWeight=this.editorPostProcessing.bloomEffectProperties.bloomWeight,t.bloomThreshold=this.editorPostProcessing.bloomEffectProperties.bloomThreshold),t.chromaticAberrationEnabled=this.editorPostProcessing.chromaticAberration.aberrationEnabled,t.chromaticAberrationEnabled&&(t.chromaticAberration.aberrationAmount=this.editorPostProcessing.chromaticAberration.aberrationAmount,t.chromaticAberration.adaptScaleToCurrentViewport=this.editorPostProcessing.chromaticAberration.adaptScaleViewport,t.chromaticAberration.alphaMode=this.editorPostProcessing.chromaticAberration.alphaMode,t.chromaticAberration.alwaysForcePOT=this.editorPostProcessing.chromaticAberration.alwaysForcePOT,t.chromaticAberration.enablePixelPerfectMode=this.editorPostProcessing.chromaticAberration.pixelPerfectMode,t.chromaticAberration.forceFullscreenViewport=this.editorPostProcessing.chromaticAberration.fullscreenViewport),t.depthOfFieldEnabled=this.editorPostProcessing.focalDepthOfField.depthOfField,t.depthOfFieldEnabled&&t.depthOfField.isSupported&&(t.depthOfFieldBlurLevel=this.editorPostProcessing.focalDepthOfField.blurLevel,t.depthOfField.fStop=this.editorPostProcessing.focalDepthOfField.focalStop,t.depthOfField.focalLength=this.editorPostProcessing.focalDepthOfField.focalLength,t.depthOfField.focusDistance=this.editorPostProcessing.focalDepthOfField.focusDistance,t.depthOfField.lensSize=this.editorPostProcessing.focalDepthOfField.maxLensSize),t.fxaaEnabled=this.editorPostProcessing.screenAntiAliasing.fullScreenEnabled,t.fxaaEnabled&&(t.fxaa.samples=this.editorPostProcessing.screenAntiAliasing.screenAntiAliasing,t.fxaa.adaptScaleToCurrentViewport=this.editorPostProcessing.screenAntiAliasing.adaptScaleViewport),t.glowLayerEnabled=this.editorPostProcessing.glowLayerProperties.glowEnabled,t.glowLayerEnabled&&(t.glowLayer.intensity=this.editorPostProcessing.glowLayerProperties.glowIntensity,t.glowLayer.blurKernelSize=this.editorPostProcessing.glowLayerProperties.blurKernelSize),t.grainEnabled=this.editorPostProcessing.grainEffectProperties.grainEnabled,t.grainEnabled&&(t.grain.animated=this.editorPostProcessing.grainEffectProperties.grainAnimated,t.grain.intensity=this.editorPostProcessing.grainEffectProperties.grainIntensity,t.grain.adaptScaleToCurrentViewport=this.editorPostProcessing.grainEffectProperties.adaptScaleViewport),t.sharpenEnabled=this.editorPostProcessing.sharpEffectProperties.sharpenEnabled,t.sharpenEnabled&&(t.sharpen.edgeAmount=this.editorPostProcessing.sharpEffectProperties.sharpEdgeAmount,t.sharpen.colorAmount=this.editorPostProcessing.sharpEffectProperties.sharpColorAmount,t.sharpen.adaptScaleToCurrentViewport=this.editorPostProcessing.sharpEffectProperties.adaptScaleViewport)):BABYLON.Tools.Warn("Babylon.js default rendering pipeline not supported")),n.UniversalCameraSystem.cameraReady=!0,[2]}})})},i.prototype.updateCameraSystemState=function(){this.m_cameraRig!=null&&(this.cameraType===0||this.cameraType===1||this.cameraType===2||this.cameraType===3)},i.prototype.destroyCameraSystemState=function(){this.virtualReality=null},i.GetWebXR=function(){return n.UniversalCameraSystem.XRExperienceHelper},i.GetPlayerCamera=function(t,i,r){i===void 0&&(i=BABYLON.PlayerNumber.One);r===void 0&&(r=!1);var u=null;return n.UniversalCameraSystem.IsCameraSystemReady()&&(i===BABYLON.PlayerNumber.One&&n.UniversalCameraSystem.PlayerOneCamera!=null?u=n.UniversalCameraSystem.PlayerOneCamera:i===BABYLON.PlayerNumber.Two&&n.UniversalCameraSystem.PlayerTwoCamera!=null?u=n.UniversalCameraSystem.PlayerTwoCamera:i===BABYLON.PlayerNumber.Three&&n.UniversalCameraSystem.PlayerThreeCamera!=null?u=n.UniversalCameraSystem.PlayerThreeCamera:i===BABYLON.PlayerNumber.Four&&n.UniversalCameraSystem.PlayerFourCamera!=null&&(u=n.UniversalCameraSystem.PlayerFourCamera)),r===!0&&parent!=null&&(u.parent=null),u},i.GetCameraTransform=function(t,i){i===void 0&&(i=BABYLON.PlayerNumber.One);var r=null;return n.UniversalCameraSystem.IsCameraSystemReady()&&(i===BABYLON.PlayerNumber.One&&n.UniversalCameraSystem.PlayerOneCamera!=null&&n.UniversalCameraSystem.PlayerOneCamera.transform!=null?r=n.UniversalCameraSystem.PlayerOneCamera.transform:i===BABYLON.PlayerNumber.Two&&n.UniversalCameraSystem.PlayerTwoCamera!=null&&n.UniversalCameraSystem.PlayerTwoCamera.transform!=null?r=n.UniversalCameraSystem.PlayerTwoCamera.transform:i===BABYLON.PlayerNumber.Three&&n.UniversalCameraSystem.PlayerThreeCamera!=null&&n.UniversalCameraSystem.PlayerThreeCamera.transform!=null?r=n.UniversalCameraSystem.PlayerThreeCamera.transform:i===BABYLON.PlayerNumber.Four&&n.UniversalCameraSystem.PlayerFourCamera!=null&&n.UniversalCameraSystem.PlayerFourCamera.transform!=null&&(r=n.UniversalCameraSystem.PlayerFourCamera.transform)),r},i.IsStereoCameras=function(){return n.UniversalCameraSystem.stereoCameras},i.IsMultiPlayerView=function(){return n.UniversalCameraSystem.multiPlayerView},i.GetMultiPlayerCount=function(){return n.UniversalCameraSystem.multiPlayerCount},i.ActivateMultiPlayerCameras=function(t){var i=!1;return n.UniversalCameraSystem.multiPlayerCameras!=null&&n.UniversalCameraSystem.multiPlayerCameras.length>0&&(t.activeCameras=n.UniversalCameraSystem.multiPlayerCameras,i=!0),i},i.DisposeMultiPlayerCameras=function(){n.UniversalCameraSystem.PlayerOneCamera!=null&&(n.UniversalCameraSystem.PlayerOneCamera.dispose(),n.UniversalCameraSystem.PlayerOneCamera=null);n.UniversalCameraSystem.PlayerTwoCamera!=null&&(n.UniversalCameraSystem.PlayerTwoCamera.dispose(),n.UniversalCameraSystem.PlayerTwoCamera=null);n.UniversalCameraSystem.PlayerThreeCamera!=null&&(n.UniversalCameraSystem.PlayerThreeCamera.dispose(),n.UniversalCameraSystem.PlayerThreeCamera=null);n.UniversalCameraSystem.PlayerFourCamera!=null&&(n.UniversalCameraSystem.PlayerFourCamera.dispose(),n.UniversalCameraSystem.PlayerFourCamera=null)},i.SetMultiPlayerViewLayout=function(t,i){var u=!1,r=BABYLON.Scalar.Clamp(i,1,4);return n.UniversalCameraSystem.IsMultiPlayerView()?(n.UniversalCameraSystem.PlayerOneCamera!=null&&n.UniversalCameraSystem.PlayerTwoCamera!=null&&n.UniversalCameraSystem.PlayerThreeCamera!=null&&n.UniversalCameraSystem.PlayerFourCamera!=null?(n.UniversalCameraSystem.multiPlayerCameras=[],r===1?(n.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,0,1,1),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!1),n.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!1),n.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerOneCamera)):r===2?(n.UniversalCameraSystem.stereoCameras===!0?(n.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,0,.5,1),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(.5,0,.5,1)):(n.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,.5,1,.5),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(0,0,1,.5)),n.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!1),n.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerOneCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerTwoCamera)):r===3?(n.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,0,.5,1),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(.5,.5,.5,.5),n.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(.5,0,.5,.5),n.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerOneCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerTwoCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerThreeCamera)):r===4?(n.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,.5,.5,.5),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(0,0,.5,.5),n.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(.5,.5,.5,.5),n.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(.5,0,.5,.5),n.UniversalCameraSystem.PlayerFourCamera.setEnabled(!0),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerOneCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerTwoCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerThreeCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerFourCamera)):BABYLON.Tools.Warn("Babylon.js camera rig invalid player count specified: "+r)):BABYLON.Tools.Warn("Babylon.js camera rig failed to initialize multi player cameras"),n.UniversalCameraSystem.multiPlayerCount=r,u=n.UniversalCameraSystem.ActivateMultiPlayerCameras(t),u===!1&&BABYLON.Tools.Warn("Babylon.js camera rig failed to initialize multi player views")):BABYLON.Tools.Warn("Babylon.js camera rig multi player view option not enabled"),u},i.PlayerOneCamera=null,i.PlayerTwoCamera=null,i.PlayerThreeCamera=null,i.PlayerFourCamera=null,i.XRExperienceHelper=null,i.multiPlayerView=!1,i.multiPlayerCount=1,i.multiPlayerCameras=null,i.stereoCameras=!0,i.startupMode=1,i.cameraReady=!1,i.renderingPipeline=null,i}(BABYLON.ScriptComponent);n.UniversalCameraSystem=t})(PROJECT||(PROJECT={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.keys=!0,n.show=!0,n.popup=!1,n.views=!1,n.xbox=!1,n.color=BABYLON.Color3.Green(),n}return __extends(i,t),i.prototype.awake=function(){this.keys=this.getProperty("enableDebugKeys",this.keys);this.show=this.getProperty("showDebugLabels",this.show);this.popup=this.getProperty("popupDebugPanel",this.popup);this.views=this.getProperty("togglePlayerViews",this.views);this.xbox=this.getProperty("allowXboxLiveSignIn",this.xbox);var n=this.getProperty("debugOutputTextColor");n!=null&&(this.color=BABYLON.Utilities.ParseColor3(n));BABYLON.SceneManager.IsWindows()&&(this.popup=!1);console.log("Debug information overlay loaded")},i.prototype.start=function(){var t=this,i,r;this.show===!0;this.keys===!0&&(this.views===!0&&(console.log("Enable Multiplayer Keys"),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num1,function(){n.UniversalCameraSystem.SetMultiPlayerViewLayout(t.scene,1);console.log("1 player pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num2,function(){n.UniversalCameraSystem.SetMultiPlayerViewLayout(t.scene,2);console.log("2 players pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num3,function(){n.UniversalCameraSystem.SetMultiPlayerViewLayout(t.scene,3);console.log("3 players pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num4,function(){n.UniversalCameraSystem.SetMultiPlayerViewLayout(t.scene,4);console.log("4 players pressed")})),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.R,function(){window.location.reload()}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.I,function(){t.popup===!0?BABYLON.SceneManager.PopupDebug(t.scene):BABYLON.SceneManager.ToggleDebug(t.scene,!0,null)}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.F,function(){}));i=this.scene.getEngine().webGLVersion<2?"red":this.color.toHexString();r=BABYLON.SceneManager.GetWebGLVersionString(this.scene);BABYLON.Utilities.PrintToScreen(r,i)},i.prototype.destroy=function(){},i}(BABYLON.ScriptComponent);n.DebugInformation=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.m_playerAgent=null,t}return __extends(t,n),t.prototype.start=function(){var n=this;this.doPointerCancel();this.scene.onPointerObservable.add(function(t){switch(t.type){case BABYLON.PointerEventTypes.POINTERDOWN:t.pickInfo.hit&&n.doPointerDown(t)}});this.m_playerAgent=this.getComponent("BABYLON.NavigationAgent");this.m_playerAgent!=null?BABYLON.Tools.Log("Test navigation mesh agent for: "+this.transform.name):BABYLON.Tools.Warn("Failed to locate test nav mesh agent for: "+this.transform.name)},t.prototype.doPointerCancel=function(){var n=this.scene.getEngine().getRenderingCanvas();n.oncontextmenu=function(n){n.preventDefault()}},t.prototype.doPointerDown=function(n){var t=this.scene.pick(this.scene.pointerX,this.scene.pointerY);t.hit&&this.m_playerAgent!=null&&(n.event.button===0?this.m_playerAgent.setDestination(t.pickedPoint):this.m_playerAgent.teleport(t.pickedPoint))},t}(BABYLON.ScriptComponent);n.TestNavigationAgent=t}(PROJECT||(PROJECT={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.enableInput=!1,n.attachCamera=!1,n.rotateCamera=!0,n.moveCharacter=!0,n.toggleView=!0,n.freeLooking=!1,n.rootMotion=!1,n.gravityForce=.5,n.slopeForce=0,n.rayLength=1,n.rayOrigin=0,n.maxAngle=45,n.speedFactor=1,n.moveSpeed=5,n.lookSpeed=2,n.jumpSpeed=8,n.jumpDelay=0,n.eyesHeight=.25,n.pivotHeight=.25,n.topLookLimit=60,n.downLookLimit=30,n.lowTurnSpeed=15,n.highTurnSpeed=25,n.takeoffPower=2.5,n.stoppingPower=5,n.acceleration=!1,n.avatarSkinTag="Skin",n.distanceFactor=.85,n.cameraSmoothing=5,n.cameraCollisions=!0,n.inputMagnitude=0,n.minimumDistance=.85,n.buttonJump=BABYLON.Xbox360Button.A,n.keyboardJump=BABYLON.UserInputKey.SpaceBar,n.buttonCamera=BABYLON.Xbox360Button.Y,n.keyboardCamera=BABYLON.UserInputKey.P,n.playerNumber=BABYLON.PlayerNumber.One,n.boomPosition=new BABYLON.Vector3(0,0,0),n.movementVelocity=BABYLON.Vector3.Zero(),n.abstractMesh=null,n.cameraDistance=0,n.forwardCamera=!1,n.dollyDirection=BABYLON.Vector3.Zero(),n.rotationEulers=BABYLON.Vector3.Zero(),n.cameraPivotOffset=BABYLON.Vector3.Zero(),n.cameraForwardVector=new BABYLON.Vector3(0,0,0),n.cameraRightVector=new BABYLON.Vector3(0,0,0),n.desiredForwardVector=new BABYLON.Vector3(0,0,0),n.desiredRightVector=new BABYLON.Vector3(0,0,0),n.scaledCamDirection=BABYLON.Vector3.Zero(),n.scaledMaxDirection=BABYLON.Vector3.Zero(),n.parentNodePosition=BABYLON.Vector3.Zero(),n.maximumCameraPos=BABYLON.Vector3.Zero(),n.raycastShape=null,n.raycastGroup=BABYLON.CollisionFilters.DefaultFilter,n.raycastMask=BABYLON.CollisionFilters.AllFilter^BABYLON.CollisionFilters.CharacterFilter,n.avatarSkins=null,n.cameraNode=null,n.cameraPivot=null,n.navigationAgent=null,n.characterController=null,n.isCharacterNavigating=!1,n.isCharacterGrounded=!1,n.isCharacterJumpFrame=!1,n.isCharacterJumpState=!1,n.navigationAngularSpeed=0,n.animationControllerTag="Animator",n.animationStateMachine=!1,n.animationStateParams=null,n.showDebugColliders=!1,n.colliderVisibility=0,n.deltaTime=0,n.jumpTimer=0,n.playerControl=0,n.playerInputX=0,n.playerInputZ=0,n.playerMouseX=0,n.playerMouseY=0,n.groundedMesh=null,n.groundedPoint=null,n.groundedAngle=0,n.groundedNormal=null,n.verticalVelocity=0,n.rootmotionSpeed=0,n.smoothDeltaTime=0,n.animationState=null,n.inputMovementVector=BABYLON.Vector3.Zero(),n.playerLookRotation=BABYLON.Vector3.Zero(),n.playerRotationVector=BABYLON.Vector2.Zero(),n.playerMovementVelocity=BABYLON.Vector3.Zero(),n.playerRotationQuaternion=BABYLON.Quaternion.Zero(),n.onPreUpdateObservable=new BABYLON.Observable,n.onBeforeMoveObservable=new BABYLON.Observable,n.onPostUpdateObservable=new BABYLON.Observable,n.pickingRay=null,n.pickingHelper=null,n.pickingOrigin=null,n.pickingDirection=new BABYLON.Vector3(0,-1,0),n.cameraRay=null,n.cameraHelper=null,n.cameraForward=new BABYLON.Vector3(0,0,0),n.cameraDirection=new BABYLON.Vector3(0,0,0),n}return __extends(i,t),i.prototype.getPlayerInputX=function(){return this.playerInputX},i.prototype.getPlayerInputZ=function(){return this.playerInputZ},i.prototype.getPlayerMouseX=function(){return this.playerMouseX},i.prototype.getPlayerMouseY=function(){return this.playerMouseY},i.prototype.getPlayerJumping=function(){return this.isCharacterJumpState},i.prototype.getPlayerGrounded=function(){return this.isCharacterGrounded},i.prototype.getGroundedMesh=function(){return this.groundedMesh},i.prototype.getGroundedPoint=function(){return this.groundedPoint},i.prototype.getGroundedAngle=function(){return this.groundedAngle},i.prototype.getGroundedNormal=function(){return this.groundedNormal},i.prototype.getCameraBoomNode=function(){return this.cameraNode},i.prototype.getCameraTransform=function(){return this.cameraPivot},i.prototype.getAnimationState=function(){return this.animationState},i.prototype.getCharacterController=function(){return this.characterController},i.prototype.awake=function(){this.awakePlayerController()},i.prototype.start=function(){this.startPlayerController()},i.prototype.update=function(){this.updatePlayerController()},i.prototype.late=function(){this.latePlayerController()},i.prototype.after=function(){this.afterPlayerController()},i.prototype.destroy=function(){this.destroyPlayerController()},i.prototype.setPlayerControl=function(t){this.playerControl=t;this.playerControl===n.PlayerInputControl.ThirdPersonStrafing||this.playerControl===n.PlayerInputControl.ThirdPersonForward?this.showAvatarSkins(!0):this.showAvatarSkins(!1);this.playerControl===n.PlayerInputControl.ThirdPersonForward?this.forwardCamera=!0:this.playerControl===n.PlayerInputControl.ThirdPersonStrafing&&(this.forwardCamera=!1)},i.prototype.togglePlayerControl=function(){this.toggleView===!0&&(this.playerControl===n.PlayerInputControl.FirstPersonStrafing?this.forwardCamera===!0?this.setPlayerControl(n.PlayerInputControl.ThirdPersonForward):this.setPlayerControl(n.PlayerInputControl.ThirdPersonStrafing):this.setPlayerControl(n.PlayerInputControl.FirstPersonStrafing))},i.prototype.showAvatarSkins=function(n){this.avatarSkins!=null&&this.avatarSkins.forEach(function(t){t.isVisible=n})},i.prototype.attachPlayerCamera=function(t){if(this.cameraNode==null){var i=t<=0||t>4?1:t;this.cameraNode=n.UniversalCameraSystem.GetCameraTransform(this.scene,i);this.cameraNode!=null?(this.cameraNode.parent=this.cameraPivot,this.cameraNode.position.copyFrom(this.boomPosition),this.cameraNode.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),this.cameraDistance=this.cameraNode.position.length(),this.dollyDirection.copyFrom(this.cameraNode.position),this.dollyDirection.normalize()):BABYLON.Tools.Warn("Failed to locate player camera for: "+this.transform.name)}},i.prototype.attachAnimationController=function(){if(this.animationState==null&&this.animationControllerTag!=null&&this.animationControllerTag!==""){var n=null;n=this.hasTransformTags(this.animationControllerTag)?this.transform:this.getChildWithTags(this.animationControllerTag,!1);n!=null?this.animationState=BABYLON.SceneManager.FindScriptComponent(n,"BABYLON.AnimationState"):BABYLON.Tools.Warn("Failed to locate bot mesh with tag: "+this.animationControllerTag)}},i.prototype.resetPlayerRotation=function(){this.transform.rotationQuaternion.toEulerAnglesToRef(this.rotationEulers);this.playerRotationVector.x=this.rotationEulers.x;this.playerRotationVector.y=this.rotationEulers.y},i.prototype.awakePlayerController=function(){var u=this,i,f,e,t;if(this.gravityForce=this.getProperty("gravityForce",this.gravityForce),this.rotateCamera=this.getProperty("rotateCamera",this.rotateCamera),this.moveCharacter=this.getProperty("moveCharacter",this.moveCharacter),this.slopeForce=this.getProperty("slopeForce",this.slopeForce),this.rayLength=this.getProperty("rayLength",this.rayLength),this.rayOrigin=this.getProperty("rayOrigin",this.rayOrigin),this.maxAngle=this.getProperty("maxAngle",this.maxAngle),this.speedFactor=this.getProperty("speedFactor",this.speedFactor),this.moveSpeed=this.getProperty("moveSpeed",this.moveSpeed),this.lookSpeed=this.getProperty("lookSpeed",this.lookSpeed),this.jumpSpeed=this.getProperty("jumpSpeed",this.jumpSpeed),this.jumpDelay=this.getProperty("jumpDelay",this.jumpDelay),this.eyesHeight=this.getProperty("eyesHeight",this.eyesHeight),this.pivotHeight=this.getProperty("pivotHeight",this.pivotHeight),this.topLookLimit=this.getProperty("topLookLimit",this.topLookLimit),this.downLookLimit=this.getProperty("downLookLimit",this.downLookLimit),this.lowTurnSpeed=this.getProperty("lowTurnSpeed",this.lowTurnSpeed),this.highTurnSpeed=this.getProperty("highTurnSpeed",this.highTurnSpeed),this.enableInput=this.getProperty("enableInput",this.enableInput),this.rootMotion=this.getProperty("rootMotion",this.rootMotion),this.playerNumber=this.getProperty("playerNumber",this.playerNumber),this.attachCamera=this.getProperty("attachCamera",this.attachCamera),this.freeLooking=this.getProperty("freeLooking",this.freeLooking),this.toggleView=this.getProperty("toggleView",this.toggleView),this.avatarSkinTag=this.getProperty("avatarSkinTag",this.avatarSkinTag),this.cameraCollisions=this.getProperty("cameraCollisions",this.cameraCollisions),this.cameraSmoothing=this.getProperty("cameraSmoothing",this.cameraSmoothing),this.distanceFactor=this.getProperty("distanceFactor",this.distanceFactor),this.minimumDistance=this.getProperty("minimumDistance",this.minimumDistance),this.stoppingPower=this.getProperty("stoppingPower",this.stoppingPower),this.takeoffPower=this.getProperty("takeoffPower",this.takeoffPower),this.acceleration=this.getProperty("acceleration",this.acceleration),this.animationControllerTag=this.getProperty("animationControllerTag",this.animationControllerTag),this.animationStateMachine=this.getProperty("animationStateMachine",this.animationStateMachine),this.animationStateParams=this.getProperty("animationStateParams",this.animationStateParams),i=this.getProperty("boomPosition"),i!=null&&(this.boomPosition=BABYLON.Utilities.ParseVector3(i)),f=this.getProperty("sphereRadius",.5),this.raycastShape=BABYLON.SceneManager.CreatePhysicsSphereShape(f),this.abstractMesh=this.getAbstractMesh(),this.showDebugColliders=BABYLON.Utilities.ShowDebugColliders(),this.colliderVisibility=BABYLON.Utilities.ColliderVisibility(),this.avatarSkinTag!=null&&this.avatarSkinTag!==""&&(this.avatarSkins=this.getChildrenWithTags(this.avatarSkinTag,!1)),e=this.getProperty("playerControl",this.playerControl),this.setPlayerControl(e),this.resetPlayerRotation(),this.cameraPivot=new BABYLON.Mesh(this.transform.name+".CameraPivot",this.scene),this.cameraPivot.parent=null,this.cameraPivot.position=this.transform.position.clone(),this.cameraPivot.rotationQuaternion=this.transform.rotationQuaternion.clone(),this.cameraPivot.checkCollisions=!1,this.cameraPivot.isPickable=!1,this.showDebugColliders===!0&&(t=BABYLON.MeshBuilder.CreateBox("TestPivot",{width:.25,height:.25,depth:.5},this.scene),t.parent=this.cameraPivot,t.position.set(0,0,0),t.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),t.visibility=.5,t.checkCollisions=!1,t.isPickable=!1),BABYLON.SceneManager.OnKeyboardPress(this.keyboardCamera,function(){u.togglePlayerControl()}),BABYLON.SceneManager.OnGamepadButtonPress(this.buttonCamera,function(){u.togglePlayerControl()}),this.navigationAgent=this.getComponent("BABYLON.NavigationAgent"),this.characterController=this.getComponent("BABYLON.CharacterController"),this.characterController!=null?BABYLON.Tools.Warn("Starting player controller in physic engine mode for: "+this.transform.name):BABYLON.Tools.Warn("Starting player controller in check collisions mode for: "+this.transform.name),this.characterController==null&&this.abstractMesh!=null&&(this.abstractMesh.checkCollisions=!0,this.abstractMesh.isPickable=!0,this.showDebugColliders===!0&&this.transform._debugCollider==null)){var r=this.abstractMesh.ellipsoid.clone(),o=this.transform.name+".Debug",n=BABYLON.MeshBuilder.CreateSphere(o,{segments:16,diameterX:r.x*2,diameterY:r.y*2,diameterZ:r.z*2},this.scene);n.position.set(0,0,0);n.rotationQuaternion=this.transform.rotationQuaternion.clone();n.setParent(this.transform);n.position.set(0,0,0);n.visibility=this.colliderVisibility;n.material=BABYLON.Utilities.GetColliderMaterial(this.scene);n.checkCollisions=!1;n.isPickable=!1;this.transform._debugCollider=n}},i.prototype.startPlayerController=function(){this.attachCamera===!0&&this.attachPlayerCamera(this.playerNumber)},i.prototype.updatePlayerController=function(){var t,i,u,f,e,o,s,r;(this.animationStateMachine===!0&&this.attachAnimationController(),this.deltaTime=this.getDeltaSeconds(),this.smoothDeltaTime=BABYLON.System.SmoothDeltaFactor*this.deltaTime+(1-BABYLON.System.SmoothDeltaFactor)*this.smoothDeltaTime,this.jumpTimer>0&&(this.jumpTimer-=this.deltaTime,this.jumpTimer<0&&(this.jumpTimer=0)),this.enableInput!==!1)&&(this.playerInputX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Horizontal,this.playerNumber),this.playerInputZ=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Vertical,this.playerNumber),this.playerMouseX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseX,this.playerNumber),this.playerMouseY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseY,this.playerNumber),this.inputMovementVector.set(this.playerInputX,0,this.playerInputZ),BABYLON.Utilities.ClampMagnitudeVector3ToRef(this.inputMovementVector,1,this.inputMovementVector),this.inputMagnitude=this.inputMovementVector.length(),this.onPreUpdateObservable.hasObservers()===!0&&this.onPreUpdateObservable.notifyObservers(this.transform),this.cameraForwardVector.copyFrom(this.cameraPivot.forward),this.cameraForwardVector.y=0,this.cameraForwardVector.normalize(),this.cameraForwardVector.scaleToRef(this.playerInputZ,this.desiredForwardVector),this.cameraRightVector.copyFrom(this.cameraPivot.right),this.cameraRightVector.y=0,this.cameraRightVector.normalize(),this.cameraRightVector.scaleToRef(this.playerInputX,this.desiredRightVector),this.playerRotationVector.y+=this.playerMouseX*this.lookSpeed*this.deltaTime,this.playerRotationVector.x+=-this.playerMouseY*this.lookSpeed*this.deltaTime,this.playerRotationVector.x=BABYLON.Scalar.Clamp(this.playerRotationVector.x,-BABYLON.Tools.ToRadians(this.downLookLimit),BABYLON.Tools.ToRadians(this.topLookLimit)),t=this.inputMagnitude*this.moveSpeed*this.deltaTime*this.speedFactor,i=this.rootmotionSpeed*this.speedFactor,this.playerControl===n.PlayerInputControl.FirstPersonStrafing?(this.desiredForwardVector.addToRef(this.desiredRightVector,this.playerMovementVelocity),this.rootMotion===!0?this.playerMovementVelocity.scaleInPlace(i):this.playerMovementVelocity.scaleInPlace(t),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.playerRotationVector.y,0,this.transform.rotationQuaternion)):this.playerControl===n.PlayerInputControl.ThirdPersonStrafing?(this.desiredForwardVector.addToRef(this.desiredRightVector,this.playerMovementVelocity),this.rootMotion===!0?this.playerMovementVelocity.scaleInPlace(i):this.playerMovementVelocity.scaleInPlace(t),this.freeLooking===!0?this.inputMagnitude>0&&(u=this.playerMovementVelocity.length()/this.moveSpeed,f=BABYLON.Scalar.Lerp(this.highTurnSpeed,this.lowTurnSpeed,u),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.playerRotationVector.y,0,this.playerRotationQuaternion),BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.playerRotationQuaternion,f*this.deltaTime,this.transform.rotationQuaternion)):BABYLON.Quaternion.FromEulerAnglesToRef(0,this.playerRotationVector.y,0,this.transform.rotationQuaternion)):this.playerControl===n.PlayerInputControl.ThirdPersonForward&&(this.desiredForwardVector.addToRef(this.desiredRightVector,this.playerLookRotation),this.rootMotion===!0?this.transform.forward.scaleToRef(i,this.playerMovementVelocity):this.transform.forward.scaleToRef(t,this.playerMovementVelocity),this.inputMagnitude>0&&(e=this.playerMovementVelocity.length()/this.moveSpeed,o=BABYLON.Scalar.Lerp(this.highTurnSpeed,this.lowTurnSpeed,e),BABYLON.Utilities.LookRotationToRef(this.playerLookRotation,this.playerRotationQuaternion),BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.playerRotationQuaternion,o*this.deltaTime,this.transform.rotationQuaternion))),this.acceleration===!0?(this.takeoffPower<.1&&(this.takeoffPower=.1),this.stoppingPower<.1&&(this.stoppingPower=.1),BABYLON.Vector3.LerpToRef(this.movementVelocity,this.playerMovementVelocity,this.takeoffPower*this.smoothDeltaTime,this.movementVelocity),s=this.playerMovementVelocity.length(),r=this.movementVelocity.length(),s===0&&r>0&&r<this.stoppingPower*.01&&this.movementVelocity.copyFrom(this.playerMovementVelocity)):this.movementVelocity.copyFrom(this.playerMovementVelocity),this.isCharacterGrounded=!0,this.isCharacterJumpFrame=!1,this.isCharacterNavigating=this.navigationAgent!=null&&this.navigationAgent.isNavigating(),this.navigationAngularSpeed=this.navigationAgent!=null?this.navigationAgent.angularSpeed:0,this.characterController!=null?this.updateCharacterController():this.updateCheckCollisions(),this.animationState!=null&&this.animationStateMachine===!0&&(this.validateAnimationStateParams(),this.animationState.setFloat(this.animationStateParams.horizontalInput,this.playerInputX),this.animationState.setFloat(this.animationStateParams.verticalInput,this.playerInputZ),this.animationState.setFloat(this.animationStateParams.mouseXInput,this.playerMouseX),this.animationState.setFloat(this.animationStateParams.mouseYInput,this.playerMouseY),this.animationState.setFloat(this.animationStateParams.speedInput,this.inputMagnitude),this.animationState.setBool(this.animationStateParams.jumpedInput,this.isCharacterJumpFrame),this.animationState.setBool(this.animationStateParams.jumpingInput,this.isCharacterJumpState),this.animationState.setBool(this.animationStateParams.groundedInput,this.isCharacterGrounded),this.isCharacterNavigating===!0),this.onPostUpdateObservable.hasObservers()===!0&&this.onPostUpdateObservable.notifyObservers(this.transform))},i.prototype.updateCharacterController=function(){this.moveCharacter===!0&&this.characterController!=null&&(this.isCharacterGrounded=this.characterController.isGrounded(),this.groundedMesh=null,this.groundedPoint=null,this.groundedNormal=null,this.groundedAngle=this.groundedNormal!=null?Math.abs(BABYLON.Utilities.GetAngle(this.groundedNormal,this.transform.forward)-90):0,this.isCharacterNavigating===!1?this.isCharacterGrounded===!0&&(this.isCharacterJumpState===!0&&(this.jumpDelay>0&&(this.jumpTimer=this.jumpDelay+this.deltaTime),this.isCharacterJumpState=!1),this.jumpTimer<=0&&(this.isCharacterJumpFrame=BABYLON.SceneManager.GetKeyboardInput(this.keyboardJump)||BABYLON.SceneManager.GetGamepadButtonInput(this.buttonJump)),this.isCharacterJumpFrame===!0&&(this.isCharacterJumpState=!0,this.characterController.jump(this.jumpSpeed)),this.onBeforeMoveObservable.hasObservers()===!0&&this.onBeforeMoveObservable.notifyObservers(this.transform),this.characterController.move(this.movementVelocity)):this.characterController.setGhostWorldPosition(this.transform.position))},i.prototype.updateCheckCollisions=function(){var n,t;this.moveCharacter===!0&&this.abstractMesh!=null&&(n=this.pickCheckCollisionsRaycast(),this.isCharacterGrounded=n!=null&&n.hit,this.groundedMesh=n!=null&&n.hit?n.pickedMesh:null,this.groundedPoint=n!=null&&n.hit?n.pickedPoint:null,this.groundedNormal=n!=null&&n.hit?n.getNormal(!0):null,this.groundedAngle=this.groundedNormal!=null?Math.abs(BABYLON.Utilities.GetAngle(this.groundedNormal,this.transform.forward)-90):0,this.gravityForce>0&&(this.verticalVelocity-=this.deltaTime*this.gravityForce),this.isCharacterNavigating===!1&&(this.isCharacterGrounded===!0&&(t=this.maxAngle>0&&this.groundedAngle>0&&this.groundedAngle<this.maxAngle?0:this.slopeForce,this.verticalVelocity=Math.max(-t,this.verticalVelocity),this.isCharacterJumpState===!0&&(this.jumpDelay>0&&(this.jumpTimer=this.jumpDelay+this.deltaTime),this.isCharacterJumpState=!1),this.jumpTimer<=0&&(this.isCharacterJumpFrame=BABYLON.SceneManager.GetKeyboardInput(this.keyboardJump)||BABYLON.SceneManager.GetGamepadButtonInput(this.buttonJump)),this.isCharacterJumpFrame===!0&&(this.isCharacterJumpState=!0,this.verticalVelocity=this.jumpSpeed*.015)),this.movementVelocity.y=this.verticalVelocity,this.onBeforeMoveObservable.hasObservers()===!0&&this.onBeforeMoveObservable.notifyObservers(this.transform),this.abstractMesh.moveWithCollisions(this.movementVelocity)))},i.prototype.pickCheckCollisionsRaycast=function(n){var i=this,t;return(n===void 0&&(n=!0),this.abstractMesh==null)?null:(this.rayLength<=0&&(this.rayLength=.1),t=this.rayLength/this.transform.scaling.y+.05,this.pickingRay==null&&(this.pickingOrigin==null&&(this.pickingOrigin=new BABYLON.Vector3(0,this.rayOrigin,0)),this.pickingRay=new BABYLON.Ray(this.pickingOrigin,this.pickingDirection,t)),this.pickingHelper==null&&(this.pickingHelper=new BABYLON.RayHelper(this.pickingRay),this.pickingOrigin==null&&(this.pickingOrigin=new BABYLON.Vector3(0,this.rayOrigin,0)),this.pickingHelper.attachToMesh(this.abstractMesh,this.pickingDirection,this.pickingOrigin,t),this.showDebugColliders===!0&&this.pickingHelper.show(this.scene,new BABYLON.Color3(1,0,0))),this.pickingRay!=null?this.scene.pickWithRay(this.pickingRay,function(n){return n!=i.abstractMesh&&n.checkCollisions===!0},n):null)},i.prototype.pickCameraCollisionsRaycast=function(n,t,i,r){var u=this;return(r===void 0&&(r=!0),this.abstractMesh==null)?null:(this.cameraRay==null&&(this.cameraRay=new BABYLON.Ray(n,t,i)),this.cameraRay!=null&&(this.cameraRay.origin.copyFrom(n),this.cameraRay.direction.copyFrom(t),this.cameraRay.length=i),this.cameraHelper==null&&(this.cameraHelper=new BABYLON.RayHelper(this.cameraRay),this.showDebugColliders===!0&&this.cameraHelper.show(this.scene,new BABYLON.Color3(1,0,0))),this.cameraRay!=null?this.scene.pickWithRay(this.cameraRay,function(n){return n!=u.abstractMesh&&n.checkCollisions===!0},r):null)},i.prototype.latePlayerController=function(){var e,o,r,u,f,t,i;this.enableInput!==!1&&(e=this.rotateCamera,this.cameraPivot!=null&&(this.playerControl===n.PlayerInputControl.ThirdPersonStrafing||this.playerControl===n.PlayerInputControl.ThirdPersonForward?this.cameraPivotOffset.set(0,this.pivotHeight,0):this.cameraPivotOffset.set(0,this.eyesHeight,0),BABYLON.Utilities.GetAbsolutePositionToRef(this.transform,this.cameraPivot.position,this.cameraPivotOffset),e===!0&&BABYLON.Quaternion.FromEulerAnglesToRef(this.playerRotationVector.x,this.playerRotationVector.y,0,this.cameraPivot.rotationQuaternion)),e===!0&&this.cameraNode!=null&&(this.cameraSmoothing<=0&&(this.cameraSmoothing=5),this.playerControl===n.PlayerInputControl.ThirdPersonStrafing||this.playerControl===n.PlayerInputControl.ThirdPersonForward?this.cameraCollisions===!0?(o=Math.abs(this.boomPosition.z),r=this.cameraNode.parent,this.dollyDirection.scaleToRef(o,this.scaledMaxDirection),this.dollyDirection.scaleToRef(this.cameraDistance,this.scaledCamDirection),BABYLON.Utilities.GetAbsolutePositionToRef(r,this.parentNodePosition),BABYLON.Utilities.TransformPointToRef(r,this.scaledMaxDirection,this.maximumCameraPos),u=!1,f=0,this.characterController!=null?(t=BABYLON.SceneManager.PhysicsShapecastToPoint(this.scene,this.raycastShape,this.parentNodePosition,this.maximumCameraPos,this.raycastGroup,this.raycastMask),u=t!=null&&t.hasHit===!0&&t.collisionObject!=null&&t.collisionObject.entity!=null,f=t!=null&&t.hasHit===!0?t.hitDistance:0):(this.cameraForward.set(0,0,-1),BABYLON.Utilities.TransformPointToRef(r,this.cameraForward,this.cameraForward),this.cameraForward.subtractToRef(this.parentNodePosition,this.cameraDirection),this.cameraDirection.normalize(),i=this.pickCameraCollisionsRaycast(this.parentNodePosition,this.cameraDirection,this.maximumCameraPos.length()),u=i!=null&&i.hit,f=i!=null&&i.distance),u===!0?(this.cameraDistance=BABYLON.Scalar.Clamp(f*this.distanceFactor,this.minimumDistance,o),(this.cameraNode.position.x!==this.scaledCamDirection.x||this.cameraNode.position.y!==this.scaledCamDirection.y||this.cameraNode.position.z!==this.scaledCamDirection.z)&&BABYLON.Vector3.LerpToRef(this.cameraNode.position,this.scaledCamDirection,this.deltaTime*this.cameraSmoothing,this.cameraNode.position)):(this.cameraNode.position.x!==this.boomPosition.x||this.cameraNode.position.y!==this.boomPosition.y||this.cameraNode.position.z!==this.boomPosition.z)&&BABYLON.Vector3.LerpToRef(this.cameraNode.position,this.boomPosition,this.deltaTime*this.cameraSmoothing,this.cameraNode.position)):(this.cameraNode.position.x!==this.boomPosition.x||this.cameraNode.position.y!==this.boomPosition.y||this.cameraNode.position.z!==this.boomPosition.z)&&BABYLON.Vector3.LerpToRef(this.cameraNode.position,this.boomPosition,this.deltaTime*this.cameraSmoothing,this.cameraNode.position):(this.cameraNode.position.x!==0||this.cameraNode.position.y!==0||this.cameraNode.position.z!==0)&&this.cameraNode.position.set(0,0,0)))},i.prototype.afterPlayerController=function(){this.enableInput!==!1&&(this.rootmotionSpeed=0,this.animationState!=null&&this.animationStateMachine===!0&&(this.rootmotionSpeed=this.animationState.getRootMotionSpeed()))},i.prototype.destroyPlayerController=function(){this.cameraPivot=null;this.cameraNode=null;this.animationState=null;this.characterController=null;this.onPreUpdateObservable.clear();this.onPreUpdateObservable=null;this.onBeforeMoveObservable.clear();this.onBeforeMoveObservable=null;this.onPostUpdateObservable.clear();this.onPostUpdateObservable=null},i.prototype.validateAnimationStateParams=function(){this.animationStateParams==null&&(this.animationStateParams={horizontalInput:"Horizontal",verticalInput:"Vertical",mouseXInput:"MouseX",mouseYInput:"MouseY",speedInput:"Speed",jumpedInput:"Jumped",jumpingInput:"Jumping",groundedInput:"Grounded"})},i}(BABYLON.ScriptComponent),i;n.UniversalPlayerController=t,function(n){n[n.FirstPersonStrafing=0]="FirstPersonStrafing";n[n.ThirdPersonStrafing=1]="ThirdPersonStrafing";n[n.ThirdPersonForward=2]="ThirdPersonForward"}(i=n.PlayerInputControl||(n.PlayerInputControl={}))}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.m_particleEmitter=null,t.m_particleSystem=null,t}return __extends(t,n),t.prototype.getParticleEmitter=function(){return this.m_particleEmitter},t.prototype.getParticleSystem=function(){return this.m_particleSystem},t.prototype.awake=function(){var u=BABYLON.SceneManager.GetRootUrl(this.scene),f=this.getProperty("classType",0),i=this.getProperty("base64ParticleSystem"),e=this.getProperty("playOnAwake",!1),r=this.getProperty("particleTexture"),t,n;this.m_particleEmitter=this.getAbstractMesh();this.m_particleEmitter==null&&(this.m_particleEmitter=BABYLON.Mesh.CreateBox(this.transform.name+".Emitter",.25,this.scene),this.m_particleEmitter.parent=this.transform,this.m_particleEmitter.position.set(0,0,0),this.m_particleEmitter.isVisible=!1,this.m_particleEmitter.isPickable=!1,this.m_particleEmitter.material=BABYLON.Utilities.GetColliderMaterial(this.scene));i!=null&&i!==""&&(t=window.atob(i),t!=null&&t!==""&&(n=JSON.parse(t),n!=null&&(n.texture!=null&&r!=null&&(n.texture.name=r.filename,n.texture.url=r.filename),this.m_particleSystem=f===1?BABYLON.GPUParticleSystem.Parse(n,this.scene,u):BABYLON.ParticleSystem.Parse(n,this.scene,u),this.m_particleSystem!=null&&(this.m_particleEmitter!=null&&(this.m_particleSystem.emitter=this.m_particleEmitter),e===!1&&this.m_particleSystem.stop()))))},t.prototype.destroy=function(){this.m_particleEmitter=null;this.m_particleSystem!=null&&(this.m_particleSystem.dispose(),this.m_particleSystem=null)},t}(BABYLON.ScriptComponent);n.FxParticleSystem=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.skyfog=!1,t.skysize=1e3,t.probesize=128,t.reflections=!1,t.reflectlevel=1,t.skytintcolor=new BABYLON.Color3(1,1,1),t.m_skyboxMesh=null,t.m_skyMaterial=null,t.m_reflectProbe=null,t}return __extends(t,n),t.prototype.getSkyboxMesh=function(){return this.m_skyboxMesh},t.prototype.getSkyMaterial=function(){return this.m_skyMaterial},t.prototype.getReflectionProbe=function(){return this.m_reflectProbe},t.prototype.awake=function(){this.awakeSkyboxMaterial()},t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){this.destroySkyboxMaterial()},t.prototype.awakeSkyboxMaterial=function(){var n,t;this.skyfog=this.getProperty("skyfog",this.skyfog);this.skysize=this.getProperty("skysize",this.skysize);this.probesize=this.getProperty("probesize",this.probesize);this.reflections=this.getProperty("reflections",this.reflections);this.reflectlevel=this.getProperty("reflectlevel",this.reflectlevel);n=this.getProperty("tintColor");n!=null&&(this.skytintcolor=BABYLON.Utilities.ParseColor3(n));this.m_skyboxMesh=BABYLON.Mesh.CreateBox("Ambient Skybox",this.skysize,this.scene);this.m_skyboxMesh.position.set(0,0,0);this.m_skyboxMesh.infiniteDistance=!0;this.m_skyboxMesh.applyFog=this.skyfog;this.scene.useRightHandedSystem===!0&&(this.m_skyboxMesh.scaling.x*=-1);this.m_skyMaterial=new BABYLON.SkyMaterial(this.transform.name+".SkyMaterial",this.scene);this.m_skyMaterial.backFaceCulling=!1;this.setSkyboxTintColor(this.skytintcolor);this.m_skyMaterial.luminance=this.getProperty("luminance",this.m_skyMaterial.luminance);this.m_skyMaterial.turbidity=this.getProperty("turbidity",this.m_skyMaterial.turbidity);this.m_skyMaterial.rayleigh=this.getProperty("rayleigh",this.m_skyMaterial.rayleigh);this.m_skyMaterial.mieCoefficient=this.getProperty("miecoefficient",this.m_skyMaterial.mieCoefficient);this.m_skyMaterial.mieDirectionalG=this.getProperty("miedirectionalg",this.m_skyMaterial.mieDirectionalG);this.m_skyMaterial.distance=this.getProperty("distance",this.m_skyMaterial.distance);this.m_skyMaterial.inclination=this.getProperty("inclination",this.m_skyMaterial.inclination);this.m_skyMaterial.azimuth=this.getProperty("azimuth",this.m_skyMaterial.azimuth);t=this.getProperty("cameraoffset");t!=null&&(this.m_skyMaterial.cameraOffset=BABYLON.Utilities.ParseVector3(t));this.m_skyMaterial.useSunPosition=this.getProperty("usesunposition",this.m_skyMaterial.useSunPosition);this.m_skyMaterial.sunPosition=new BABYLON.Vector3(0,50,0);this.scene.metadata!=null&&this.scene.metadata.unity!=null&&this.scene.metadata.unity&&this.scene.metadata.unity.sunposition!=null&&(this.m_skyMaterial.sunPosition=BABYLON.Utilities.ParseVector3(this.scene.metadata.unity.sunposition));this.m_skyboxMesh.material=this.m_skyMaterial;this.reflections===!0&&(this.m_reflectProbe=new BABYLON.ReflectionProbe("Skybox-ReflectionProbe",this.probesize,this.scene),this.m_reflectProbe.renderList.push(this.m_skyboxMesh),this.scene.customRenderTargets.push(this.m_reflectProbe.cubeTexture),this.scene.environmentTexture=this.m_reflectProbe.cubeTexture,this.scene.environmentIntensity=this.reflectlevel)},t.prototype.destroySkyboxMaterial=function(){this.m_skyboxMesh!=null&&(this.m_skyboxMesh.dispose(),this.m_skyboxMesh=null);this.m_reflectProbe!=null&&(this.m_reflectProbe.dispose(),this.m_reflectProbe=null);this.m_skyMaterial!=null&&(this.m_skyMaterial.dispose(),this.m_skyMaterial=null)},t.prototype.setSkyboxTintColor=function(n){for(var t=[],r=this.m_skyboxMesh.getTotalVertices(),i=0;i<r;++i)t.push(n.r,n.g,n.b,1);this.m_skyboxMesh.setVerticesData("color",t);this.m_skyboxMesh.useVertexColors=!0},t}(BABYLON.ScriptComponent);n.SkyMaterialSystem=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.waterTag="Water",t.targetSize=new BABYLON.Vector2(128,128),t.renderSize=new BABYLON.Vector2(512,512),t.depthFactor=1,t.reflectSkybox=!0,t.subDivisions=32,t.heightOffset=1,t.windDirection=new BABYLON.Vector2(0,1),t.windForce=6,t.waveSpeed=1,t.waveLength=.4,t.waveHeight=.4,t.bumpHeight=.4,t.waterColor=new BABYLON.Color3(.1,.1,.6),t.colorBlendFactor=.2,t.waterColor2=new BABYLON.Color3(.1,.1,.6),t.colorBlendFactor2=.2,t.disableClipPlane=!1,t.m_waterGeometry=null,t.m_waterMaterial=null,t}return __extends(t,n),t.prototype.getWaterGeometry=function(){return this.m_waterGeometry},t.prototype.getWaterMaterial=function(){return this.m_waterMaterial},t.prototype.awake=function(){var h=this,e,o,s,i,r,n,u,f,t;this.waterTag=this.getProperty("watertag",this.waterTag);this.depthFactor=this.getProperty("depthfactor",this.depthFactor);this.subDivisions=this.getProperty("subdivisions",this.subDivisions);this.heightOffset=this.getProperty("heightoffset",this.heightOffset);this.reflectSkybox=this.getProperty("reflectskybox",this.reflectSkybox);this.windForce=this.getProperty("windforce",this.windForce);this.waveSpeed=this.getProperty("wavespeed",this.waveSpeed);this.waveLength=this.getProperty("wavelength",this.waveLength);this.waveHeight=this.getProperty("waveheight",this.waveHeight);this.bumpHeight=this.getProperty("bumpheight",this.bumpHeight);this.bumpSuperimpose=this.getProperty("bumpsuperimpose",this.bumpSuperimpose);this.bumpAffectsReflection=this.getProperty("bumpaffectsreflection",this.bumpAffectsReflection);this.colorBlendFactor=this.getProperty("colorblendfactor",this.colorBlendFactor);this.colorBlendFactor2=this.getProperty("colorblendfactor2",this.colorBlendFactor2);this.disableClipPlane=this.getProperty("disableclipplane",this.disableClipPlane);this.fresnelSeparate=this.getProperty("fresnelseparate",this.fresnelSeparate);e=this.getProperty("watercolor");this.waterColor=BABYLON.Utilities.ParseColor3(e);o=this.getProperty("watercolor2");this.waterColor2=BABYLON.Utilities.ParseColor3(o);s=this.getProperty("winddirection");this.windDirection=BABYLON.Utilities.ParseVector2(s);i=this.getProperty("targetsize");i!=null&&(this.targetSize=BABYLON.Utilities.ParseVector2(i));r=this.getProperty("rendersize");r!=null&&(this.renderSize=BABYLON.Utilities.ParseVector2(r));n=null;u=this.getProperty("bumptexture");u!=null&&(n=BABYLON.Utilities.ParseTexture(u,this.scene));n!=null?(this.m_waterMaterial=new BABYLON.WaterMaterial(this.transform.name+".Water",this.scene,this.renderSize),this.m_waterMaterial.bumpTexture=n,this.m_waterMaterial.windDirection=this.windDirection,this.m_waterMaterial.windForce=this.windForce,this.m_waterMaterial.waveSpeed=this.waveSpeed,this.m_waterMaterial.waveLength=this.waveLength,this.m_waterMaterial.waveHeight=this.waveHeight,this.m_waterMaterial.bumpHeight=this.bumpHeight,this.m_waterMaterial.bumpSuperimpose=this.bumpSuperimpose,this.m_waterMaterial.bumpAffectsReflection=this.bumpAffectsReflection,this.m_waterMaterial.waterColor=this.waterColor,this.m_waterMaterial.colorBlendFactor=this.colorBlendFactor,this.m_waterMaterial.waterColor2=this.waterColor2,this.m_waterMaterial.colorBlendFactor2=this.colorBlendFactor2,this.m_waterMaterial.disableClipPlane=this.disableClipPlane,this.m_waterMaterial.fresnelSeparate=this.fresnelSeparate,this.reflectSkybox===!0&&(f=BABYLON.SceneManager.GetAmbientSkybox(this.scene),f!=null&&this.m_waterMaterial.addToRenderList(f)),this.waterTag!=null&&this.waterTag!==""&&(t=this.scene.getMeshesByTags(this.waterTag),t!=null&&t.length>0&&t.forEach(function(n){h.m_waterMaterial.addToRenderList(n)})),this.m_waterGeometry=BABYLON.Mesh.CreateGround(this.transform.name+".WaterMesh",this.targetSize.x,this.targetSize.y,this.subDivisions,this.scene,!1),this.m_waterGeometry.parent=this.transform,this.m_waterGeometry.position.set(0,this.heightOffset,0),this.depthFactor>0&&(this.m_waterGeometry.scaling.y*=this.depthFactor),this.m_waterGeometry.material=this.m_waterMaterial):BABYLON.Tools.Warn("No supported water bump texture for: "+this.transform.name)},t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.WaterMaterialSystem=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){var u,f;return r===void 0&&(r={}),u=n.call(this,t,i,r)||this,u.smoothFollow=0,u.smoothRotate=0,u.matchRotation=!1,u.followTarget=null,u.targetPosition=BABYLON.Vector3.Zero(),u.targetRotation=BABYLON.Quaternion.Zero(),u.smoothFollow=u.getProperty("smoothFollow",u.smoothFollow),u.smoothRotate=u.getProperty("smoothRotate",u.smoothRotate),u.matchRotation=u.getProperty("matchRotation",u.matchRotation),f=u.getProperty("followTarget"),f!=null&&(u.followTarget=BABYLON.Utilities.ParseTransformByID(f,u.scene),u.followTarget!=null&&BABYLON.Utilities.ValidateTransformQuaternion(u.followTarget)),BABYLON.Utilities.ValidateTransformQuaternion(u.transform),u}return __extends(t,n),t.prototype.start=function(){console.log("Starting simple follow target for: "+this.transform.name)},t.prototype.late=function(){if(this.followTarget!=null){var n=this.getDeltaSeconds();BABYLON.Utilities.GetAbsolutePositionToRef(this.followTarget,this.targetPosition);this.targetRotation.copyFrom(this.followTarget.absoluteRotationQuaternion);this.smoothFollow>0?BABYLON.Vector3.LerpToRef(this.transform.position,this.targetPosition,n*this.smoothFollow,this.transform.position):this.transform.position.copyFrom(this.targetPosition);this.matchRotation===!0&&(this.smoothRotate>0?BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.targetRotation,n*this.smoothRotate,this.transform.rotationQuaternion):this.transform.rotationQuaternion.copyFrom(this.targetRotation))}},t}(BABYLON.ScriptComponent);n.SimpleFollowCamera=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){var u,f;return r===void 0&&(r={}),u=n.call(this,t,i,r)||this,u.target=null,u.targetHeight=1.75,u.followHeight=1.75,u.heightDamping=12,u.rotationDamping=3,u.minimumDistance=6,u.maximumDistance=8,u.startBehindTarget=!0,u.followBehindTarget=!0,u.targetPosition=BABYLON.Vector3.Zero(),u.targetAngles=new BABYLON.Vector3(0,0,0),u.transformAngles=new BABYLON.Vector3(0,0,0),u.positionBuffer=new BABYLON.Vector3(0,0,0),u.rotationBuffer=new BABYLON.Quaternion(0,0,0,1),u.tempRotationBuffer=new BABYLON.Vector3(0,0,0),u.targetHeight=u.getProperty("targetHeight",u.targetHeight),u.followHeight=u.getProperty("followHeight",u.followHeight),u.heightDamping=u.getProperty("heightDamping",u.heightDamping),u.rotationDamping=u.getProperty("rotationDamping",u.rotationDamping),u.minimumDistance=u.getProperty("minimumDistance",u.minimumDistance),u.maximumDistance=u.getProperty("maximumDistance",u.maximumDistance),u.startBehindTarget=u.getProperty("startBehindTarget",u.startBehindTarget),u.followBehindTarget=u.getProperty("followBehindTarget",u.followBehindTarget),u.rotationDamping<=0&&(u.rotationDamping=3),u.heightDamping<=0&&(u.heightDamping=12),f=u.getProperty("target"),f!=null&&(u.target=BABYLON.Utilities.ParseTransformByID(f,u.scene)),u}return __extends(t,n),t.prototype.start=function(){this.target!=null&&this.startBehindTarget===!0},t.prototype.late=function(){var n;if(this.target!=null){if(this.targetPosition.copyFrom(this.target.position),this.followBehindTarget===!0){n=this.getDeltaSeconds();BABYLON.Utilities.ToEulerToRef(this.target.rotationQuaternion,this.targetAngles);BABYLON.Utilities.ToEulerToRef(this.transform.rotationQuaternion,this.transformAngles);var t=this.targetPosition.y+this.followHeight,i=BABYLON.Scalar.Lerp(this.transform.position.y,t,this.heightDamping*n),r=this.targetAngles.y,u=BABYLON.Scalar.LerpAngle(this.transformAngles.y,r,this.rotationDamping*n),f=BABYLON.Scalar.Lerp(this.minimumDistance,this.maximumDistance,1);BABYLON.Utilities.FromEulerToRef(0,u,0,this.rotationBuffer);BABYLON.Utilities.MultiplyQuaternionByVectorToRef(this.rotationBuffer,BABYLON.Vector3.Forward(),this.tempRotationBuffer);this.tempRotationBuffer.scaleInPlace(f);this.positionBuffer.copyFrom(this.targetPosition);this.positionBuffer.subtractInPlace(this.tempRotationBuffer);this.transform.position.set(this.positionBuffer.x,i,this.positionBuffer.z)}this.targetPosition.y+=this.targetHeight;this.transform.lookAt(this.targetPosition)}},t.prototype.destroy=function(){this.target=null;this.targetAngles=null;this.transformAngles=null;this.positionBuffer=null;this.rotationBuffer=null;this.tempRotationBuffer=null},t}(BABYLON.ScriptComponent);n.SmoothFollowTarget=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){var u,f;r===void 0&&(r={});u=n.call(this,t,i,r)||this;u._waypointMeshLines=null;u._waypointSplineCurve=null;u._waypointTransformNodes=null;u._waypointSplinePositions=null;u._waypointSphereMaterial=null;u.resolution=1;u.closedLoop=!0;u.drawLines=!1;u.drawPoints=!1;u.drawTraces=!1;u.pointSize=.5;u.lineHeight=.25;u.lineColor=new BABYLON.Color3(1,1,1);u.pointColor=new BABYLON.Color3(1,1,1);u.traceColor=new BABYLON.Color3(1,1,1);u.resolution=u.getProperty("resolution",u.resolution);u.closedLoop=u.getProperty("closedLoop",u.closedLoop);u.drawLines=u.getProperty("drawLines",u.drawLines);u.drawPoints=u.getProperty("drawPoints",u.drawPoints);u.drawTraces=u.getProperty("drawTraces",u.drawTraces);u.pointSize=u.getProperty("pointSize",u.pointSize);u.lineHeight=u.getProperty("lineHeight",u.lineHeight);var e=u.getProperty("lineColor"),o=u.getProperty("pointColor"),s=u.getProperty("traceColor");return u.lineColor=BABYLON.Utilities.ParseColor3(e,u.lineColor),u.pointColor=BABYLON.Utilities.ParseColor3(o,u.pointColor),u.traceColor=BABYLON.Utilities.ParseColor3(s,u.traceColor),u._waypointSphereMaterial=new BABYLON.StandardMaterial(u.transform.name+".SplineMaterial",u.scene),u._waypointSphereMaterial.diffuseColor=u.pointColor,u._waypointTransformNodes=u.transform.getChildren(null,!0),u._waypointTransformNodes!=null&&u._waypointTransformNodes.length>0&&(f=[],u._waypointTransformNodes.forEach(function(n){if(BABYLON.Utilities.ValidateTransformQuaternion(n),f.push(BABYLON.Utilities.GetAbsolutePosition(n)),u.drawPoints===!0){var t=BABYLON.MeshBuilder.CreateSphere(n.name+".WireSphere",{segments:24,diameter:u.pointSize*2},u.scene);t.parent=n;t.position.set(0,0,0);t.visibility=.25;t.isVisible=!0;t.material=u._waypointSphereMaterial}}),u._waypointSplineCurve=BABYLON.Curve3.CreateCatmullRomSpline(f,u.resolution,u.closedLoop),u._waypointSplineCurve!=null&&(u._waypointSplinePositions=u._waypointSplineCurve.getPoints()),u._waypointSplinePositions!=null&&console.warn("DEBUG: Waypoint Manager - "+u.transform.name+": ("+u._waypointTransformNodes.length+" - "+u._waypointSplinePositions.length+" - "+u._waypointSplineCurve.length().toFixed(2)+")")),u}return __extends(t,n),t.prototype.getSplineCurve=function(){return this._waypointSplineCurve},t.prototype.getSplineCurveLength=function(){return this._waypointSplineCurve!=null?this._waypointSplineCurve.length():0},t.prototype.getSplineCurvePositions=function(){return this._waypointSplinePositions},t.prototype.getControlPointTransforms=function(){return this._waypointTransformNodes},t.prototype.start=function(){this._waypointSplinePositions!=null&&this.drawLines===!0&&(this._waypointMeshLines=BABYLON.MeshBuilder.CreateLines(this.transform.name+".SplineMesh",{points:this._waypointSplinePositions},this.scene),this._waypointMeshLines.parent=this.transform,this._waypointMeshLines.color=this.lineColor,this._waypointMeshLines.position.y+=this.lineHeight)},t.prototype.destroy=function(){this.lineColor=null;this._waypointSplineCurve=null;this._waypointTransformNodes=null;this._waypointSplinePositions=null;this._waypointMeshLines!=null&&(this._waypointMeshLines.dispose(),this._waypointMeshLines=null)},t}(BABYLON.ScriptComponent);n.WaypointTargetManager=t}(PROJECT||(PROJECT={})),function(n){var t=function(){function n(){}return n.rand_vect=function(){var n=Math.random()*2*Math.PI;return{x:Math.cos(n),y:Math.sin(n)}},n.dot_prod_grid=function(t,i,r,u){var f,e={x:t-r,y:i-u};return n.gradients[[r,u]]?f=n.gradients[[r,u]]:(f=n.rand_vect(),n.gradients[[r,u]]=f),e.x*f.x+e.y*f.y},n.smootherstep=function(n){return 6*Math.pow(n,5)-15*Math.pow(n,4)+10*Math.pow(n,3)},n.interp=function(t,i,r){return i+n.smootherstep(t)*(r-i)},n.seed=function(){n.gradients={}},n.generate=function(t,i){var r=Math.floor(t),u=Math.floor(i),f=n.dot_prod_grid(t,i,r,u),e=n.dot_prod_grid(t,i,r+1,u),o=n.dot_prod_grid(t,i,r,u+1),s=n.dot_prod_grid(t,i,r+1,u+1),h=n.interp(t-r,f,e),c=n.interp(t-r,o,s);return n.interp(i-u,h,c)},n.gradients={},n}();n.PerlinNoiseGenerator=t}(BABYLON||(BABYLON={}));BABYLON.PerlinNoiseGenerator.seed(),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.m_bodyMaterial=null,t.m_bodyAbtractMesh=null,t}return __extends(t,n),t.prototype.awake=function(){var i=this.getProperty("mainMaterialIndex",0),u=this.getProperty("mainBodyTransform"),f=this.getProperty("mainBodyPaintColor"),e=BABYLON.Utilities.ParseColor3(f,BABYLON.Color3.White()),n,t,r;u!=null&&(this.m_bodyAbtractMesh=BABYLON.Utilities.ParseChildTransform(this.transform,u),this.m_bodyAbtractMesh!=null?(this.m_bodyAbtractMesh.material instanceof BABYLON.MultiMaterial?(n=this.m_bodyAbtractMesh.material,n.subMaterials!=null&&n.subMaterials.length>i&&(t=n.clone(n.name+"."+this.transform.name),r=t.subMaterials[i],t.subMaterials[i]=r.clone(r.name+"."+this.transform.name),this.m_bodyMaterial=t.subMaterials[i],this.m_bodyAbtractMesh.material=t)):(this.m_bodyMaterial=this.m_bodyAbtractMesh.material.clone(this.m_bodyAbtractMesh.material.name+"."+this.transform.name),this.m_bodyAbtractMesh.material=this.m_bodyMaterial),this.m_bodyMaterial!=null&&(this.m_bodyMaterial.isFrozen&&this.m_bodyMaterial.unfreeze(),this.m_bodyMaterial.albedoColor.copyFrom(e),this.m_bodyMaterial.freeze())):BABYLON.Tools.Warn("Failed to find auto body mesh for: "+this.transform.name))},t.prototype.setupVehicleMaterials=function(n,t,i,r){t===void 0&&(t=null);i===void 0&&(i=0);r===void 0&&(r=0);this.m_bodyMaterial!=null&&(this.m_bodyMaterial.isFrozen&&this.m_bodyMaterial.unfreeze(),this.m_bodyMaterial.albedoColor.copyFrom(n),this.m_bodyMaterial.freeze())},t}(BABYLON.ScriptComponent);n.AutoBodyGarage=t}(PROJECT||(PROJECT={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.countdownState=0,n.countdownImage1=null,n.countdownImage2=null,n.countdownImage3=null,n.countdownImageGo=null,n.countdownImagesLoaded=!1,n.countdownSound1=null,n.countdownSound2=null,n.countdownSound3=null,n.countdownSoundGo=null,n.countdownSoundsLoaded=!1,n.mustangOneVehicle=null,n.mustangTwoVehicle=null,n.mustangThreeVehicle=null,n.mustangFourVehicle=null,n.startPositionHeight=0,n.startCountdownVolume=.5,n}return __extends(i,t),i.prototype.awake=function(){this.awakeDemoController()},i.prototype.start=function(){this.initDemoController()},i.prototype.update=function(){this.updateDemoController()},i.prototype.awakeDemoController=function(){this.startPositionHeight=this.getProperty("startHeight",this.startPositionHeight);this.startCountdownVolume=this.getProperty("startVolume",this.startCountdownVolume)},i.prototype.initDemoController=function(){return __awaiter(this,void 0,void 0,function(){var a,r,s,h,c,l,v,y,p,w,k,b,d,g,nt,tt,it,rt,ut,ft,u,e,t,o,i,f=this;return __generator(this,function(et){switch(et.label){case 0:return a=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,this.scene),r=BABYLON.Scalar.Clamp(parseInt(BABYLON.Utilities.GetUrlParameter("players")||"0"),0,4),r>=2&&n.UniversalCameraSystem.IsMultiPlayerView()&&n.UniversalCameraSystem.SetMultiPlayerViewLayout(this.scene,r),s=BABYLON.SceneManager.GetAbstractMesh(this.scene,"Start Position 1"),s==null&&(s=BABYLON.Mesh.CreateBox("Start Position 1",1,this.scene)),BABYLON.Utilities.ValidateTransformQuaternion(s),s.isVisible=!1,h=BABYLON.SceneManager.GetAbstractMesh(this.scene,"Start Position 2"),h==null&&(h=BABYLON.Mesh.CreateBox("Start Position 2",1,this.scene)),BABYLON.Utilities.ValidateTransformQuaternion(h),h.isVisible=!1,c=BABYLON.SceneManager.GetAbstractMesh(this.scene,"Start Position 3"),c==null&&(c=BABYLON.Mesh.CreateBox("Start Position 3",1,this.scene)),BABYLON.Utilities.ValidateTransformQuaternion(c),c.isVisible=!1,l=BABYLON.SceneManager.GetAbstractMesh(this.scene,"Start Position 4"),l==null&&(l=BABYLON.Mesh.CreateBox("Start Position 4",1,this.scene)),BABYLON.Utilities.ValidateTransformQuaternion(l),l.isVisible=!1,v=BABYLON.SceneManager.GetAbstractMesh(this.scene,"Start Position 5"),v==null&&(v=BABYLON.Mesh.CreateBox("Start Position 5",1,this.scene)),BABYLON.Utilities.ValidateTransformQuaternion(v),v.isVisible=!1,y=BABYLON.SceneManager.GetAbstractMesh(this.scene,"Start Position 6"),y==null&&(y=BABYLON.Mesh.CreateBox("Start Position 6",1,this.scene)),BABYLON.Utilities.ValidateTransformQuaternion(y),y.isVisible=!1,p=BABYLON.SceneManager.GetAbstractMesh(this.scene,"Start Position 7"),p==null&&(p=BABYLON.Mesh.CreateBox("Start Position 7",1,this.scene)),BABYLON.Utilities.ValidateTransformQuaternion(p),p.isVisible=!1,w=BABYLON.SceneManager.GetAbstractMesh(this.scene,"Start Position 8"),w==null&&(w=BABYLON.Mesh.CreateBox("Start Position 8",1,this.scene)),BABYLON.Utilities.ValidateTransformQuaternion(w),w.isVisible=!1,k=BABYLON.SceneManager.GetRootUrl(this.scene),[4,BABYLON.SceneLoader.LoadAssetContainerAsync(k,"MustangPrefab.gltf",this.scene)];case 1:return b=et.sent(),d=r>=4?4:0,g=r>=4,this.mustangOneVehicle=n.DemoRaceController.CreateMustangVehicle(this.scene,b,"Mustang","MustangOne",d,s,this.startPositionHeight,!0,g,160,1.5,10,BABYLON.Color3.White()),nt=r>=3?3:0,tt=r>=3,this.mustangTwoVehicle=n.DemoRaceController.CreateMustangVehicle(this.scene,b,"Mustang","MustangTwo",nt,h,this.startPositionHeight,!0,tt,160,1.4,6,BABYLON.Color3.Blue()),it=r>=2?2:0,rt=r>=2,this.mustangThreeVehicle=n.DemoRaceController.CreateMustangVehicle(this.scene,b,"Mustang","MustangThree",it,c,this.startPositionHeight,!0,rt,160,1.6,8,BABYLON.Color3.Black()),ut=r>=1?1:0,ft=!0,this.mustangFourVehicle=n.DemoRaceController.CreateMustangVehicle(this.scene,b,"Mustang","MustangFour",ut,l,this.startPositionHeight,!0,ft,161,1.66,10,BABYLON.Color3.Red()),u=BABYLON.SceneManager.GetRootUrl(this.scene),e=this.getProperty("countdownImages"),e!=null&&e.length>0?(t=e[0],this.countdownImage1=new BABYLON.GUI.Image("image_"+t.name,u+t.filename),this.countdownImage1.isVisible=!1,this.countdownImage1.width="50%",this.countdownImage1.height="50%",a.addControl(this.countdownImage1),t=e[1],this.countdownImage2=new BABYLON.GUI.Image("image_"+t.name,u+t.filename),this.countdownImage2.isVisible=!1,this.countdownImage2.width="50%",this.countdownImage2.height="50%",a.addControl(this.countdownImage2),t=e[2],this.countdownImage3=new BABYLON.GUI.Image("image_"+t.name,u+t.filename),this.countdownImage3.isVisible=!1,this.countdownImage3.width="50%",this.countdownImage3.height="50%",a.addControl(this.countdownImage3),t=e[3],this.countdownImageGo=new BABYLON.GUI.Image("image_"+t.name,u+t.filename),this.countdownImageGo.isVisible=!1,this.countdownImageGo.width="50%",this.countdownImageGo.height="50%",a.addControl(this.countdownImageGo)):BABYLON.SceneManager.ShowPageErrorMessage("No countdown images specified"),o=this.getProperty("countdownSounds"),o!=null&&o.length>0?(i=o[0],this.countdownSound1=new BABYLON.Sound("sound_"+i.name,u+i.filename,this.scene,function(){f.countdownSound1.setVolume(f.startCountdownVolume)}),i=o[1],this.countdownSound2=new BABYLON.Sound("sound_"+i.name,u+i.filename,this.scene,function(){f.countdownSound2.setVolume(f.startCountdownVolume)}),i=o[2],this.countdownSound3=new BABYLON.Sound("sound_"+i.name,u+i.filename,this.scene,function(){f.countdownSound3.setVolume(f.startCountdownVolume)}),i=o[3],this.countdownSoundGo=new BABYLON.Sound("sound_"+i.name,u+i.filename,this.scene,function(){f.countdownSoundGo.setVolume(f.startCountdownVolume)})):BABYLON.SceneManager.ShowPageErrorMessage("No countdown sounds specified"),[2]}})})},i.prototype.updateDemoController=function(){this.countdownImagesLoaded===!1&&this.countdownImage1!=null&&this.countdownImage2!=null&&this.countdownImage3!=null&&this.countdownImageGo!=null&&(this.countdownImagesLoaded=this.countdownImage1.isLoaded&&this.countdownImage2.isLoaded&&this.countdownImage3.isLoaded&&this.countdownImageGo.isLoaded);this.countdownSoundsLoaded===!1&&this.countdownSound1!=null&&this.countdownSound2!=null&&this.countdownSound3!=null&&this.countdownSoundGo!=null&&(this.countdownSoundsLoaded=this.countdownSound1.isReady()&&this.countdownSound2.isReady()&&this.countdownSound3.isReady()&&this.countdownSoundGo.isReady());this.countdownState===0&&this.countdownImagesLoaded===!0&&this.countdownSoundsLoaded===!0&&(BABYLON.SceneManager.ShowSceneLoader(!1),this.countdownState=1,this.processNextCountdown(1e3))},i.prototype.updateNextCountdown=function(){this.hideCountdownItems();switch(this.countdownState){case 1:this.countdownState=2;this.countdownImage3.isVisible=!0;this.countdownSound3.play();this.processNextCountdown(1e3);break;case 2:this.countdownState=3;this.countdownImage2.isVisible=!0;this.countdownSound2.play();this.processNextCountdown(1e3);break;case 3:this.countdownState=4;this.countdownImage1.isVisible=!0;this.countdownSound1.play();this.processNextCountdown(1e3);break;case 4:this.countdownState=5;this.countdownImageGo.isVisible=!0;this.countdownSoundGo.play();this.processNextCountdown(500);break;default:this.startDemoController()}},i.prototype.processNextCountdown=function(n){var t=this;BABYLON.SceneManager.SetTimeout(n,function(){t.updateNextCountdown()})},i.prototype.hideCountdownItems=function(){this.countdownImage1.isVisible&&(this.countdownImage1.isVisible=!1);this.countdownImage2.isVisible&&(this.countdownImage2.isVisible=!1);this.countdownImage3.isVisible&&(this.countdownImage3.isVisible=!1);this.countdownImageGo.isVisible&&(this.countdownImageGo.isVisible=!1)},i.prototype.killCountdownItems=function(){this.countdownImage1!=null&&(this.countdownImage1.dispose(),this.countdownImage1=null);this.countdownImage2!=null&&(this.countdownImage2.dispose(),this.countdownImage2=null);this.countdownImage3!=null&&(this.countdownImage3.dispose(),this.countdownImage3=null);this.countdownImageGo!=null&&(this.countdownImageGo.dispose(),this.countdownImageGo=null);this.countdownSound1!=null&&(this.countdownSound1.dispose(),this.countdownSound1=null);this.countdownSound2!=null&&(this.countdownSound2.dispose(),this.countdownSound2=null);this.countdownSound3!=null&&(this.countdownSound3.dispose(),this.countdownSound3=null);this.countdownSoundGo!=null&&(this.countdownSoundGo.dispose(),this.countdownSoundGo=null)},i.prototype.startDemoController=function(){this.hideCountdownItems();this.killCountdownItems();this.mustangOneVehicle!=null&&n.DemoRaceController.EnableMustangVehicle(this.mustangOneVehicle,!0);this.mustangTwoVehicle!=null&&n.DemoRaceController.EnableMustangVehicle(this.mustangTwoVehicle,!0);this.mustangThreeVehicle!=null&&n.DemoRaceController.EnableMustangVehicle(this.mustangThreeVehicle,!0);this.mustangFourVehicle!=null&&n.DemoRaceController.EnableMustangVehicle(this.mustangFourVehicle,!0)},i.CreateMustangVehicle=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w;if(v===void 0&&(v=null),y===void 0&&(y=0),p===void 0&&(p=0),w=BABYLON.SceneManager.InstantiatePrefab(t,i,r),w!=null){w.rotationQuaternion=f.rotationQuaternion.clone();w.position=f.position.clone();w.position.y+=e;var g=BABYLON.SceneManager.FindScriptComponent(w,"PROJECT.AutoBodyGarage"),k=BABYLON.SceneManager.FindScriptComponent(w,"PROJECT.VehicleInputController"),d=BABYLON.SceneManager.FindScriptComponent(w,"PROJECT.VehicleCameraManager"),b=BABYLON.SceneManager.FindScriptComponent(w,"PROJECT.StandardCarController");g!=null&&g.setupVehicleMaterials(a,v,y,p);b!=null&&(b.lowSpeedAngle=u===0?20:10,b.highSpeedAngle=u===0?10:1,b.topEngineSpeed=h,b.powerCoefficient=c);k!=null&&(k.enableInput=!1,k.playerNumber=u,k.driverSkillLevel=l);d!=null&&s===!0&&(d.enableCamera=!0,d.attachPlayerCamera(u))}else BABYLON.Tools.Warn("===> Failed to instantiate mustang prefab: "+r);return w},i.EnableMustangVehicle=function(n,t){var i=BABYLON.SceneManager.FindScriptComponent(n,"PROJECT.VehicleInputController");i!=null&&(i.enableInput=t)},i}(BABYLON.ScriptComponent);n.DemoRaceController=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.trackNodes=null,t.raceLineData_1=null,t.raceLineData_2=null,t.raceLineData_3=null,t.raceLineData_4=null,t.raceLineData_5=null,t.raceLineColor_1=null,t.raceLineColor_2=null,t.raceLineColor_3=null,t.raceLineColor_4=null,t.raceLineColor_5=null,t.debugMeshLines_1=null,t.debugMeshLines_2=null,t.debugMeshLines_3=null,t.debugMeshLines_4=null,t.debugMeshLines_5=null,t.drawDebugLines=!1,t}return __extends(t,n),t.prototype.getTrackNodes=function(){return this.trackNodes},t.prototype.getControlPoints=function(n){var t=null;switch(n){case 0:t=this.raceLineData_1;break;case 1:t=this.raceLineData_2;break;case 2:t=this.raceLineData_3;break;case 3:t=this.raceLineData_4;break;case 4:t=this.raceLineData_5}return t},t.prototype.awake=function(){this.trackNodes=this.getProperty("TrackNodes",this.trackNodes);this.raceLineData_1=this.getProperty("RaceLineData_1",this.raceLineData_1);this.raceLineData_2=this.getProperty("RaceLineData_2",this.raceLineData_2);this.raceLineData_3=this.getProperty("RaceLineData_3",this.raceLineData_3);this.raceLineData_4=this.getProperty("RaceLineData_4",this.raceLineData_4);this.raceLineData_5=this.getProperty("RaceLineData_5",this.raceLineData_5);this.raceLineColor_1=this.getProperty("RaceLineColor_1",this.raceLineColor_1);this.raceLineColor_2=this.getProperty("RaceLineColor_2",this.raceLineColor_2);this.raceLineColor_3=this.getProperty("RaceLineColor_3",this.raceLineColor_3);this.raceLineColor_4=this.getProperty("RaceLineColor_4",this.raceLineColor_4);this.raceLineColor_5=this.getProperty("RaceLineColor_5",this.raceLineColor_5);this.drawDebugLines=this.getProperty("DrawDebugLines",this.drawDebugLines)},t.prototype.start=function(){var i=this;if(this.drawDebugLines===!0){var n=0,r=.5,t=new BABYLON.TransformNode(this.transform.name+".DebugLines",this.scene);if(t.position.set(0,0,0),t.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),this.trackNodes!=null&&this.trackNodes.length>0){var g=[],nt=BABYLON.Color3.White(),u=new BABYLON.StandardMaterial(this.transform.name+".NodeMaterial",this.scene);u.diffuseColor=nt;n=0;this.trackNodes.forEach(function(f){var o=new BABYLON.Vector3(f.position.x,f.position.y,f.position.z),s=new BABYLON.Quaternion(f.rotation.x,f.rotation.y,f.rotation.z,f.rotation.w),e;g.push(o);e=BABYLON.MeshBuilder.CreateCylinder(i.transform.name+".TrackNode_"+n,{diameterTop:0,diameterBottom:r*2,height:2},i.scene);e.parent=t;e.position.copyFrom(o);e.position.y+=.5;e.rotationQuaternion=s.multiply(BABYLON.Utilities.FromEuler(90,0,0));e.material=u;n++})}if(this.raceLineData_5!=null&&this.raceLineData_5.length>0){var f=[],e=this.raceLineColor_5!=null?new BABYLON.Color3(this.raceLineColor_5.r,this.raceLineColor_5.g,this.raceLineColor_5.b):BABYLON.Color3.White(),o=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_5",this.scene);o.diffuseColor=e;n=0;this.raceLineData_5.forEach(function(u){var s=new BABYLON.Vector3(u.position.x,u.position.y,u.position.z),e;f.push(s);e=BABYLON.MeshBuilder.CreateSphere(i.transform.name+".ControlPoint_5_"+n,{segments:24,diameter:r*2},i.scene);e.parent=t;e.position.copyFrom(s);e.position.y+=.5;e.material=o;n++});this.debugMeshLines_5=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_5",{points:f},this.scene);this.debugMeshLines_5.parent=t;this.debugMeshLines_5.position.y+=.5;this.debugMeshLines_5.color=e}if(this.raceLineData_4!=null&&this.raceLineData_4.length>0){var s=[],h=this.raceLineColor_4!=null?new BABYLON.Color3(this.raceLineColor_4.r,this.raceLineColor_4.g,this.raceLineColor_4.b):BABYLON.Color3.White(),c=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_4",this.scene);c.diffuseColor=h;n=0;this.raceLineData_4.forEach(function(u){var e=new BABYLON.Vector3(u.position.x,u.position.y,u.position.z),f;s.push(e);f=BABYLON.MeshBuilder.CreateSphere(i.transform.name+".ControlPoint_4_"+n,{segments:24,diameter:r*2},i.scene);f.parent=t;f.position.copyFrom(e);f.position.y+=.5;f.material=c;n++});this.debugMeshLines_4=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_4",{points:s},this.scene);this.debugMeshLines_4.parent=t;this.debugMeshLines_4.position.y+=.5;this.debugMeshLines_4.color=h}if(this.raceLineData_3!=null&&this.raceLineData_3.length>0){var l=[],a=this.raceLineColor_3!=null?new BABYLON.Color3(this.raceLineColor_3.r,this.raceLineColor_3.g,this.raceLineColor_3.b):BABYLON.Color3.White(),v=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_3",this.scene);v.diffuseColor=a;n=0;this.raceLineData_3.forEach(function(u){var e=new BABYLON.Vector3(u.position.x,u.position.y,u.position.z),f;l.push(e);f=BABYLON.MeshBuilder.CreateSphere(i.transform.name+".ControlPoint_3_"+n,{segments:24,diameter:r*2},i.scene);f.parent=t;f.position.copyFrom(e);f.position.y+=.5;f.material=v;n++});this.debugMeshLines_3=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_3",{points:l},this.scene);this.debugMeshLines_3.parent=t;this.debugMeshLines_3.position.y+=.5;this.debugMeshLines_3.color=a}if(this.raceLineData_2!=null&&this.raceLineData_2.length>0){var y=[],p=this.raceLineColor_2!=null?new BABYLON.Color3(this.raceLineColor_2.r,this.raceLineColor_2.g,this.raceLineColor_2.b):BABYLON.Color3.White(),w=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_2",this.scene);w.diffuseColor=p;n=0;this.raceLineData_2.forEach(function(u){var e=new BABYLON.Vector3(u.position.x,u.position.y,u.position.z),f;y.push(e);f=BABYLON.MeshBuilder.CreateSphere(i.transform.name+".ControlPoint_2_"+n,{segments:24,diameter:r*2},i.scene);f.parent=t;f.position.copyFrom(e);f.position.y+=.5;f.material=w;n++});this.debugMeshLines_2=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_2",{points:y},this.scene);this.debugMeshLines_2.parent=t;this.debugMeshLines_2.position.y+=.5;this.debugMeshLines_2.color=p}if(this.raceLineData_1!=null&&this.raceLineData_1.length>0){var b=[],k=this.raceLineColor_1!=null?new BABYLON.Color3(this.raceLineColor_1.r,this.raceLineColor_1.g,this.raceLineColor_1.b):BABYLON.Color3.White(),d=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_1",this.scene);d.diffuseColor=k;n=0;this.raceLineData_1.forEach(function(u){var e=new BABYLON.Vector3(u.position.x,u.position.y,u.position.z),f;b.push(e);f=BABYLON.MeshBuilder.CreateSphere(i.transform.name+".ControlPoint_1_"+n,{segments:24,diameter:r*2},i.scene);f.parent=t;f.position.copyFrom(e);f.position.y+=.5;f.material=d;n++});this.debugMeshLines_1=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_1",{points:b},this.scene);this.debugMeshLines_1.parent=t;this.debugMeshLines_1.position.y+=.5;this.debugMeshLines_1.color=k}}},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.RaceTrackManager=t}(PROJECT||(PROJECT={})),function(n){var t=function(){function n(){this.Pos=BABYLON.Vector3.Zero();this.Normal=BABYLON.Vector3.Zero();this.Tangent=BABYLON.Vector4.Zero();this.Posl=BABYLON.Vector3.Zero();this.Posr=BABYLON.Vector3.Zero();this.Intensity=0;this.LastIndex=-1}return n}(),i;n.SkidMarkSection=t;i=function(n){function i(t,r,u){u===void 0&&(u={});var f=n.call(this,t,r,u)||this;return i.MAX_MARKS=f.getProperty("maxSections",i.MAX_MARKS),i.MARK_COLOR=BABYLON.Utilities.ParseColor3(f.getProperty("textureColor"),i.MARK_COLOR),i.MARK_WIDTH=f.getProperty("textureWidth",i.MARK_WIDTH),i.GROUND_OFFSET=f.getProperty("groundOffset",i.GROUND_OFFSET),i.GPU_TRIANGLES=f.getProperty("gpuQuadIndices",i.GPU_TRIANGLES),i.TEXTURE_MARKS=f.getProperty("textureMarks",i.TEXTURE_MARKS),i.TEX_INTENSITY=f.getProperty("textureIntensity",i.TEX_INTENSITY),i.MIN_DISTANCE=f.getProperty("textureDistance",i.MIN_DISTANCE),i.MIN_SQR_DISTANCE=i.MIN_DISTANCE*i.MIN_DISTANCE,f}return __extends(i,n),i.prototype.start=function(){i.CreateSkidMarkManager(this.scene)},i.prototype.update=function(){i.UpdateSkidMarkManager()},i.AddSkidMarkSegment=function(n,t,r,u){var o,f,e,s;if(i.SkidMarkMesh==null)return null;if(i.TempVector3_POS.set(0,0,0),i.TempVector3_DIR.set(0,0,0),i.TempVector3_XDIR.set(0,0,0),i.TempVector3_SDIR.set(0,0,0),r>1)r=1;else if(r<0)return-1;return u>0&&(n.subtractToRef(i.SkidMarkSections[u].Pos,i.TempVector3_POS),o=i.TempVector3_POS.lengthSquared(),o<i.MIN_SQR_DISTANCE)?u:(f=i.SkidMarkSections[i.SkidMarkIndex],t.scaleToRef(i.GROUND_OFFSET,i.TempVector3_POS),n.addToRef(i.TempVector3_POS,f.Pos),f.Normal.copyFrom(t),f.Intensity=r*i.TEX_INTENSITY,f.LastIndex=u,u!=-1&&(e=i.SkidMarkSections[u],f.Pos.subtractToRef(e.Pos,i.TempVector3_DIR),BABYLON.Vector3.CrossToRef(i.TempVector3_DIR,t,i.TempVector3_XDIR),i.TempVector3_XDIR.normalizeToRef(i.TempVector3_XDIR),i.TempVector3_XDIR.scaleToRef(i.MARK_WIDTH*.5,i.TempVector3_SDIR),f.Pos.addToRef(i.TempVector3_SDIR,f.Posl),f.Pos.subtractToRef(i.TempVector3_SDIR,f.Posr),f.Tangent.set(i.TempVector3_XDIR.x,i.TempVector3_XDIR.y,i.TempVector3_XDIR.z,1),e.LastIndex===-1&&(f.Pos.addToRef(i.TempVector3_SDIR,e.Posl),f.Pos.subtractToRef(i.TempVector3_SDIR,e.Posr),e.Tangent.copyFrom(f.Tangent))),i.AddSkidMarkVertexData(),s=i.SkidMarkIndex,i.SkidMarkIndex=++i.SkidMarkIndex%i.MAX_MARKS,s)},i.CreateSkidMarkManager=function(n){var r,f,u;if(i.SkidMarkMesh==null){for(r=new BABYLON.StandardMaterial("SkidMarkMaterial",n),r.backFaceCulling=!1,r.disableLighting=!0,r.emissiveColor=i.MARK_COLOR,r.diffuseColor=i.MARK_COLOR,r.diffuseTexture=BABYLON.Utilities.ParseTexture(i.TEXTURE_MARKS,n),r.diffuseTexture!=null&&(r.diffuseTexture.hasAlpha=!0,r.useAlphaFromDiffuseTexture=!0),r.freeze(),i.SkidMarkMesh=new BABYLON.Mesh("SkidMarkMesh",n),i.SkidMarkMesh.material=r,i.SkidMarkMesh.alwaysSelectAsActiveMesh=!0,i.SkidMarkMesh.doNotSyncBoundingInfo=!0,i.SkidMarkMesh.receiveShadows=!1,i.SkidMarkMesh.checkCollisions=!1,i.SkidMarkMesh.useVertexColors=!0,i.SkidMarkMesh.hasVertexAlpha=!0,i.SkidMarkMesh.isPickable=!1,i.SkidMarkSections=new Array(i.MAX_MARKS),f=0;f<i.SkidMarkSections.length;f++)i.SkidMarkSections[f]=new t;i.SkidBufferPositions=new Float32Array(i.MAX_MARKS*12);i.SkidBufferNormals=new Float32Array(i.MAX_MARKS*12);i.SkidBufferTangents=new Float32Array(i.MAX_MARKS*16);i.SkidBufferColors=new Float32Array(i.MAX_MARKS*16);i.SkidBufferUvs=new Float32Array(i.MAX_MARKS*8);i.SkidBufferIndices=new Int32Array(i.MAX_MARKS*6);u=new BABYLON.VertexData;u.positions=i.SkidBufferPositions;u.normals=i.SkidBufferNormals;u.tangents=i.SkidBufferTangents;u.colors=i.SkidBufferColors;u.uvs=i.SkidBufferUvs;u.indices=i.SkidBufferIndices;u.applyToMesh(i.SkidMarkMesh,!0);i.SkidMarkMesh.freezeWorldMatrix()}},i.AddSkidMarkVertexData=function(){var t=i.SkidMarkSections[i.SkidMarkIndex],r,n;t.LastIndex!==-1&&(r=i.SkidMarkSections[t.LastIndex],i.SkidMarkUpdated=!0,n=i.SkidMarkIndex*4+0,i.SkidBufferPositions[n*3]=r.Posl.x,i.SkidBufferPositions[n*3+1]=r.Posl.y,i.SkidBufferPositions[n*3+2]=r.Posl.z,n=i.SkidMarkIndex*4+1,i.SkidBufferPositions[n*3]=r.Posr.x,i.SkidBufferPositions[n*3+1]=r.Posr.y,i.SkidBufferPositions[n*3+2]=r.Posr.z,n=i.SkidMarkIndex*4+2,i.SkidBufferPositions[n*3]=t.Posl.x,i.SkidBufferPositions[n*3+1]=t.Posl.y,i.SkidBufferPositions[n*3+2]=t.Posl.z,n=i.SkidMarkIndex*4+3,i.SkidBufferPositions[n*3]=t.Posr.x,i.SkidBufferPositions[n*3+1]=t.Posr.y,i.SkidBufferPositions[n*3+2]=t.Posr.z,n=i.SkidMarkIndex*4+0,i.SkidBufferNormals[n*3]=r.Normal.x,i.SkidBufferNormals[n*3+1]=r.Normal.y,i.SkidBufferNormals[n*3+2]=r.Normal.z,n=i.SkidMarkIndex*4+1,i.SkidBufferNormals[n*3]=r.Normal.x,i.SkidBufferNormals[n*3+1]=r.Normal.y,i.SkidBufferNormals[n*3+2]=r.Normal.z,n=i.SkidMarkIndex*4+2,i.SkidBufferNormals[n*3]=t.Normal.x,i.SkidBufferNormals[n*3+1]=t.Normal.y,i.SkidBufferNormals[n*3+2]=t.Normal.z,n=i.SkidMarkIndex*4+3,i.SkidBufferNormals[n*3]=t.Normal.x,i.SkidBufferNormals[n*3+1]=t.Normal.y,i.SkidBufferNormals[n*3+2]=t.Normal.z,n=i.SkidMarkIndex*4+0,i.SkidBufferTangents[n*4]=r.Tangent.x,i.SkidBufferTangents[n*4+1]=r.Tangent.y,i.SkidBufferTangents[n*4+2]=r.Tangent.z,i.SkidBufferTangents[n*4+3]=r.Tangent.w,n=i.SkidMarkIndex*4+1,i.SkidBufferTangents[n*4]=r.Tangent.x,i.SkidBufferTangents[n*4+1]=r.Tangent.y,i.SkidBufferTangents[n*4+2]=r.Tangent.z,i.SkidBufferTangents[n*4+3]=r.Tangent.w,n=i.SkidMarkIndex*4+2,i.SkidBufferTangents[n*4]=t.Tangent.x,i.SkidBufferTangents[n*4+1]=t.Tangent.y,i.SkidBufferTangents[n*4+2]=t.Tangent.z,i.SkidBufferTangents[n*4+3]=t.Tangent.w,n=i.SkidMarkIndex*4+3,i.SkidBufferTangents[n*4]=t.Tangent.x,i.SkidBufferTangents[n*4+1]=t.Tangent.y,i.SkidBufferTangents[n*4+2]=t.Tangent.z,i.SkidBufferTangents[n*4+3]=t.Tangent.w,n=i.SkidMarkIndex*4+0,i.SkidBufferColors[n*4]=1,i.SkidBufferColors[n*4+1]=1,i.SkidBufferColors[n*4+2]=1,i.SkidBufferColors[n*4+3]=r.Intensity,n=i.SkidMarkIndex*4+1,i.SkidBufferColors[n*4]=1,i.SkidBufferColors[n*4+1]=1,i.SkidBufferColors[n*4+2]=1,i.SkidBufferColors[n*4+3]=r.Intensity,n=i.SkidMarkIndex*4+2,i.SkidBufferColors[n*4]=1,i.SkidBufferColors[n*4+1]=1,i.SkidBufferColors[n*4+2]=1,i.SkidBufferColors[n*4+3]=t.Intensity,n=i.SkidMarkIndex*4+3,i.SkidBufferColors[n*4]=1,i.SkidBufferColors[n*4+1]=1,i.SkidBufferColors[n*4+2]=1,i.SkidBufferColors[n*4+3]=t.Intensity,n=i.SkidMarkIndex*4+0,i.SkidBufferUvs[n*2]=0,i.SkidBufferUvs[n*2+1]=0,n=i.SkidMarkIndex*4+1,i.SkidBufferUvs[n*2]=1,i.SkidBufferUvs[n*2+1]=0,n=i.SkidMarkIndex*4+2,i.SkidBufferUvs[n*2]=0,i.SkidBufferUvs[n*2+1]=1,n=i.SkidMarkIndex*4+3,i.SkidBufferUvs[n*2]=1,i.SkidBufferUvs[n*2+1]=1,i.SkidBufferIndices[i.SkidMarkIndex*6+0]=i.SkidMarkIndex*4+0,i.SkidBufferIndices[i.SkidMarkIndex*6+2]=i.SkidMarkIndex*4+1,i.SkidBufferIndices[i.SkidMarkIndex*6+1]=i.SkidMarkIndex*4+2,i.SkidBufferIndices[i.SkidMarkIndex*6+3]=i.SkidMarkIndex*4+2,i.SkidBufferIndices[i.SkidMarkIndex*6+5]=i.SkidMarkIndex*4+1,i.SkidBufferIndices[i.SkidMarkIndex*6+4]=i.SkidMarkIndex*4+3)},i.UpdateSkidMarkManager=function(){i.SkidMarkMesh!=null&&i.SkidMarkUpdated===!0&&(i.SkidMarkUpdated=!1,i.SkidMarkMesh.geometry!=null&&(i.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.PositionKind,i.SkidBufferPositions,0,!1),i.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.NormalKind,i.SkidBufferNormals,0,!1),i.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.TangentKind,i.SkidBufferTangents,0,!1),i.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.ColorKind,i.SkidBufferColors,0,!1),i.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.UVKind,i.SkidBufferUvs,0,!1),i.SkidMarkMesh.geometry.updateIndices(i.SkidBufferIndices,0,i.GPU_TRIANGLES)))},i.MAX_MARKS=1024,i.GROUND_OFFSET=.01,i.GPU_TRIANGLES=!0,i.MARK_COLOR=BABYLON.Color3.Black(),i.MARK_WIDTH=.3,i.TEX_INTENSITY=1,i.MIN_DISTANCE=.1,i.MIN_SQR_DISTANCE=i.MIN_DISTANCE*i.MIN_DISTANCE,i.TEXTURE_MARKS=null,i.SkidBufferPositions=null,i.SkidBufferNormals=null,i.SkidBufferTangents=null,i.SkidBufferColors=null,i.SkidBufferUvs=null,i.SkidBufferIndices=null,i.SkidMarkSections=null,i.SkidMarkIndex=0,i.SkidMarkMesh=null,i.SkidMarkUpdated=!1,i.TempVector3_POS=new BABYLON.Vector3(0,0,0),i.TempVector3_DIR=new BABYLON.Vector3(0,0,0),i.TempVector3_XDIR=new BABYLON.Vector3(0,0,0),i.TempVector3_SDIR=new BABYLON.Vector3(0,0,0),i}(BABYLON.ScriptComponent);n.SkidMarkManager=i}(PROJECT||(PROJECT={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n._rigidbody=null,n._engineAudioSource=null,n._skidAudioSource=null,n.gearIndex=0,n.downShift=1e3,n.shiftingTime=0,n.engineForce=0,n.handBraking=!1,n.linearDamping=0,n.angularDamping=0,n.forwardSpeed=0,n.absoluteSpeed=0,n.americanSpeed=0,n.normalizedSpeed=0,n.frontWheelPower=0,n.backWheelPower=0,n.wheelBrakingForce=0,n.visualSteerAngle=0,n.physicsSteerAngle=0,n.raycastVehicle=null,n.brakeLightsMesh=null,n.brakeLightsTrans=null,n.reverseLightsMesh=null,n.reverseLightsTrans=null,n.frontLeftWheelTrans=null,n.frontRightWheelTrans=null,n.backLeftWheelTrans=null,n.backRightWheelTrans=null,n.frontLeftWheelMesh=null,n.frontRightWheelMesh=null,n.backLeftWheelMesh=null,n.backRightWheelMesh=null,n.frontLeftWheelEmitter=null,n.frontRightWheelEmitter=null,n.backLeftWheelEmitter=null,n.backRightWheelEmitter=null,n.frontLeftWheelParticle=null,n.frontRightWheelParticle=null,n.backLeftWheelParticle=null,n.backRightWheelParticle=null,n.frontLeftWheelCollider=null,n.frontRightWheelCollider=null,n.backLeftWheelCollider=null,n.backRightWheelCollider=null,n.engineTorqueCurve=null,n.wheelRadius=0,n.clutchSlip=0,n.engineRPM=0,n.pitchRPM=0,n.shiftRPM=0,n.SKID_FL=0,n.SKID_FR=0,n.SKID_RL=0,n.SKID_RR=0,n.FRONT_LEFT=-1,n.FRONT_RIGHT=-1,n.BACK_LEFT=-1,n.BACK_RIGHT=-1,n.smokeTexture=null,n.skidThreashold=.55,n.skidDrawVelocity=.02,n.smokeIntensity=250,n.smokeOpacity=.1,n.smokeDonuts=2,n.maxTurnAngle=20,n.maxBurnAngle=40,n.maxSteerBoost=3,n.overSteerSpeed=1,n.topEngineSpeed=125,n.powerCoefficient=1,n.frictionLerpSpeed=.5,n.lowSpeedAngle=10,n.highSpeedAngle=1,n.lowSpeedTurning=.015,n.highSpeedTurning=.005,n.rayTestingType=0,n.stableDownImpulse=5,n.roadConnectAccel=5,n.testPointCount=32,n.sweepPenetration=0,n.smoothFlyingForce=250,n.transmissionRatio=.75,n.differentialRatio=3.55,n.maxFrontBraking=0,n.maxReversePower=.25,n.minBrakingForce=50,n.maxBrakingForce=150,n.handBrakingForce=2500,n.linearBrakingForce=.25,n.angularBrakingForce=0,n.burnoutTimeDelay=1,n.burnoutWheelPitch=.85,n.burnoutCoefficient=10,n.burnoutTriggerMark=10,n.maxThrottleBurnouts=!1,n.playVehicleSounds=!1,n.wheelDriveType=0,n.gearBoxMaxPitching=6500,n.gearBoxShiftChange=4500,n.gearBoxShiftDelay=.35,n.gearBoxShiftRatios=[4.17,2.34,1.52,1.14,.89,.68],n.gearBoxShiftRanges=[1e3,2400,2800,3200,3200,3200],n.slideWhenFootBraking=!1,n.throttleBrakingForce=0,n.throttleEngineSpeed=0,n.powerSlideFriction=1,n.wheelSkidFriction=1,n.skiddingLerpSpeed=.25,n.burnoutLerpSpeed=.05,n.m_physicsWorld=null,n.m_frontLeftWheel=null,n.m_frontRightWheel=null,n.m_backLeftWheel=null,n.m_backRightWheel=null,n.m_frontLeftWheelSkid=-1,n.m_frontRightWheelSkid=-1,n.m_backLeftWheelSkid=-1,n.m_backRightWheelSkid=-1,n.m_velocityOffset=new BABYLON.Vector3(0,0,0),n.m_angularDampener=new BABYLON.Vector3(1,1,1),n.burnoutTimer=0,n.restoreTimer=0,n.cooldownTimer=0,n.wheelDonuts=!1,n.wheelBurnout=!1,n.wheelSkidding=!1,n.donutSpinTime=0,n.currentForward=0,n.currentTurning=0,n.currentSkidding=!1,n.currentDrifting=!1,n.allowedTurningAngle=0,n.allowedTurningIncement=0,n}return __extends(i,t),i.prototype.getFootBraking=function(){return this.currentForward<0&&this.forwardSpeed>1},i.prototype.getHandBraking=function(){return this.handBraking},i.prototype.getPowerSliding=function(){return this.getFootBraking()===!0&&this.slideWhenFootBraking===!0},i.prototype.getCurrentForward=function(){return this.currentForward},i.prototype.getCurrentTurning=function(){return this.currentTurning},i.prototype.getCurrentSkidding=function(){return this.currentSkidding},i.prototype.getcurrentDrifting=function(){return this.currentDrifting},i.prototype.getReverseThrottle=function(){return this.currentForward<0&&this.forwardSpeed<0},i.prototype.getFrontLeftSkid=function(){return this.SKID_FL},i.prototype.getFrontRightSkid=function(){return this.SKID_FR},i.prototype.getBackLeftSkid=function(){return this.SKID_RL},i.prototype.getBackRightSkid=function(){return this.SKID_RR},i.prototype.getRigidbodyPhysics=function(){return this._rigidbody},i.prototype.getRaycastVehicle=function(){return this.raycastVehicle},i.prototype.getForwardSpeed=function(){return this.absoluteSpeed},i.prototype.getAbsoluteSpeed=function(){return this.forwardSpeed},i.prototype.getAmericanSpeed=function(){return this.americanSpeed},i.prototype.getNormalizedSpeed=function(){return this.normalizedSpeed},i.prototype.getCurrentGearIndex=function(){return this.gearIndex},i.prototype.getCurrentEngineRPM=function(){return this.engineRPM},i.prototype.getCurrentEnginePitch=function(){return BABYLON.Scalar.Clamp(this.pitchRPM/this.gearBoxMaxPitching+.1)},i.prototype.getGearShiftRatioCount=function(){return this.gearBoxShiftRatios!=null?this.gearBoxShiftRatios.length:0},i.prototype.getSmokeTextureMask=function(){return this.smokeTexture},i.prototype.getBrakeLightsMesh=function(){return this.brakeLightsMesh},i.prototype.getReverseLightsMesh=function(){return this.reverseLightsMesh},i.prototype.getFrontLeftWheelNode=function(){return this.frontLeftWheelMesh},i.prototype.getFrontRightWheelNode=function(){return this.frontRightWheelMesh},i.prototype.getBackLeftWheelNode=function(){return this.backLeftWheelMesh},i.prototype.getBackRightWheelNode=function(){return this.backRightWheelMesh},i.prototype.getWheelBurnoutEnabled=function(){return this.wheelBurnout},i.prototype.getWheelDonutsEnabled=function(){return this.wheelDonuts},i.prototype.getCurrentDonutSpinTime=function(){return this.donutSpinTime},i.prototype.awake=function(){this.awakeVehicleState()},i.prototype.start=function(){this.initVehicleState()},i.prototype.destroy=function(){this.destroyVehicleState()},i.prototype.awakeVehicleState=function(){var t,i,n;this.engineForce=0;this.frontWheelPower=0;this.backWheelPower=0;this.wheelBrakingForce=0;this.visualSteerAngle=0;this.physicsSteerAngle=0;this.m_physicsWorld=BABYLON.SceneManager.GetPhysicsWorld(this.scene);this.rayTestingType=this.getProperty("rayTestingType",this.rayTestingType);this.testPointCount=this.getProperty("testPointCount",this.testPointCount);this.sweepPenetration=this.getProperty("sweepPenetration",this.sweepPenetration);this.skidThreashold=this.getProperty("skidThreashold",this.skidThreashold);this.skidDrawVelocity=this.getProperty("skidDrawVelocity",this.skidDrawVelocity);this.smokeIntensity=this.getProperty("smokeIntensity",this.smokeIntensity);this.smokeOpacity=this.getProperty("smokeOpacity",this.smokeOpacity);this.smokeDonuts=this.getProperty("smokeDonuts",this.smokeDonuts);this.topEngineSpeed=this.getProperty("topEngineSpeed",this.topEngineSpeed);this.powerCoefficient=this.getProperty("powerCoefficient",this.powerCoefficient);this.maxFrontBraking=this.getProperty("maxFrontBraking",this.maxFrontBraking);this.maxReversePower=this.getProperty("maxReversePower",this.maxReversePower);this.stableDownImpulse=this.getProperty("stableDownImpulse",this.stableDownImpulse);this.roadConnectAccel=this.getProperty("roadConnectAccel",this.roadConnectAccel);this.smoothFlyingForce=this.getProperty("smoothFlyingForce",this.smoothFlyingForce);this.frictionLerpSpeed=this.getProperty("frictionLerpSpeed",this.frictionLerpSpeed);this.maxTurnAngle=this.getProperty("maxTurnAngle",this.maxTurnAngle);this.maxBurnAngle=this.getProperty("maxBurnAngle",this.maxBurnAngle);this.maxSteerBoost=this.getProperty("maxSteerBoost",this.maxSteerBoost);this.overSteerSpeed=this.getProperty("overSteerSpeed",this.overSteerSpeed);this.lowSpeedAngle=this.getProperty("lowSpeedAngle",this.lowSpeedAngle);this.highSpeedAngle=this.getProperty("highSpeedAngle",this.highSpeedAngle);this.wheelDriveType=this.getProperty("wheelDriveType",this.wheelDriveType);this.minBrakingForce=this.getProperty("minBrakingForce",this.minBrakingForce);this.maxBrakingForce=this.getProperty("maxBrakingForce",this.maxBrakingForce);this.handBrakingForce=this.getProperty("handBrakingForce",this.handBrakingForce);this.linearBrakingForce=this.getProperty("linearBrakingForce",this.linearBrakingForce);this.angularBrakingForce=this.getProperty("angularBrakingForce",this.angularBrakingForce);this.lowSpeedTurning=this.getProperty("lowSpeedTurning",this.lowSpeedTurning);this.highSpeedTurning=this.getProperty("highSpeedTurning",this.highSpeedTurning);this.brakeLightsTrans=this.getProperty("brakeLightsMesh",this.brakeLightsTrans);this.reverseLightsTrans=this.getProperty("reverseLightsMesh",this.reverseLightsTrans);this.frontLeftWheelTrans=this.getProperty("frontLeftWheelMesh",this.frontLeftWheelTrans);this.frontRightWheelTrans=this.getProperty("frontRightWheelMesh",this.frontRightWheelTrans);this.backLeftWheelTrans=this.getProperty("rearLeftWheelMesh",this.backLeftWheelTrans);this.backRightWheelTrans=this.getProperty("rearRightWheelMesh",this.backRightWheelTrans);this.frontLeftWheelCollider=this.getProperty("frontLeftWheelCollider",this.frontLeftWheelCollider);this.frontRightWheelCollider=this.getProperty("frontRightWheelCollider",this.frontRightWheelCollider);this.backLeftWheelCollider=this.getProperty("rearLeftWheelCollider",this.backLeftWheelCollider);this.backRightWheelCollider=this.getProperty("rearRightWheelCollider",this.backRightWheelCollider);this.burnoutTimeDelay=this.getProperty("burnoutTimeDelay",this.burnoutTimeDelay);this.burnoutWheelPitch=this.getProperty("burnoutWheelPitch",this.burnoutWheelPitch);this.burnoutCoefficient=this.getProperty("burnoutCoefficient",this.burnoutCoefficient);this.burnoutTriggerMark=this.getProperty("burnoutTriggerMark",this.burnoutTriggerMark);this.maxThrottleBurnouts=this.getProperty("maxThrottleBurnouts",this.maxThrottleBurnouts);this.playVehicleSounds=this.getProperty("playVehicleSounds",this.playVehicleSounds);this.differentialRatio=this.getProperty("gearBoxDifferential",this.differentialRatio);this.transmissionRatio=this.getProperty("gearBoxOverdrive",this.transmissionRatio);this.gearBoxMaxPitching=this.getProperty("gearBoxMaxPitching",this.gearBoxMaxPitching);this.gearBoxShiftChange=this.getProperty("gearBoxShiftChange",this.gearBoxShiftChange);this.gearBoxShiftDelay=this.getProperty("gearBoxShiftDelay",this.gearBoxShiftDelay);this.gearBoxShiftRatios=this.getProperty("gearBoxShiftRatios",this.gearBoxShiftRatios);this.gearBoxShiftRanges=this.getProperty("gearBoxShiftRanges",this.gearBoxShiftRanges);this.maxTurnAngle<=0&&(this.maxTurnAngle=20);this.maxBurnAngle<=0&&(this.maxBurnAngle=40);this.testPointCount<=0&&(this.testPointCount=32);this.sweepPenetration<=0&&(this.sweepPenetration=0);this.stableDownImpulse<=0&&(this.stableDownImpulse=0);this.roadConnectAccel<=0&&(this.roadConnectAccel=0);this.smoothFlyingForce<=0&&(this.smoothFlyingForce=0);this.maxFrontBraking<=0&&(this.maxFrontBraking=0);this.maxReversePower<=0&&(this.maxReversePower=.25);this.lowSpeedAngle<=0&&(this.lowSpeedAngle=10);this.highSpeedAngle<=0&&(this.highSpeedAngle=1);this.lowSpeedTurning<=0&&(this.lowSpeedTurning=.015);this.highSpeedTurning<=0&&(this.highSpeedTurning=.005);this.powerCoefficient<=0&&(this.powerCoefficient=1);this.topEngineSpeed<=0&&(this.topEngineSpeed=125);this.gearBoxMaxPitching<=0&&(this.gearBoxMaxPitching=6500);this.gearBoxShiftChange<=0&&(this.gearBoxShiftChange=4500);this.gearBoxShiftDelay<=0&&(this.gearBoxShiftDelay=.35);this.transmissionRatio<=0&&(this.transmissionRatio=1);this.differentialRatio<=0&&(this.differentialRatio=1);this.frictionLerpSpeed<=0&&(this.frictionLerpSpeed=1);this.skiddingLerpSpeed<=0&&(this.skiddingLerpSpeed=1);this.burnoutLerpSpeed<=0&&(this.burnoutLerpSpeed=1);this.burnoutTimeDelay<=0&&(this.burnoutTimeDelay=1);this.burnoutWheelPitch<=0&&(this.burnoutWheelPitch=1);t=this.getProperty("angularDampener");t!=null&&(this.m_angularDampener=BABYLON.Utilities.ParseVector3(t));i=this.getProperty("smokeTexture");i!=null&&(this.smokeTexture=BABYLON.Utilities.ParseTexture(i,this.scene));n=this.getProperty("engineTorque");n!=null&&n.animation!=null&&(this.engineTorqueCurve=BABYLON.Animation.Parse(n.animation));this.engineTorqueCurve==null&&BABYLON.Tools.Warn("Failed to parse engine torque curve for: "+this.transform.name)},i.prototype.initVehicleState=function(){if(BABYLON.Utilities.ValidateTransformQuaternion(this.transform),this._engineAudioSource=this.getComponent("BABYLON.AudioSource"),this._engineAudioSource==null&&BABYLON.Tools.Warn("No engine audio source manager found for: "+this.transform.name),this._rigidbody=this.getComponent("BABYLON.RigidbodyPhysics"),this._rigidbody!=null)if(this.raycastVehicle=BABYLON.RaycastVehicle.GetInstance(this.scene,this._rigidbody,this.m_angularDampener),this.raycastVehicle!=null){this.linearDamping=this._rigidbody.getLinearDamping();this.angularDamping=this._rigidbody.getAngularDamping();var n=this.brakeLightsTrans!=null&&this.brakeLightsTrans.name!=null&&this.brakeLightsTrans.name!==""?this.brakeLightsTrans.name:null,t=this.reverseLightsTrans!=null&&this.reverseLightsTrans.name!=null&&this.reverseLightsTrans.name!==""?this.reverseLightsTrans.name:null,i=this.frontLeftWheelTrans!=null&&this.frontLeftWheelTrans.name!=null&&this.frontLeftWheelTrans.name!==""?this.frontLeftWheelTrans.name:null,r=this.frontRightWheelTrans!=null&&this.frontRightWheelTrans.name!=null&&this.frontRightWheelTrans.name!==""?this.frontRightWheelTrans.name:null,u=this.backLeftWheelTrans!=null&&this.backLeftWheelTrans.name!=null&&this.backLeftWheelTrans.name!==""?this.backLeftWheelTrans.name:null,f=this.backRightWheelTrans!=null&&this.backRightWheelTrans.name!=null&&this.backRightWheelTrans.name!==""?this.backRightWheelTrans.name:null,e=this.frontLeftWheelCollider!=null&&this.frontLeftWheelCollider.name!=null&&this.frontLeftWheelCollider.name!==""?this.frontLeftWheelCollider.name:null,o=this.frontRightWheelCollider!=null&&this.frontRightWheelCollider.name!=null&&this.frontRightWheelCollider.name!==""?this.frontRightWheelCollider.name:null,s=this.backLeftWheelCollider!=null&&this.backLeftWheelCollider.name!=null&&this.backLeftWheelCollider.name!==""?this.backLeftWheelCollider.name:null,h=this.backRightWheelCollider!=null&&this.backRightWheelCollider.name!=null&&this.backRightWheelCollider.name!==""?this.backRightWheelCollider.name:null;e!=null&&(this.FRONT_LEFT=this.raycastVehicle.getWheelIndexByName(e));o!=null&&(this.FRONT_RIGHT=this.raycastVehicle.getWheelIndexByName(o));s!=null&&(this.BACK_LEFT=this.raycastVehicle.getWheelIndexByName(s));h!=null&&(this.BACK_RIGHT=this.raycastVehicle.getWheelIndexByName(h));n!=null&&(this.brakeLightsMesh=this.getChildNode(n,BABYLON.SearchType.IndexOf,!1),this.brakeLightsMesh!=null&&(this.brakeLightsMesh.isVisible=!1));t!=null&&(this.reverseLightsMesh=this.getChildNode(t,BABYLON.SearchType.IndexOf,!1),this.reverseLightsMesh!=null&&(this.reverseLightsMesh.isVisible=!1));this.raycastVehicle.getNumWheels()>=4?(this.BACK_LEFT>=0&&u!=null&&(this.m_backLeftWheel=this.raycastVehicle.getWheelInfo(this.BACK_LEFT),this.backLeftWheelMesh=this.getChildNode(u,BABYLON.SearchType.IndexOf,!1),this.backLeftWheelMesh!=null&&(this.m_backLeftWheel.spinner=BABYLON.SceneManager.FindChildTransformNode(this.backLeftWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.BACK_LEFT,this.backLeftWheelMesh),this.backLeftWheelEmitter=new BABYLON.AbstractMesh("Emitter_RL"),this.backLeftWheelEmitter.parent=this.m_backLeftWheel.spinner||this.backLeftWheelMesh,this.backLeftWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.backLeftWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_RL",this.backLeftWheelEmitter),(this.wheelDriveType===0||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_backLeftWheel!=null&&(this.wheelRadius=this.m_backLeftWheel.get_m_wheelsRadius()))),this.BACK_RIGHT>=0&&f!=null&&(this.m_backRightWheel=this.raycastVehicle.getWheelInfo(this.BACK_RIGHT),this.backRightWheelMesh=this.getChildNode(f,BABYLON.SearchType.IndexOf,!1),this.backRightWheelMesh!=null&&(this.m_backRightWheel.spinner=BABYLON.SceneManager.FindChildTransformNode(this.backRightWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.BACK_RIGHT,this.backRightWheelMesh),this.backRightWheelEmitter=new BABYLON.AbstractMesh("Emitter_RR"),this.backRightWheelEmitter.parent=this.m_backRightWheel.spinner||this.backRightWheelMesh,this.backRightWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.backRightWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_RR",this.backRightWheelEmitter),(this.wheelDriveType===0||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_backRightWheel!=null&&(this.wheelRadius=this.m_backRightWheel.get_m_wheelsRadius()))),this.FRONT_LEFT>=0&&i!=null&&(this.m_frontLeftWheel=this.raycastVehicle.getWheelInfo(this.FRONT_LEFT),this.frontLeftWheelMesh=this.getChildNode(i,BABYLON.SearchType.IndexOf,!1),this.frontLeftWheelMesh!=null&&(this.m_frontLeftWheel.spinner=BABYLON.SceneManager.FindChildTransformNode(this.frontLeftWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.FRONT_LEFT,this.frontLeftWheelMesh),this.frontLeftWheelEmitter=new BABYLON.AbstractMesh("Emitter_FL"),this.frontLeftWheelEmitter.parent=this.m_frontLeftWheel.spinner||this.frontLeftWheelMesh,this.frontLeftWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.frontLeftWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_FL",this.frontLeftWheelEmitter),(this.wheelDriveType===1||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_frontLeftWheel!=null&&(this.wheelRadius=this.m_frontLeftWheel.get_m_wheelsRadius()))),this.FRONT_RIGHT>=0&&r!=null&&(this.m_frontRightWheel=this.raycastVehicle.getWheelInfo(this.FRONT_RIGHT),this.frontRightWheelMesh=this.getChildNode(r,BABYLON.SearchType.IndexOf,!1),this.frontRightWheelMesh!=null&&(this.m_frontRightWheel.spinner=BABYLON.SceneManager.FindChildTransformNode(this.frontRightWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.FRONT_RIGHT,this.frontRightWheelMesh),this.frontRightWheelEmitter=new BABYLON.AbstractMesh("Emitter_FR"),this.frontRightWheelEmitter.parent=this.m_frontRightWheel.spinner||this.frontRightWheelMesh,this.frontRightWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.frontRightWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_FR",this.frontRightWheelEmitter),(this.wheelDriveType===1||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_frontRightWheel!=null&&(this.wheelRadius=this.m_frontRightWheel.get_m_wheelsRadius()))),this.raycastVehicle.setShapeTestingMode(this.rayTestingType===1),this.raycastVehicle.setShapeTestingSize(this.wheelRadius*.5),this.raycastVehicle.setShapeTestingCount(this.testPointCount),this.raycastVehicle.setSweepPenetration(this.sweepPenetration),this.raycastVehicle.setEnableMultiRaycast(!0),this.raycastVehicle.setInterpolateNormals(!1),this.raycastVehicle.setMinimumWheelContacts(4),this.raycastVehicle.setSmoothFlyingImpulse(this.smoothFlyingForce),this.raycastVehicle.setTrackConnectionAccel(this.roadConnectAccel),this.raycastVehicle.setStabilizingForce(this.stableDownImpulse),this.raycastVehicle.setCollisionFilterGroup(BABYLON.CollisionFilters.DefaultFilter),this.raycastVehicle.setCollisionFilterMask(BABYLON.CollisionFilters.StaticFilter),this._skidAudioSource==null&&this.backRightWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.backRightWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&this.backLeftWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.backLeftWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&this.frontRightWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.frontRightWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&this.frontLeftWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.frontLeftWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&BABYLON.Tools.Warn("No skid audio source manager found for: "+this.transform.name)):BABYLON.Tools.Warn("Invalid vehicle controller wheel count info for: "+this.transform.name)}else BABYLON.Tools.Warn("No wheel collider information found for: "+this.transform.name);else BABYLON.Tools.Warn("Failed to get rigidbody component: "+this.transform.name)},i.prototype.destroyVehicleState=function(){this._rigidbody=null;this._engineAudioSource=null;this._skidAudioSource=null;this.m_frontLeftWheel!=null&&(Ammo.destroy(this.m_frontLeftWheel),this.m_frontLeftWheel=null);this.m_frontRightWheel!=null&&(Ammo.destroy(this.m_frontRightWheel),this.m_frontRightWheel=null);this.m_backLeftWheel!=null&&(Ammo.destroy(this.m_backLeftWheel),this.m_backLeftWheel=null);this.m_backRightWheel!=null&&(Ammo.destroy(this.m_backRightWheel),this.m_backRightWheel=null);this.m_physicsWorld=null;this.raycastVehicle=null;this.frontLeftWheelMesh=null;this.frontRightWheelMesh=null;this.backLeftWheelMesh=null;this.backRightWheelMesh=null;this.frontLeftWheelTrans=null;this.frontRightWheelTrans=null;this.backLeftWheelTrans=null;this.backRightWheelTrans=null;this.frontLeftWheelCollider=null;this.frontRightWheelCollider=null;this.backLeftWheelCollider=null;this.backRightWheelCollider=null},i.prototype.drive=function(n,t,i,r,u){var f,a,e,h,v,o,c;if(u===void 0&&(u=!0),this.currentForward=BABYLON.Scalar.Clamp(n,-1,1),this.currentTurning=BABYLON.Scalar.Clamp(t,-1,1),this.currentSkidding=i,this.currentDrifting=r,this.handBraking=this.getCurrentSkidding()===!0&&this.handBrakingForce>0,this._rigidbody!=null&&this.raycastVehicle!=null){if(this.FRONT_LEFT>=0&&this.FRONT_RIGHT>=0&&this.BACK_LEFT>=0&&this.BACK_RIGHT>=0){f=this.getDeltaSeconds();this.engineForce=0;this.wheelBrakingForce=0;this.frontWheelPower=0;this.backWheelPower=0;var k=this.gearBoxShiftRatios!=null&&this.gearBoxShiftRatios.length>this.gearIndex?this.gearBoxShiftRatios[this.gearIndex]:1,d=k*this.differentialRatio*this.transmissionRatio,g=this.getVehicleEngineTorque(this.engineRPM)*Math.abs(this.currentForward),s=g*d,l=BABYLON.Scalar.Lerp(this.minBrakingForce,this.maxBrakingForce,this.normalizedSpeed)*Math.abs(this.currentForward);if(this.currentForward>0&&this.wheelBurnout===!0&&this.wheelDonuts===!0?this.engineForce=s:this.currentForward>0?this.forwardSpeed<-1?this.wheelBrakingForce=l:this.engineForce=s:this.currentForward<0?this.forwardSpeed>1?this.wheelBrakingForce=l:this.engineForce=-(s*this.maxReversePower):(this.engineForce=0,this.wheelBrakingForce=10),a=this.throttleEngineSpeed>0?this.throttleEngineSpeed:this.topEngineSpeed,(this.shiftingTime>0||this.americanSpeed>a)&&(this.engineForce=0),u===!1?(e=0,this.americanSpeed>=10?(h=BABYLON.Tools.ToRadians(BABYLON.Scalar.Lerp(this.lowSpeedAngle,this.highSpeedAngle,this.normalizedSpeed)),h*=BABYLON.Scalar.Lerp(this.lowSpeedTurning,this.highSpeedTurning,this.normalizedSpeed)*100,this.physicsSteerAngle=this.currentTurning*h,e=this.currentTurning*BABYLON.Tools.ToRadians(this.maxTurnAngle),this.maxSteerBoost>0&&Math.abs(this.currentTurning)>=.1&&(e+=BABYLON.Tools.ToRadians(this.maxSteerBoost)*Math.sign(this.currentTurning))):(this.physicsSteerAngle=this.currentTurning*BABYLON.Tools.ToRadians(this.maxTurnAngle),e=this.currentTurning*BABYLON.Tools.ToRadians(this.maxTurnAngle)),this.overSteerSpeed>0&&this.handBraking===!0&&(e*=-1),v=this.overSteerSpeed>0?this.overSteerSpeed:1,this.visualSteerAngle=BABYLON.Scalar.Lerp(this.visualSteerAngle,e,v*f*9)):(this.allowedTurningIncement=BABYLON.Scalar.Lerp(this.lowSpeedTurning,this.highSpeedTurning,this.normalizedSpeed),this.allowedTurningAngle=this.americanSpeed>=10?BABYLON.Scalar.Lerp(BABYLON.Tools.ToRadians(this.lowSpeedAngle),BABYLON.Tools.ToRadians(this.highSpeedAngle),this.normalizedSpeed):BABYLON.Tools.ToRadians(this.maxTurnAngle),this.wheelBurnout===!0&&this.wheelDonuts===!0&&(this.allowedTurningAngle=BABYLON.Tools.ToRadians(this.maxBurnAngle)),this.currentTurning>0?this.physicsSteerAngle<this.allowedTurningAngle&&(this.physicsSteerAngle+=this.allowedTurningIncement):this.currentTurning<0?this.physicsSteerAngle>-this.allowedTurningAngle&&(this.physicsSteerAngle-=this.allowedTurningIncement):this.physicsSteerAngle<-this.allowedTurningIncement?this.physicsSteerAngle+=this.allowedTurningIncement:this.physicsSteerAngle>this.allowedTurningIncement?this.physicsSteerAngle-=this.allowedTurningIncement:this.physicsSteerAngle=0,this.wheelBurnout===!0||this.wheelSkidding==!0?(this.allowedTurningAngle=BABYLON.Tools.ToRadians(this.maxTurnAngle),this.allowedTurningIncement=this.lowSpeedTurning):(this.allowedTurningIncement=BABYLON.Scalar.Lerp(this.lowSpeedTurning,this.highSpeedTurning,this.normalizedSpeed),this.allowedTurningAngle=BABYLON.Scalar.Lerp(BABYLON.Tools.ToRadians(this.lowSpeedAngle),BABYLON.Tools.ToRadians(this.highSpeedAngle),this.normalizedSpeed),this.maxSteerBoost>0&&Math.abs(this.currentTurning)>=.1&&(this.allowedTurningAngle+=BABYLON.Tools.ToRadians(this.maxSteerBoost))),this.overSteerSpeed>0&&this.handBraking===!0&&(this.currentTurning*=-1),this.currentTurning>0?this.visualSteerAngle<this.allowedTurningAngle&&(this.visualSteerAngle+=this.allowedTurningIncement):this.currentTurning<0?this.visualSteerAngle>-this.allowedTurningAngle&&(this.visualSteerAngle-=this.allowedTurningIncement):this.visualSteerAngle<-this.allowedTurningIncement?this.visualSteerAngle+=this.allowedTurningIncement:this.visualSteerAngle>this.allowedTurningIncement?this.visualSteerAngle-=this.allowedTurningIncement:this.visualSteerAngle=0),o=!0,this.handBraking===!0)this.wheelBurnout=!1,this.wheelDonuts=!1,this.burnoutTimer=0,this.raycastVehicle.lockedWheelIndexes==null&&(this.raycastVehicle.lockedWheelIndexes=[this.BACK_LEFT,this.BACK_RIGHT]),this.americanSpeed>=5&&this.wheelSkidding===!1&&(this.wheelSkidding=!0,this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.set_m_frictionSlip(this.wheelSkidFriction),this.m_frontRightWheel!=null&&this.m_frontRightWheel.set_m_frictionSlip(this.wheelSkidFriction),this.m_backLeftWheel!=null&&this.m_backLeftWheel.set_m_frictionSlip(this.wheelSkidFriction),this.m_backRightWheel!=null&&this.m_backRightWheel.set_m_frictionSlip(this.wheelSkidFriction),o=!1),this.updateCurrentBrakeDamping(this.linearBrakingForce,this.angularBrakingForce),o===!0&&this.updateCurrentFrictionSlip(f*this.skiddingLerpSpeed),this.updateCurrentRotationDelta(0),this.updateCurrentRotationBoost(0),this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_LEFT),this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_RIGHT),this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_LEFT),this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_RIGHT),this.raycastVehicle.setEngineForce(0,this.FRONT_LEFT),this.raycastVehicle.setEngineForce(0,this.FRONT_RIGHT),this.raycastVehicle.setEngineForce(0,this.BACK_LEFT),this.raycastVehicle.setEngineForce(0,this.BACK_RIGHT),this.raycastVehicle.setBrakingForce(0,this.FRONT_LEFT),this.raycastVehicle.setBrakingForce(0,this.FRONT_RIGHT),this.raycastVehicle.setBrakingForce(this.handBrakingForce,this.BACK_LEFT),this.raycastVehicle.setBrakingForce(this.handBrakingForce,this.BACK_RIGHT);else{this.raycastVehicle.lockedWheelIndexes!=null&&(this.raycastVehicle.lockedWheelIndexes=null,this.updateCurrentRotationDelta(0),this.updateCurrentRotationBoost(0));this.wheelSkidding=!1;this.burnoutCoefficient=BABYLON.Scalar.Clamp(this.burnoutCoefficient,1,20);this.burnoutTriggerMark=BABYLON.Scalar.Clamp(this.burnoutTriggerMark,1,20);var nt=this.americanSpeed<=this.burnoutTriggerMark,y=this.currentForward<-.9||this.currentForward>.9,p=this.currentTurning<-.9||this.currentTurning>.9,w=f*this.frictionLerpSpeed,b=0;this.burnoutTimer<=0&&y===!0&&nt===!0&&this.maxThrottleBurnouts===!0&&(this.burnoutTimer=this.burnoutTimeDelay*.25,this.wheelDonuts=!1,this.wheelBurnout=!0);this.restoreTimer>0&&(this.restoreTimer-=f,this.restoreTimer<0&&(this.restoreTimer=0),w*=this.burnoutLerpSpeed);this.cooldownTimer>0&&(this.cooldownTimer-=f,this.cooldownTimer<0&&(this.cooldownTimer=0));this.wheelDonuts===!0?(this.donutSpinTime+=f,p===!1&&(this.burnoutTimer=0)):this.donutSpinTime=0;this.burnoutTimer>0&&y===!0?(b=.1,c=this.wheelDonuts===!0?1.25:1,this.burnoutCoefficient>=1&&(this.engineForce*=this.burnoutCoefficient),this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.set_m_frictionSlip(this.wheelSkidFriction*c),this.m_frontRightWheel!=null&&this.m_frontRightWheel.set_m_frictionSlip(this.wheelSkidFriction*c),this.m_backLeftWheel!=null&&this.m_backLeftWheel.set_m_frictionSlip(this.wheelSkidFriction),this.m_backRightWheel!=null&&this.m_backRightWheel.set_m_frictionSlip(this.wheelSkidFriction),o=!1,this.burnoutTimer-=f,this.burnoutTimer<=0&&p===!0&&this.cooldownTimer<=0&&this.currentForward>0&&this.currentDrifting===!0&&(this.burnoutTimer=.01,this.wheelDonuts=!0)):(this.burnoutTimer=0,this.donutSpinTime=0,this.wheelDonuts===!0&&(this.wheelDonuts=!1,this.cooldownTimer=this.burnoutTimeDelay*2),this.wheelBurnout===!0&&(this.wheelBurnout=!1,this.restoreTimer=this.burnoutTimeDelay*.75));this.wheelBurnout===!0&&this.wheelDonuts===!0?this.frontWheelPower=this.engineForce*.2:(this.wheelDriveType===1||this.wheelDriveType===2)&&(this.frontWheelPower=this.engineForce);(this.wheelDriveType===0||this.wheelDriveType===2)&&(this.backWheelPower=this.engineForce);this.getFootBraking()===!0?this.updateCurrentBrakeDamping(this.linearBrakingForce*.2,this.angularBrakingForce*.2):this.throttleBrakingForce>0?this.updateCurrentBrakeDamping(this.throttleBrakingForce,this.angularDamping):this.updateCurrentBrakeDamping(this.linearDamping,this.angularDamping);o===!0&&this.updateCurrentFrictionSlip(w);this.updateCurrentRotationBoost(b);this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_LEFT);this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_RIGHT);this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_LEFT);this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_RIGHT);this.raycastVehicle.setEngineForce(this.frontWheelPower,this.FRONT_LEFT);this.raycastVehicle.setEngineForce(this.frontWheelPower,this.FRONT_RIGHT);this.raycastVehicle.setEngineForce(this.backWheelPower,this.BACK_LEFT);this.raycastVehicle.setEngineForce(this.backWheelPower,this.BACK_RIGHT);this.maxFrontBraking>0?(this.raycastVehicle.setBrakingForce(this.wheelBrakingForce*this.maxFrontBraking,this.FRONT_LEFT),this.raycastVehicle.setBrakingForce(this.wheelBrakingForce*this.maxFrontBraking,this.FRONT_RIGHT)):(this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.FRONT_LEFT),this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.FRONT_RIGHT));this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.BACK_LEFT);this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.BACK_RIGHT)}}this.syncVehicleState()}},i.prototype.syncVehicleState=function(){var nt=this.getDeltaSeconds(),u=this.getGearShiftRatioCount(),h,c,l,r,tt,f,rt,e,ft,o,ot,s,t,g;if(this.shiftingTime>0&&(this.shiftingTime-=nt,this.shiftingTime<0&&(this.shiftingTime=0)),this._rigidbody!=null&&this.raycastVehicle!=null&&(h=.2,this.forwardSpeed=this.raycastVehicle.getRawCurrentSpeedKph(),Math.abs(this.forwardSpeed)<h&&(this.forwardSpeed=0),this.absoluteSpeed=this.raycastVehicle.getAbsCurrentSpeedKph(),this.absoluteSpeed<h&&(this.absoluteSpeed=0),this.americanSpeed=this.absoluteSpeed*BABYLON.System.Kph2Mph,this.normalizedSpeed=BABYLON.Scalar.Clamp(this.absoluteSpeed/this.topEngineSpeed),this.gearBoxShiftRatios!=null&&this.gearIndex>=0&&this.gearIndex<u)){var ht=Math.min(Math.max(nt,1/200),1),ct=this.wheelRadius*2*BABYLON.System.Meter2Inch,lt=this.gearBoxShiftRatios[this.gearIndex]*this.differentialRatio*this.transmissionRatio;this.downShift=this.gearBoxShiftRanges!=null&&this.gearBoxShiftRanges.length===this.gearBoxShiftRatios.length?this.gearBoxShiftRanges[this.gearIndex]:1e3;this.clutchSlip=BABYLON.Utilities.LerpClamp(this.clutchSlip,0,1-Math.pow(.01,ht));this.engineRPM=this.americanSpeed*lt*336/ct;this.pitchRPM=BABYLON.Utilities.LerpClamp(this.shiftRPM,this.engineRPM,1-this.clutchSlip)+i.MIN_RPM;this.americanSpeed<5?this.gearIndex=0:this.engineRPM>this.gearBoxShiftChange?(this.shiftRPM=this.engineRPM,this.clutchSlip=1,this.shiftingTime=this.gearBoxShiftDelay,this.gearIndex<u-1&&this.gearIndex++):this.engineRPM<this.downShift&&(this.shiftRPM=this.engineRPM,this.clutchSlip=1,this.shiftingTime=0,this.gearIndex>0&&this.gearIndex--);this.gearIndex<0?this.gearIndex=0:this.gearIndex>=u&&(this.gearIndex=u-1)}if(this.skidDrawVelocity>0&&this._rigidbody!=null&&(this.m_velocityOffset.copyFrom(this._rigidbody.getLinearVelocity()),this.m_velocityOffset.scaleInPlace(this.skidDrawVelocity)),c=0,this.playVehicleSounds===!0&&(c=this.getCurrentEnginePitch()*.75),this._engineAudioSource!=null&&(l=this._engineAudioSource.getSoundClip(),l!=null&&l.setPlaybackRate(c)),this.smokeDonuts=BABYLON.Scalar.Clamp(this.smokeDonuts,1,10),r=this.smokeIntensity,this.wheelBurnout===!0&&this.wheelDonuts===!0&&(r*=this.smokeDonuts),this.SKID_FL=0,this.SKID_FR=0,this.SKID_RL=0,this.SKID_RR=0,this.m_frontLeftWheel!=null)if(tt=this.m_frontLeftWheel.get_m_raycastInfo().get_m_groundObject()!==0,this.SKID_FL=this.updateCurrentSkidInfo(this.m_frontLeftWheel),this.SKID_FL<this.skidThreashold&&(this.SKID_FL=0),this.SKID_FL>0&&tt===!0){var a=this.m_frontLeftWheel.get_m_raycastInfo().get_m_contactPointWS(),v=this.m_frontLeftWheel.get_m_raycastInfo().get_m_contactNormalWS(),it=new BABYLON.Vector3(a.x(),a.y(),a.z()),at=new BABYLON.Vector3(v.x(),v.y(),v.z()),vt=BABYLON.Scalar.Normalize(this.SKID_FL,this.skidThreashold,1);this.skidDrawVelocity>0&&it.addInPlace(this.m_velocityOffset);this.m_frontLeftWheelSkid=n.SkidMarkManager.AddSkidMarkSegment(it,at,vt,this.m_frontLeftWheelSkid);this.frontLeftWheelParticle!=null&&(this.frontLeftWheelParticle.isStarted()===!1&&this.frontLeftWheelParticle.start(),f=this.SKID_FL*this.SKID_FL,this.frontLeftWheelParticle.emitRate=r*f,this.frontLeftWheelParticle.minSize=.2*f+.2,this.frontLeftWheelParticle.maxSize=1.5*f+1.2)}else this.frontLeftWheelParticle!=null&&(this.frontLeftWheelParticle.emitRate=0),this.m_frontLeftWheelSkid=-1;if(this.m_frontRightWheel!=null)if(rt=this.m_frontRightWheel.get_m_raycastInfo().get_m_groundObject()!==0,this.SKID_FR=this.updateCurrentSkidInfo(this.m_frontRightWheel),this.SKID_FR<this.skidThreashold&&(this.SKID_FR=0),this.SKID_FR>0&&rt===!0){var y=this.m_frontRightWheel.get_m_raycastInfo().get_m_contactPointWS(),p=this.m_frontRightWheel.get_m_raycastInfo().get_m_contactNormalWS(),ut=new BABYLON.Vector3(y.x(),y.y(),y.z()),yt=new BABYLON.Vector3(p.x(),p.y(),p.z()),pt=BABYLON.Scalar.Normalize(this.SKID_FR,this.skidThreashold,1);this.skidDrawVelocity>0&&ut.addInPlace(this.m_velocityOffset);this.m_frontRightWheelSkid=n.SkidMarkManager.AddSkidMarkSegment(ut,yt,pt,this.m_frontRightWheelSkid);this.frontRightWheelParticle!=null&&(this.frontRightWheelParticle.isStarted()===!1&&this.frontRightWheelParticle.start(),e=this.SKID_FR*this.SKID_FR,this.frontRightWheelParticle.emitRate=r*e,this.frontRightWheelParticle.minSize=.2*e+.2,this.frontRightWheelParticle.maxSize=1.5*e+1.2)}else this.frontRightWheelParticle!=null&&(this.frontRightWheelParticle.emitRate=0),this.m_frontRightWheelSkid=-1;if((this.wheelBurnout==!0||this.restoreTimer>0)&&(this.SKID_FL*=this.burnoutWheelPitch,this.SKID_FR*=this.burnoutWheelPitch),this.SKID_FL*=.75,this.SKID_FR*=.75,this.m_backLeftWheel!=null)if(ft=this.m_backLeftWheel.get_m_raycastInfo().get_m_groundObject()!==0,this.SKID_RL=this.updateCurrentSkidInfo(this.m_backLeftWheel),this.SKID_RL<this.skidThreashold&&(this.SKID_RL=0),this.SKID_RL>0&&ft===!0){var w=this.m_backLeftWheel.get_m_raycastInfo().get_m_contactPointWS(),b=this.m_backLeftWheel.get_m_raycastInfo().get_m_contactNormalWS(),et=new BABYLON.Vector3(w.x(),w.y(),w.z()),wt=new BABYLON.Vector3(b.x(),b.y(),b.z()),bt=BABYLON.Scalar.Normalize(this.SKID_RL,this.skidThreashold,1);this.skidDrawVelocity>0&&et.addInPlace(this.m_velocityOffset);this.m_backLeftWheelSkid=n.SkidMarkManager.AddSkidMarkSegment(et,wt,bt,this.m_backLeftWheelSkid);this.backLeftWheelParticle!=null&&(this.backLeftWheelParticle.isStarted()===!1&&this.backLeftWheelParticle.start(),o=this.SKID_RL*this.SKID_RL,this.backLeftWheelParticle.emitRate=r*o,this.backLeftWheelParticle.minSize=.2*o+.2,this.backLeftWheelParticle.maxSize=1.5*o+1.2)}else this.backLeftWheelParticle!=null&&(this.backLeftWheelParticle.emitRate=0),this.m_backLeftWheelSkid=-1;if(this.m_backRightWheel!=null)if(ot=this.m_backRightWheel.get_m_raycastInfo().get_m_groundObject()!==0,this.SKID_RR=this.updateCurrentSkidInfo(this.m_backRightWheel),this.SKID_RR<this.skidThreashold&&(this.SKID_RR=0),this.SKID_RR>0&&ot===!0){var k=this.m_backRightWheel.get_m_raycastInfo().get_m_contactPointWS(),d=this.m_backRightWheel.get_m_raycastInfo().get_m_contactNormalWS(),st=new BABYLON.Vector3(k.x(),k.y(),k.z()),kt=new BABYLON.Vector3(d.x(),d.y(),d.z()),dt=BABYLON.Scalar.Normalize(this.SKID_RR,this.skidThreashold,1);this.skidDrawVelocity>0&&st.addInPlace(this.m_velocityOffset);this.m_backRightWheelSkid=n.SkidMarkManager.AddSkidMarkSegment(st,kt,dt,this.m_backRightWheelSkid);this.backRightWheelParticle!=null&&(this.backRightWheelParticle.isStarted()===!1&&this.backRightWheelParticle.start(),s=this.SKID_RR*this.SKID_RR,this.backRightWheelParticle.emitRate=r*s,this.backRightWheelParticle.minSize=.2*s+.2,this.backRightWheelParticle.maxSize=1.5*s+1.2)}else this.backRightWheelParticle!=null&&(this.backRightWheelParticle.emitRate=0),this.m_backRightWheelSkid=-1;(this.wheelBurnout==!0||this.restoreTimer>0)&&(this.SKID_RL*=this.burnoutWheelPitch,this.SKID_RR*=this.burnoutWheelPitch);t=0;this.playVehicleSounds===!0&&(this.SKID_FL>t&&(t=this.SKID_FL),this.SKID_FR>t&&(t=this.SKID_FR),this.SKID_RL>t&&(t=this.SKID_RL),this.SKID_RR>t&&(t=this.SKID_RR));this._skidAudioSource!=null&&(g=this._skidAudioSource.getSoundClip(),g!=null&&g.setPlaybackRate(t));this.brakeLightsMesh!=null&&(this.brakeLightsMesh.isVisible=this.getFootBraking()||this.getHandBraking());this.reverseLightsMesh!=null&&(this.reverseLightsMesh.isVisible=this.getReverseThrottle())},i.prototype.getVehicleEngineTorque=function(n){var t=0;return this.engineTorqueCurve!=null&&(t=BABYLON.Utilities.SampleAnimationFloat(this.engineTorqueCurve,BABYLON.Scalar.Clamp(n,i.MIN_RPM,i.MAX_RPM))*this.powerCoefficient),t},i.prototype.createSmokeParticleSystem=function(n,t){var i=new BABYLON.ParticleSystem(n,1e4,this.scene);return i.blendMode=BABYLON.ParticleSystem.BLENDMODE_STANDARD,i.particleTexture=this.smokeTexture,i.emitter=t,i.emitRate=0,i.updateSpeed=.01,i.minSize=.2,i.maxSize=1.3,i.minAngularSpeed=-1.5,i.maxAngularSpeed=1.5,i.minLifeTime=3,i.maxLifeTime=5,i.addVelocityGradient(0,1),i.addVelocityGradient(.1,.7),i.addVelocityGradient(.7,.2),i.addVelocityGradient(1,.05),i.gravity=new BABYLON.Vector3(0,-.1,0),i.minEmitBox=new BABYLON.Vector3(0,-.25,0),i.maxEmitBox=new BABYLON.Vector3(0,-.25,0),i.direction1=new BABYLON.Vector3(-1,-1,-1),i.direction2=new BABYLON.Vector3(1,1,1),i.color1=new BABYLON.Color4(.95,.95,.95,this.smokeOpacity),i.color2=new BABYLON.Color4(.85,.85,.85,this.smokeOpacity),i.colorDead=new BABYLON.Color4(.9,.9,.9,this.smokeOpacity*.5),i},i.prototype.updateCurrentSkidInfo=function(n){return this.getPowerSliding()===!0?BABYLON.Scalar.Lerp(0,1,this.normalizedSpeed):BABYLON.Scalar.Clamp(1-n.get_m_skidInfo())},i.prototype.updateCurrentBrakeDamping=function(n,t){this._rigidbody!=null&&this._rigidbody.setDamping(n,t)},i.prototype.updateCurrentRotationDelta=function(n){this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.set_m_deltaRotation(n);this.m_frontRightWheel!=null&&this.m_frontRightWheel.set_m_deltaRotation(n);this.m_backLeftWheel!=null&&this.m_backLeftWheel.set_m_deltaRotation(n);this.m_backRightWheel!=null&&this.m_backRightWheel.set_m_deltaRotation(n)},i.prototype.updateCurrentRotationBoost=function(n){(this.wheelDriveType===1||this.wheelDriveType===2)&&(this.m_frontLeftWheel!=null&&(this.m_frontLeftWheel.rotationBoost=n),this.m_frontRightWheel!=null&&(this.m_frontRightWheel.rotationBoost=n));(this.wheelDriveType===0||this.wheelDriveType===2)&&(this.m_backLeftWheel!=null&&(this.m_backLeftWheel.rotationBoost=n),this.m_backRightWheel!=null&&(this.m_backRightWheel.rotationBoost=n))},i.prototype.updateCurrentFrictionSlip=function(n){var t,i,r,u;this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.defaultFriction!=null&&(t=this.m_frontLeftWheel.get_m_frictionSlip(),t<this.m_frontLeftWheel.defaultFriction?(t=BABYLON.Scalar.Lerp(t,this.m_frontLeftWheel.defaultFriction,n),this.m_frontLeftWheel.set_m_frictionSlip(t)):t>this.m_frontLeftWheel.defaultFriction&&this.m_frontLeftWheel.set_m_frictionSlip(this.m_frontLeftWheel.defaultFriction));this.m_frontRightWheel!=null&&this.m_frontRightWheel.defaultFriction!=null&&(i=this.m_frontRightWheel.get_m_frictionSlip(),i!==this.m_frontRightWheel.defaultFriction?(i=BABYLON.Scalar.Lerp(i,this.m_frontRightWheel.defaultFriction,n),this.m_frontRightWheel.set_m_frictionSlip(i)):i>this.m_frontRightWheel.defaultFriction&&this.m_frontRightWheel.set_m_frictionSlip(this.m_frontRightWheel.defaultFriction));this.m_backLeftWheel!=null&&this.m_backLeftWheel.defaultFriction!=null&&(r=this.m_backLeftWheel.get_m_frictionSlip(),r!==this.m_backLeftWheel.defaultFriction?(r=BABYLON.Scalar.Lerp(r,this.m_backLeftWheel.defaultFriction,n),this.m_backLeftWheel.set_m_frictionSlip(r)):r>this.m_backLeftWheel.defaultFriction&&this.m_backLeftWheel.set_m_frictionSlip(this.m_backLeftWheel.defaultFriction));this.m_backRightWheel!=null&&this.m_backRightWheel.defaultFriction!=null&&(u=this.m_backRightWheel.get_m_frictionSlip(),u!==this.m_backRightWheel.defaultFriction?(u=BABYLON.Scalar.Lerp(u,this.m_backRightWheel.defaultFriction,n),this.m_backRightWheel.set_m_frictionSlip(u)):u>this.m_backRightWheel.defaultFriction&&this.m_backRightWheel.set_m_frictionSlip(this.m_backRightWheel.defaultFriction))},i.MIN_RPM=1e3,i.MAX_RPM=6e3,i}(BABYLON.ScriptComponent);n.StandardCarController=t}(PROJECT||(PROJECT={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.enableCamera=!1,n.followHeight=1.75,n.setCameraPitch=20,n.rotationDamping=5,n.minimumDistance=6,n.maximumDistance=8,n.buttonCamera=BABYLON.Xbox360Button.Y,n.keyboardCamera=BABYLON.UserInputKey.P,n.firstPerson=!1,n.cameraPivot=null,n.targetEulers=BABYLON.Vector3.Zero(),n.cameraEulers=BABYLON.Vector3.Zero(),n.cameraRotation=BABYLON.Quaternion.Zero(),n.cameraPivotOffset=BABYLON.Vector3.Zero(),n.cameraBoomPosition=BABYLON.Vector3.Zero(),n.autoAttachCamera=!1,n.m_cameraTransform=null,n.m_inputController=null,n.m_standardController=null,n.m_donutCameraLock=new BABYLON.Vector3(0,.5,7.5),n.m_firstPersonOffset=new BABYLON.Vector3(-.25,1,-.485),n.smoothDeltaTime=0,n}return __extends(i,t),i.prototype.awake=function(){this.awakeCameraManager()},i.prototype.start=function(){this.initCameraManager()},i.prototype.update=function(){this.updateCameraManager()},i.prototype.destroy=function(){this.destroyCameraManager()},i.prototype.awakeCameraManager=function(){var n,t;this.enableCamera=this.getProperty("enableCamera",this.enableCamera);this.followHeight=this.getProperty("followHeight",this.followHeight);this.setCameraPitch=this.getProperty("setCameraPitch",this.setCameraPitch);this.rotationDamping=this.getProperty("rotationDamping",this.rotationDamping);this.minimumDistance=this.getProperty("minimumDistance",this.minimumDistance);this.maximumDistance=this.getProperty("maximumDistance",this.maximumDistance);this.autoAttachCamera=this.getProperty("attachCamera",this.autoAttachCamera);n=this.getProperty("donutCameraLock");n!=null&&(this.m_donutCameraLock=BABYLON.Utilities.ParseVector3(n));t=this.getProperty("firstPersonOffset");t!=null&&(this.m_firstPersonOffset=BABYLON.Utilities.ParseVector3(t));this.rotationDamping<=0&&(this.rotationDamping=3)},i.prototype.initCameraManager=function(){var n=this;this.m_standardController=this.getComponent("PROJECT.StandardCarController");this.m_inputController=this.getComponent("PROJECT.VehicleInputController");this.m_inputController!=null&&(BABYLON.SceneManager.OnKeyboardPress(this.keyboardCamera,function(){n.togglePlayerCamera()}),BABYLON.SceneManager.OnGamepadButtonPress(this.buttonCamera,function(){n.togglePlayerCamera()}));this.cameraPivot=new BABYLON.TransformNode(this.transform.name+".CameraPivot",this.scene);this.cameraPivot.parent=null;this.cameraPivot.position=this.transform.position.clone();this.cameraPivot.rotationQuaternion=this.transform.rotationQuaternion.clone()},i.prototype.updateCameraManager=function(){this.m_cameraTransform==null&&this.autoAttachCamera===!0&&this.m_inputController!=null&&this.attachPlayerCamera(this.m_inputController.playerNumber);this.firstPerson===!0?this.firstPersonCamera():this.thirdPersonCamera()},i.prototype.destroyCameraManager=function(){this.m_donutCameraLock=null;this.m_standardController=null;this.m_cameraTransform=null},i.prototype.attachPlayerCamera=function(t){if(this.m_cameraTransform==null){var i=t<=0||t>4?1:t;this.m_cameraTransform=n.UniversalCameraSystem.GetCameraTransform(this.scene,i);this.m_cameraTransform!=null&&(this.m_cameraTransform.parent=this.cameraPivot,this.m_cameraTransform.position.copyFrom(this.cameraBoomPosition),this.m_cameraTransform.rotationQuaternion=BABYLON.Utilities.FromEuler(this.setCameraPitch,0,0))}},i.prototype.togglePlayerCamera=function(){this.firstPerson=!this.firstPerson},i.prototype.firstPersonCamera=function(){if(this.enableCamera===!0&&this.m_cameraTransform!=null&&this.m_standardController!=null){var n=this.transform;this.cameraPivot.rotationQuaternion.copyFrom(n.rotationQuaternion);BABYLON.Utilities.GetAbsolutePositionToRef(this.transform,this.cameraPivot.position);this.m_cameraTransform.position.copyFrom(this.m_firstPersonOffset);BABYLON.Utilities.FromEulerToRef(0,0,0,this.m_cameraTransform.rotationQuaternion)}},i.prototype.thirdPersonCamera=function(){var t,i;if(this.enableCamera===!0&&this.cameraPivot!=null&&this.m_cameraTransform!=null&&this.m_standardController!=null){this.cameraPivotOffset.set(0,this.followHeight,0);BABYLON.Utilities.GetAbsolutePositionToRef(this.transform,this.cameraPivot.position,this.cameraPivotOffset);var r=this.transform,u=this.getDeltaSeconds(),n=BABYLON.System.SmoothDeltaFactor;this.smoothDeltaTime=n*u+(1-n)*this.smoothDeltaTime;t=this.smoothDeltaTime*this.rotationDamping;r.rotationQuaternion.toEulerAnglesToRef(this.targetEulers);this.cameraPivot.rotationQuaternion.toEulerAnglesToRef(this.cameraEulers);BABYLON.Quaternion.FromEulerAnglesToRef(this.cameraEulers.x,this.targetEulers.y,this.cameraEulers.z,this.cameraRotation);BABYLON.Quaternion.SlerpToRef(this.cameraPivot.rotationQuaternion,this.cameraRotation,t,this.cameraPivot.rotationQuaternion);i=BABYLON.Scalar.Lerp(this.minimumDistance,this.maximumDistance,this.m_standardController.getNormalizedSpeed());this.cameraBoomPosition.set(0,0,-i);this.m_cameraTransform.position.copyFrom(this.cameraBoomPosition);BABYLON.Utilities.FromEulerToRef(this.setCameraPitch,0,0,this.m_cameraTransform.rotationQuaternion)}},i}(BABYLON.ScriptComponent);n.VehicleCameraManager=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.playerDeltaX=0,t.playerDeltaY=0,t.playerMouseX=0,t.playerMouseY=0,t.inBrakingZone=!1,t.brakingZoneTag="",t.waypointPosition=BABYLON.Vector3.Zero(),t.waypointCount=0,t.waypointIndex=0,t.nextTargetSpeed=0,t.prevTargetSpeed=0,t.lastMovementTime=0,t.vehicleResetCheck=0,t.showChaseRabbit=!1,t.showSensorLines=!1,t.rabbitTrackerLine=null,t.rabbitTrackerColor=new BABYLON.Color3(1,1,1),t.greenTrackingColor=new BABYLON.Color3(0,1,0),t.redTrackingColor=new BABYLON.Color3(1,0,0),t.localTargetPosition=new BABYLON.Vector3(0,0,0),t.mainCenterSensorLine=null,t.mainRightSensorLine=null,t.mainLeftSensorLine=null,t.angleRightSensorLine=null,t.angleLeftSensorLine=null,t.sideRightSensorLine=null,t.sideLeftSensorLine=null,t.sensorStartPos=BABYLON.Vector3.Zero(),t.sensorPointPos=BABYLON.Vector3.Zero(),t.sensorAnglePos=BABYLON.Vector3.Zero(),t.rsideStartPos=BABYLON.Vector3.Zero(),t.rsidePointPos=BABYLON.Vector3.Zero(),t.lsideStartPos=BABYLON.Vector3.Zero(),t.lsidePointPos=BABYLON.Vector3.Zero(),t.tempScaleVector=BABYLON.Vector3.Zero(),t.trackVehiclePosition=BABYLON.Vector3.Zero(),t.trackRabbitPosition=BABYLON.Vector3.Zero(),t.enableInput=!1,t.resetTiming=3,t.playerNumber=BABYLON.PlayerNumber.One,t.triggerForward=BABYLON.Xbox360Trigger.Right,t.keyboardForawrd=BABYLON.UserInputKey.W,t.auxKeyboardForawrd=BABYLON.UserInputKey.UpArrow,t.triggerBackwards=BABYLON.Xbox360Trigger.Left,t.keyboardBackwards=BABYLON.UserInputKey.S,t.auxKeyboardBackwards=BABYLON.UserInputKey.DownArrow,t.buttonHandbrake=BABYLON.Xbox360Button.X,t.keyboardHandbrake=BABYLON.UserInputKey.SpaceBar,t.buttonDonut=BABYLON.Xbox360Button.B,t.keyboardDonut=BABYLON.UserInputKey.Shift,t.raceLineNode=0,t.minLookAhead=5,t.maxLookAhead=50,t.driverSkillLevel=1,t.chaseRabbitSpeed=1,t.throttleSensitivity=1,t.steeringSensitivity=1,t.brakingSensitivity=1,t.brakingTurnAngle=20,t.brakingSpeedLimit=40,t.skiddingSpeedLimit=80,t.linearDampenForce=.1,t.driveSpeedMultiplier=5,t.resetMovingTimeout=5,t.maxRaceTrackSpeed=0,t.handBrakeZoneTag="HandBrake",t.trackManagerIdentity="TrackManager",t.sensorLength=8,t.spacerWidths=.85,t.angleFactors=1.5,t.initialOffsetX=1,t.initialOffsetY=.5,t.initialOffsetZ=2,t.sidewaysLength=1,t.avoidanceFactor=.5,t.reversingFlag=!1,t.reversingTime=0,t.reversingWait=2,t.reversingFor=1.5,t.m_chaseRabbitMesh=null,t.m_circuitInterfaces=null,t.m_circuitRaceLine_1=null,t.m_circuitRaceLine_2=null,t.m_circuitRaceLine_3=null,t.m_circuitRaceLine_4=null,t.m_circuitRaceLine_5=null,t.m_rigidbodyPhysics=null,t.m_standardCarController=null,t}return __extends(t,n),t.prototype.getPlayerDeltaX=function(){return this.playerDeltaX},t.prototype.getPlayerDeltaY=function(){return this.playerDeltaY},t.prototype.getPlayerMouseX=function(){return this.playerMouseX},t.prototype.getPlayerMouseY=function(){return this.playerMouseY},t.prototype.getWaypointIndex=function(){return this.waypointIndex},t.prototype.getChaseRabbitMesh=function(){return this.m_chaseRabbitMesh},t.prototype.resetChaseRabbitMesh=function(){this.m_chaseRabbitMesh!=null&&(this.m_chaseRabbitMesh.position=this.transform.position.clone(),this.m_chaseRabbitMesh.rotationQuaternion=this.transform.rotationQuaternion.clone())},t.prototype.awake=function(){this.awakeVehicleController()},t.prototype.start=function(){this.initVehicleController()},t.prototype.update=function(){this.updateVehicleController()},t.prototype.destroy=function(){this.destroyVehicleController()},t.prototype.awakeVehicleController=function(){this.enableInput=this.getProperty("enableInput",this.enableInput);this.resetTiming=this.getProperty("resetTiming",this.resetTiming);this.playerNumber=this.getProperty("playerNumber",this.playerNumber);this.showChaseRabbit=this.getProperty("showChaseRabbit",this.showChaseRabbit);this.showSensorLines=this.getProperty("showSensorLines",this.showSensorLines);this.minLookAhead=this.getProperty("minLookAhead",this.minLookAhead);this.maxLookAhead=this.getProperty("maxLookAhead",this.maxLookAhead);this.handBrakeZoneTag=this.getProperty("handBrakeZoneTag",this.handBrakeZoneTag);this.driverSkillLevel=this.getProperty("driverSkillLevel",this.driverSkillLevel);this.throttleSensitivity=this.getProperty("throttleSensitivity",this.throttleSensitivity);this.steeringSensitivity=this.getProperty("steeringSensitivity",this.steeringSensitivity);this.brakingSensitivity=this.getProperty("brakingSensitivity",this.brakingSensitivity);this.brakingTurnAngle=this.getProperty("brakingTurnAngle",this.brakingTurnAngle);this.brakingSpeedLimit=this.getProperty("brakingSpeedLimit",this.brakingSpeedLimit);this.skiddingSpeedLimit=this.getProperty("skiddingSpeedLimit",this.skiddingSpeedLimit);this.linearDampenForce=this.getProperty("linearDampenForce",this.linearDampenForce);this.resetMovingTimeout=this.getProperty("resetMovingTimeout",this.resetMovingTimeout);this.driveSpeedMultiplier=this.getProperty("driveSpeedMultiplier",this.driveSpeedMultiplier);this.maxRaceTrackSpeed=this.getProperty("maxRaceTrackSpeed",this.maxRaceTrackSpeed);this.trackManagerIdentity=this.getProperty("trackManagerIdentity",this.trackManagerIdentity);this.sensorLength=this.getProperty("sensorLength",this.sensorLength);this.spacerWidths=this.getProperty("spacerWidths",this.spacerWidths);this.angleFactors=this.getProperty("angleFactors",this.angleFactors);this.initialOffsetX=this.getProperty("initialOffsetX",this.initialOffsetX);this.initialOffsetY=this.getProperty("initialOffsetY",this.initialOffsetY);this.initialOffsetZ=this.getProperty("initialOffsetZ",this.initialOffsetZ);this.sidewaysLength=this.getProperty("sidewaysLength",this.sidewaysLength);this.avoidanceFactor=this.getProperty("avoidanceFactor",this.avoidanceFactor);this.throttleSensitivity<=0&&(this.throttleSensitivity=1);this.steeringSensitivity<=0&&(this.steeringSensitivity=1);this.brakingSensitivity<=0&&(this.brakingSensitivity=1);this.linearDampenForce<=0&&(this.linearDampenForce=.1);this.angleFactors<=0&&(this.angleFactors=1.5);this.sensorLength<=0&&(this.sensorLength=8);this.sidewaysLength<=0&&(this.sidewaysLength=1);this.brakingSpeedLimit<=0&&(this.brakingSpeedLimit=40);this.skiddingSpeedLimit<=0&&(this.skiddingSpeedLimit=80);this.driveSpeedMultiplier<=1&&(this.driveSpeedMultiplier=1);(this.handBrakeZoneTag==null||this.handBrakeZoneTag==="")&&(this.handBrakeZoneTag="HandBrake");(this.trackManagerIdentity==null||this.trackManagerIdentity==="")&&(this.trackManagerIdentity="TrackManager");var n=this.getProperty("initialRaceLineNode",1);this.raceLineNode=n-1},t.prototype.initVehicleController=function(){var t=this,i,n;this.m_rigidbodyPhysics=this.getComponent("BABYLON.RigidbodyPhysics");this.m_rigidbodyPhysics!=null?(this.m_rigidbodyPhysics.onCollisionEnterObservable.add(function(n){var i=BABYLON.SceneManager.GetTransformTag(n);i==="Vehicle"||i===t.handBrakeZoneTag&&(t.inBrakingZone=!0,t.brakingZoneTag=i)}),this.m_rigidbodyPhysics.onCollisionStayObservable.add(function(n){if(n!=null){var i=BABYLON.SceneManager.GetTransformTag(n);i==="Vehicle"||i===t.handBrakeZoneTag}}),this.m_rigidbodyPhysics.onCollisionExitObservable.add(function(n){if(n!=null){var i=BABYLON.SceneManager.GetTransformTag(n);i==="Vehicle"||i===t.handBrakeZoneTag&&(t.inBrakingZone=!1,t.brakingZoneTag="")}})):BABYLON.Tools.Warn("Null rigidbody physics for: "+this.transform.name);this.m_standardCarController=this.getComponent("PROJECT.StandardCarController");this.m_standardCarController!=null?this.m_standardCarController.playVehicleSounds=!0:BABYLON.Tools.Warn("Null standard car controller for: "+this.transform.name);i=BABYLON.SceneManager.GetTransformNode(this.scene,this.trackManagerIdentity);i!=null?(n=BABYLON.SceneManager.FindScriptComponent(i,"PROJECT.RaceTrackManager"),n!=null?(this.waypointCount=0,this.waypointIndex=0,this.m_circuitInterfaces=n.getTrackNodes(),this.m_circuitRaceLine_1=n.getControlPoints(0),this.m_circuitRaceLine_2=n.getControlPoints(1),this.m_circuitRaceLine_3=n.getControlPoints(2),this.m_circuitRaceLine_4=n.getControlPoints(3),this.m_circuitRaceLine_5=n.getControlPoints(4),this.m_circuitInterfaces!=null&&this.m_circuitInterfaces.length>0&&(this.waypointCount=this.m_circuitInterfaces.length)):BABYLON.Tools.Warn("Fail to locate race track manager for: "+this.transform.name)):BABYLON.Tools.Warn("Fail to locate race track manager '"+this.trackManagerIdentity+"' for: "+this.transform.name)},t.prototype.updateVehicleController=function(){if(this.enableInput===!0&&(this.playerNumber===0?this.updateAutoPilotDrive():this.updateManualInputDrive()),this.resetTiming>0&&this.m_standardCarController!=null){var n=BABYLON.SceneManager.GetGameTime();(this.transform.up.y>.5||this.m_standardCarController.getAbsoluteSpeed()>1)&&(this.vehicleResetCheck=n);n>this.vehicleResetCheck+this.resetTiming&&(this.transform.position.addInPlace(BABYLON.Vector3.Up().scale(.5)),BABYLON.Utilities.LookRotationToRef(this.transform.forward,this.transform.rotationQuaternion))}},t.prototype.updateManualInputDrive=function(){if(this.m_standardCarController!=null){this.playerDeltaX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Horizontal,this.playerNumber);this.playerDeltaY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Vertical,this.playerNumber);this.playerMouseX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseX,this.playerNumber);this.playerMouseY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseY,this.playerNumber);var e=BABYLON.SceneManager.GetKeyboardInput(this.auxKeyboardForawrd),o=BABYLON.SceneManager.GetKeyboardInput(this.keyboardForawrd),t=BABYLON.SceneManager.GetGamepadTriggerInput(this.triggerForward,this.playerNumber),s=BABYLON.SceneManager.GetKeyboardInput(this.auxKeyboardBackwards),h=BABYLON.SceneManager.GetKeyboardInput(this.keyboardBackwards),i=BABYLON.SceneManager.GetGamepadTriggerInput(this.triggerBackwards,this.playerNumber),c=BABYLON.SceneManager.GetKeyboardInput(this.keyboardHandbrake),l=BABYLON.SceneManager.GetGamepadButtonInput(this.buttonHandbrake,this.playerNumber),a=BABYLON.SceneManager.GetKeyboardInput(this.keyboardDonut),v=BABYLON.SceneManager.GetGamepadButtonInput(this.buttonDonut,this.playerNumber),n=0,r=0,u=!1,f=!1;t>.2?n=t:this.playerNumber===BABYLON.PlayerNumber.One&&(o===!0||e===!0)&&(n=1);i>.2?n=-i:this.playerNumber===BABYLON.PlayerNumber.One&&(h===!0||s===!0)&&(n=-1);r=this.playerDeltaX;u=c===!0||l===!0;f=a===!0||v===!0;this.m_standardCarController.throttleEngineSpeed=0;this.m_standardCarController.throttleBrakingForce=0;this.m_standardCarController.slideWhenFootBraking=!1;this.m_standardCarController.drive(n,r,u,f,!0)}},t.prototype.updateAutoPilotDrive=function(){var a,u,p,h,w,b,e,rt,ot,st,l;if(this.m_standardCarController!=null){a=this.getGameTime();u=this.transform.getAbsolutePosition();this.driverSkillLevel=BABYLON.Scalar.Clamp(this.driverSkillLevel,1,10);this.raceLineNode=BABYLON.Scalar.Clamp(this.raceLineNode,0,4);this.m_chaseRabbitMesh==null&&(this.m_chaseRabbitMesh=BABYLON.MeshBuilder.CreateSphere(this.transform.name+".Rabbit",{segments:24,diameter:1},this.scene),this.m_chaseRabbitMesh.checkCollisions=!1,this.m_chaseRabbitMesh.receiveShadows=!1,this.m_chaseRabbitMesh.visibility=1,this.m_chaseRabbitMesh.isVisible=!1,this.resetChaseRabbitMesh());this.m_chaseRabbitMesh!=null&&(this.m_chaseRabbitMesh.isVisible===!0&&this.showChaseRabbit===!1&&(this.m_chaseRabbitMesh.isVisible=!1),this.m_chaseRabbitMesh.isVisible===!1&&this.showChaseRabbit===!0&&(this.m_chaseRabbitMesh.isVisible=!0));this.m_standardCarController.getAbsoluteSpeed()>=1&&(this.lastMovementTime=a);var t="",i=!1,n=null,r=0;this.sensorStartPos.copyFrom(u);this.transform.up.scaleAndAddToRef(this.initialOffsetY,this.sensorStartPos);this.transform.forward.scaleAndAddToRef(this.initialOffsetZ,this.sensorStartPos);this.sensorPointPos.copyFrom(this.sensorStartPos);this.transform.forward.scaleAndAddToRef(this.sensorLength,this.sensorPointPos);this.sensorAnglePos.copyFrom(this.sensorPointPos);this.rsideStartPos.copyFrom(u);this.transform.up.scaleAndAddToRef(this.initialOffsetY,this.rsideStartPos);this.transform.right.scaleAndAddToRef(this.initialOffsetX,this.rsideStartPos);this.rsidePointPos.copyFrom(this.rsideStartPos);this.transform.right.scaleAndAddToRef(this.sidewaysLength,this.rsidePointPos);this.lsideStartPos.copyFrom(u);this.transform.up.scaleAndAddToRef(this.initialOffsetY,this.lsideStartPos);this.transform.right.scaleAndAddToRef(-this.initialOffsetX,this.lsideStartPos);this.lsidePointPos.copyFrom(this.lsideStartPos);this.transform.right.scaleAndAddToRef(-this.sidewaysLength,this.lsidePointPos);var v=this.sensorStartPos.clone(),nt=this.sensorPointPos.clone(),y=!1;if(this.transform.right.scaleToRef(this.spacerWidths,this.tempScaleVector),this.sensorStartPos.addInPlace(this.tempScaleVector),this.sensorPointPos.addInPlace(this.tempScaleVector),t="",i=!1,n=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.sensorStartPos,this.sensorPointPos),n.hasHit===!0&&n.collisionObject!=null&&n.collisionObject.entity!=null&&(t=BABYLON.SceneManager.GetTransformTag(n.collisionObject.entity),i=t=="Vehicle"||t==="Obstacle",i===!0&&(y=!0,r-=1)),this.showSensorLines===!0&&(this.mainRightSensorLine==null&&(this.mainRightSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".MainRightSensorLine",this.scene)),i===!0?this.mainRightSensorLine.drawLine([this.sensorStartPos,n.hitPoint],BABYLON.Color3.Yellow()):this.mainRightSensorLine.drawLine([this.sensorStartPos,this.sensorPointPos],BABYLON.Color3.Blue())),p=!1,this.transform.right.scaleToRef(this.spacerWidths*2*this.angleFactors,this.tempScaleVector),this.sensorAnglePos.addInPlace(this.tempScaleVector),t="",i=!1,n=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.sensorStartPos,this.sensorAnglePos),y===!1&&n.hasHit===!0&&n.collisionObject!=null&&n.collisionObject.entity!=null&&(t=BABYLON.SceneManager.GetTransformTag(n.collisionObject.entity),i=t=="Vehicle"||t==="Obstacle",i===!0&&(p=!0,r-=.5)),this.showSensorLines===!0&&(this.angleRightSensorLine==null&&(this.angleRightSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".AngleRightSensorLine",this.scene)),i===!0?this.angleRightSensorLine.drawLine([this.sensorStartPos,n.hitPoint],BABYLON.Color3.Yellow()):this.angleRightSensorLine.drawLine([this.sensorStartPos,this.sensorAnglePos],BABYLON.Color3.Blue())),t="",i=!1,n=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.rsideStartPos,this.rsidePointPos),y===!1&&p===!1&&n.hasHit===!0&&n.collisionObject!=null&&n.collisionObject.entity!=null&&(t=BABYLON.SceneManager.GetTransformTag(n.collisionObject.entity),i=t=="Vehicle"||t==="Obstacle",i===!0&&(r-=.5)),this.showSensorLines===!0&&(this.sideRightSensorLine==null&&(this.sideRightSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".SideRightSensorLine",this.scene)),i===!0?this.sideRightSensorLine.drawLine([this.rsideStartPos,n.hitPoint],BABYLON.Color3.Yellow()):this.sideRightSensorLine.drawLine([this.rsideStartPos,this.rsidePointPos],BABYLON.Color3.Blue())),h=!1,this.transform.right.scaleToRef(-(this.spacerWidths*2),this.tempScaleVector),this.sensorStartPos.addInPlace(this.tempScaleVector),this.sensorPointPos.addInPlace(this.tempScaleVector),t="",i=!1,n=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.sensorStartPos,this.sensorPointPos),n.hasHit===!0&&n.collisionObject!=null&&n.collisionObject.entity!=null&&(t=BABYLON.SceneManager.GetTransformTag(n.collisionObject.entity),i=t=="Vehicle"||t==="Obstacle",i===!0&&(h=!0,r+=1)),this.showSensorLines===!0&&(this.mainLeftSensorLine==null&&(this.mainLeftSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".MainLeftSensorLine",this.scene)),i===!0?this.mainLeftSensorLine.drawLine([this.sensorStartPos,n.hitPoint],BABYLON.Color3.Yellow()):this.mainLeftSensorLine.drawLine([this.sensorStartPos,this.sensorPointPos],BABYLON.Color3.Blue())),w=!1,this.transform.right.scaleToRef(-(this.spacerWidths*4)*this.angleFactors,this.tempScaleVector),this.sensorAnglePos.addInPlace(this.tempScaleVector),t="",i=!1,n=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.sensorStartPos,this.sensorAnglePos),h===!1&&n.hasHit===!0&&n.collisionObject!=null&&n.collisionObject.entity!=null&&(t=BABYLON.SceneManager.GetTransformTag(n.collisionObject.entity),i=t=="Vehicle"||t==="Obstacle",i===!0&&(w=!0,r+=.5)),this.showSensorLines===!0&&(this.angleLeftSensorLine==null&&(this.angleLeftSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".AngleLeftSensorLine",this.scene)),i===!0?this.angleLeftSensorLine.drawLine([this.sensorStartPos,n.hitPoint],BABYLON.Color3.Yellow()):this.angleLeftSensorLine.drawLine([this.sensorStartPos,this.sensorAnglePos],BABYLON.Color3.Blue())),t="",i=!1,n=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.lsideStartPos,this.lsidePointPos),h===!1&&w===!1&&n.hasHit===!0&&n.collisionObject!=null&&n.collisionObject.entity!=null&&(t=BABYLON.SceneManager.GetTransformTag(n.collisionObject.entity),i=t=="Vehicle"||t==="Obstacle",i===!0&&(r+=.5)),this.showSensorLines===!0&&(this.sideLeftSensorLine==null&&(this.sideLeftSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".SideLeftSensorLine",this.scene)),i===!0?this.sideLeftSensorLine.drawLine([this.lsideStartPos,n.hitPoint],BABYLON.Color3.Yellow()):this.sideLeftSensorLine.drawLine([this.lsideStartPos,this.lsidePointPos],BABYLON.Color3.Blue())),t="",i=!1,n=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,v,nt),r===0&&n.hasHit===!0&&n.collisionObject!=null&&n.collisionObject.entity!=null&&(t=BABYLON.SceneManager.GetTransformTag(n.collisionObject.entity),i=t=="Vehicle"||t==="Obstacle",i===!0&&(r=n.hitNormal.x<0?-1:1)),this.showSensorLines===!0&&(this.mainCenterSensorLine==null&&(this.mainCenterSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".MainCenterSensorLine",this.scene)),i===!0?this.mainCenterSensorLine.drawLine([v,n.hitPoint],BABYLON.Color3.Yellow()):this.mainCenterSensorLine.drawLine([v,nt],BABYLON.Color3.Blue())),b=this.getCurrentTrackNode(this.waypointIndex),e=this.getCurrentControlPoint(this.raceLineNode,this.waypointIndex),this.m_chaseRabbitMesh!=null&&this.waypointCount>0&&b!=null&&e!=null){this.waypointPosition.set(e.position.x,e.position.y,e.position.z);var c=(e.speed>0?e.speed:100)*this.getDriverSkillFactor(),tt=b.radius*1,it=BABYLON.Vector3.Distance(this.waypointPosition,u);it<tt?(this.prevTargetSpeed<=0&&(this.prevTargetSpeed=c),this.nextTargetSpeed=BABYLON.Scalar.Lerp(this.prevTargetSpeed,c,1-it/tt),this.showChaseRabbit===!0&&(this.rabbitTrackerColor=this.redTrackingColor)):(this.nextTargetSpeed=c,this.showChaseRabbit===!0&&(this.rabbitTrackerColor=this.greenTrackingColor));var s=this.m_standardCarController.getNormalizedSpeed(),k=this.m_standardCarController.getAmericanSpeed(),ht=BABYLON.Scalar.Lerp(this.minLookAhead,this.maxLookAhead,s),o=this.m_chaseRabbitMesh.getAbsolutePosition(),ct=BABYLON.Vector3.Distance(u,o);ct<=ht&&(this.chaseRabbitSpeed=BABYLON.Scalar.Lerp(1,this.driveSpeedMultiplier,s),this.m_chaseRabbitMesh.lookAt(this.waypointPosition),this.m_chaseRabbitMesh.translate(BABYLON.Axis.Z,this.chaseRabbitSpeed));this.showChaseRabbit===!0&&(this.trackVehiclePosition.set(u.x,u.y+.5,u.z),this.trackRabbitPosition.set(o.x,o.y+.25,o.z),this.rabbitTrackerLine==null&&(this.rabbitTrackerLine=new BABYLON.LinesMeshRenderer(this.transform.name+".TrackingLine",this.scene)),this.rabbitTrackerLine!=null&&this.rabbitTrackerLine.drawLine([this.trackVehiclePosition,this.trackRabbitPosition],this.rabbitTrackerColor));rt=BABYLON.Vector3.Distance(o,this.waypointPosition);rt<=5&&(this.prevTargetSpeed=this.nextTargetSpeed,this.waypointIndex++,this.waypointIndex>=this.waypointCount&&(this.waypointIndex=0));BABYLON.Utilities.InverseTransformPointToRef(this.transform,o,this.localTargetPosition);a>this.lastMovementTime+this.resetMovingTimeout;var lt=BABYLON.Tools.ToDegrees(Math.atan2(this.localTargetPosition.x,this.localTargetPosition.z)),ut=BABYLON.Scalar.Clamp(Math.abs(lt),0,90),at=ut/90,f=0,d=0,ft=!1,vt=this.maxRaceTrackSpeed,g=1*this.throttleSensitivity,et=BABYLON.Scalar.Clamp(this.localTargetPosition.x/this.localTargetPosition.length()*this.steeringSensitivity,-1,1);this.avoidanceFactor>0&&r!==0&&(ot=r*.6*this.avoidanceFactor,st=r*.3*this.avoidanceFactor,et+=BABYLON.Scalar.Lerp(ot,st,s));l=!1;this.nextTargetSpeed<=0&&(this.nextTargetSpeed=c);k>this.nextTargetSpeed&&(d=BABYLON.Scalar.Lerp(0,this.linearDampenForce,s),g*=.2);this.brakingTurnAngle>0&&ut>=this.brakingTurnAngle&&k>=this.brakingSpeedLimit&&(f=BABYLON.Scalar.Lerp(0,1+s,at),d=0,ft=!0,l=f>0&&this.inBrakingZone===!0&&this.brakingZoneTag===this.handBrakeZoneTag&&k>=this.skiddingSpeedLimit,l===!0&&(f=1));f>0&&(f=BABYLON.Scalar.Clamp(f*this.brakingSensitivity,0,1));f>0&&(g=-f);this.m_standardCarController.throttleEngineSpeed=vt;this.m_standardCarController.throttleBrakingForce=d;this.m_standardCarController.slideWhenFootBraking=ft;this.m_standardCarController.drive(g,et,l,!1,!1)}}},t.prototype.getDriverSkillFactor=function(){var n=.6;switch(this.driverSkillLevel){case 10:n=1;break;case 9:n=.98;break;case 8:n=.95;break;case 7:n=.9;break;case 6:n=.85;break;case 5:n=.8;break;case 4:n=.75;break;case 3:n=.7;break;case 2:n=.65;break;case 1:n=.6}return n},t.prototype.getCurrentTrackNode=function(n){var t=null;return n>=0&&n<this.waypointCount&&(t=this.m_circuitInterfaces[n]),t},t.prototype.getCurrentControlPoint=function(n,t){var i=null;if(t>=0&&t<this.waypointCount)switch(n){case 0:i=this.m_circuitRaceLine_1[t];break;case 1:i=this.m_circuitRaceLine_2[t];break;case 2:i=this.m_circuitRaceLine_3[t];break;case 3:i=this.m_circuitRaceLine_4[t];break;case 4:i=this.m_circuitRaceLine_5[t]}return i},t.prototype.destroyVehicleController=function(){this.m_circuitInterfaces=null;this.m_circuitRaceLine_1=null;this.m_circuitRaceLine_2=null;this.m_circuitRaceLine_3=null;this.m_circuitRaceLine_4=null;this.m_circuitRaceLine_5=null;this.m_rigidbodyPhysics=null;this.m_standardCarController=null;this.m_chaseRabbitMesh!=null&&(this.m_chaseRabbitMesh.dispose(),this.m_chaseRabbitMesh=null)},t}(BABYLON.ScriptComponent);n.VehicleInputController=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.captionType=0,t.displayTimer=5,t.domElement=null,t.textTracks=null,t.logCaptions=!1,t.m_captionSource=null,t.m_captionTimer=0,t.onUpdateCaptionObservable=new BABYLON.Observable,t}return __extends(t,n),t.prototype.getCaptionType=function(){return this.captionType},t.prototype.awake=function(){this.awakeCaptionSystem()},t.prototype.start=function(){this.startCaptionSystem()},t.prototype.update=function(){this.updateCaptionSystem()},t.prototype.destroy=function(){this.destroyCaptionSystem()},t.prototype.awakeCaptionSystem=function(){this.captionType=this.getProperty("captionType",this.captionType);this.displayTimer=this.getProperty("displayTimer",this.displayTimer);this.domElement=this.getProperty("domElement",this.domElement);this.textTracks=this.getProperty("textTracks",this.textTracks);this.logCaptions=this.getProperty("logCaptions",this.logCaptions);this.transform.metadata==null&&(this.transform.metadata={});this.transform.metadata.vtt=!0},t.prototype.startCaptionSystem=function(){this.captionType===0?(this.m_captionSource=this.getComponent("BABYLON.WebVideoPlayer"),this.m_captionSource==null&&BABYLON.Tools.Warn("Failed to locate web video player component for: "+this.transform.name)):(this.m_captionSource=this.getComponent("BABYLON.AudioSource"),this.m_captionSource==null&&BABYLON.Tools.Warn("Failed to locate audio source component for: "+this.transform.name));this.m_captionSource!=null&&this.attachCaptionSystem();this.postCaptionMessage("")},t.prototype.updateCaptionSystem=function(){this.displayTimer>0&&this.m_captionTimer>0&&(this.m_captionTimer+=this.getDeltaSeconds(),this.m_captionTimer>=this.displayTimer&&this.postCaptionMessage(""))},t.prototype.destroyCaptionSystem=function(){this.textTracks=null;this.m_captionSource=null;this.m_captionElement=null;this.onUpdateCaptionObservable.clear();this.onUpdateCaptionObservable=null},t.prototype.attachCaptionSystem=function(){var n=this,t=BABYLON.SceneManager.GetRootUrl(this.scene);this.textTracks!=null&&this.textTracks.length>0&&this.textTracks.forEach(function(i){var r=document.createElement("track"),u,f;r.src=t+i.trackAsset.filename;r.kind=n.formatTextTrackKind(i.trackKind);r.label=i.trackLabel;r.srclang=i.trackLanguage;r.default=i.isDefaultTrack;r.addEventListener("cuechange",function(t){var i=t.target,r;i!=null&&i.track!=null&&i.track.activeCues!=null&&i.track.activeCues[0]!=null&&(r=i.track.activeCues[0],r.text!=null&&r.text!==""&&(n.logCaptions===!0&&console.log(r.text),n.postCaptionMessage(r.text)))});n.m_captionSource instanceof BABYLON.WebVideoPlayer?(u=n.m_captionSource.getVideoElement(),u!=null?u.appendChild(r):BABYLON.Tools.Warn("Null html video element for: "+n.transform.name)):n.m_captionSource instanceof BABYLON.AudioSource&&(f=n.m_captionSource.getAudioElement(),f!=null?f.appendChild(r):BABYLON.Tools.Warn("Null html audio element for: "+n.transform.name))})},t.prototype.postCaptionMessage=function(n){this.m_captionTimer=0;n!=null&&(this.onUpdateCaptionObservable.hasObservers()===!0&&this.onUpdateCaptionObservable.notifyObservers(n),this.domElement!=null&&(this.m_captionElement==null&&(this.m_captionElement=document.getElementById(this.domElement)),this.m_captionElement!=null&&(this.m_captionElement.innerHTML=n)),n!==""&&(this.m_captionTimer=1e-5))},t.prototype.formatTextTrackKind=function(n){var t="subtitles";switch(n){case 0:t="subtitles";break;case 1:t="captions";break;case 2:t="descriptions";break;case 3:t="chapters";break;case 4:t="metadata"}return t},t.EnableTextTracks=function(n,t){if(n!=null&&n.textTracks!=null&&n.textTracks.length>0)for(var i=0;i<n.textTracks.length;i++)n.textTracks[i].mode=t===!0?"showing":"disabled"},t.SetDefaultTextTrack=function(n){if(n!=null&&n.textTracks!=null&&n.textTracks.length>0)for(var t=0;t<n.textTracks.length;t++);},t}(BABYLON.ScriptComponent);n.CaptionSystem=t}(MVRK||(MVRK={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.isReady=!1,t.groupName=null,t.m_soundMap=null,t.m_soundList=null,t}return __extends(t,n),t.prototype.getIsReady=function(){return this.isReady},t.prototype.getGroupName=function(){return this.groupName},t.prototype.awake=function(){this.groupName=this.getProperty("groupName",this.transform.name);this.m_soundMap=new Map;this.m_soundList=[];this.isReady=!1},t.prototype.start=function(){var t=this.getProperty("audioTracks"),i,f,r,u,n;if(t!=null&&t.length>0)for(i=0;i<t.length;i++)f=t[i],r=BABYLON.Utilities.ParseTransformByID(f,this.scene),r!=null&&(u=BABYLON.SceneManager.FindScriptComponent(r,"BABYLON.AudioSource"),u!=null&&(n=u.getSoundClip(),n!=null&&(this.m_soundMap.set(n.name,n),this.m_soundList.push(n))))},t.prototype.update=function(){},t.prototype.destroy=function(){this.m_soundList=null;this.m_soundMap.clear();this.m_soundMap=null},t.prototype.getSound=function(n){var t=this.m_soundMap.get(n);return t!=null?t:null},t.prototype.playSound=function(n,t,i,r){var u=!1,f=this.getSound(n);return f!=null&&(f.play(t,i,r),u=!0),u},t.prototype.stopSound=function(n,t){var i=!1,r=this.getSound(n);return r!=null&&(r.stop(t),i=!0),i},t.prototype.stopGroupSound=function(n){var t,i;if(this.m_soundList!=null&&this.m_soundList.length>0)for(t=0;t<this.m_soundList.length;t++)i=this.m_soundList[t],i!=null&&i.stop(n)},t.prototype.setGroupVolume=function(n,t){var i,r;if(this.m_soundList!=null&&this.m_soundList.length>0)for(i=0;i<this.m_soundList.length;i++)r=this.m_soundList[i],r!=null&&r.setVolume(n,t)},t}(BABYLON.ScriptComponent);n.SoundManager=t}(MVRK||(MVRK={})),function(n){var t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.VideoController=t}(MVRK||(MVRK={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.abstractMesh=null,n}return __extends(i,t),i.prototype.awake=function(){this.abstractMesh=this.getAbstractMesh()},i.prototype.update=function(){var t,i;n.InsideNotification.CurrentRoom!==this.transform.name&&(t=this.scene.activeCamera.globalPosition,this.pointIsInside(t)&&(n.InsideNotification.CurrentRoom=this.transform.name,i='{"command":"location","param1":"'+this.transform.name+'"}',BABYLON.SceneManager.PostWindowMessage(i,"*")))},i.prototype.pointIsInside=function(n){if(this.abstractMesh!=null){var r=this.abstractMesh.getBoundingInfo(),t=r.boundingBox.maximumWorld,i=r.boundingBox.minimumWorld;if(n.x<i.x||n.x>t.x||n.y<i.y||n.y>t.y||n.z<i.z||n.z>t.z)return!1}return!0},i.CurrentRoom="",i}(BABYLON.ScriptComponent);n.InsideNotification=t}(MVRK||(MVRK={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.triggerType="vod",t.triggerParam="defaultParam",t.triggerFocus=null,t.abstractMesh=null,t}return __extends(t,n),t.prototype.awake=function(){var t=this,n,i;this.triggerParam=this.getProperty("triggerParam",this.triggerParam);this.triggerType=this.getProperty("triggerType",this.triggerType);this.abstractMesh=this.getAbstractMesh();this.abstractMesh!=null&&(this.abstractMesh.actionManager=new BABYLON.ActionManager(this.scene));n=this.getProperty("triggerFocus");n!=null&&(this.triggerFocus=BABYLON.Utilities.ParseTransformByID(n,this.scene));i='{"command":"'+this.triggerType+'","param":"'+this.triggerParam+'"}';this.abstractMesh!=null&&this.abstractMesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPickTrigger},function(){!t.triggerFocus||t.gradualFocus();BABYLON.SceneManager.PostWindowMessage(i,"*")}))},t.prototype.gradualFocus=function(){var i=this.scene.activeCamera,n=new BABYLON.Mesh("empty",this.scene),t,r;n.position=i.position.clone();n.rotation=i.rotation.clone();n.movePOV(0,0,-2);t=n.position.clone();r=this.triggerFocus.absolutePosition;this.scene.activeCamera.lockedTarget=t;n.dispose();this.lerpCameraView(t,r,0)},t.prototype.lerpCameraView=function(n,t,i){var r=this,u=BABYLON.Vector3.Lerp(n,t,i);i<1?setTimeout(function(){var f=i+.01;r.scene.activeCamera.lockedTarget=u;r.lerpCameraView(n,t,f)},5):this.scene.activeCamera.lockedTarget=null},t}(BABYLON.ScriptComponent);n.PopupTrigger=t}(MVRK||(MVRK={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.floatSpeed=1,t.floatDistance=.2,t.randomOffset=.1,t.initPosition=new BABYLON.Vector3(0,0,0),t.floatingVector=new BABYLON.Vector3(0,0,0),t}return __extends(t,n),t.prototype.awake=function(){this.floatSpeed=this.getProperty("floatSpeed",this.floatSpeed);this.floatDistance=this.getProperty("floatDistance",this.floatDistance);this.randomOffset=BABYLON.Scalar.RandomRange(-Math.PI,Math.PI);this.initPosition.copyFrom(this.transform.position)},t.prototype.update=function(){var n=this.getGameTime();this.floatingVector.set(0,Math.sin((n+this.randomOffset)*this.floatSpeed)*this.floatDistance,0);this.floatingVector.addToRef(this.initPosition,this.transform.position)},t.prototype.destroy=function(){this.initPosition=null;this.floatingVector=null},t}(BABYLON.ScriptComponent);n.FloatingAnimation=t}(MVRK||(MVRK={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.rotateSpeedX=0,t.rotateSpeedY=0,t.rotateSpeedZ=1,t}return __extends(t,n),t.prototype.awake=function(){this.rotateSpeedX=this.getProperty("rotateSpeedX",this.rotateSpeedX);this.rotateSpeedY=this.getProperty("rotateSpeedY",this.rotateSpeedY);this.rotateSpeedZ=this.getProperty("rotateSpeedZ",this.rotateSpeedZ);this.transform.rotation==null&&(this.transform.rotation=new BABYLON.Vector3(0,0,0));this.transform.rotationQuaternion!=null&&(this.transform.rotationQuaternion.toEulerAnglesToRef(this.transform.rotation),this.transform.rotationQuaternion=null)},t.prototype.update=function(){var n=this.getDeltaSeconds();this.rotateSpeedX!==0&&(this.transform.rotation.x+=this.rotateSpeedX*n);this.rotateSpeedY!==0&&(this.transform.rotation.y+=this.rotateSpeedY*n);this.rotateSpeedZ!==0&&(this.transform.rotation.z+=this.rotateSpeedZ*n)},t}(BABYLON.ScriptComponent);n.RotateTransform=t}(MVRK||(MVRK={})),function(n){var t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.gridCols=1,t.gridRows=1,t.startRow=1,t.bottomUp=!1,t.timeInSeconds=1,t.colWidth=0,t.rowHeight=0,t.animTimer=0,t.tileIndex=0,t.tileReset=0,t.baseTexture=null,t}return __extends(t,n),t.prototype.awake=function(){var f,t,n,i,r,u;this.gridCols=this.getProperty("gridCols",this.gridCols);this.gridRows=this.getProperty("gridRows",this.gridRows);this.startRow=this.getProperty("startRow",this.startRow);this.bottomUp=this.getProperty("bottomUp",this.bottomUp);this.timeInSeconds=this.getProperty("timeInSeconds",this.timeInSeconds);this.colWidth=1/this.gridCols;this.rowHeight=1/this.gridRows;this.tileIndex=0;this.tileReset=0;f=this.gridCols*this.gridRows;t=this.getProperty("maxTileCount",0);t>0&&t<f&&(this.tileReset=t);n=this.getAbstractMesh();n!=null&&n.material!=null&&(n.material instanceof BABYLON.PBRMaterial?(i=n.material.clone(n.name+"."+n.material.name),this.baseTexture=i.albedoTexture,n.material=i):n.material instanceof BABYLON.StandardMaterial&&(r=n.material.clone(n.name+"."+n.material.name),this.baseTexture=r.diffuseTexture,n.material=r));this.baseTexture!=null&&(this.baseTexture.uScale=this.colWidth,this.baseTexture.vScale=this.rowHeight,u=BABYLON.Scalar.Clamp((this.startRow-1)*this.rowHeight),this.baseTexture.uOffset=0,this.baseTexture.vOffset=this.bottomUp===!0?u:1-u-this.rowHeight,this.startRow>1&&(this.tileIndex=(this.startRow-1)*this.gridCols))},t.prototype.start=function(){this.animTimer=0},t.prototype.reset=function(){this.baseTexture!=null&&(this.baseTexture.uOffset=0,this.baseTexture.vOffset=this.bottomUp===!0?0:1-this.rowHeight)},t.prototype.update=function(){this.timeInSeconds>0&&(this.animTimer+=this.getDeltaSeconds(),this.animTimer>=this.timeInSeconds&&(this.animTimer=0,this.animate()))},t.prototype.animate=function(){this.baseTexture!=null&&(this.baseTexture.uOffset>=1-this.colWidth?(this.baseTexture.uOffset=0,this.bottomUp===!0?this.baseTexture.vOffset>=1-this.rowHeight?this.baseTexture.vOffset=0:this.baseTexture.vOffset+=this.rowHeight:this.baseTexture.vOffset<=0?this.baseTexture.vOffset=1-this.rowHeight:this.baseTexture.vOffset-=this.rowHeight,(this.baseTexture.vOffset<0||this.baseTexture.vOffset>0)&&(this.baseTexture.vOffset=BABYLON.Scalar.Clamp(this.baseTexture.vOffset))):this.baseTexture.uOffset+=this.colWidth,(this.baseTexture.uOffset<0||this.baseTexture.uOffset>0)&&(this.baseTexture.uOffset=BABYLON.Scalar.Clamp(this.baseTexture.uOffset)));this.tileReset>0&&(this.tileIndex++,this.tileIndex>=this.tileReset&&(this.tileIndex=0,this.reset()))},t.prototype.destroy=function(){this.baseTexture=null},t}(BABYLON.ScriptComponent);n.SpriteAnimation=t}(MVRK||(MVRK={})),function(n){var t=function(){function n(){}return n.SwitchScene=function(n){BABYLON.SceneManager.LoadSceneFile(n)},n}();n.SceneLoader=t}(MVRK||(MVRK={})),function(n){var t=function(n){function t(t,i,r){return r===void 0&&(r={}),n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.update=function(){this.getAbstractMesh().setPositionWithLocalVector(new BABYLON.Vector3(0,0,0))},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.AnchorInSpot=t}(PROJECT||(PROJECT={})),function(n){var t=function(){function n(n,t){this.name=n;this.animator=t}return n}(),i;n.Animator=t;i=function(i){function r(t,r,u){u===void 0&&(u={});var f=i.call(this,t,r,u)||this;return f.animators=[],f.draggables=[],n.AnimatorManager._instance==null&&(n.AnimatorManager._instance=f),f}return __extends(r,i),Object.defineProperty(r,"Instance",{get:function(){return r._instance},enumerable:!1,configurable:!0}),r.prototype.awake=function(){var n=this,i,u;BABYLON.SceneManager.SetWindowState("AnimatorManager",r.Instance);i=this.getProperty("animators");u=this.getProperty("draggables");u.forEach(function(t){var i=n.scene.getNodeByID(t.id);n.draggables.push(i)});i.forEach(function(i){var r=n.scene.getNodeByID(i.id),u=BABYLON.SceneManager.FindScriptComponent(r,"BABYLON.AnimationState"),f=new t(r.name,u);n.animators.push(f)});this.BindEndAnimationMessages(this.animators)},r.prototype.GetAnimator=function(n){var t=null;return this.animators.forEach(function(i){if(i.name===n)return t=i}),t},r.prototype.BindEndAnimationMessages=function(){},r.prototype.ResetDraggables=function(){this.draggables.forEach(function(n){n.setPositionWithLocalVector(new BABYLON.Vector3(0,0,0))})},r}(BABYLON.ScriptComponent);n.AnimatorManager=i}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.awake=function(){this.camera=this.scene.activeCamera},t.prototype.start=function(){},t.prototype.update=function(){var t=this.camera.globalPosition,n=this.transform.absolutePosition,i=t.subtract(n).normalize().scale(-1);this.transform.lookAt(n.add(i),null,null,null,BABYLON.Space.WORLD)},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.BillboardMesh=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.drag=null,u.leftBound=0,u.rightBound=1,u.canDrag=!1,u}return __extends(t,n),t.prototype.awake=function(){var n=this,t=this.getAbstractMesh(),i=this.transform.absolutePosition;this.leftBound=this.getProperty("leftBound",this.leftBound);this.rightBound=this.getProperty("rightBound",this.rightBound);this.canDrag=this.getProperty("canDrag",this.canDrag);this.drag=new BABYLON.PointerDragBehavior({dragPlaneNormal:new BABYLON.Vector3(0,0,1)});t!=null&&this.canDrag&&(t.addBehavior(this.drag),this.drag.validateDrag=function(t){var r=BABYLON.Utilities.InverseTransformPoint(n.transform.parent,t),u=BABYLON.Scalar.Normalize(n.transform.getPositionExpressedInLocalSpace().x,0,1),f={dragValue:u};return(BABYLON.SceneManager.PostWindowMessage(JSON.stringify(f),"*"),t.y!=i.y&&(t.y=i.y),r.x<n.leftBound)?!1:r.x>n.rightBound?!1:!0})},t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.LimitedDrag=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){return r===void 0&&(r={}),n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.awake=function(){this.abstractMesh=this.getAbstractMesh();this.abstractMesh!=null&&(this.abstractMesh.actionManager=new BABYLON.ActionManager(this.scene));this.abstractMesh!=null&&this.abstractMesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPickTrigger},function(){}))},t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.Pickable=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.drag=null,u.axis=null,u.angle=.02,u.tempPointerX=0,u}return __extends(t,n),t.prototype.awake=function(){var n=this,i=this.getAbstractMesh(),r=this.transform.absolutePosition,t;this.axis=new BABYLON.Vector3(0,1,0);this.angle=.04;t=this.scene.pointerX;this.drag=new BABYLON.PointerDragBehavior({dragPlaneNormal:new BABYLON.Vector3(0,0,1)});i!=null&&(i.addBehavior(this.drag),this.drag.validateDrag=function(){var i=t-n.scene.pointerX;return Math.abs(i)>50?(t=n.scene.pointerX,!1):Math.abs(i)>50?(t=n.scene.pointerX,!1):(i>0?n.direction=1:i<0&&(n.direction=-1),n.direction===1?n.transform.rotate(n.axis,n.angle,BABYLON.Space.WORLD):n.direction===-1&&n.transform.rotate(n.axis,-n.angle,BABYLON.Space.WORLD),t=n.scene.pointerX,!0)})},t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.Rotator=t}(PROJECT||(PROJECT={})),function(n){var s=function(t){function i(){var i=t!==null&&t.apply(this,arguments)||this;return i._frametime=0,i._layercount=0,i._updatemode=0,i._hasrootmotion=!1,i._processmotion=!0,i._initialtargetblending=!1,i._hastransformhierarchy=!1,i._leftfeetbottomheight=0,i._rightfeetbottomheight=0,i._runtimecontroller=null,i._executed=!1,i._checkers=new n.TransitionCheck,i._source="",i._machine=null,i._deltaPosition=new n.Vector3(0,0,0),i._deltaRotation=new n.Quaternion(0,0,0,1),i._deltaAngleY=0,i._positionWeight=!1,i._rootBoneWeight=!1,i._rotationWeight=!1,i._rootQuatWeight=!1,i._positionHolder=new n.Vector3(0,0,0),i._rootBoneHolder=new n.Vector3(0,0,0),i._rotationHolder=new n.Quaternion(0,0,0,1),i._rootQuatHolder=new n.Quaternion(0,0,0,1),i._rootMotionMatrix=n.Matrix.Zero(),i._rootMotionScaling=new n.Vector3(0,0,0),i._rootMotionRotation=new n.Quaternion(0,0,0,1),i._rootMotionPosition=new n.Vector3(0,0,0),i._lastMotionRotation=new n.Quaternion(0,0,0,1),i._lastMotionPosition=new n.Vector3(0,0,0),i._quatRotationDiff=new n.Quaternion(0,0,0,1),i._quatRotateVector=new n.Vector3(0,0,0),i._dirtyMotionMatrix=null,i._dirtyBlenderMatrix=null,i._targetPosition=new n.Vector3(0,0,0),i._targetRotation=new n.Quaternion(0,0,0,1),i._targetScaling=new n.Vector3(1,1,1),i._updateMatrix=n.Matrix.Zero(),i._blenderMatrix=n.Matrix.Zero(),i._blendWeights=new n.BlendingWeights,i._data=new Map,i._anims=new Map,i._numbers=new Map,i._booleans=new Map,i._triggers=new Map,i._parameters=new Map,i.speedRatio=1,i.applyRootMotion=!1,i.enableAnimation=!0,i.m_avatarMask=null,i.m_defaultGroup=null,i.m_animationTargets=null,i.onAnimationIKObservable=new n.Observable,i.onAnimationEndObservable=new n.Observable,i.onAnimationLoopObservable=new n.Observable,i.onAnimationEventObservable=new n.Observable,i.onAnimationUpdateObservable=new n.Observable,i}return __extends(i,t),i.prototype.hasRootMotion=function(){return this._hasrootmotion},i.prototype.getAnimationTime=function(){return this._frametime},i.prototype.getDeltaPosition=function(){return this._deltaPosition},i.prototype.getDeltaRotation=function(){return this._deltaRotation},i.prototype.getRuntimeController=function(){return this._runtimecontroller},i.prototype.awake=function(){this.awakeStateMachine()},i.prototype.late=function(){this.lateStateMachine()},i.prototype.destroy=function(){this.destroyStateMachine()},i.prototype.playAnimation=function(t,i,r,u){var f;if(i===void 0&&(i=0),r===void 0&&(r=0),u===void 0&&(u=null),f=!1,this._machine.layers!=null&&this._machine.layers.length>r){var e=this._machine.layers[r],o=e.animationStateMachine!=null?e.animationStateMachine.rate||n.AnimationState.FPS:n.AnimationState.FPS,s=i>0?n.Utilities.ComputeBlendingSpeed(u||o,i):0;this.setCurrentAnimationState(e,t,s);f=!0}else n.Tools.Warn("No animation state layers on "+this.transform.name);return f},i.prototype.getBool=function(n){return this._booleans.get(n)||!1},i.prototype.setBool=function(n,t){this._booleans.set(n,t)},i.prototype.getFloat=function(n){return this._numbers.get(n)||0},i.prototype.setFloat=function(n,t){this._numbers.set(n,t)},i.prototype.getInteger=function(n){return this._numbers.get(n)||0},i.prototype.setInteger=function(n,t){this._numbers.set(n,t)},i.prototype.getTrigger=function(n){return this._triggers.get(n)||!1},i.prototype.setTrigger=function(n){this._triggers.set(n,!0)},i.prototype.resetTrigger=function(n){this._triggers.set(n,!1)},i.prototype.getMachineState=function(n){return this._data.get(n)},i.prototype.setMachineState=function(n,t){this._data.set(n,t)},i.prototype.getCurrentState=function(n){return this._machine.layers!=null&&this._machine.layers.length>n?this._machine.layers[n].animationStateMachine:null},i.prototype.getAnimationGroup=function(n){return this._anims.get(n)},i.prototype.getAnimationGroups=function(){return this._anims},i.prototype.setAnimationGroups=function(t,i){var r=this;i===void 0&&(i=!1);t!=null&&t.length>0&&(this._anims=new Map,this.m_animationTargets=[],this.m_defaultGroup=t[0],t.forEach(function(t){var i=t;try{t.stop()}catch(u){}t.targetedAnimations!=null&&t.targetedAnimations.length>0&&t.targetedAnimations.forEach(function(t){for(var e,i,o,u,s,h=-1,f=0;f<r.m_animationTargets.length;f++)if(r.m_animationTargets[f].target===t.target){h=f;break}if(h<0)if(r.m_animationTargets.push(t),t.target.metadata==null&&(t.target.metadata={}),t.target instanceof n.TransformNode){for(n.Utilities.ValidateTransformQuaternion(t.target),e=[],u=0;u<r._layercount;u++)i=new n.AnimationMixer,i.positionBuffer=null,i.rotationBuffer=null,i.scalingBuffer=null,i.originalMatrix=null,i.blendingFactor=0,i.blendingSpeed=0,i.rootPosition=null,i.rootRotation=null,e.push(i);t.target.metadata.mixer=e}else if(t.target instanceof n.MorphTarget){for(o=[],u=0;u<r._layercount;u++)s=new n.AnimationMixer,s.influenceBuffer=null,o.push(s);t.target.metadata.mixer=o}});i!=null&&i.metadata!=null&&i.metadata.unity!=null&&i.metadata.unity.clip!=null&&i.metadata.unity.clip!==""&&r._anims.set(i.metadata.unity.clip,t)}))},i.prototype.getRootMotionAngle=function(){return this._deltaAngleY},i.prototype.getRootMotionSpeed=function(){var t=this._deltaPosition.length();return t>=n.AnimationState.MOTION?t:0},i.prototype.getForwardMoveSpeed=function(n){return n===void 0&&(n=!0),n?Math.abs(this._deltaPosition.z):this._deltaPosition.z},i.prototype.awakeStateMachine=function(){var t=this,r,i;this.m_animationTargets=[];this.m_defaultGroup=null;this.m_avatarMask=new Map;this._machine=this.getProperty("machine",this._machine);this._updatemode=this.getProperty("updatemode",this._updatemode);this._hasrootmotion=this.getProperty("hasrootmotion",this._hasrootmotion);this._processmotion=this.getProperty("parserootmotion",this._processmotion);this._runtimecontroller=this.getProperty("runtimecontroller",this._runtimecontroller);this._hastransformhierarchy=this.getProperty("hastransformhierarchy",this._hastransformhierarchy);this._leftfeetbottomheight=this.getProperty("leftfeetbottomheight",this._leftfeetbottomheight);this._rightfeetbottomheight=this.getProperty("rightfeetbottomheight",this._rightfeetbottomheight);this.applyRootMotion=this.getProperty("applyrootmotion",this.applyRootMotion);this._source=this.transform.metadata!=null&&this.transform.metadata.unity!=null&&this.transform.metadata.unity.animator!=null&&this.transform.metadata.unity.animator!==""?this.transform.metadata.unity.animator:null;this._machine!=null&&(this._machine.speed!=null&&(this.speedRatio=this._machine.speed),this._machine.parameters!=null&&this._machine.parameters.length>0&&(r=this._machine.parameters,r.forEach(function(i){var r=i.name,u=i.type,s=i.curve,f=i.defaultFloat,e=i.defaultBool,o=i.defaultInt;t._parameters.set(r,u);u===n.AnimatorParameterType.Bool?t.setBool(r,e):u===n.AnimatorParameterType.Float?t.setFloat(r,f):u===n.AnimatorParameterType.Int?t.setInteger(r,o):u===n.AnimatorParameterType.Trigger&&t.resetTrigger(r)})),this._machine.layers!=null&&this._machine.layers.length>0&&(this._layercount=this._machine.layers.length,this._machine.layers.sort(function(n,t){return n.index<t.index?-1:n.index>t.index?1:0}),this._machine.layers.forEach(function(n){if(n.avatarMask!=null&&n.avatarMask.transformPaths!=null&&n.avatarMask.transformPaths.length>0)for(var i=0;i<n.avatarMask.transformPaths.length;i++)t.m_avatarMask.set(n.avatarMask.transformPaths[i],i)})));this._source!=null&&this._source!==""&&this.scene.animationGroups!=null&&(i=null,this.scene.animationGroups.forEach(function(n){var r=n;r!=null&&r.metadata!=null&&r.metadata.unity!=null&&r.metadata.unity.source!=null&&r.metadata.unity.source!==""&&r.metadata.unity.source===t._source&&(i==null&&(i=[]),i.push(n))}),i!=null&&i.length>0&&this.setAnimationGroups(i));this._machine!=null&&this._machine.states!=null&&this._machine.states.length>0&&this._machine.states.forEach(function(n){n!=null&&n.name!=null&&(t.setupTreeBranches(n.blendtree),t.setMachineState(n.name,n))})},i.prototype.lateStateMachine=function(n){var i=this,t;n===void 0&&(n=null);this._executed===!1&&(this._executed=!0,this._machine.layers!=null&&this._machine.layers.length>0&&this._machine.layers.forEach(function(n){i.setCurrentAnimationState(n,n.entry,0)}));this.enableAnimation===!0&&(t=n||this.getDeltaSeconds(),this.updateAnimationState(t),this.updateAnimationCurves(t),this.updateAnimationTargets(t),this.onAnimationUpdateObservable.hasObservers()===!0&&this.onAnimationUpdateObservable.notifyObservers(this.transform))},i.prototype.destroyStateMachine=function(){this._data=null;this._anims=null;this._numbers=null;this._booleans=null;this._triggers=null;this._parameters=null;this._checkers=null;this._machine=null;this.onAnimationIKObservable.clear();this.onAnimationIKObservable=null;this.onAnimationEndObservable.clear();this.onAnimationEndObservable=null;this.onAnimationLoopObservable.clear();this.onAnimationLoopObservable=null;this.onAnimationEventObservable.clear();this.onAnimationEventObservable=null;this.onAnimationUpdateObservable.clear();this.onAnimationUpdateObservable=null},i.prototype.updateAnimationState=function(n){var t=this;this._machine.layers!=null&&this._machine.layers.length>0&&this._machine.layers.forEach(function(i){t.checkStateMachine(i,n)})},i.prototype.updateAnimationCurves=function(){},i.prototype.updateAnimationTargets=function(t){var i=this;this.transform.rotationQuaternion!=null||this.transform.rotation!=null;this._machine.layers!=null&&this._machine.layers.length>0&&this._machine.layers.forEach(function(r){var f,d,c,tt,h,nt,y,p,rt,ut,b,ft,v,k,e,et,ot;if(r.index===0&&(i._frametime=r.animationTime),r.animationStateMachine!=null&&r.animationStateMachine.blendtree!=null&&(r.iKPass===!0&&i.onAnimationIKObservable.hasObservers()===!0&&i.onAnimationIKObservable.notifyObservers(r.index),f=r.animationStateMachine,f.type===n.MotionType.Clip&&f.played!==-1&&(f.played+=t),f.blendtree.children!=null&&f.blendtree.children.length>0&&(d=f.blendtree.children[0],d!=null)))if(f.blendtree.blendType==n.BlendTreeType.Clip){if(c=d.track,c!=null){y=n.AnimationState.TIME/c.to;r.animationNormal=r.animationTime/n.AnimationState.TIME;p=r.animationNormal>.99?1:r.animationNormal;tt=Math.round(p*100)/100;f.speed<0&&(r.animationNormal=1-r.animationNormal);var w=c.to*r.animationNormal,o=0,g=!1,st=!1,ht=0,ct=!1,s=0,lt=!1,at=!1,vt=!1,it=!1,l=!1,a=!1,u=c;u.metadata!=null&&u.metadata.unity!=null&&u.metadata.unity.settings!=null&&(o=u.metadata.unity.settings.level!=null?u.metadata.unity.settings.level:0,g=u.metadata.unity.settings.looptime!=null?u.metadata.unity.settings.looptime:!1,st=u.metadata.unity.settings.loopblend!=null?u.metadata.unity.settings.loopblend:!1,ht=u.metadata.unity.settings.cycleoffset!=null?u.metadata.unity.settings.cycleoffset:0,ct=u.metadata.unity.settings.heightfromfeet!=null?u.metadata.unity.settings.heightfromfeet:!1,s=u.metadata.unity.settings.orientationoffsety!=null?u.metadata.unity.settings.orientationoffsety:0,lt=u.metadata.unity.settings.keeporiginalorientation!=null?u.metadata.unity.settings.keeporiginalorientation:!1,at=u.metadata.unity.settings.keeporiginalpositionxz!=null?u.metadata.unity.settings.keeporiginalpositionxz:!1,vt=u.metadata.unity.settings.keeporiginalpositiony!=null?u.metadata.unity.settings.keeporiginalpositiony:!1,it=u.metadata.unity.settings.loopblendorientation!=null?u.metadata.unity.settings.loopblendorientation:!1,l=u.metadata.unity.settings.loopblendpositiony!=null?u.metadata.unity.settings.loopblendpositiony:!1,a=u.metadata.unity.settings.loopblendpositionxz!=null?u.metadata.unity.settings.loopblendpositionxz:!1);s=n.Tools.ToRadians(s);s*=-1;o*=-1;r.animationTime>=n.AnimationState.TIME&&(r.animationFirstRun=!1,r.animationLoopFrame=!0,g===!0?i.onAnimationLoopObservable.hasObservers()===!0&&i.onAnimationLoopObservable.notifyObservers(r.index):r.animationEndFrame===!1&&(r.animationEndFrame=!0,i.onAnimationEndObservable.hasObservers()===!0&&i.onAnimationEndObservable.notifyObservers(r.index)));(r.animationFirstRun===!0||g===!0)&&c.targetedAnimations.forEach(function(t){var f,y,u,e,c,v,h,p;t.target instanceof n.TransformNode?(f=t.target,(r.index===0||r.avatarMask==null||i.filterTargetAvatarMask(r,f))&&(y=f.metadata!=null&&f.metadata.unity!=null&&f.metadata.unity.rootbone!=null?f.metadata.unity.rootbone:!1,f.metadata!=null&&f.metadata.mixer!=null&&(u=f.metadata.mixer[r.index],u!=null&&(t.animation.targetProperty==="position"?(i._targetPosition=n.Utilities.SampleAnimationVector3(t.animation,w),y===!0?(i._positionWeight=!1,i._positionHolder.set(0,0,0),i._rootBoneWeight=!1,i._rootBoneHolder.set(0,0,0),i.applyRootMotion===!0?l===!0&&a===!0?(i._positionWeight=!0,i._positionHolder.set(i._targetPosition.x,i._targetPosition.y+o,i._targetPosition.z)):l===!1&&a===!1?(i._rootBoneWeight=!0,i._rootBoneHolder.set(i._targetPosition.x,i._targetPosition.y+o,i._targetPosition.z)):l===!0&&a===!1?(i._positionWeight=!0,i._positionHolder.set(0,i._targetPosition.y+o,0),i._rootBoneWeight=!0,i._rootBoneHolder.set(i._targetPosition.x,0,i._targetPosition.z)):a===!0&&l===!1&&(i._positionWeight=!0,i._positionHolder.set(i._targetPosition.x,0,i._targetPosition.z),i._rootBoneWeight=!0,i._rootBoneHolder.set(0,i._targetPosition.y+o,0)):i._processmotion===!0?(i._positionWeight=!0,i._positionHolder.set(0,i._targetPosition.y+o,0),i._rootBoneWeight=!0,i._rootBoneHolder.set(0,0,0)):(i._positionWeight=!0,i._positionHolder.set(i._targetPosition.x,i._targetPosition.y+o,i._targetPosition.z)),i._positionWeight===!0&&(u.positionBuffer==null&&(u.positionBuffer=new n.Vector3(0,0,0)),n.Utilities.BlendVector3Value(u.positionBuffer,i._positionHolder,1)),i._rootBoneWeight===!0&&(u.rootPosition==null&&(u.rootPosition=new n.Vector3(0,0,0)),n.Utilities.BlendVector3Value(u.rootPosition,i._rootBoneHolder,1))):(u.positionBuffer==null&&(u.positionBuffer=new n.Vector3(0,0,0)),n.Utilities.BlendVector3Value(u.positionBuffer,i._targetPosition,1))):t.animation.targetProperty==="rotationQuaternion"?(i._targetRotation=n.Utilities.SampleAnimationQuaternion(t.animation,w),y===!0?(i._rotationWeight=!1,i._rotationHolder.set(0,0,0,0),i._rootQuatWeight=!1,i._rootQuatHolder.set(0,0,0,0),e=i._targetRotation.toEulerAngles(),c=e.y,i.applyRootMotion===!0?it===!0?(i._rotationWeight=!0,n.Quaternion.FromEulerAnglesToRef(e.x,c+s,e.z,i._rotationHolder)):(i._rotationWeight=!0,n.Quaternion.FromEulerAnglesToRef(e.x,0,e.z,i._rotationHolder),i._rootQuatWeight=!0,n.Quaternion.FromEulerAnglesToRef(0,c+s,0,i._rootQuatHolder)):(i._rotationWeight=!0,n.Quaternion.FromEulerAnglesToRef(e.x,c+s,e.z,i._rotationHolder)),i._rotationWeight===!0&&(u.rotationBuffer==null&&(u.rotationBuffer=new n.Quaternion(0,0,0,1)),n.Utilities.BlendQuaternionValue(u.rotationBuffer,i._rotationHolder,1)),i._rootQuatWeight===!0&&(u.rootRotation==null&&(u.rootRotation=new n.Quaternion(0,0,0,1)),n.Utilities.BlendQuaternionValue(u.rootRotation,i._rootQuatHolder,1))):(u.rotationBuffer==null&&(u.rotationBuffer=new n.Quaternion(0,0,0,1)),n.Utilities.BlendQuaternionValue(u.rotationBuffer,i._targetRotation,1))):t.animation.targetProperty==="scaling"&&(i._targetScaling=n.Utilities.SampleAnimationVector3(t.animation,w),u.scalingBuffer==null&&(u.scalingBuffer=new n.Vector3(1,1,1)),n.Utilities.BlendVector3Value(u.scalingBuffer,i._targetScaling,1)))))):t.target instanceof n.MorphTarget&&(v=t.target,v.metadata!=null&&v.metadata.mixer!=null&&(h=v.metadata.mixer[r.index],t.animation.targetProperty==="influence"&&(p=n.Utilities.SampleAnimationFloat(t.animation,w),h.influenceBuffer==null&&(h.influenceBuffer=0),h.influenceBuffer=n.Utilities.BlendFloatValue(h.influenceBuffer,p,1))))});r.animationStateMachine.events!=null&&r.animationStateMachine.events.length>0&&r.animationStateMachine.events.forEach(function(n){n.time===tt&&i.onAnimationEventObservable.hasObservers()===!0&&i.onAnimationEventObservable.notifyObservers(n)});r.animationLoopFrame===!0?(r.animationTime=0,r.animationNormal=0,r.animationLoopFrame=!1):(r.animationTime+=t*y*Math.abs(f.speed)*Math.abs(i.speedRatio),r.animationTime=n.Scalar.Clamp(r.animationTime,0,n.AnimationState.TIME))}}else{if(i._blendWeights.primary=null,i._blendWeights.secondary=null,h=[],nt=f.blendtree,i.parseTreeBranches(r,nt,1,h),y=i.computeWeightedFrameRatio(h),r.animationNormal=r.animationTime/n.AnimationState.TIME,p=r.animationNormal>.99?1:r.animationNormal,rt=Math.round(p*100)/100,f.speed<0&&(r.animationNormal=1-r.animationNormal),ut=r.animationNormal,r.animationTime>=n.AnimationState.TIME&&(r.animationLoopFrame=!0),b=h!=null&&h.length>0&&h[0].track!=null?h[0].track:null,b!=null)for(ft=b.targetedAnimations.length,v=0;v<ft;v++)k=b.targetedAnimations[v],k.target instanceof n.TransformNode&&(e=k.target,(r.index===0||r.avatarMask==null||i.filterTargetAvatarMask(r,e))&&(et=e.metadata!=null&&e.metadata.unity!=null&&e.metadata.unity.rootbone!=null?e.metadata.unity.rootbone:!1,e.metadata!=null&&e.metadata.mixer!=null&&(i._initialtargetblending=!0,ot=e.metadata.mixer[r.index],i.updateBlendableTargets(t,r,nt,k,v,ot,ut,et))));r.animationStateMachine.events!=null&&r.animationStateMachine.events.length>0&&r.animationStateMachine.events.forEach(function(n){n.time===rt&&i.onAnimationEventObservable.hasObservers()===!0&&i.onAnimationEventObservable.notifyObservers(n)});r.animationLoopFrame===!0?(r.animationTime=0,r.animationNormal=0,r.animationLoopFrame=!1):(r.animationTime+=t*y*Math.abs(f.speed)*Math.abs(i.speedRatio),r.animationTime=n.Scalar.Clamp(r.animationTime,0,n.AnimationState.TIME))}});this.finalizeAnimationTargets()},i.prototype.updateBlendableTargets=function(t,i,r,u,f,e,o,s){var k,c,p,a,d,g,v,nt;if(e!=null&&r.children!=null&&r.children.length>0)for(k=0;k<r.children.length;k++)if(c=r.children[k],c.weight>0)if(c.type===n.MotionType.Clip){if(c.track!=null){var l=0,it=!1,rt=0,ut=!1,y=0,ft=!1,et=!1,ot=!1,tt=!1,w=!1,b=!1,h=c.track;h.metadata!=null&&h.metadata.unity!=null&&h.metadata.unity.settings!=null&&(l=h.metadata.unity.settings.level!=null?h.metadata.unity.settings.level:0,it=h.metadata.unity.settings.loopblend!=null?h.metadata.unity.settings.loopblend:!1,rt=h.metadata.unity.settings.cycleoffset!=null?h.metadata.unity.settings.cycleoffset:0,ut=h.metadata.unity.settings.heightfromfeet!=null?h.metadata.unity.settings.heightfromfeet:!1,y=h.metadata.unity.settings.orientationoffsety!=null?h.metadata.unity.settings.orientationoffsety:0,ft=h.metadata.unity.settings.keeporiginalorientation!=null?h.metadata.unity.settings.keeporiginalorientation:!1,et=h.metadata.unity.settings.keeporiginalpositionxz!=null?h.metadata.unity.settings.keeporiginalpositionxz:!1,ot=h.metadata.unity.settings.keeporiginalpositiony!=null?h.metadata.unity.settings.keeporiginalpositiony:!1,tt=h.metadata.unity.settings.loopblendorientation!=null?h.metadata.unity.settings.loopblendorientation:!1,w=h.metadata.unity.settings.loopblendpositiony!=null?h.metadata.unity.settings.loopblendpositiony:!1,b=h.metadata.unity.settings.loopblendpositionxz!=null?h.metadata.unity.settings.loopblendpositionxz:!1);y=n.Tools.ToRadians(y);y*=-1;l*=-1;p=c.track.targetedAnimations[f];a=this._initialtargetblending===!0?1:parseFloat(c.weight.toFixed(2));this._initialtargetblending=!1;p.target===u.target&&p.animation.targetProperty===u.animation.targetProperty?(d=o,c.timescale<0&&(d=1-d),g=c.track.to*d,u.animation.targetProperty==="position"?(this._targetPosition=n.Utilities.SampleAnimationVector3(p.animation,g),s===!0?(this._positionWeight=!1,this._positionHolder.set(0,0,0),this._rootBoneWeight=!1,this._rootBoneHolder.set(0,0,0),this.applyRootMotion===!0?w===!0&&b===!0?(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+l,this._targetPosition.z)):w===!1&&b===!1?(this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this._targetPosition.y+l,this._targetPosition.z)):w===!0&&b===!1?(this._positionWeight=!0,this._positionHolder.set(0,this._targetPosition.y+l,0),this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,0,this._targetPosition.z)):b===!0&&w===!1&&(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,0,this._targetPosition.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(0,this._targetPosition.y+l,0)):this._processmotion===!0?(this._positionWeight=!0,this._positionHolder.set(0,this._targetPosition.y+l,0),this._rootBoneWeight=!0,this._rootBoneHolder.set(0,0,0)):(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+l,this._targetPosition.z)),this._positionWeight===!0&&(e.positionBuffer==null&&(e.positionBuffer=new n.Vector3(0,0,0)),n.Utilities.BlendVector3Value(e.positionBuffer,this._positionHolder,a)),this._rootBoneWeight===!0&&(e.rootPosition==null&&(e.rootPosition=new n.Vector3(0,0,0)),n.Utilities.BlendVector3Value(e.rootPosition,this._rootBoneHolder,a))):(e.positionBuffer==null&&(e.positionBuffer=new n.Vector3(0,0,0)),n.Utilities.BlendVector3Value(e.positionBuffer,this._targetPosition,a))):u.animation.targetProperty==="rotationQuaternion"?(this._targetRotation=n.Utilities.SampleAnimationQuaternion(p.animation,g),s===!0?(this._rotationWeight=!1,this._rotationHolder.set(0,0,0,0),this._rootQuatWeight=!1,this._rootQuatHolder.set(0,0,0,0),v=this._targetRotation.toEulerAngles(),nt=v.y,this.applyRootMotion===!0?tt===!0?(this._rotationWeight=!0,n.Quaternion.FromEulerAnglesToRef(v.x,nt+y,v.z,this._rotationHolder)):(this._rotationWeight=!0,n.Quaternion.FromEulerAnglesToRef(v.x,0,v.z,this._rotationHolder),this._rootQuatWeight=!0,n.Quaternion.FromEulerAnglesToRef(0,nt+y,0,this._rootQuatHolder)):(this._rotationWeight=!0,n.Quaternion.FromEulerAnglesToRef(v.x,nt+y,v.z,this._rotationHolder)),this._rotationWeight===!0&&(e.rotationBuffer==null&&(e.rotationBuffer=new n.Quaternion(0,0,0,1)),n.Utilities.BlendQuaternionValue(e.rotationBuffer,this._rotationHolder,a)),this._rootQuatWeight===!0&&(e.rootRotation==null&&(e.rootRotation=new n.Quaternion(0,0,0,1)),n.Utilities.BlendQuaternionValue(e.rootRotation,this._rootQuatHolder,a))):(e.rotationBuffer==null&&(e.rotationBuffer=new n.Quaternion(0,0,0,1)),n.Utilities.BlendQuaternionValue(e.rotationBuffer,this._targetRotation,a))):u.animation.targetProperty==="scaling"&&(this._targetScaling=n.Utilities.SampleAnimationVector3(p.animation,g),e.scalingBuffer==null&&(e.scalingBuffer=new n.Vector3(1,1,1)),n.Utilities.BlendVector3Value(e.scalingBuffer,this._targetScaling,a))):n.Tools.Warn(r.name+" - "+c.track.name+" blend tree mismatch ("+f+"): "+u.target.name+" >>> "+p.target.name)}}else c.type===n.MotionType.Tree&&this.updateBlendableTargets(t,i,c.subtree,u,f,e,o,s)},i.prototype.finalizeAnimationTargets=function(){var t=this;this._deltaAngleY=0;this._deltaPosition.set(0,0,0);this._deltaRotation.set(0,0,0,1);this._dirtyMotionMatrix=null;this.m_animationTargets!=null&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(i){var r=i.target;r.metadata!=null&&r.metadata.mixer!=null&&t._machine.layers!=null&&t._machine.layers.length>0&&(t._blenderMatrix.reset(),t._dirtyBlenderMatrix=null,t._machine.layers.forEach(function(i){var u=r.metadata.mixer[i.index];u!=null&&(r instanceof n.TransformNode?((u.positionBuffer!=null||u.rotationBuffer!=null||u.scalingBuffer!=null)&&(n.Matrix.ComposeToRef(u.scalingBuffer||r.scaling,u.rotationBuffer||r.rotationQuaternion,u.positionBuffer||r.position,t._updateMatrix),u.blendingSpeed>0&&(u.blendingFactor<=1&&u.originalMatrix==null&&(u.originalMatrix=n.Matrix.Compose(r.scaling,r.rotationQuaternion,r.position)),u.blendingFactor<=1&&u.originalMatrix!=null&&(n.Utilities.FastMatrixSlerp(u.originalMatrix,t._updateMatrix,u.blendingFactor,t._updateMatrix),u.blendingFactor+=u.blendingSpeed)),n.Utilities.FastMatrixSlerp(t._blenderMatrix,t._updateMatrix,i.defaultWeight,t._blenderMatrix),t._dirtyBlenderMatrix=!0,u.positionBuffer=null,u.rotationBuffer=null,u.scalingBuffer=null),(u.rootPosition!=null||u.rootRotation!=null)&&(n.Matrix.ComposeToRef(t.transform.scaling,u.rootRotation||t.transform.rotationQuaternion,u.rootPosition||t.transform.position,t._updateMatrix),n.Utilities.FastMatrixSlerp(t._rootMotionMatrix,t._updateMatrix,i.defaultWeight,t._rootMotionMatrix),t._dirtyMotionMatrix=!0,u.rootPosition=null,u.rootRotation=null)):r instanceof n.MorphTarget&&u.influenceBuffer!=null&&(r.influence=n.Scalar.Lerp(r.influence,u.influenceBuffer,i.defaultWeight),u.influenceBuffer=null))}),t._dirtyBlenderMatrix!=null&&t._blenderMatrix.decompose(r.scaling,r.rotationQuaternion,r.position))});this._dirtyMotionMatrix!=null&&(this._rootMotionMatrix.decompose(this._rootMotionScaling,this._rootMotionRotation,this._rootMotionPosition),this._frametime===0&&(this._lastMotionPosition.copyFrom(this._rootMotionPosition),this._lastMotionRotation.copyFrom(this._rootMotionRotation)),this.applyRootMotion!=null&&(this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),n.Utilities.QuaternionDiffToRef(this._lastMotionRotation,this._rootMotionRotation,this._quatRotationDiff),this._quatRotationDiff.toEulerAnglesToRef(this._quatRotateVector),this._deltaAngleY=this._quatRotateVector.y,n.Quaternion.FromEulerAnglesToRef(0,this._deltaAngleY,0,this._deltaRotation),this._lastMotionPosition.addInPlace(this._deltaPosition),this._lastMotionRotation.multiplyInPlace(this._deltaRotation)))},i.prototype.checkStateMachine=function(t){var i=this;this._checkers.result=null;this._checkers.offest=0;this._checkers.blending=0;this._checkers.triggered=[];t.animationStateMachine!=null&&(this.checkStateTransitions(t,t.animationStateMachine.transitions,t.animationStateMachine.time,t.animationStateMachine.length,t.animationStateMachine.rate),this._checkers.result==null&&this._machine.transitions!=null&&this.checkStateTransitions(t,this._machine.transitions,t.animationStateMachine.time,t.animationStateMachine.length,t.animationStateMachine.rate));this._checkers.triggered!=null&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(n){i.resetTrigger(n)}),this._checkers.triggered=null);this._checkers.result!=null&&(this._checkers.offest>0?n.SceneManager.SetTimeout(this._checkers.offest*1e3,function(){i.setCurrentAnimationState(t,i._checkers.result,i._checkers.blending)}):this.setCurrentAnimationState(t,this._checkers.result,this._checkers.blending))},i.prototype.checkStateTransitions=function(t,i,r,u,f){var o=this,c,s,l;if(i!=null&&i.length>0){for(var e=0,h=-1,e=0;e<i.length;e++)if(i[e].solo===!0&&i[e].mute===!1){h=e;break}for(c=function(){var c=i[e],l,y;if(c.layerIndex!==t.index||c.mute===!0||h>=0&&h!==e)return"continue";var a=!1,w=n.Scalar.Denormalize(c.exitTime,0,u),v=n.SceneManager.GetGameTime()-r>=w;if(c.hasExitTime===!0&&c.intSource==n.InterruptionSource.None&&v===!1)return"continue";if(c.conditions!=null&&c.conditions.length>0?(l=0,y=c.conditions.length,c.conditions.forEach(function(t){var i=o._parameters.get(t.parameter),r,f,s,e,u;if(i!=null)if(i==n.AnimatorParameterType.Float||i==n.AnimatorParameterType.Int)r=parseFloat(o.getFloat(t.parameter).toFixed(2)),t.mode===n.ConditionMode.Greater&&r>t.threshold?l++:t.mode===n.ConditionMode.Less&&r<t.threshold?l++:t.mode===n.ConditionMode.Equals&&r===t.threshold?l++:t.mode===n.ConditionMode.NotEqual&&r!==t.threshold&&l++;else if(i==n.AnimatorParameterType.Bool)f=o.getBool(t.parameter),t.mode===n.ConditionMode.If&&f===!0?l++:t.mode===n.ConditionMode.IfNot&&f===!1&&l++;else if(i==n.AnimatorParameterType.Trigger&&(s=o.getTrigger(t.parameter),s===!0)){for(l++,e=-1,u=0;u<o._checkers.triggered.length;u++)if(o._checkers.triggered[u]===t.parameter){e=u;break}e<0&&o._checkers.triggered.push(t.parameter)}}),a=c.hasExitTime===!0?v===!0&&l===y:l===y):a=c.hasExitTime===!0&&v===!0,a===!0){var p=u>0?u:1,b=f>0?f:n.AnimationState.FPS,k=c.isExit===!1?c.destination:n.AnimationState.EXIT,d=c.fixedDuration===!0?c.offset:n.Scalar.Denormalize(c.offset,0,p),g=c.fixedDuration===!0?c.duration:n.Scalar.Denormalize(c.duration,0,p),nt=n.Utilities.ComputeBlendingSpeed(b,g);return s._checkers.result=k,s._checkers.offest=d,s._checkers.blending=nt,"break"}},s=this,e=0;e<i.length;e++)if(l=c(),l==="break")break}},i.prototype.setCurrentAnimationState=function(t,i,r){if(i!=null&&i!==""&&i!==n.AnimationState.EXIT&&(t.animationStateMachine==null||t.animationStateMachine.name!==i)){var u=this.getMachineState(i);this.m_animationTargets!=null&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(n){var u=n.target,i;u.metadata!=null&&u.metadata.mixer!=null&&(i=u.metadata.mixer[t.index],i!=null&&(i.originalMatrix=null,i.blendingFactor=0,i.blendingSpeed=r))});u!=null&&u.layerIndex===t.index&&(u.time=0,u.played=0,u.interrupted=!1,t.animationTime=0,t.animationNormal=0,t.animationFirstRun=!0,t.animationEndFrame=!1,t.animationLoopFrame=!1,t.animationStateMachine=u,t.animationStateMachine.time=n.SceneManager.GetGameTime())}},i.prototype.checkAvatarTransformPath=function(n,t){var r=!1,i;return this.m_avatarMask!=null&&(i=this.m_avatarMask.get(t),i!=null&&i>=0&&(r=!0)),r},i.prototype.filterTargetAvatarMask=function(n,t){var i=!1,r;return t.metadata!=null&&t.metadata.unity!=null&&t.metadata.unity.bone!=null&&t.metadata.unity.bone!==""&&(r=t.metadata.unity.bone,i=this.checkAvatarTransformPath(n,r)),i},i.prototype.sortWeightedBlendingList=function(n){n!=null&&n.length>0&&n.sort(function(n,t){return n.weight<t.weight?1:n.weight>t.weight?-1:0})},i.prototype.computeWeightedFrameRatio=function(t){var i=1,r,u;return t!=null&&t.length>0&&(this.sortWeightedBlendingList(t),this._blendWeights.primary=t[0],r=this._blendWeights.primary.weight,r<1&&t.length>1&&(this._blendWeights.secondary=t[1]),this._blendWeights.primary!=null&&this._blendWeights.secondary!=null?(u=n.Scalar.Clamp(this._blendWeights.primary.weight),i=n.Scalar.Lerp(this._blendWeights.secondary.ratio,this._blendWeights.primary.ratio,u)):this._blendWeights.primary!=null&&this._blendWeights.secondary==null&&(i=this._blendWeights.primary.ratio)),i},i.prototype.setupTreeBranches=function(t){var i=this;t!=null&&t.children!=null&&t.children.length>0&&t.children.forEach(function(t){t.type===n.MotionType.Tree?i.setupTreeBranches(t.subtree):t.type===n.MotionType.Clip&&t.motion!=null&&t.motion!==""&&(t.weight=0,t.ratio=0,t.track=i.getAnimationGroup(t.motion),t.track!=null&&(t.ratio=n.AnimationState.TIME/t.track.to))})},i.prototype.parseTreeBranches=function(t,i,r,u){if(i!=null){i.valueParameterX=i.blendParameterX!=null?parseFloat(this.getFloat(i.blendParameterX).toFixed(2)):0;i.valueParameterY=i.blendParameterY!=null?parseFloat(this.getFloat(i.blendParameterY).toFixed(2)):0;switch(i.blendType){case n.BlendTreeType.Simple1D:this.parse1DSimpleTreeBranches(t,i,r,u);break;case n.BlendTreeType.SimpleDirectional2D:this.parse2DSimpleDirectionalTreeBranches(t,i,r,u);break;case n.BlendTreeType.FreeformDirectional2D:this.parse2DFreeformDirectionalTreeBranches(t,i,r,u);break;case n.BlendTreeType.FreeformCartesian2D:this.parse2DFreeformCartesianTreeBranches(t,i,r,u)}}},i.prototype.parse1DSimpleTreeBranches=function(t,i,r,u){var e=this,f;i!=null&&i.children!=null&&i.children.length>0&&(f=[],i.children.forEach(function(n){n.weight=0;var t={source:n,motion:n.motion,posX:n.threshold,posY:n.threshold,weight:n.weight};f.push(t)}),n.BlendTreeSystem.Calculate1DSimpleBlendTree(i.valueParameterX,f),f.forEach(function(n){n.source!=null&&(n.source.weight=n.weight)}),i.children.forEach(function(i){i.weight*=r;i.type===n.MotionType.Clip&&i.weight>0&&u.push(i);i.type===n.MotionType.Tree&&e.parseTreeBranches(t,i.subtree,i.weight,u)}))},i.prototype.parse2DSimpleDirectionalTreeBranches=function(t,i,r,u){var e=this,f;i!=null&&i.children!=null&&i.children.length>0&&(f=[],i.children.forEach(function(n){n.weight=0;var t={source:n,motion:n.motion,posX:n.positionX,posY:n.positionY,weight:n.weight};f.push(t)}),n.BlendTreeSystem.Calculate2DFreeformDirectional(i.valueParameterX,i.valueParameterY,f),f.forEach(function(n){n.source!=null&&(n.source.weight=n.weight)}),i.children.forEach(function(i){i.weight*=r;i.type===n.MotionType.Clip&&i.weight>0&&u.push(i);i.type===n.MotionType.Tree&&e.parseTreeBranches(t,i.subtree,i.weight,u)}))},i.prototype.parse2DFreeformDirectionalTreeBranches=function(t,i,r,u){var e=this,f;i!=null&&i.children!=null&&i.children.length>0&&(f=[],i.children.forEach(function(n){n.weight=0;var t={source:n,motion:n.motion,posX:n.positionX,posY:n.positionY,weight:n.weight};f.push(t)}),n.BlendTreeSystem.Calculate2DFreeformDirectional(i.valueParameterX,i.valueParameterY,f),f.forEach(function(n){n.source!=null&&(n.source.weight=n.weight)}),i.children.forEach(function(i){i.weight*=r;i.type===n.MotionType.Clip&&i.weight>0&&u.push(i);i.type===n.MotionType.Tree&&e.parseTreeBranches(t,i.subtree,i.weight,u)}))},i.prototype.parse2DFreeformCartesianTreeBranches=function(t,i,r,u){var e=this,f;i!=null&&i.children!=null&&i.children.length>0&&(f=[],i.children.forEach(function(n){n.weight=0;var t={source:n,motion:n.motion,posX:n.positionX,posY:n.positionY,weight:n.weight};f.push(t)}),n.BlendTreeSystem.Calculate2DFreeformCartesian(i.valueParameterX,i.valueParameterY,f),f.forEach(function(n){n.source!=null&&(n.source.weight=n.weight)}),i.children.forEach(function(i){i.weight*=r;i.type===n.MotionType.Clip&&i.weight>0&&u.push(i);i.type===n.MotionType.Tree&&e.parseTreeBranches(t,i.subtree,i.weight,u)}))},i.FPS=30,i.TIME=1,i.EXIT="[EXIT]",i.MOTION=.001,i}(n.ScriptComponent),t,i,r,u,f,e,o,h,c,l,a,v,y;n.AnimationState=s;t=function(){function n(n){this.source=n.source;this.motion=n.motion;this.posX=n.posX||0;this.posY=n.posY||0;this.weight=n.weight||0}return n}();n.BlendTreeValue=t;i=function(){function n(){}return n.ClampValue=function(n,t,i){return n<=t?t:n>=i?i:n},n.GetSignedAngle=function(n,t){return Math.atan2(n.x*t.y-n.y*t.x,n.x*t.x+n.y*t.y)},n.GetLinearInterpolation=function(n,t,i,r,u){return t+(u-n)*((r-t)/(i-n))},n.GetRightNeighbourIndex=function(n,t){t.sort(function(n,t){return n.posX-t.posX});for(var i=0;i<t.length;++i)if(t[i].posX>n)return i;return-1},n}();n.BlendTreeUtils=i;r=function(){function t(){}return t.Calculate1DSimpleBlendTree=function(t,i){var u=i[0],f=i[i.length-1];if(t<=u.posX)u.weight=1;else if(t>=f.posX)f.weight=1;else{var e=n.BlendTreeUtils.GetRightNeighbourIndex(t,i),r=i[e-1],o=i[e],s=n.BlendTreeUtils.GetLinearInterpolation(r.posX,1,o.posX,0,t);r.weight=s;o.weight=1-r.weight}},t.Calculate2DFreeformDirectional=function(t,i,r){var o,f,w,e,h,l,u;n.BlendTreeSystem.TempVector2_IP.set(t,i);n.BlendTreeSystem.TempVector2_POSI.set(0,0);n.BlendTreeSystem.TempVector2_POSJ.set(0,0);n.BlendTreeSystem.TempVector2_POSIP.set(0,0);n.BlendTreeSystem.TempVector2_POSIJ.set(0,0);var a=2,v=0,b=n.BlendTreeSystem.TempVector2_IP.length();for(o=0;o<r.length;++o){u=r[o];n.BlendTreeSystem.TempVector2_POSI.set(u.posX,u.posY);var c=n.BlendTreeSystem.TempVector2_POSI.length(),k=b-c,d=n.BlendTreeUtils.GetSignedAngle(n.BlendTreeSystem.TempVector2_POSI,n.BlendTreeSystem.TempVector2_IP),s=1;for(f=0;f<r.length;++f)if(f===o)continue;else{n.BlendTreeSystem.TempVector2_POSJ.set(r[f].posX,r[f].posY);var y=n.BlendTreeSystem.TempVector2_POSJ.length(),p=(c+y)/2,g=k/p,nt=(y-c)/p,tt=n.BlendTreeUtils.GetSignedAngle(n.BlendTreeSystem.TempVector2_POSI,n.BlendTreeSystem.TempVector2_POSJ);n.BlendTreeSystem.TempVector2_POSIP.set(g,d*a);n.BlendTreeSystem.TempVector2_POSIJ.set(nt,tt*a);w=n.BlendTreeSystem.TempVector2_POSIJ.lengthSquared();e=n.Vector2.Dot(n.BlendTreeSystem.TempVector2_POSIP,n.BlendTreeSystem.TempVector2_POSIJ)/w;e=1-e;e=n.BlendTreeUtils.ClampValue(e,0,1);s=Math.min(e,s)}u.weight=s;v+=s}for(h=0,l=r;h<l.length;h++)u=l[h],u.weight/=v},t.Calculate2DFreeformCartesian=function(t,i,r){var c,o,s,f,a,e,h,l,u;for(n.BlendTreeSystem.TempVector2_IP.set(t,i),n.BlendTreeSystem.TempVector2_POSI.set(0,0),n.BlendTreeSystem.TempVector2_POSJ.set(0,0),n.BlendTreeSystem.TempVector2_POSIP.set(0,0),n.BlendTreeSystem.TempVector2_POSIJ.set(0,0),c=0,o=0;o<r.length;++o){for(u=r[o],n.BlendTreeSystem.TempVector2_POSI.set(u.posX,u.posY),n.BlendTreeSystem.TempVector2_IP.subtractToRef(n.BlendTreeSystem.TempVector2_POSI,n.BlendTreeSystem.TempVector2_POSIP),s=1,f=0;f<r.length;++f)if(f===o)continue;else n.BlendTreeSystem.TempVector2_POSJ.set(r[f].posX,r[f].posY),n.BlendTreeSystem.TempVector2_POSJ.subtractToRef(n.BlendTreeSystem.TempVector2_POSI,n.BlendTreeSystem.TempVector2_POSIJ),a=n.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),e=n.Vector2.Dot(n.BlendTreeSystem.TempVector2_POSIP,n.BlendTreeSystem.TempVector2_POSIJ)/a,e=1-e,e=n.BlendTreeUtils.ClampValue(e,0,1),s=Math.min(s,e);u.weight=s;c+=s}for(h=0,l=r;h<l.length;h++)u=l[h],u.weight/=c},t.TempVector2_IP=new n.Vector2(0,0),t.TempVector2_POSI=new n.Vector2(0,0),t.TempVector2_POSJ=new n.Vector2(0,0),t.TempVector2_POSIP=new n.Vector2(0,0),t.TempVector2_POSIJ=new n.Vector2(0,0),t}();n.BlendTreeSystem=r;u=function(){function n(){}return n}();n.MachineState=u;f=function(){function n(){}return n}();n.TransitionCheck=f;e=function(){function n(){}return n}();n.AnimationMixer=e;o=function(){function n(){}return n}();n.BlendingWeights=o,function(n){n[n.Clip=0]="Clip";n[n.Tree=1]="Tree"}(h=n.MotionType||(n.MotionType={})),function(n){n[n.If=1]="If";n[n.IfNot=2]="IfNot";n[n.Greater=3]="Greater";n[n.Less=4]="Less";n[n.Equals=6]="Equals";n[n.NotEqual=7]="NotEqual"}(c=n.ConditionMode||(n.ConditionMode={})),function(n){n[n.None=0]="None";n[n.Source=1]="Source";n[n.Destination=2]="Destination";n[n.SourceThenDestination=3]="SourceThenDestination";n[n.DestinationThenSource=4]="DestinationThenSource"}(l=n.InterruptionSource||(n.InterruptionSource={})),function(n){n[n.Simple1D=0]="Simple1D";n[n.SimpleDirectional2D=1]="SimpleDirectional2D";n[n.FreeformDirectional2D=2]="FreeformDirectional2D";n[n.FreeformCartesian2D=3]="FreeformCartesian2D";n[n.Direct=4]="Direct";n[n.Clip=5]="Clip"}(a=n.BlendTreeType||(n.BlendTreeType={})),function(n){n[n.Lower=0]="Lower";n[n.Upper=1]="Upper"}(v=n.BlendTreePosition||(n.BlendTreePosition={})),function(n){n[n.Float=1]="Float";n[n.Int=3]="Int";n[n.Bool=4]="Bool";n[n.Trigger=9]="Trigger"}(y=n.AnimatorParameterType||(n.AnimatorParameterType={}))}(BABYLON||(BABYLON={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n._audio=null,n._name=null,n._file=null,n._loop=!1,n._mute=!1,n._volume=1,n._pitch=1,n._priority=128,n._panstereo=0,n._mindistance=1,n._maxdistance=50,n._rolloffmode="linear",n._rollofffactor=1,n._playonawake=!0,n._spatialblend=0,n._reverbzonemix=1,n._bypasseffects=!1,n._bypassreverbzones=!1,n._bypasslistenereffects=!1,n}return __extends(i,t),i.prototype.getSoundClip=function(){return this._audio},i.prototype.getAudioElement=function(){return this._audio!=null?this._audio._htmlAudioElement:null},i.prototype.awake=function(){this.awakeAudioSource()},i.prototype.destroy=function(){this.destroyAudioSource()},i.prototype.awakeAudioSource=function(){var t=this,i;if(this._name=this.getProperty("name",this._name),this._file=this.getProperty("file",this._file),this._loop=this.getProperty("loop",this._loop),this._mute=this.getProperty("mute",this._mute),this._volume=this.getProperty("volume",this._volume),this._pitch=this.getProperty("pitch",this._pitch),this._priority=this.getProperty("priority",this._priority),this._panstereo=this.getProperty("panstereo",this._panstereo),this._playonawake=this.getProperty("playonawake",this._playonawake),this._mindistance=this.getProperty("mindistance",this._mindistance),this._maxdistance=this.getProperty("maxdistance",this._maxdistance),this._rolloffmode=this.getProperty("rolloffmode",this._rolloffmode),this._rollofffactor=this.getProperty("rollofffactor",this._rollofffactor),this._spatialblend=this.getProperty("spatialblend",this._spatialblend),this._reverbzonemix=this.getProperty("reverbzonemix",this._reverbzonemix),this._bypasseffects=this.getProperty("bypasseffects",this._bypasseffects),this._bypassreverbzones=this.getProperty("bypassreverbzones",this._bypassreverbzones),this._bypasslistenereffects=this.getProperty("bypasslistenereffects",this._bypasslistenereffects),i=this.transform.metadata!=null&&this.transform.metadata.vtt!=null&&this.transform.metadata.vtt===!0,(this._name==null||this._name==="")&&(this._name="Unknown"),this._file!=null&&this._file!==""){var u=n.SceneManager.GetRootUrl(this.scene),r=this._spatialblend>=.1,f=this._rolloffmode==="logarithmic"?"exponential":"linear";this._audio=new n.Sound(this._name,u+this._file,this.scene,function(){t._audio.setVolume(t._mute===!0?0:t._volume);t._audio.setPlaybackRate(t._pitch)},{loop:this._loop,autoplay:this._playonawake,refDistance:this._mindistance,maxDistance:this._maxdistance,rolloffFactor:this._rollofffactor,spatialSound:r,distanceModel:f,streaming:i});this._audio.setPosition(this.transform.position.clone());r===!0&&this._audio.attachToMesh(this.transform)}},i.prototype.destroyAudioSource=function(){this._audio!=null&&(this._audio.dispose(),this._audio=null)},i}(n.ScriptComponent);n.AudioSource=t}(BABYLON||(BABYLON={})),function(n){var t=function(t){function i(){var i=t!==null&&t.apply(this,arguments)||this;return i._abstractMesh=null,i._avatarRadius=.5,i._avatarHeight=2,i._centerOffset=new n.Vector3(0,0,0),i._skinWidth=.08,i._stepOffset=.3,i._slopeLimit=45,i._capsuleSegments=16,i._minMoveDistance=.001,i._isPhysicsReady=!1,i._maxCollisions=4,i._useGhostSweepTest=!1,i._tmpCollisionContacts=null,i.updatePosition=!0,i.m_character=null,i.m_ghostShape=null,i.m_ghostObject=null,i.m_ghostCollision=null,i.m_ghostTransform=null,i.m_ghostPosition=null,i.m_startPosition=null,i.m_startTransform=null,i.m_walkDirection=null,i.m_warpPosition=null,i.m_turningRate=0,i.m_moveDeltaX=0,i.m_moveDeltaZ=0,i.m_physicsEngine=null,i.m_collisionPosition=n.Vector3.Zero(),i.onUpdatePositionObservable=new n.Observable,i.onCollisionEnterObservable=new n.Observable,i.onCollisionStayObservable=new n.Observable,i.onCollisionExitObservable=new n.Observable,i}return __extends(i,t),i.prototype.getInternalCharacter=function(){return this.m_character},i.prototype.getAvatarRadius=function(){return this._avatarRadius},i.prototype.getAvatarHeight=function(){return this._avatarHeight},i.prototype.getSkinWidth=function(){return this._skinWidth},i.prototype.getStepOffset=function(){return this._stepOffset},i.prototype.getUseSweepTest=function(){return this._useGhostSweepTest},i.prototype.getMinMoveDistance=function(){return this._minMoveDistance},i.prototype.setMinMoveDistance=function(n){this._minMoveDistance=n},i.prototype.getVerticalVelocity=function(){return this.m_character!=null&&this.m_character.getVerticalVelocity?this.m_character.getVerticalVelocity():0},i.prototype.getAddedMargin=function(){return this.m_character!=null&&this.m_character.getAddedMargin?this.m_character.getAddedMargin():0},i.prototype.setAddedMargin=function(n){this.m_character!=null&&this.m_character.getAddedMargin&&this.m_character.setAddedMargin(n)},i.prototype.setMaxJumpHeight=function(n){this.m_character!=null&&this.m_character.setMaxJumpHeight(n)},i.prototype.setFallingSpeed=function(n){this.m_character!=null&&this.m_character.setFallSpeed(n)},i.prototype.getSlopeLimit=function(){return this.m_character!=null?this.m_character.getMaxSlope():0},i.prototype.setSlopeLimit=function(n){this.m_character!=null&&this.m_character.setMaxSlope(n)},i.prototype.setUpAxis=function(n){this.m_character!=null&&this.m_character.setUpAxis(n)},i.prototype.getGravity=function(){return this.m_character!=null?this.m_character.getGravity():0},i.prototype.setGravity=function(n){this.m_character!=null&&this.m_character.setGravity(n)},i.prototype.isGrounded=function(){return this.m_character!=null?this.m_character.onGround():!1},i.prototype.isReady=function(){return this.m_character!=null},i.prototype.canJump=function(){return this.m_character!=null?this.m_character.canJump():!1},i.prototype.internalWarp=function(n){this.m_character!=null&&this.m_character.warp(n)},i.prototype.internalJump=function(){this.m_character!=null&&this.m_character.jump()},i.prototype.internalSetJumpSpeed=function(n){this.m_character!=null&&this.m_character.setJumpSpeed(n)},i.prototype.internalSetWalkDirection=function(n){this.m_character!=null&&this.m_character.setWalkDirection(n)},i.prototype.internalSetVelocityForTimeInterval=function(n,t){this.m_character!=null&&this.m_character.setVelocityForTimeInterval(n,t)},i.prototype.awake=function(){this.awakeMovementState()},i.prototype.start=function(){this.startMovementState()},i.prototype.update=function(){this.updateMovementState()},i.prototype.destroy=function(){this.destroyMovementState()},i.prototype.awakeMovementState=function(){var f,r,u,e,o,i,s,t;this._abstractMesh=this.getAbstractMesh();this._avatarRadius=this.getProperty("avatarRadius",this._avatarRadius);this._avatarHeight=this.getProperty("avatarHeight",this._avatarHeight);this._skinWidth=this.getProperty("skinWidth",this._skinWidth);this._slopeLimit=this.getProperty("slopeLimit",this._slopeLimit);this._stepOffset=this.getProperty("stepOffset",this._stepOffset);this._minMoveDistance=this.getProperty("minMoveDistance",this._minMoveDistance);this._capsuleSegments=this.getProperty("capsuleSegments",this._capsuleSegments);this._useGhostSweepTest=this.getProperty("useGhostSweepTest",this._useGhostSweepTest);this.m_warpPosition=new Ammo.btVector3(0,0,0);this.m_walkDirection=new Ammo.btVector3(0,0,0);this.m_physicsEngine=n.SceneManager.GetPhysicsEngine(this.scene);f=this.getProperty("centerOffset");f!=null&&(this._centerOffset=n.Utilities.ParseVector3(f));this.setMaxNotifications(this._maxCollisions);r=n.SceneManager.GetPhysicsWorld(this.scene);r!=null?(u=n.Utilities.GetAbsolutePosition(this.transform,this._centerOffset),this.m_startPosition=new Ammo.btVector3(u.x,u.y,u.z),this.m_startTransform=new Ammo.btTransform,this.m_startTransform.setIdentity(),this.m_startTransform.setOrigin(this.m_startPosition),e=n.Utilities.ShowDebugColliders(),o=n.Utilities.ColliderVisibility(),e===!0&&this.transform._debugCollider==null&&(i=new n.Vector3(this._avatarRadius,this._avatarHeight,1),i.x*=Math.max(Math.abs(this.transform.scaling.x),Math.abs(this.transform.scaling.z)),i.y*=this.transform.scaling.y,s=this.transform.name+".Debug",t=n.MeshBuilder.CreateCapsule(s,{tessellation:this._capsuleSegments,subdivisions:8,capSubdivisions:16,height:i.y,radius:i.x},this.scene),t.position.set(0,0,0),t.rotationQuaternion=this.transform.rotationQuaternion.clone(),t.setParent(this.transform),t.position.copyFrom(this._centerOffset),t.visibility=o,t.material=n.Utilities.GetColliderMaterial(this.scene),t.checkCollisions=!1,t.isPickable=!1,this.transform._debugCollider=t),this.m_ghostShape=new Ammo.btCapsuleShape(this._avatarRadius,this._avatarHeight/2),this.m_ghostShape.setMargin(this._skinWidth+n.CharacterController.MARGIN_FACTOR),this.m_ghostObject=new Ammo.btPairCachingGhostObject,this.m_ghostObject.setWorldTransform(this.m_startTransform),this.m_ghostObject.setCollisionShape(this.m_ghostShape),this.m_ghostObject.setCollisionFlags(n.CollisionFlags.CF_CHARACTER_OBJECT),this.m_ghostCollision=Ammo.castObject(this.m_ghostObject,Ammo.btCollisionObject),this.m_ghostCollision.entity=this._abstractMesh,this.m_character=new Ammo.btKinematicCharacterController(this.m_ghostObject,this.m_ghostShape,this._stepOffset),this.m_character.setUseGhostSweepTest(this._useGhostSweepTest),this.m_character.setUpInterpolate(!0),this.m_character.setMaxSlope(n.Tools.ToRadians(this._slopeLimit)),this.m_character.setGravity(n.System.Gravity3G),r.addCollisionObject(this.m_ghostObject,n.CollisionFilters.CharacterFilter,n.CollisionFilters.StaticFilter|n.CollisionFilters.DefaultFilter|n.CollisionFilters.CharacterFilter),r.addAction(this.m_character)):n.Tools.Warn("Null physics world detected. Failed to create character controller: "+this.transform.name);this._isPhysicsReady=this.m_physicsEngine!=null&&this._tmpCollisionContacts!=null&&this.m_ghostObject!=null&&this._abstractMesh!=null},i.prototype.startMovementState=function(){this.updateMovementState()},i.prototype.syncMovementState=function(){this._isPhysicsReady===!0&&(this.m_ghostTransform=this.m_ghostObject.getWorldTransform(),this.m_ghostPosition=this.m_ghostTransform!=null?this.m_ghostTransform.getOrigin():null)},i.prototype.updateMovementState=function(){this.syncMovementState();this._isPhysicsReady===!0&&this.m_ghostPosition!=null&&(this.updatePosition===!0?(this.m_collisionPosition.set(this.m_ghostPosition.x(),this.m_ghostPosition.y(),this.m_ghostPosition.z()),this._centerOffset!=null&&this.m_collisionPosition.subtractInPlace(this._centerOffset),this.transform.position.copyFrom(this.m_collisionPosition)):this.setGhostWorldPosition(this.transform.position),this.onUpdatePositionObservable.hasObservers()===!0&&this.onUpdatePositionObservable.notifyObservers(this.transform));this.parseGhostCollisionContacts()},i.prototype.parseGhostCollisionContacts=function(){var n,i,e,r,o,s,u,f,t;if(this._isPhysicsReady===!0){var h=this.onCollisionEnterObservable.hasObservers(),c=this.onCollisionStayObservable.hasObservers(),l=this.onCollisionExitObservable.hasObservers();if(h||c||l){for(n=0,n=0;n<this._tmpCollisionContacts.length;n++)this._tmpCollisionContacts[n].reset=!0;if(i=this.m_ghostObject.getNumOverlappingObjects(),i>this._maxCollisions&&(i=this._maxCollisions),i>0)for(n=0;n<i;n++)if(e=this.m_ghostObject.getOverlappingObject(n),e!=null&&(r=Ammo.castObject(e,Ammo.btCollisionObject),r!=null&&r.entity!=null&&r.isActive())){for(o=-1,s=r.entity,n=0;n<this._tmpCollisionContacts.length;n++)if(u=this._tmpCollisionContacts[n],u.mesh!=null&&u.mesh===s){u.state=1;u.reset=!1;o=n;break}if(o===-1)for(n=0;n<this._tmpCollisionContacts.length;n++)if(f=this._tmpCollisionContacts[n],f.mesh==null){f.mesh=s;f.state=0;f.reset=!1;break}}for(n=0;n<this._tmpCollisionContacts.length;n++)t=this._tmpCollisionContacts[n],t.reset===!0?(l&&t.mesh!=null&&this.onCollisionExitObservable.notifyObservers(t.mesh),t.mesh=null,t.state=0,t.reset=!1):t.state===0?h&&t.mesh!=null&&this.onCollisionEnterObservable.notifyObservers(t.mesh):c&&t.mesh!=null&&this.onCollisionStayObservable.notifyObservers(t.mesh)}}},i.prototype.destroyMovementState=function(){this.m_physicsEngine=null;this.m_character!=null&&(Ammo.destroy(this.m_character),this.m_character=null);this.m_ghostObject!=null&&(Ammo.destroy(this.m_ghostObject),this.m_ghostObject=null);this.m_ghostShape!=null&&(Ammo.destroy(this.m_ghostShape),this.m_ghostShape=null);this.m_ghostCollision!=null&&(Ammo.destroy(this.m_ghostCollision),this.m_ghostCollision=null);this.m_ghostPosition!=null&&(Ammo.destroy(this.m_ghostPosition),this.m_ghostPosition=null);this.m_ghostTransform!=null&&(Ammo.destroy(this.m_ghostTransform),this.m_ghostTransform=null);this.m_startPosition!=null&&(Ammo.destroy(this.m_startPosition),this.m_startPosition=null);this.m_startTransform!=null&&(Ammo.destroy(this.m_startTransform),this.m_startTransform=null);this.m_warpPosition!=null&&(Ammo.destroy(this.m_warpPosition),this.m_warpPosition=null);this.m_walkDirection!=null&&(Ammo.destroy(this.m_walkDirection),this.m_walkDirection=null);this.onUpdatePositionObservable.clear();this.onUpdatePositionObservable=null;this.onCollisionEnterObservable.clear();this.onCollisionEnterObservable=null;this.onCollisionStayObservable.clear();this.onCollisionStayObservable=null;this.onCollisionExitObservable.clear();this.onCollisionExitObservable=null;this._tmpCollisionContacts=null;this._abstractMesh=null},i.prototype.setMaxNotifications=function(t){this._maxCollisions=t;this._tmpCollisionContacts=[];for(var i=0;i<this._maxCollisions;i++)this._tmpCollisionContacts.push(new n.CollisionContactInfo)},i.prototype.setActivationState=function(n){this.m_ghostCollision!=null&&this.m_ghostCollision.setActivationState&&this.m_ghostCollision.setActivationState(n)},i.prototype.getCollisionFilterGroup=function(){var n=-1;return this.m_ghostCollision!=null&&this.m_ghostCollision.getBroadphaseHandle&&(n=this.m_ghostCollision.getBroadphaseHandle().get_m_collisionFilterGroup()),n},i.prototype.setCollisionFilterGroup=function(n){this.m_ghostCollision!=null&&this.m_ghostCollision.getBroadphaseHandle&&this.m_ghostCollision.getBroadphaseHandle().set_m_collisionFilterGroup(n)},i.prototype.getCollisionFilterMask=function(){var n=-1;return this.m_ghostCollision!=null&&this.m_ghostCollision.getBroadphaseHandle&&(n=this.m_ghostCollision.getBroadphaseHandle().get_m_collisionFilterMask()),n},i.prototype.setCollisionFilterMask=function(n){this.m_ghostCollision!=null&&this.m_ghostCollision.getBroadphaseHandle&&this.m_ghostCollision.getBroadphaseHandle().set_m_collisionFilterMask(n)},i.prototype.getContactProcessingThreshold=function(){return this.m_ghostCollision!=null&&this.m_ghostCollision.getContactProcessingThreshold&&this.m_ghostCollision.getContactProcessingThreshold(),-1},i.prototype.setContactProcessingThreshold=function(n){this.m_ghostCollision!=null&&this.m_ghostCollision.setContactProcessingThreshold&&this.m_ghostCollision.setContactProcessingThreshold(n)},i.prototype.setGhostWorldPosition=function(n){this.m_ghostObject!=null&&this.m_ghostTransform!=null&&(this.m_ghostPosition!=null&&n!=null&&(this.m_ghostPosition.setValue(n.x,n.y,n.z),this.m_ghostTransform.setOrigin(this.m_ghostPosition)),this.m_ghostObject.setWorldTransform(this.m_ghostTransform))},i.prototype.move=function(n){n!=null&&(this.m_moveDeltaX=n.x,this.m_moveDeltaZ=n.z,Math.abs(n.x)<this._minMoveDistance&&(n.x>0?this.m_moveDeltaX=this._minMoveDistance:n.x<0&&(this.m_moveDeltaX=-this._minMoveDistance)),Math.abs(n.z)<this._minMoveDistance&&(n.z>0?this.m_moveDeltaZ=this._minMoveDistance:n.z<0&&(this.m_moveDeltaZ=-this._minMoveDistance)),this.m_walkDirection!=null&&(this.m_walkDirection.setValue(this.m_moveDeltaX,0,this.m_moveDeltaZ),this.internalSetWalkDirection(this.m_walkDirection)))},i.prototype.jump=function(n){this.internalSetJumpSpeed(n);this.internalJump()},i.prototype.warp=function(n){this.m_warpPosition!=null&&(this.m_warpPosition.setValue(n.x,n.y,n.z),this.internalWarp(this.m_warpPosition))},i.MARGIN_FACTOR=-.04,i}(n.ScriptComponent);n.CharacterController=t}(BABYLON||(BABYLON={})),function(n){var t=function(t){function i(){var i=t!==null&&t.apply(this,arguments)||this;return i.distanceToTarget=0,i.moveDirection=new n.Vector3(0,0,0),i.resetPosition=new n.Vector3(0,0,0),i.lastPosition=new n.Vector3(0,0,0),i.currentPosition=new n.Vector3(0,0,0),i.currentVelocity=new n.Vector3(0,0,0),i.currentWaypoint=new n.Vector3(0,0,0),i.heightOffset=0,i.angularSpeed=0,i.updatePosition=!0,i.distanceEpsilon=.1,i.velocityEpsilon=1,i.stoppingDistance=0,i.m_agentState=0,i.m_agentIndex=-1,i.m_agentTrans=null,i.m_agentParams=null,i.m_agentRotation=new n.Quaternion(0,0,0,1),i.m_agentMovement=new n.Vector3(0,0,0),i.m_agentDirection=new n.Vector3(0,0,1),i.m_agentQuaternion=new n.Quaternion(0,0,0,1),i.m_agentDestination=null,i.onPreUpdateObservable=new n.Observable,i.onPostUpdateObservable=new n.Observable,i.onNavCompleteObservable=new n.Observable,i}return __extends(i,t),i.prototype.isNavigating=function(){return this.m_agentDestination!=null},i.prototype.getAgentType=function(){return this.type},i.prototype.getAgentState=function(){return this.m_agentState},i.prototype.getAgentIndex=function(){return this.m_agentIndex},i.prototype.getAgentRadius=function(){return this.avoidRadius},i.prototype.getAgentHeight=function(){return this.avoidHeight},i.prototype.getAgentSpeed=function(){return this.speed},i.prototype.getAgentOffset=function(){return this.baseOffset},i.prototype.getTargetDistance=function(){return this.distanceToTarget},i.prototype.awake=function(){this.awakeNavigationAgent()},i.prototype.late=function(){this.updateNavigationAgent()},i.prototype.destroy=function(){this.destroyNavigationAgent()},i.prototype.awakeNavigationAgent=function(){this.type=this.getProperty("type",this.type);this.speed=this.getProperty("speed",this.speed);this.baseOffset=this.getProperty("offset",this.baseOffset);this.angularSpeed=this.getProperty("angularspeed",this.angularSpeed);this.acceleration=this.getProperty("acceleration",this.acceleration);this.stoppingDistance=this.getProperty("stoppingdistance",this.stoppingDistance);this.autoBraking=this.getProperty("autobraking",this.autoBraking);this.avoidRadius=this.getProperty("avoidradius",this.avoidRadius);this.avoidHeight=this.getProperty("avoidheight",this.avoidHeight);this.obstacleAvoidanceType=this.getProperty("avoidquality",this.obstacleAvoidanceType);this.avoidancePriority=this.getProperty("avoidpriority",this.avoidancePriority);this.autoTraverseOffMeshLink=this.getProperty("autotraverse",this.autoTraverseOffMeshLink);this.autoRepath=this.getProperty("autopepath",this.autoRepath);this.areaMask=this.getProperty("areamask",this.areaMask);n.Utilities.ValidateTransformQuaternion(this.transform);this.m_agentTrans=new n.TransformNode(this.transform.name+".Agent",this.scene);this.m_agentTrans.position=new n.Vector3(0,0,0);this.m_agentTrans.rotation=new n.Vector3(0,0,0);n.Utilities.ValidateTransformQuaternion(this.m_agentTrans);this.lastPosition.copyFrom(this.transform.position)},i.prototype.updateNavigationAgent=function(){var t=n.SceneManager.GetCrowdInterface(this.scene),i,r;t!=null&&(this.m_agentIndex<0&&(this.m_agentParams={radius:this.avoidRadius,height:this.avoidHeight,maxSpeed:this.speed,maxAcceleration:this.acceleration,collisionQueryRange:.5,pathOptimizationRange:0,separationWeight:1},n.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition),this.m_agentIndex=t.addAgent(this.resetPosition,this.m_agentParams,this.m_agentTrans)),this.m_agentState=t.getAgentState(this.m_agentIndex),this.getAgentWaypointToRef(this.currentWaypoint),this.getAgentPositionToRef(this.currentPosition),this.m_agentState===n.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH?(this.currentPosition.subtractToRef(this.lastPosition,this.currentVelocity),this.currentVelocity.scaleInPlace(this.speed*1.5)):this.getAgentVelocityToRef(this.currentVelocity),this.m_agentDestination!=null?(this.distanceToTarget=n.Vector3.Distance(this.currentPosition,this.m_agentDestination),(this.updatePosition===!0||this.angularSpeed>0)&&(this.onPreUpdateObservable.hasObservers()===!0&&this.onPreUpdateObservable.notifyObservers(this.transform),this.angularSpeed>0&&this.currentVelocity.length()>=this.velocityEpsilon&&(this.currentVelocity.normalize(),i=this.angularSpeed*n.NavigationAgent.ANGULAR_SPEED_RATIO*this.getDeltaSeconds(),this.m_agentState===n.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH?(this.moveDirection.copyFrom(this.m_agentDirection),this.m_agentDirection.set(this.moveDirection.x+(this.currentVelocity.x-this.moveDirection.x),this.moveDirection.y+(this.currentVelocity.y-this.moveDirection.y),this.moveDirection.z+(this.currentVelocity.z-this.moveDirection.z)),this.m_agentDirection.normalize(),r=n.NavigationAgent.TARGET_ANGLE_FACTOR-Math.atan2(this.m_agentDirection.z,this.m_agentDirection.x),n.Quaternion.FromEulerAnglesToRef(0,r,0,this.m_agentRotation),n.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.m_agentRotation,i,this.transform.rotationQuaternion)):(this.m_agentQuaternion.copyFrom(this.transform.rotationQuaternion),this.transform.lookAt(this.currentWaypoint),this.transform.rotationQuaternion.toEulerAnglesToRef(this.m_agentDirection),n.Quaternion.FromEulerAnglesToRef(0,this.m_agentDirection.y,0,this.m_agentRotation),n.Quaternion.SlerpToRef(this.m_agentQuaternion,this.m_agentRotation,i,this.transform.rotationQuaternion))),this.updatePosition===!0&&this.transform.position.set(this.currentPosition.x,this.currentPosition.y+this.baseOffset+this.heightOffset,this.currentPosition.z),this.onPostUpdateObservable.hasObservers()===!0&&this.onPostUpdateObservable.notifyObservers(this.transform)),this.distanceToTarget<=Math.max(this.distanceEpsilon,this.stoppingDistance)&&(this.cancelNavigation(),this.onNavCompleteObservable.hasObservers()===!0&&this.onNavCompleteObservable.notifyObservers(this.transform))):this.distanceToTarget=0,this.lastPosition.copyFrom(this.transform.position))},i.prototype.destroyNavigationAgent=function(){this.m_agentIndex=-1;this.m_agentRotation=null;this.m_agentMovement=null;this.m_agentDirection=null;this.m_agentDestination=null;this.moveDirection=null;this.resetPosition=null;this.lastPosition=null;this.currentPosition=null;this.currentVelocity=null;this.currentWaypoint=null;this.onPreUpdateObservable.clear();this.onPreUpdateObservable=null;this.onPostUpdateObservable.clear();this.onPostUpdateObservable=null;this.onNavCompleteObservable.clear();this.onNavCompleteObservable=null;this.m_agentTrans!=null&&(this.m_agentTrans.dispose(),this.m_agentTrans=null)},i.prototype.move=function(t,i){i===void 0&&(i=!0);var u=n.SceneManager.GetNavigationTools(),r=n.SceneManager.GetCrowdInterface(this.scene);u!=null&&r!=null?(r.getAgentPosition(this.m_agentIndex).addToRef(t,this.m_agentMovement),this.m_agentDestination=i===!0?u.getClosestPoint(this.m_agentMovement):this.m_agentMovement.clone(),this.m_agentIndex>=0&&r.agentGoto(this.m_agentIndex,this.m_agentDestination)):n.Tools.Warn("No recast navigation mesh or crowd interface data available!")},i.prototype.teleport=function(t,i){i===void 0&&(i=!0);var r=n.SceneManager.GetNavigationTools(),u=n.SceneManager.GetCrowdInterface(this.scene);r!=null&&u!=null?(this.m_agentDestination=i===!0?r.getClosestPoint(t):t.clone(),this.m_agentIndex>=0&&u.agentTeleport(this.m_agentIndex,this.m_agentDestination)):n.Tools.Warn("No recast navigation mesh or crowd interface data available!")},i.prototype.setDestination=function(t,i,r){i===void 0&&(i=!0);r===void 0&&(r=!0);var u=n.SceneManager.GetNavigationTools(),f=n.SceneManager.GetCrowdInterface(this.scene);u!=null&&f!=null?(r===!0&&this.resetAgentPosition(),this.m_agentDestination=i===!0?u.getClosestPoint(t):t.clone(),this.m_agentIndex>=0&&f.agentGoto(this.m_agentIndex,this.m_agentDestination)):n.Tools.Warn("No recast navigation mesh or crowd interface data available!")},i.prototype.getAgentVelocity=function(){var t=n.SceneManager.GetCrowdInterface(this.scene);return t!=null&&this.m_agentIndex>=0?t.getAgentVelocity(this.m_agentIndex):null},i.prototype.getAgentVelocityToRef=function(t){var i=n.SceneManager.GetCrowdInterface(this.scene);i!=null&&this.m_agentIndex>=0&&i.getAgentVelocityToRef(this.m_agentIndex,t)},i.prototype.getAgentPosition=function(){var t=n.SceneManager.GetCrowdInterface(this.scene);return t!=null&&this.m_agentIndex>=0?t.getAgentPosition(this.m_agentIndex):null},i.prototype.getAgentPositionToRef=function(t){var i=n.SceneManager.GetCrowdInterface(this.scene);i!=null&&this.m_agentIndex>=0&&i.getAgentPositionToRef(this.m_agentIndex,t)},i.prototype.getAgentWaypoint=function(){var t=n.SceneManager.GetCrowdInterface(this.scene);return t!=null&&this.m_agentIndex>=0?t.getAgentNextTargetPath(this.m_agentIndex):null},i.prototype.getAgentWaypointToRef=function(t){var i=n.SceneManager.GetCrowdInterface(this.scene);i!=null&&this.m_agentIndex>=0&&i.getAgentNextTargetPathToRef(this.m_agentIndex,t)},i.prototype.resetAgentPosition=function(){this.m_agentDestination=null;n.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition);var t=n.SceneManager.GetCrowdInterface(this.scene);t!=null&&this.m_agentIndex>=0&&t.agentTeleport(this.m_agentIndex,this.resetPosition)},i.prototype.cancelNavigation=function(){this.m_agentDestination=null;var i=n.SceneManager.GetCrowdInterface(this.scene),t=this.getAgentPosition();t!=null&&i!=null&&this.m_agentIndex>=0&&(i.agentTeleport(this.m_agentIndex,t),t.y+=this.baseOffset+this.heightOffset,this.transform.position.copyFrom(t))},i.TARGET_ANGLE_FACTOR=Math.PI*.5,i.ANGULAR_SPEED_RATIO=.1,i}(n.ScriptComponent),i;n.NavigationAgent=t,function(n){n[n.DT_CROWDAGENT_STATE_INVALID=0]="DT_CROWDAGENT_STATE_INVALID";n[n.DT_CROWDAGENT_STATE_WALKING=1]="DT_CROWDAGENT_STATE_WALKING";n[n.DT_CROWDAGENT_STATE_OFFMESH=2]="DT_CROWDAGENT_STATE_OFFMESH"}(i=n.CrowdAgentState||(n.CrowdAgentState={}))}(BABYLON||(BABYLON={})),function(n){var t=function(){function t(t,i,r,u){u===void 0&&(u=null);this._centerMass=new n.Vector3(0,0,0);this._chassisMesh=null;this._tempVectorPos=new n.Vector3(0,0,0);this.lockedWheelIndexes=null;this.m_vehicle=null;this.m_vehicleTuning=null;this.m_vehicleRaycaster=null;this.m_vehicleColliders=null;this.m_tempTransform=null;this.m_tempPosition=null;this.m_wheelDirectionCS0=null;this.m_wheelAxleCS=null;this._chassisMesh=t;this._centerMass=r;this.m_vehicleTuning=new Ammo.btVehicleTuning;this.m_vehicleRaycaster=Ammo.btSmoothVehicleRaycaster!=null?new Ammo.btSmoothVehicleRaycaster(i):new Ammo.btDefaultVehicleRaycaster(i);this.m_vehicleColliders=this._chassisMesh.metadata!=null&&this._chassisMesh.metadata.unity!=null&&this._chassisMesh.metadata.unity.wheels!=null?this._chassisMesh.metadata.unity.wheels:null;this.m_vehicle=new Ammo.btRaycastVehicle(this.m_vehicleTuning,this._chassisMesh.physicsImpostor.physicsBody,this.m_vehicleRaycaster);this.m_vehicle.setCoordinateSystem(0,1,2);this.m_wheelDirectionCS0=new Ammo.btVector3(0,-1,0);this.m_wheelAxleCS=new Ammo.btVector3(-1,0,0);this.m_tempPosition=null;this.m_tempTransform=null;this.setupWheelInformation(u);i.addAction(this.m_vehicle);Ammo.btSmoothVehicleRaycaster==null&&n.Tools.Warn("Using Default Vehicle Raycaster For:"+t.name)}return t.prototype.getInternalVehicle=function(){return this.m_vehicle},t.prototype.getUpAxis=function(){if(this.m_vehicle!=null)return this.m_vehicle.getUpAxis()},t.prototype.getRightAxis=function(){if(this.m_vehicle!=null)return this.m_vehicle.getRightAxis()},t.prototype.getForwardAxis=function(){if(this.m_vehicle!=null)return this.m_vehicle.getForwardAxis()},t.prototype.getForwardVector=function(){if(this.m_vehicle!=null)return this.m_vehicle.getForwardVector()},t.prototype.getNumWheels=function(){if(this.m_vehicle!=null)return this.m_vehicle.getNumWheels()},t.prototype.getWheelInfo=function(n){if(this.m_vehicle!=null)return this.m_vehicle.getWheelInfo(n)},t.prototype.resetSuspension=function(){this.m_vehicle!=null&&this.m_vehicle.resetSuspension()},t.prototype.setPitchControl=function(n){this.m_vehicle!=null&&this.m_vehicle.setPitchControl(n)},t.prototype.setEngineForce=function(n,t){this.m_vehicle!=null&&this.m_vehicle.applyEngineForce(n,t)},t.prototype.setBrakingForce=function(n,t){this.m_vehicle!=null&&this.m_vehicle.setBrake(n,t)},t.prototype.getWheelTransform=function(n){if(this.m_vehicle!=null)return this.m_vehicle.getWheelTransformWS(n)},t.prototype.updateWheelTransform=function(n,t){this.m_vehicle!=null&&this.m_vehicle.updateWheelTransform(n,t)},t.prototype.getUserConstraintType=function(){if(this.m_vehicle!=null)return this.m_vehicle.getUserConstraintType()},t.prototype.setUserConstraintType=function(n){this.m_vehicle!=null&&this.m_vehicle.setUserConstraintType(n)},t.prototype.setUserConstraintId=function(n){this.m_vehicle!=null&&this.m_vehicle.setUserConstraintId(n)},t.prototype.getUserConstraintId=function(){if(this.m_vehicle!=null)return this.m_vehicle.getUserConstraintId()},t.prototype.getRawCurrentSpeedKph=function(){if(this.m_vehicle!=null)return this.m_vehicle.getCurrentSpeedKmHour()},t.prototype.getRawCurrentSpeedMph=function(){if(this.m_vehicle!=null)return this.m_vehicle.getCurrentSpeedKmHour()*n.System.Kph2Mph},t.prototype.getAbsCurrentSpeedKph=function(){if(this.m_vehicle!=null)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())},t.prototype.getAbsCurrentSpeedMph=function(){if(this.m_vehicle!=null)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())*n.System.Kph2Mph},t.prototype.getVehicleTuningSystem=function(){return this.m_vehicleTuning},t.prototype.getChassisWorldTransform=function(){if(this.m_vehicle!=null)return this.m_vehicle.getChassisWorldTransform()},t.prototype.dispose=function(){this.deleteWheelInformation();this.m_vehicle!=null&&(Ammo.destroy(this.m_vehicle),this.m_vehicle=null);this.m_vehicleTuning!=null&&(Ammo.destroy(this.m_vehicleTuning),this.m_vehicleTuning=null);this.m_vehicleRaycaster!=null&&(Ammo.destroy(this.m_vehicleRaycaster),this.m_vehicleRaycaster=null);this.m_wheelDirectionCS0!=null&&(Ammo.destroy(this.m_wheelDirectionCS0),this.m_wheelDirectionCS0=null);this.m_wheelAxleCS!=null&&(Ammo.destroy(this.m_wheelAxleCS),this.m_wheelAxleCS=null);this.m_tempPosition!=null&&(Ammo.destroy(this.m_tempPosition),this.m_tempPosition=null);this.m_tempTransform!=null&&(Ammo.destroy(this.m_tempTransform),this.m_tempTransform=null);this.m_vehicleColliders=null},t.GetInstance=function(t,i,r){var u,f;return r===void 0&&(r=null),u=i,u.m_raycastVehicle==null&&(i.hasWheelColliders()?(f=n.SceneManager.GetRightHanded(t),f===!0&&n.Tools.Warn("Raycast vehicle not supported for right handed scene: "+u._abstractMesh.name),u.m_raycastVehicle=new n.RaycastVehicle(u._abstractMesh,u.m_physicsWorld,u._centerOfMass,r)):n.Tools.Warn("No wheel collider metadata found for: "+u._abstractMesh.name)),u.m_raycastVehicle},t.prototype.getEnableMultiRaycast=function(){var n=!1;return this.m_vehicle!=null&&this.m_vehicle.get_m_enableMultiRaycast&&(n=this.m_vehicle.get_m_enableMultiRaycast()),n},t.prototype.setEnableMultiRaycast=function(n){this.m_vehicle!=null&&this.m_vehicle.set_m_enableMultiRaycast&&this.m_vehicle.set_m_enableMultiRaycast(n)},t.prototype.getStabilizingForce=function(){var n=-1;return this.m_vehicle!=null&&this.m_vehicle.get_m_stabilizingForce&&(n=this.m_vehicle.get_m_stabilizingForce()),n},t.prototype.setStabilizingForce=function(n){this.m_vehicle!=null&&this.m_vehicle.set_m_stabilizingForce&&this.m_vehicle.set_m_stabilizingForce(n)},t.prototype.getSmoothFlyingImpulse=function(){var n=-1;return this.m_vehicle!=null&&this.m_vehicle.get_m_smoothFlyingImpulse&&(n=this.m_vehicle.get_m_smoothFlyingImpulse()),n},t.prototype.setSmoothFlyingImpulse=function(n){this.m_vehicle!=null&&this.m_vehicle.set_m_smoothFlyingImpulse&&this.m_vehicle.set_m_smoothFlyingImpulse(n)},t.prototype.getTrackConnectionAccel=function(){var n=-1;return this.m_vehicle!=null&&this.m_vehicle.get_m_trackConnectionAccel&&(n=this.m_vehicle.get_m_trackConnectionAccel()),n},t.prototype.setTrackConnectionAccel=function(n){this.m_vehicle!=null&&this.m_vehicle.set_m_trackConnectionAccel&&this.m_vehicle.set_m_trackConnectionAccel(n)},t.prototype.getMinimumWheelContacts=function(){var n=-1;return this.m_vehicle!=null&&this.m_vehicle.get_m_minimumWheelContacts&&(n=this.m_vehicle.get_m_minimumWheelContacts()),n},t.prototype.setMinimumWheelContacts=function(n){this.m_vehicle!=null&&this.m_vehicle.set_m_minimumWheelContacts&&this.m_vehicle.set_m_minimumWheelContacts(n)},t.prototype.getInterpolateNormals=function(){var n=!1;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_interpolateNormals&&(n=this.m_vehicleRaycaster.get_m_interpolateNormals()),n},t.prototype.setInterpolateNormals=function(n){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_interpolateNormals&&this.m_vehicleRaycaster.set_m_interpolateNormals(n)},t.prototype.getShapeTestingMode=function(){var n=!1;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_shapeTestingMode&&(n=this.m_vehicleRaycaster.get_m_shapeTestingMode()),n},t.prototype.setShapeTestingMode=function(n){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_shapeTestingMode&&this.m_vehicleRaycaster.set_m_shapeTestingMode(n)},t.prototype.getShapeTestingSize=function(){var n=0;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_shapeTestingSize&&(n=this.m_vehicleRaycaster.get_m_shapeTestingSize()),n},t.prototype.setShapeTestingSize=function(n){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_shapeTestingSize&&this.m_vehicleRaycaster.set_m_shapeTestingSize(n)},t.prototype.getShapeTestingCount=function(){var n=0;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_testPointCount&&(n=this.m_vehicleRaycaster.get_m_testPointCount()),n},t.prototype.setShapeTestingCount=function(n){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_testPointCount&&this.m_vehicleRaycaster.set_m_testPointCount(n)},t.prototype.getSweepPenetration=function(){var n=0;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_sweepPenetration&&(n=this.m_vehicleRaycaster.get_m_sweepPenetration()),n},t.prototype.setSweepPenetration=function(n){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_sweepPenetration&&this.m_vehicleRaycaster.set_m_sweepPenetration(n)},t.prototype.getCollisionFilterGroup=function(){var n=-1;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_collisionFilterGroup&&(n=this.m_vehicleRaycaster.get_m_collisionFilterGroup()),n},t.prototype.setCollisionFilterGroup=function(n){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_collisionFilterGroup&&this.m_vehicleRaycaster.set_m_collisionFilterGroup(n)},t.prototype.getCollisionFilterMask=function(){var n=-1;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_collisionFilterMask&&(n=this.m_vehicleRaycaster.get_m_collisionFilterMask()),n},t.prototype.setCollisionFilterMask=function(n){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_collisionFilterMask&&this.m_vehicleRaycaster.set_m_collisionFilterMask(n)},t.prototype.getWheelIndexByID=function(n){var i=-1,t,r;if(this.m_vehicleColliders!=null&&this.m_vehicleColliders.length>0)for(t=0;t<this.m_vehicleColliders.length;t++)if(r=this.m_vehicleColliders[t],n.toLowerCase()===r.id.toLowerCase()){i=t;break}return i},t.prototype.getWheelIndexByName=function(n){var i=-1,t,r;if(this.m_vehicleColliders!=null&&this.m_vehicleColliders.length>0)for(t=0;t<this.m_vehicleColliders.length;t++)if(r=this.m_vehicleColliders[t],n.toLowerCase()===r.name.toLowerCase()){i=t;break}return i},t.prototype.getWheelColliderInfo=function(n){var t=-1;return this.m_vehicleColliders!=null&&this.m_vehicleColliders.length>0&&this.m_vehicleColliders.length>n&&(t=this.m_vehicleColliders[n]),t},t.prototype.setWheelTransformMesh=function(n,t){if(t!=null){var i=this.getWheelInfo(n);i!=null&&(i.transform=t)}},t.prototype.getVisualSteeringAngle=function(n){var i=0,t=this.getWheelInfo(n);return t!=null&&t.steeringAngle!=null&&(i=t.steeringAngle),i},t.prototype.setVisualSteeringAngle=function(n,t){var i=this.getWheelInfo(t);i!=null&&(i.steeringAngle=n)},t.prototype.getPhysicsSteeringAngle=function(n){if(this.m_vehicle!=null)return Math.abs(this.m_vehicle.getSteeringValue(n))},t.prototype.setPhysicsSteeringAngle=function(n,t){this.m_vehicle!=null&&this.m_vehicle.setSteeringValue(n,t)},t.prototype.setupWheelInformation=function(t){var u;if(t===void 0&&(t=null),this._chassisMesh!=null&&this._chassisMesh.physicsImpostor!=null&&this._chassisMesh.physicsImpostor.physicsBody!=null&&(t!=null&&this._chassisMesh.physicsImpostor.physicsBody.setAngularFactor(new Ammo.btVector3(t.x,t.y,t.z)),this._chassisMesh.physicsImpostor.physicsBody.setActivationState(n.CollisionState.DISABLE_DEACTIVATION)),this.m_vehicle!=null&&this.m_vehicleColliders!=null&&this.m_vehicleColliders.length>0){for(u=-1,u=0;u<this.m_vehicleColliders.length;u++){var i=this.m_vehicleColliders[u],e=i.name!=null?i.name:"Unknown",o=i.radius!=null?i.radius:.35,s=i.position!=null&&i.position.length>=3?i.position[0]:1,h=i.position!=null&&i.position.length>=3?i.position[2]:-1,c=i.wheelconnectionpoint!=null?i.wheelconnectionpoint:.5,l=i.suspensionrestlength!=null?i.suspensionrestlength:.3,a=i.frontwheel!=null?!0:e.toLowerCase().indexOf("front")>=0,v=h,y=s,p=-this._centerMass.x,w=-this._centerMass.z;this.m_vehicle.addWheel(new Ammo.btVector3(y+p,c,v+w),this.m_wheelDirectionCS0,this.m_wheelAxleCS,l,o,this.m_vehicleTuning,a)}if(this.m_vehicle.getNumWheels()===this.m_vehicleColliders.length)for(u=0;u<this.m_vehicleColliders.length;u++){var i=this.m_vehicleColliders[u],b=i.totalsuspensionforces!=null?i.totalsuspensionforces:1e6,k=i.suspensiontravelcm!=null?i.suspensiontravelcm:25,d=i.rollinfluence!=null?i.rollinfluence:.2,f=i.frictionslip!=null?i.frictionslip:10,g=i.suspensionstiffness!=null?i.suspensionstiffness:50,nt=i.dampingcompression!=null?i.dampingcompression:3.5,tt=i.dampingrelaxation!=null?i.dampingrelaxation:4.5,r=this.m_vehicle.getWheelInfo(u);r!=null&&(r.steeringAngle=0,r.rotationBoost=0,r.defaultFriction=f,r.set_m_frictionSlip(f),r.set_m_rollInfluence(d),r.set_m_maxSuspensionForce(b),r.set_m_maxSuspensionTravelCm(k),r.set_m_suspensionStiffness(g),r.set_m_wheelsDampingCompression(nt),r.set_m_wheelsDampingRelaxation(tt))}else n.Tools.Warn("Failed to create proper number of wheels for: "+this._chassisMesh.name)}},t.prototype.updateWheelInformation=function(){var f=this.getNumWheels(),i,t,e,r,o;if(f>0)for(i=0;i<f;i++)if(t=this.getWheelInfo(i),t!=null&&(e=this.lockedWheelInformation(i),this.updateWheelTransform(i,!1),this.m_tempTransform=this.getWheelTransform(i),this.m_tempPosition=this.m_tempTransform.getOrigin(),t.transform!=null&&(r=t.transform,r.parent!=null&&(n.Utilities.ConvertAmmoVector3ToRef(this.m_tempPosition,this._tempVectorPos),n.Utilities.InverseTransformPointToRef(r.parent,this._tempVectorPos,this._tempVectorPos),r.position.y=this._tempVectorPos.y,o=t.steeringAngle!=null?t.steeringAngle:0,n.Quaternion.FromEulerAnglesToRef(0,o,0,r.rotationQuaternion),t.spinner!=null&&t.spinner.addRotation&&e===!1)))){var s=0,u=t.get_m_deltaRotation!=null?t.get_m_deltaRotation():0,h=t.rotationBoost!=null?t.rotationBoost:0;s=u<0?u+-h:u+h;t.spinner.addRotation(s,0,0)}},t.prototype.lockedWheelInformation=function(n){var i=!1,t;if(this.lockedWheelIndexes!=null&&this.lockedWheelIndexes.length>0)for(t=0;t<this.lockedWheelIndexes.length;t++)if(this.lockedWheelIndexes[t]===n){i=!0;break}return i},t.prototype.deleteWheelInformation=function(){var i=this.getNumWheels(),t,n;if(i>0)for(t=0;t<i;t++)n=this.getWheelInfo(t),n!=null&&(n.transform!=null&&delete n.transform,n.spinner!=null&&delete n.spinner,n.steeringAngle!=null&&delete n.steeringAngle,n.rotationBoost!=null&&delete n.rotationBoost,n.defaultFriction!=null&&delete n.defaultFriction)},t}();n.RaycastVehicle=t}(BABYLON||(BABYLON={})),function(n){var i=function(i){function r(){var t=i!==null&&i.apply(this,arguments)||this;return t._abstractMesh=null,t._isKinematic=!1,t._maxCollisions=4,t._isPhysicsReady=!1,t._centerOfMass=new n.Vector3(0,0,0),t._tmpLinearFactor=new n.Vector3(0,0,0),t._tmpAngularFactor=new n.Vector3(0,0,0),t._tmpCenterOfMass=new n.Vector3(0,0,0),t._tmpGravityVector=null,t._tmpCollisionContacts=null,t.m_physicsWorld=null,t.m_physicsEngine=null,t.m_raycastVehicle=null,t.onCollisionEnterObservable=new n.Observable,t.onCollisionStayObservable=new n.Observable,t.onCollisionExitObservable=new n.Observable,t}return __extends(r,i),Object.defineProperty(r.prototype,"isKinematic",{get:function(){return this._isKinematic},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"centerOfMass",{get:function(){return this._centerOfMass},enumerable:!1,configurable:!0}),r.prototype.awake=function(){this.awakeRigidbodyState()},r.prototype.update=function(){this.updateRigidbodyState()},r.prototype.after=function(){this.afterRigidbodyState()},r.prototype.destroy=function(){this.destroyRigidbodyState()},r.prototype.awakeRigidbodyState=function(){this._abstractMesh=this.getAbstractMesh();this._isKinematic=this.getProperty("isKinematic",this._isKinematic);this.m_physicsWorld=n.SceneManager.GetPhysicsWorld(this.scene);this.m_physicsEngine=n.SceneManager.GetPhysicsEngine(this.scene);this.transform.metadata!=null&&this.transform.metadata.unity!=null&&this.transform.metadata.unity.physics!=null&&(this._centerOfMass=this.transform.metadata.unity.physics.center!=null?n.Utilities.ParseVector3(this.transform.metadata.unity.physics.center,this._centerOfMass):this._centerOfMass);this.setMaxNotifications(this._maxCollisions);n.Utilities.ValidateTransformQuaternion(this.transform);this._isPhysicsReady=this.m_physicsEngine!=null&&this._tmpCollisionContacts!=null&&this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null;var t=this._isKinematic===!0?n.CollisionFilters.StaticFilter:n.CollisionFilters.DefaultFilter,i=this._isKinematic===!0?n.CollisionFilters.AllFilter^n.CollisionFilters.StaticFilter:n.CollisionFilters.AllFilter;this.setCollisionFilterGroup(t);this.setCollisionFilterMask(i);this.resetBodyCollisionContacts()},r.prototype.updateRigidbodyState=function(){this.syncronizeVehicleController()},r.prototype.afterRigidbodyState=function(){this.parseBodyCollisionContacts();this.resetBodyCollisionContacts()},r.prototype.destroyRigidbodyState=function(){this.m_physicsWorld=null;this.m_physicsEngine=null;this.m_raycastVehicle!=null&&(this.m_raycastVehicle.dispose&&this.m_raycastVehicle.dispose(),this.m_raycastVehicle=null);this._tmpGravityVector!=null&&(Ammo.destroy(this._tmpGravityVector),this._tmpGravityVector=null);this.onCollisionEnterObservable.clear();this.onCollisionEnterObservable=null;this.onCollisionStayObservable.clear();this.onCollisionStayObservable=null;this.onCollisionExitObservable.clear();this.onCollisionExitObservable=null;this._tmpCollisionContacts=null;this._abstractMesh=null},r.prototype.syncronizeVehicleController=function(){this.m_raycastVehicle!=null&&this.m_raycastVehicle.updateWheelInformation&&this.m_raycastVehicle.updateWheelInformation()},r.prototype.parseBodyCollisionContacts=function(){var n,u,f,l,e,o,i,r,t;if(this._isPhysicsReady===!0){var s=this.onCollisionEnterObservable.hasObservers(),h=this.onCollisionStayObservable.hasObservers(),c=this.onCollisionExitObservable.hasObservers();if(s||h||c){for(n=0,n=0;n<this._tmpCollisionContacts.length;n++)this._tmpCollisionContacts[n].reset=!0;if(u=0,this._abstractMesh.physicsImpostor.tmpCollisionObjects!=null){f=this._abstractMesh.physicsImpostor.tmpCollisionObjects;for(l in f){for(e=-1,o=f[l],n=0;n<this._tmpCollisionContacts.length;n++)if(i=this._tmpCollisionContacts[n],i.mesh!=null&&i.mesh===o){i.state=1;i.reset=!1;e=n;break}if(e===-1)for(n=0;n<this._tmpCollisionContacts.length;n++)if(r=this._tmpCollisionContacts[n],r.mesh==null){r.mesh=o;r.state=0;r.reset=!1;break}if(u++,u>this._maxCollisions)break}}for(n=0;n<this._tmpCollisionContacts.length;n++)t=this._tmpCollisionContacts[n],t.reset===!0?(c&&t.mesh!=null&&this.onCollisionExitObservable.notifyObservers(t.mesh),t.mesh=null,t.state=0,t.reset=!1):t.state===0?s&&t.mesh!=null&&this.onCollisionEnterObservable.notifyObservers(t.mesh):h&&t.mesh!=null&&this.onCollisionStayObservable.notifyObservers(t.mesh)}}},r.prototype.resetBodyCollisionContacts=function(){if(this._isPhysicsReady===!0){var n=this.onCollisionEnterObservable.hasObservers(),t=this.onCollisionStayObservable.hasObservers(),i=this.onCollisionExitObservable.hasObservers();this._abstractMesh.physicsImpostor.tmpCollisionObjects=n||t||i?{}:null}},r.prototype.setGravity=function(n){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setGravity&&n!=null&&(this._tmpGravityVector==null&&(this._tmpGravityVector=new Ammo.btVector3(0,0,0)),this._tmpGravityVector.setValue(n.x,n.y,n.z),this._abstractMesh.physicsImpostor.physicsBody.setGravity(this._tmpGravityVector))},r.prototype.getGravity=function(){var t=new n.Vector3(0,0,0);return this.getGravityToRef(t),t},r.prototype.getGravityToRef=function(t){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getGravity){var i=this._abstractMesh.physicsImpostor.physicsBody.getGravity();n.Utilities.ConvertAmmoVector3ToRef(i,t)}},r.prototype.getMass=function(){var n=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(n=this._abstractMesh.physicsImpostor.mass),n},r.prototype.setMass=function(n){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.mass!==n&&(this._abstractMesh.physicsImpostor.mass=n)},r.prototype.getFriction=function(){var n=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(n=this._abstractMesh.physicsImpostor.friction),n},r.prototype.setFriction=function(n){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.friction!==n&&(this._abstractMesh.physicsImpostor.friction=n)},r.prototype.getRestitution=function(){var n=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(n=this._abstractMesh.physicsImpostor.restitution),n},r.prototype.setRestitution=function(n){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.restitution!==n&&(this._abstractMesh.physicsImpostor.restitution=n)},r.prototype.getLinearVelocity=function(){var n=null;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(n=this._abstractMesh.physicsImpostor.getLinearVelocity()),n},r.prototype.setLinearVelocity=function(n){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&n!=null&&this._abstractMesh.physicsImpostor.setLinearVelocity(n)},r.prototype.getAngularVelocity=function(){var n=null;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(n=this._abstractMesh.physicsImpostor.getAngularVelocity()),n},r.prototype.setAngularVelocity=function(n){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&n!=null&&this._abstractMesh.physicsImpostor.setAngularVelocity(n)},r.prototype.getWorldTransform=function(){var t=null,n;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(n=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),n!=null&&n.getWorldTransform&&(t=n.getWorldTransform())),t},r.prototype.getTransformPositionToRef=function(t){var i=this.getWorldTransform(),r;i!=null&&t!=null&&(r=i.getOrigin(),n.Utilities.ConvertAmmoVector3ToRef(r,t))},r.prototype.getTransformRotationToRef=function(t){var i=this.getWorldTransform(),r;i!=null&&t!=null&&(r=i.getRotation(),n.Utilities.ConvertAmmoQuaternionToRef(r,t))},r.prototype.clearForces=function(){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.clearForces&&this._abstractMesh.physicsImpostor.physicsBody.clearForces()},r.prototype.applyTorque=function(t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyTorque&&t!=null&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyTorque(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyLocalTorque=function(t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyLocalTorque&&t!=null&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyLocalTorque(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyImpulse=function(t,i){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyImpulse&&t!=null&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVectorAux==null&&(n.RigidbodyPhysics.TempAmmoVectorAux=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),n.RigidbodyPhysics.TempAmmoVectorAux.setValue(i.x,i.y,i.z),this._abstractMesh.physicsImpostor.physicsBody.applyImpulse(n.RigidbodyPhysics.TempAmmoVector,n.RigidbodyPhysics.TempAmmoVectorAux))},r.prototype.applyCentralImpulse=function(t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralImpulse&&t!=null&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralImpulse(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyTorqueImpulse=function(t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyTorqueImpulse&&t!=null&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyTorqueImpulse(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyForce=function(t,i){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyForce&&t!=null&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVectorAux==null&&(n.RigidbodyPhysics.TempAmmoVectorAux=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),n.RigidbodyPhysics.TempAmmoVectorAux.setValue(i.x,i.y,i.z),this._abstractMesh.physicsImpostor.physicsBody.applyForce(n.RigidbodyPhysics.TempAmmoVector,n.RigidbodyPhysics.TempAmmoVectorAux))},r.prototype.applyCentralForce=function(t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralForce&&t!=null&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralForce(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyCentralLocalForce=function(t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralLocalForce&&t!=null&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralLocalForce(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.getCenterOfMassTransform=function(){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getCenterOfMassTransform){var t=this._abstractMesh.physicsImpostor.physicsBody.getCenterOfMassTransform(),n=t.getOrigin();this._tmpCenterOfMass.set(n.x(),n.y(),n.z())}return this._tmpCenterOfMass},r.prototype.setCenterOfMassTransform=function(t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setCenterOfMassTransform&&t!=null&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),n.RigidbodyPhysics.TempCenterTransform==null&&(n.RigidbodyPhysics.TempCenterTransform=new Ammo.btTransform),n.RigidbodyPhysics.TempCenterTransform.setIdentity(),n.RigidbodyPhysics.TempCenterTransform.setOrigin(n.RigidbodyPhysics.TempAmmoVector),this._abstractMesh.physicsImpostor.physicsBody.setCenterOfMassTransform(n.RigidbodyPhysics.TempCenterTransform))},r.prototype.getLinearFactor=function(){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getLinearFactor){var n=this._abstractMesh.physicsImpostor.physicsBody.getLinearFactor();this._tmpLinearFactor.set(n.x(),n.y(),n.z())}return this._tmpLinearFactor},r.prototype.setLinearFactor=function(t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setLinearFactor&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.setLinearFactor(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.getAngularFactor=function(){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getAngularFactor){var n=this._abstractMesh.physicsImpostor.physicsBody.getAngularFactor();this._tmpAngularFactor.set(n.x(),n.y(),n.z())}return this._tmpAngularFactor},r.prototype.setAngularFactor=function(t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setAngularFactor&&(n.RigidbodyPhysics.TempAmmoVector==null&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.setAngularFactor(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.getAngularDamping=function(){var n=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getAngularDamping&&(n=this._abstractMesh.physicsImpostor.physicsBody.getAngularDamping()),n},r.prototype.getLinearDamping=function(){var n=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getLinearDamping&&(n=this._abstractMesh.physicsImpostor.physicsBody.getLinearDamping()),n},r.prototype.setDamping=function(n,t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setDamping&&this._abstractMesh.physicsImpostor.physicsBody.setDamping(n,t)},r.prototype.setSleepingThresholds=function(n,t){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setSleepingThresholds&&this._abstractMesh.physicsImpostor.physicsBody.setSleepingThresholds(n,t)},r.prototype.hasWheelColliders=function(){return this._isPhysicsReady===!0&&this._abstractMesh.metadata!=null&&this._abstractMesh.metadata.unity!=null&&this._abstractMesh.metadata.unity.wheels!=null},r.prototype.setMaxNotifications=function(n){this._maxCollisions=n;this._tmpCollisionContacts=[];for(var i=0;i<this._maxCollisions;i++)this._tmpCollisionContacts.push(new t)},r.prototype.setActivationState=function(n){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null){var t=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject);t!=null&&t.setActivationState&&t.setActivationState(n)}},r.prototype.getCollisionFilterGroup=function(){var n=-1;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&(n=this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().get_m_collisionFilterGroup()),n},r.prototype.setCollisionFilterGroup=function(n){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().set_m_collisionFilterGroup(n)},r.prototype.getCollisionFilterMask=function(){var n=-1;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&(n=this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().get_m_collisionFilterMask()),n},r.prototype.setCollisionFilterMask=function(n){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().set_m_collisionFilterMask(n)},r.prototype.getCollisionShapeType=function(){var i=-1,t,n;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(t=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),t!=null&&(n=t.getCollisionShape(),n!=null&&n.getShapeType&&(i=n.getShapeType()))),i},r.prototype.getCollisionShapeMargin=function(){var i=-1,t,n;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(t=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),t!=null&&(n=t.getCollisionShape(),n!=null&&n.getMargin&&(i=n.getMargin()))),i},r.prototype.setCollisionShapeMargin=function(n){var i,t;this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(i=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),i!=null&&(t=i.getCollisionShape(),t!=null&&t.setMargin&&t.setMargin(n)))},r.prototype.getContactProcessingThreshold=function(){var t=-1,n;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(n=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),n!=null&&n.getContactProcessingThreshold&&(t=n.getContactProcessingThreshold())),t},r.prototype.setContactProcessingThreshold=function(n){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null){var t=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject);t!=null&&t.setContactProcessingThreshold&&t.setContactProcessingThreshold(n)}},r.CreatePhysicsMetadata=function(t,i,r,u){i===void 0&&(i=0);r===void 0&&(r=.05);u===void 0&&(u=null);var f=u!=null?u:new n.Vector3(0,0,0);return{type:"rigidbody",mass:t,ldrag:i,adrag:r,center:{x:f.x,y:f.y,z:f.z}}},r.CreateCollisionMetadata=function(n,t,i,r,u,f){return t===void 0&&(t=!1),i===void 0&&(i=!1),r===void 0&&(r=0),u===void 0&&(u=.6),f===void 0&&(f=.6),{type:n,trigger:t,convexmesh:i,restitution:r,dynamicfriction:u,staticfriction:f,wheelinformation:null}},r.CreatePhysicsProperties=function(n,t,i,r,u){return t===void 0&&(t=0),i===void 0&&(i=.05),r===void 0&&(r=!0),u===void 0&&(u=!1),{mass:n,drag:t,angularDrag:i,useGravity:r,isKinematic:u}},r.SetupPhysicsComponent=function(t,i){var r=i.metadata!=null&&i.metadata.unity!=null?i.metadata.unity:null;if(r!=null&&(r.physics!=null||r.collision!=null)){var y=r.physics!=null,p=r.physics!=null&&r.physics.root!=null?r.physics.root:!1,o=r.physics!=null&&r.physics.mass!=null?r.physics.mass:0,w=o===0,h=r.collision!=null,s=r.collision!=null&&r.collision.type!=null?r.collision.type:"BoxCollider",b=r.collision!=null&&r.collision.convexmesh!=null?r.collision.convexmesh:!1,c=r.collision!=null&&r.collision.dynamicfriction!=null?r.collision.dynamicfriction:.6,k=r.collision!=null&&r.collision.staticfriction!=null?r.collision.staticfriction:.6,l=r.collision!=null&&r.collision.restitution!=null?r.collision.restitution:0,a=r.collision!=null&&r.collision.trigger!=null?r.collision.trigger:!1,v=n.PhysicsImpostor.BoxImpostor;if(v=s==="MeshCollider"?b===!0?n.PhysicsImpostor.ConvexHullImpostor:n.PhysicsImpostor.MeshImpostor:s==="CapsuleCollider"?n.PhysicsImpostor.CapsuleImpostor:s==="SphereCollider"?n.PhysicsImpostor.SphereImpostor:n.PhysicsImpostor.BoxImpostor,y===!0)if(p){var u=null,f=null,e=i.getChildren(null,!1);e!=null&&e.length>0&&e.forEach(function(n){if(n.metadata!=null&&n.metadata.unity!=null&&n.metadata.unity.collision!=null){var t=n.metadata.unity.collision,i=t.wheelinformation!=null?t.wheelinformation:null;i!=null?(f==null&&(f=[]),f.push(i)):(u==null&&(u=[]),u.push(n))}});f!=null&&f.length>0&&(i.metadata==null&&(i.metadata={}),i.metadata.unity==null&&(i.metadata.unity={}),i.metadata.unity.wheels=f);u!=null&&u.length>0&&(h===!0&&u.unshift(i),i._compoundNodes=u,n.SceneManager.CreatePhysicsImpostor(t,i,n.PhysicsImpostor.NoImpostor,{mass:o,friction:c,restitution:l}),n.RigidbodyPhysics.ConfigRigidbodyPhysics(t,i,!1,a,r.physics));e=null}else h===!0&&(n.SceneManager.CreatePhysicsImpostor(t,i,v,{mass:o,friction:w?k:c,restitution:l}),n.RigidbodyPhysics.ConfigRigidbodyPhysics(t,i,!1,a,r.physics))}},r.ConfigRigidbodyPhysics=function(t,i,r,u,f){i!=null&&(i.physicsImpostor!=null?i.physicsImpostor.executeNativeFunction(function(r,e){var s,c,h,l,a,v,y,p,o;if(e.activate&&e.activate(),s=Ammo.castObject(e,Ammo.btCollisionObject),s.entity=i,c=n.SceneManager.GetPhysicsWorld(t),c!=null&&c.generateInternalEdgeInfo&&(h=s.getCollisionShape(),h!=null&&h.getShapeType&&(l=h.getShapeType(),l===21&&(a=Ammo.castObject(h,Ammo.btBvhTriangleMeshShape),s.triangleMapInfo=new Ammo.btTriangleInfoMap,c.generateInternalEdgeInfo(a,s.triangleMapInfo)))),v=f!=null&&f.gravity!=null?f.gravity:!0,v===!1&&(e.setGravity?e.setGravity(new Ammo.btVector3(0,0,0)):n.Tools.Warn("Physics engine set gravity override not supported for: "+i.name)),e.setDamping?(y=f!=null&&f.ldrag!=null?f.ldrag:0,p=f!=null&&f.adrag!=null?f.adrag:.05,e.setDamping(y,p)):n.Tools.Warn("Physics engine set drag damping not supported for: "+i.name),e.setCollisionFlags&&e.getCollisionFlags?u===!0?e.setCollisionFlags(e.getCollisionFlags()|n.CollisionFlags.CF_NO_CONTACT_RESPONSE|n.CollisionFlags.CF_CUSTOM_MATERIAL_CALLBACK):e.setCollisionFlags(e.getCollisionFlags()|n.CollisionFlags.CF_CUSTOM_MATERIAL_CALLBACK):n.Tools.Warn("Physics engine set collision flags not supported for: "+i.name),o=f!=null&&f.freeze!=null?f.freeze:null,o!=null){if(e.setLinearFactor){var w=o.positionx!=null&&o.positionx===!0?0:1,b=o.positiony!=null&&o.positiony===!0?0:1,k=o.positionz!=null&&o.positionz===!0?0:1;e.setLinearFactor(new Ammo.btVector3(w,b,k))}else n.Tools.Warn("Physics engine set linear factor not supported for: "+i.name);if(e.setAngularFactor){var d=o.rotationx!=null&&o.rotationx===!0?0:1,g=o.rotationy!=null&&o.rotationy===!0?0:1,nt=o.rotationz!=null&&o.rotationz===!0?0:1;e.setAngularFactor(new Ammo.btVector3(d,g,nt))}else n.Tools.Warn("Physics engine set angular factor not supported for: "+i.name)}}):n.Tools.Warn("No valid physics impostor to setup for "+i.name))},r.TempAmmoVector=null,r.TempAmmoVectorAux=null,r.TempCenterTransform=null,r}(n.ScriptComponent),t;n.RigidbodyPhysics=i;t=function(){function n(){this.mesh=null;this.state=0;this.reset=!1}return n}();n.CollisionContactInfo=t}(BABYLON||(BABYLON={})),function(n){var t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.awake=function(){},t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.late=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(n.ScriptComponent);n.ShurikenParticles=t}(BABYLON||(BABYLON={})),function(n){var t=function(){function t(){}return t.RegisterOnSocketConnect=function(t){n.SceneManager.SetWindowState("onSocketConnect",t)},t.RegisterOnSocketDisconnect=function(t){n.SceneManager.SetWindowState("onSocketDisconnect",t)},t.ConnectWindowSocket=function(n){var t=null;return window.frameElement!=null&&parent!=null&&parent.window!=null&&parent.window.socketConnect?t=parent.window.socketConnect(n):window.socketConnect&&(t=window.socketConnect(n)),t},t.GetWindowSocket=function(){return n.SceneManager.GetWindowState("socket")},t}();n.SocketController=t}(BABYLON||(BABYLON={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.m_abstractMesh=null,n.m_videoTexture=null,n.m_videoMaterial=null,n}return __extends(i,t),i.prototype.getVideoMaterial=function(){return this.m_videoMaterial},i.prototype.getVideoTexture=function(){return this.m_videoTexture},i.prototype.getVideoElement=function(){return this.m_videoTexture!=null?this.m_videoTexture.video:null},i.prototype.getVideoScreen=function(){return this.m_abstractMesh},i.prototype.awake=function(){this.awakeWebVideoPlayer()},i.prototype.destroy=function(){this.destroyWebVideoPlayer()},i.prototype.awakeWebVideoPlayer=function(){var r;if(this.m_abstractMesh=this.getAbstractMesh(),this.m_abstractMesh!=null){this.m_videoMaterial=new n.StandardMaterial(this.transform.name+".VideoMat",this.scene);this.m_videoMaterial.roughness=1;this.m_videoMaterial.emissiveColor=new n.Color3(1,1,1);this.m_abstractMesh.material=this.m_videoMaterial;var u=this.getProperty("url",null),t=this.getProperty("source",null),i=u;if(t!=null&&t.filename!=null&&t.filename!==""&&(r=n.SceneManager.GetRootUrl(this.scene),i=r+t.filename),i!=null&&i!==""){var f=this.getProperty("muted",!1),e=this.getProperty("poster",null),o=this.getProperty("inverty",!0),s=this.getProperty("sampling",3),h=this.getProperty("mipmaps",!1),c=this.getProperty("looping",!1),l=this.getProperty("playonawake",!0),a={autoUpdateTexture:!0,autoPlay:l,loop:c,muted:f,poster:e};this.setVideoSource(i,h,o,s,a)}}else n.Tools.Warn("No video mesh available for: "+this.transform.name)},i.prototype.destroyWebVideoPlayer=function(){this.m_abstractMesh=null;this.m_videoTexture!=null&&(this.m_videoTexture.dispose(),this.m_videoTexture=null);this.m_videoMaterial!=null&&(this.m_videoMaterial.dispose(),this.m_videoMaterial=null)},i.prototype.setVideoSource=function(t,i,r,u,f){i===void 0&&(i=!1);r===void 0&&(r=!0);u===void 0&&(u=n.Texture.TRILINEAR_SAMPLINGMODE);this.m_abstractMesh!=null&&this.m_videoMaterial!=null?(this.m_videoMaterial.diffuseTexture=null,this.m_videoTexture!=null&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),this.m_videoTexture=new n.VideoTexture(this.transform.name+".VideoTex",t,this.scene,i,r,u,f),this.m_videoMaterial.diffuseTexture=this.m_videoTexture):n.Tools.Warn("No video mesh or material available for: "+this.transform.name)},i}(n.ScriptComponent);n.WebVideoPlayer=t}(BABYLON||(BABYLON={}))

// Project Shader Fixes
if (BABYLON.Effect.IncludesShadersStore["pbrBlockFinalColorComposition"]) BABYLON.Effect.IncludesShadersStore["pbrBlockFinalColorComposition"] = BABYLON.Effect.IncludesShadersStore["pbrBlockFinalColorComposition"].replace("finalColor.rgb*=lightmapColor.rgb", "finalColor.rgb*=(lightmapColor.rgb+finalEmissive.rgb)");
if (BABYLON.Effect.ShadersStore["defaultPixelShader"]) BABYLON.Effect.ShadersStore["defaultPixelShader"] = BABYLON.Effect.ShadersStore["defaultPixelShader"].replace("color.rgb *= lightmapColor.rgb", "color.rgb *= (lightmapColor.rgb + finalEmissive.rgb)");
