// Xbox Project Shim Services
var EnableXboxLiveServices=!0

// Verizon-VX360-3D.js
var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStatics(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b);d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;(y=0,t)&&(op=[op[0]&2,t.value]);switch(op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}t[2]&&_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g},BABYLON,MVRK,PROJECT;(function(PROJECT){var UniversalCameraSystem=function(_super){function UniversalCameraSystem(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.mainCamera=!1,_this.cameraType=0,_this.cameraInertia=.5,_this.cameraController=null,_this.virtualReality=null,_this.arcRotateConfig=null,_this.multiPlayerSetup=null,_this.editorPostProcessing=null,_this.m_cameraRig=null,_this}return __extends(UniversalCameraSystem,_super),UniversalCameraSystem.GetRenderingPipeline=function(){return PROJECT.UniversalCameraSystem.renderingPipeline},UniversalCameraSystem.IsCameraSystemReady=function(){return PROJECT.UniversalCameraSystem.cameraReady},UniversalCameraSystem.prototype.isMainCamera=function(){return this.mainCamera},UniversalCameraSystem.prototype.getCameraType=function(){return this.cameraType},UniversalCameraSystem.prototype.awake=function(){this.awakeCameraSystemState()},UniversalCameraSystem.prototype.start=function(){this.startCameraSystemState()},UniversalCameraSystem.prototype.update=function(){this.updateCameraSystemState()},UniversalCameraSystem.prototype.destroy=function(){this.destroyCameraSystemState()},UniversalCameraSystem.prototype.awakeCameraSystemState=function(){if(this.mainCamera=this.getTransformTag()==="MainCamera",this.cameraType=this.getProperty("mainCameraType",this.cameraType),this.cameraInertia=this.getProperty("setCameraInertia",this.cameraInertia),this.virtualReality=this.getProperty("virtualRealityRig",this.virtualReality),this.arcRotateConfig=this.getProperty("arcRotateConfig",this.arcRotateConfig),this.multiPlayerSetup=this.getProperty("multiPlayerSetup",this.multiPlayerSetup),this.cameraController=this.getProperty("cameraController",this.cameraController),this.editorPostProcessing=this.getProperty("renderingPipeline",this.editorPostProcessing),this.cameraType===1){var webxr=BABYLON.SceneManager.GetWindowState("webxr");webxr!=null&&webxr==="disabled"&&(this.cameraType=0)}},UniversalCameraSystem.prototype.startCameraSystemState=function(){return __awaiter(this,void 0,void 0,function(){var webvrFloorMeshes,webvrHelperOptions,webvrImmersiveMode,webvrReferenceType,_a,cameraName,playerOneTransform,playerOneName,playerOneCamerax,playerTwoTransform,playerTwoName,playerTwoCamerax,playerThreeTransform,playerThreeName,playerThreeCamerax,playerFourTransform,playerFourName,playerFourCamerax,targetVector,defaultPipeline,colorGradingTexture,curve;return __generator(this,function(_b){switch(_b.label){case 0:return(BABYLON.Utilities.ValidateTransformQuaternion(this.transform),this.multiPlayerSetup!=null&&(PROJECT.UniversalCameraSystem.startupMode=this.multiPlayerSetup.playerStartupMode,PROJECT.UniversalCameraSystem.stereoCameras=this.multiPlayerSetup.stereoSideBySide),this.m_cameraRig=this.getCameraRig(),!(this.m_cameraRig!=null))?[3,5]:(this.m_cameraRig.inertia=this.cameraInertia,this.cameraController.attachControl===!0&&(this.m_cameraRig.parent=null,this.m_cameraRig.position.copyFrom(this.transform.position),this.m_cameraRig.rotationQuaternion=this.transform.rotationQuaternion!=null?this.transform.rotationQuaternion.clone():BABYLON.Quaternion.FromEulerAngles(this.transform.rotation.x,this.transform.rotation.y,this.transform.rotation.z),this.m_cameraRig instanceof BABYLON.FreeCamera&&(this.m_cameraRig.checkCollisions=this.cameraController.checkCollisions,this.m_cameraRig.applyGravity=this.cameraController.setApplyGravity),this.m_cameraRig.attachControl(this.cameraController.preventDefault)),!(this.cameraType===0))?[3,1]:(PROJECT.UniversalCameraSystem.PlayerOneCamera=this.m_cameraRig,PROJECT.UniversalCameraSystem.PlayerOneCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerOneCamera.transform=this.transform,[3,5]);case 1:if(!(this.cameraType===1))return[3,4];if(!(this.virtualReality!=null))return[3,3];webvrFloorMeshes=null;webvrHelperOptions=null;webvrImmersiveMode=this.virtualReality.immersiveExperience===1?"immersive-ar":"immersive-vr";webvrReferenceType="local-floor";switch(this.virtualReality.referenceSpaceType){case 0:webvrReferenceType="viewer";break;case 1:webvrReferenceType="local";break;case 2:webvrReferenceType="local-floor";break;case 3:webvrReferenceType="bounded-floor";break;case 4:webvrReferenceType="unbounded";break;default:webvrReferenceType="local-floor"}return(this.virtualReality.setFloorMeshesTags==null||this.virtualReality.setFloorMeshesTags==="")&&(this.virtualReality.setFloorMeshesTags="Navigation"),this.virtualReality.enableTeleportation===!0&&(webvrFloorMeshes=this.scene.getMeshesByTags(this.virtualReality.setFloorMeshesTags)),webvrHelperOptions=this.virtualReality.enableTeleportation===!0&&webvrFloorMeshes!=null&&webvrFloorMeshes.length>0?{floorMeshes:webvrFloorMeshes,renderingGroupId:this.virtualReality.renderingGroupNum,disableDefaultUI:this.virtualReality.disableUserInterface,disableTeleportation:this.virtualReality.enableTeleportation===!1,ignoreNativeCameraTransformation:this.virtualReality.ignoreNativeCamera,inputOptions:{doNotLoadControllerMeshes:this.virtualReality.experienceInputOptions.disableMeshLoad,forceInputProfile:this.virtualReality.experienceInputOptions.forceInputProfile,disableOnlineControllerRepository:this.virtualReality.experienceInputOptions.disableRepository,customControllersRepositoryURL:this.virtualReality.experienceInputOptions.customRepository,disableControllerAnimation:this.virtualReality.experienceInputOptions.disableModelAnim,controllerOptions:{disableMotionControllerAnimation:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlAnim,doNotLoadControllerMesh:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlMesh,forceControllerProfile:this.virtualReality.experienceInputOptions.controllerOptions.forceCtrlProfile,renderingGroupId:this.virtualReality.experienceInputOptions.controllerOptions.renderingGroup}},uiOptions:{sessionMode:webvrImmersiveMode,referenceSpaceType:webvrReferenceType}}:{renderingGroupId:this.virtualReality.renderingGroupNum,disableDefaultUI:this.virtualReality.disableUserInterface,disableTeleportation:this.virtualReality.enableTeleportation===!1,ignoreNativeCameraTransformation:this.virtualReality.ignoreNativeCamera,inputOptions:{doNotLoadControllerMeshes:this.virtualReality.experienceInputOptions.disableMeshLoad,forceInputProfile:this.virtualReality.experienceInputOptions.forceInputProfile,disableOnlineControllerRepository:this.virtualReality.experienceInputOptions.disableRepository,customControllersRepositoryURL:this.virtualReality.experienceInputOptions.customRepository,disableControllerAnimation:this.virtualReality.experienceInputOptions.disableModelAnim,controllerOptions:{disableMotionControllerAnimation:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlAnim,doNotLoadControllerMesh:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlMesh,forceControllerProfile:this.virtualReality.experienceInputOptions.controllerOptions.forceCtrlProfile,renderingGroupId:this.virtualReality.experienceInputOptions.controllerOptions.renderingGroup}},uiOptions:{sessionMode:webvrImmersiveMode,referenceSpaceType:webvrReferenceType}},_a=PROJECT.UniversalCameraSystem,[4,this.scene.createDefaultXRExperienceAsync(webvrHelperOptions)];case 2:_a.XRExperienceHelper=_b.sent();PROJECT.UniversalCameraSystem.XRExperienceHelper.baseExperience||BABYLON.SceneManager.LogWarning("WebXR not supported in current browser.");_b.label=3;case 3:return[3,5];case 4:this.cameraType===2?(cameraName=this.m_cameraRig.name,playerOneTransform=new BABYLON.TransformNode("Player Camera 1",this.scene),playerOneTransform.rotationQuaternion=this.transform.rotationQuaternion.clone(),playerOneTransform.position=this.transform.position.clone(),playerOneTransform.parent=this.transform.parent,playerOneName=cameraName+".1",playerOneCamerax=this.m_cameraRig.clone(playerOneName),playerOneCamerax.name=playerOneName,playerOneCamerax.parent=playerOneTransform,playerOneCamerax.position=new BABYLON.Vector3(0,0,0),playerOneCamerax.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),playerOneCamerax.viewport=new BABYLON.Viewport(0,0,0,0),playerOneCamerax.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerOneCamera=playerOneCamerax,PROJECT.UniversalCameraSystem.PlayerOneCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerOneCamera.transform=playerOneTransform,playerOneTransform.cameraRig=PROJECT.UniversalCameraSystem.PlayerOneCamera,playerTwoTransform=new BABYLON.TransformNode("Player Camera 2",this.scene),playerTwoTransform.rotationQuaternion=this.transform.rotationQuaternion.clone(),playerTwoTransform.position=this.transform.position.clone(),playerTwoTransform.parent=this.transform.parent,playerTwoName=cameraName+".2",playerTwoCamerax=this.m_cameraRig.clone(playerTwoName),playerTwoCamerax.name=playerTwoName,playerTwoCamerax.parent=playerTwoTransform,playerTwoCamerax.position=new BABYLON.Vector3(0,0,0),playerTwoCamerax.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),playerTwoCamerax.viewport=new BABYLON.Viewport(0,0,0,0),playerTwoCamerax.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerTwoCamera=playerTwoCamerax,PROJECT.UniversalCameraSystem.PlayerTwoCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerTwoCamera.transform=playerTwoTransform,playerTwoTransform.cameraRig=PROJECT.UniversalCameraSystem.PlayerTwoCamera,playerThreeTransform=new BABYLON.TransformNode("Player Camera 3",this.scene),playerThreeTransform.rotationQuaternion=this.transform.rotationQuaternion.clone(),playerThreeTransform.position=this.transform.position.clone(),playerThreeTransform.parent=this.transform.parent,playerThreeName=cameraName+".3",playerThreeCamerax=this.m_cameraRig.clone(playerThreeName),playerThreeCamerax.name=playerThreeName,playerThreeCamerax.parent=playerThreeTransform,playerThreeCamerax.position=new BABYLON.Vector3(0,0,0),playerThreeCamerax.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),playerThreeCamerax.viewport=new BABYLON.Viewport(0,0,0,0),playerThreeCamerax.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerThreeCamera=playerThreeCamerax,PROJECT.UniversalCameraSystem.PlayerThreeCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerThreeCamera.transform=playerThreeTransform,playerThreeTransform.cameraRig=PROJECT.UniversalCameraSystem.PlayerThreeCamera,playerFourTransform=new BABYLON.TransformNode("Player Camera 4",this.scene),playerFourTransform.rotationQuaternion=this.transform.rotationQuaternion.clone(),playerFourTransform.position=this.transform.position.clone(),playerFourTransform.parent=this.transform.parent,playerFourName=cameraName+".4",playerFourCamerax=this.m_cameraRig.clone(playerFourName),playerFourCamerax.name=playerFourName,playerFourCamerax.parent=playerFourTransform,playerFourCamerax.position=new BABYLON.Vector3(0,0,0),playerFourCamerax.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),playerFourCamerax.viewport=new BABYLON.Viewport(0,0,0,0),playerFourCamerax.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerFourCamera=playerFourCamerax,PROJECT.UniversalCameraSystem.PlayerFourCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerFourCamera.transform=playerFourTransform,playerFourTransform.cameraRig=PROJECT.UniversalCameraSystem.PlayerFourCamera,PROJECT.UniversalCameraSystem.multiPlayerView=!0,PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(this.scene,PROJECT.UniversalCameraSystem.startupMode)):this.cameraType===3&&(targetVector=BABYLON.Utilities.ParseVector3(this.arcRotateConfig.target),this.m_cameraRig=new BABYLON.ArcRotateCamera(this.transform.name+".ArcRotate",this.arcRotateConfig.alpha,this.arcRotateConfig.beta,this.arcRotateConfig.radius,targetVector,this.scene),this.m_cameraRig.wheelPrecision=this.arcRotateConfig.wheel,this.scene.switchActiveCamera(this.m_cameraRig,!0));_b.label=5;case 5:return this.editorPostProcessing!=null&&this.editorPostProcessing.usePostProcessing===!0&&(PROJECT.UniversalCameraSystem.renderingPipeline=new BABYLON.DefaultRenderingPipeline("UniversalCameraSystem",this.editorPostProcessing.highDynamicRange,this.scene,this.scene.cameras,!0),PROJECT.UniversalCameraSystem.renderingPipeline.isSupported===!0?(defaultPipeline=PROJECT.UniversalCameraSystem.renderingPipeline,defaultPipeline.samples=this.editorPostProcessing.screenAntiAliasing.multiAntiAliasing,defaultPipeline.imageProcessingEnabled=this.editorPostProcessing.imageProcessingConfig.imageProcessing,defaultPipeline.imageProcessingEnabled&&(defaultPipeline.imageProcessing.contrast=this.editorPostProcessing.imageProcessingConfig.imageContrast,defaultPipeline.imageProcessing.exposure=this.editorPostProcessing.imageProcessingConfig.imageExposure,defaultPipeline.imageProcessing.colorGradingEnabled=this.editorPostProcessing.imageProcessingConfig.useColorGrading,defaultPipeline.imageProcessing.colorGradingEnabled&&this.editorPostProcessing.imageProcessingConfig.setGradingTexture!=null&&(colorGradingTexture=BABYLON.Utilities.ParseTexture(this.editorPostProcessing.imageProcessingConfig.setGradingTexture,this.scene,!0,!1),colorGradingTexture.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,colorGradingTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,defaultPipeline.imageProcessing.colorGradingTexture=colorGradingTexture,defaultPipeline.imageProcessing.colorGradingWithGreenDepth=!1),defaultPipeline.imageProcessing.colorCurvesEnabled=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.curvesEnabled,defaultPipeline.imageProcessing.colorCurvesEnabled&&(curve=new BABYLON.ColorCurves,curve.globalDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalDen,curve.globalExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalExp,curve.globalHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalHue,curve.globalSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalSat,curve.highlightsDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsDen,curve.highlightsExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsExp,curve.highlightsHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsHue,curve.highlightsSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsSat,curve.midtonesDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesDen,curve.midtonesExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesExp,curve.midtonesHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesHue,curve.midtonesSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesSat,curve.shadowsDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsDen,curve.shadowsExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsExp,curve.shadowsHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsHue,curve.shadowsSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsSat,defaultPipeline.imageProcessing.colorCurves=curve)),defaultPipeline.bloomEnabled=this.editorPostProcessing.bloomEffectProperties.bloomEnabled,defaultPipeline.bloomEnabled&&(defaultPipeline.bloomKernel=this.editorPostProcessing.bloomEffectProperties.bloomKernel,defaultPipeline.bloomScale=this.editorPostProcessing.bloomEffectProperties.bloomScale,defaultPipeline.bloomWeight=this.editorPostProcessing.bloomEffectProperties.bloomWeight,defaultPipeline.bloomThreshold=this.editorPostProcessing.bloomEffectProperties.bloomThreshold),defaultPipeline.chromaticAberrationEnabled=this.editorPostProcessing.chromaticAberration.aberrationEnabled,defaultPipeline.chromaticAberrationEnabled&&(defaultPipeline.chromaticAberration.aberrationAmount=this.editorPostProcessing.chromaticAberration.aberrationAmount,defaultPipeline.chromaticAberration.adaptScaleToCurrentViewport=this.editorPostProcessing.chromaticAberration.adaptScaleViewport,defaultPipeline.chromaticAberration.alphaMode=this.editorPostProcessing.chromaticAberration.alphaMode,defaultPipeline.chromaticAberration.alwaysForcePOT=this.editorPostProcessing.chromaticAberration.alwaysForcePOT,defaultPipeline.chromaticAberration.enablePixelPerfectMode=this.editorPostProcessing.chromaticAberration.pixelPerfectMode,defaultPipeline.chromaticAberration.forceFullscreenViewport=this.editorPostProcessing.chromaticAberration.fullscreenViewport),defaultPipeline.depthOfFieldEnabled=this.editorPostProcessing.focalDepthOfField.depthOfField,defaultPipeline.depthOfFieldEnabled&&defaultPipeline.depthOfField.isSupported&&(defaultPipeline.depthOfFieldBlurLevel=this.editorPostProcessing.focalDepthOfField.blurLevel,defaultPipeline.depthOfField.fStop=this.editorPostProcessing.focalDepthOfField.focalStop,defaultPipeline.depthOfField.focalLength=this.editorPostProcessing.focalDepthOfField.focalLength,defaultPipeline.depthOfField.focusDistance=this.editorPostProcessing.focalDepthOfField.focusDistance,defaultPipeline.depthOfField.lensSize=this.editorPostProcessing.focalDepthOfField.maxLensSize),defaultPipeline.fxaaEnabled=this.editorPostProcessing.screenAntiAliasing.fullScreenEnabled,defaultPipeline.fxaaEnabled&&(defaultPipeline.fxaa.samples=this.editorPostProcessing.screenAntiAliasing.screenAntiAliasing,defaultPipeline.fxaa.adaptScaleToCurrentViewport=this.editorPostProcessing.screenAntiAliasing.adaptScaleViewport),defaultPipeline.glowLayerEnabled=this.editorPostProcessing.glowLayerProperties.glowEnabled,defaultPipeline.glowLayerEnabled&&(defaultPipeline.glowLayer.intensity=this.editorPostProcessing.glowLayerProperties.glowIntensity,defaultPipeline.glowLayer.blurKernelSize=this.editorPostProcessing.glowLayerProperties.blurKernelSize),defaultPipeline.grainEnabled=this.editorPostProcessing.grainEffectProperties.grainEnabled,defaultPipeline.grainEnabled&&(defaultPipeline.grain.animated=this.editorPostProcessing.grainEffectProperties.grainAnimated,defaultPipeline.grain.intensity=this.editorPostProcessing.grainEffectProperties.grainIntensity,defaultPipeline.grain.adaptScaleToCurrentViewport=this.editorPostProcessing.grainEffectProperties.adaptScaleViewport),defaultPipeline.sharpenEnabled=this.editorPostProcessing.sharpEffectProperties.sharpenEnabled,defaultPipeline.sharpenEnabled&&(defaultPipeline.sharpen.edgeAmount=this.editorPostProcessing.sharpEffectProperties.sharpEdgeAmount,defaultPipeline.sharpen.colorAmount=this.editorPostProcessing.sharpEffectProperties.sharpColorAmount,defaultPipeline.sharpen.adaptScaleToCurrentViewport=this.editorPostProcessing.sharpEffectProperties.adaptScaleViewport)):BABYLON.SceneManager.LogWarning("Babylon.js default rendering pipeline not supported")),PROJECT.UniversalCameraSystem.cameraReady=!0,[2]}})})},UniversalCameraSystem.prototype.updateCameraSystemState=function(){this.m_cameraRig!=null&&(this.cameraType===0||this.cameraType===1||this.cameraType===2||this.cameraType===3)},UniversalCameraSystem.prototype.destroyCameraSystemState=function(){this.virtualReality=null},UniversalCameraSystem.GetWebXR=function(){return PROJECT.UniversalCameraSystem.XRExperienceHelper},UniversalCameraSystem.GetPlayerCamera=function(scene,player,detach){player===void 0&&(player=BABYLON.PlayerNumber.One);detach===void 0&&(detach=!1);var result=null;return PROJECT.UniversalCameraSystem.IsCameraSystemReady()&&(player===BABYLON.PlayerNumber.One&&PROJECT.UniversalCameraSystem.PlayerOneCamera!=null?result=PROJECT.UniversalCameraSystem.PlayerOneCamera:player===BABYLON.PlayerNumber.Two&&PROJECT.UniversalCameraSystem.PlayerTwoCamera!=null?result=PROJECT.UniversalCameraSystem.PlayerTwoCamera:player===BABYLON.PlayerNumber.Three&&PROJECT.UniversalCameraSystem.PlayerThreeCamera!=null?result=PROJECT.UniversalCameraSystem.PlayerThreeCamera:player===BABYLON.PlayerNumber.Four&&PROJECT.UniversalCameraSystem.PlayerFourCamera!=null&&(result=PROJECT.UniversalCameraSystem.PlayerFourCamera)),detach===!0&&parent!=null&&(result.parent=null),result},UniversalCameraSystem.GetCameraTransform=function(scene,player){player===void 0&&(player=BABYLON.PlayerNumber.One);var result=null;return PROJECT.UniversalCameraSystem.IsCameraSystemReady()&&(player===BABYLON.PlayerNumber.One&&PROJECT.UniversalCameraSystem.PlayerOneCamera!=null&&PROJECT.UniversalCameraSystem.PlayerOneCamera.transform!=null?result=PROJECT.UniversalCameraSystem.PlayerOneCamera.transform:player===BABYLON.PlayerNumber.Two&&PROJECT.UniversalCameraSystem.PlayerTwoCamera!=null&&PROJECT.UniversalCameraSystem.PlayerTwoCamera.transform!=null?result=PROJECT.UniversalCameraSystem.PlayerTwoCamera.transform:player===BABYLON.PlayerNumber.Three&&PROJECT.UniversalCameraSystem.PlayerThreeCamera!=null&&PROJECT.UniversalCameraSystem.PlayerThreeCamera.transform!=null?result=PROJECT.UniversalCameraSystem.PlayerThreeCamera.transform:player===BABYLON.PlayerNumber.Four&&PROJECT.UniversalCameraSystem.PlayerFourCamera!=null&&PROJECT.UniversalCameraSystem.PlayerFourCamera.transform!=null&&(result=PROJECT.UniversalCameraSystem.PlayerFourCamera.transform)),result},UniversalCameraSystem.IsStereoCameras=function(){return PROJECT.UniversalCameraSystem.stereoCameras},UniversalCameraSystem.IsMultiPlayerView=function(){return PROJECT.UniversalCameraSystem.multiPlayerView},UniversalCameraSystem.GetMultiPlayerCount=function(){return PROJECT.UniversalCameraSystem.multiPlayerCount},UniversalCameraSystem.ActivateMultiPlayerCameras=function(scene){var result=!1;return PROJECT.UniversalCameraSystem.multiPlayerCameras!=null&&PROJECT.UniversalCameraSystem.multiPlayerCameras.length>0&&(scene.activeCameras=PROJECT.UniversalCameraSystem.multiPlayerCameras,result=!0),result},UniversalCameraSystem.DisposeMultiPlayerCameras=function(){PROJECT.UniversalCameraSystem.PlayerOneCamera!=null&&(PROJECT.UniversalCameraSystem.PlayerOneCamera.dispose(),PROJECT.UniversalCameraSystem.PlayerOneCamera=null);PROJECT.UniversalCameraSystem.PlayerTwoCamera!=null&&(PROJECT.UniversalCameraSystem.PlayerTwoCamera.dispose(),PROJECT.UniversalCameraSystem.PlayerTwoCamera=null);PROJECT.UniversalCameraSystem.PlayerThreeCamera!=null&&(PROJECT.UniversalCameraSystem.PlayerThreeCamera.dispose(),PROJECT.UniversalCameraSystem.PlayerThreeCamera=null);PROJECT.UniversalCameraSystem.PlayerFourCamera!=null&&(PROJECT.UniversalCameraSystem.PlayerFourCamera.dispose(),PROJECT.UniversalCameraSystem.PlayerFourCamera=null)},UniversalCameraSystem.SetMultiPlayerViewLayout=function(scene,totalNumPlayers){var result=!1,players=BABYLON.Scalar.Clamp(totalNumPlayers,1,4);return PROJECT.UniversalCameraSystem.IsMultiPlayerView()?(PROJECT.UniversalCameraSystem.PlayerOneCamera!=null&&PROJECT.UniversalCameraSystem.PlayerTwoCamera!=null&&PROJECT.UniversalCameraSystem.PlayerThreeCamera!=null&&PROJECT.UniversalCameraSystem.PlayerFourCamera!=null?(PROJECT.UniversalCameraSystem.multiPlayerCameras=[],players===1?(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,0,1,1),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerOneCamera)):players===2?(PROJECT.UniversalCameraSystem.stereoCameras===!0?(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,0,.5,1),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(.5,0,.5,1)):(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,.5,1,.5),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(0,0,1,.5)),PROJECT.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerOneCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerTwoCamera)):players===3?(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,0,.5,1),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(.5,.5,.5,.5),PROJECT.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(.5,0,.5,.5),PROJECT.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerOneCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerTwoCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerThreeCamera)):players===4?(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,.5,.5,.5),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(0,0,.5,.5),PROJECT.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(.5,.5,.5,.5),PROJECT.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(.5,0,.5,.5),PROJECT.UniversalCameraSystem.PlayerFourCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerOneCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerTwoCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerThreeCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerFourCamera)):BABYLON.SceneManager.LogWarning("Babylon.js camera rig invalid player count specified: "+players)):BABYLON.SceneManager.LogWarning("Babylon.js camera rig failed to initialize multi player cameras"),PROJECT.UniversalCameraSystem.multiPlayerCount=players,result=PROJECT.UniversalCameraSystem.ActivateMultiPlayerCameras(scene),result===!1&&BABYLON.SceneManager.LogWarning("Babylon.js camera rig failed to initialize multi player views")):BABYLON.SceneManager.LogWarning("Babylon.js camera rig multi player view option not enabled"),result},UniversalCameraSystem.PlayerOneCamera=null,UniversalCameraSystem.PlayerTwoCamera=null,UniversalCameraSystem.PlayerThreeCamera=null,UniversalCameraSystem.PlayerFourCamera=null,UniversalCameraSystem.XRExperienceHelper=null,UniversalCameraSystem.multiPlayerView=!1,UniversalCameraSystem.multiPlayerCount=1,UniversalCameraSystem.multiPlayerCameras=null,UniversalCameraSystem.stereoCameras=!0,UniversalCameraSystem.startupMode=1,UniversalCameraSystem.cameraReady=!1,UniversalCameraSystem.renderingPipeline=null,UniversalCameraSystem}(BABYLON.ScriptComponent);PROJECT.UniversalCameraSystem=UniversalCameraSystem})(PROJECT||(PROJECT={})),function(PROJECT){var UniversalPlayerController=function(_super){function UniversalPlayerController(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.enableInput=!1,_this.attachCamera=!1,_this.rotateCamera=!0,_this.moveCharacter=!0,_this.toggleView=!0,_this.freeLooking=!1,_this.rootMotion=!1,_this.gravityForce=.5,_this.slopeForce=0,_this.rayLength=1,_this.rayOrigin=0,_this.maxAngle=45,_this.speedFactor=1,_this.moveSpeed=5,_this.lookSpeed=2,_this.jumpSpeed=8,_this.jumpDelay=0,_this.eyesHeight=.25,_this.pivotHeight=.25,_this.topLookLimit=60,_this.downLookLimit=30,_this.lowTurnSpeed=15,_this.highTurnSpeed=25,_this.takeoffPower=2.5,_this.stoppingPower=5,_this.acceleration=!1,_this.avatarSkinTag="Skin",_this.distanceFactor=.85,_this.cameraSmoothing=5,_this.cameraCollisions=!0,_this.inputMagnitude=0,_this.minimumDistance=.85,_this.buttonJump=BABYLON.Xbox360Button.A,_this.keyboardJump=BABYLON.UserInputKey.SpaceBar,_this.buttonCamera=BABYLON.Xbox360Button.Y,_this.keyboardCamera=BABYLON.UserInputKey.P,_this.playerNumber=BABYLON.PlayerNumber.One,_this.boomPosition=new BABYLON.Vector3(0,0,0),_this.movementVelocity=BABYLON.Vector3.Zero(),_this.abstractMesh=null,_this.cameraDistance=0,_this.forwardCamera=!1,_this.dollyDirection=BABYLON.Vector3.Zero(),_this.rotationEulers=BABYLON.Vector3.Zero(),_this.cameraPivotOffset=BABYLON.Vector3.Zero(),_this.cameraForwardVector=new BABYLON.Vector3(0,0,0),_this.cameraRightVector=new BABYLON.Vector3(0,0,0),_this.desiredForwardVector=new BABYLON.Vector3(0,0,0),_this.desiredRightVector=new BABYLON.Vector3(0,0,0),_this.scaledCamDirection=BABYLON.Vector3.Zero(),_this.scaledMaxDirection=BABYLON.Vector3.Zero(),_this.parentNodePosition=BABYLON.Vector3.Zero(),_this.maximumCameraPos=BABYLON.Vector3.Zero(),_this.raycastShape=null,_this.raycastGroup=BABYLON.CollisionFilters.DefaultFilter,_this.raycastMask=BABYLON.CollisionFilters.AllFilter^BABYLON.CollisionFilters.CharacterFilter,_this.avatarSkins=null,_this.cameraNode=null,_this.cameraPivot=null,_this.navigationAgent=null,_this.characterController=null,_this.isCharacterNavigating=!1,_this.isCharacterGrounded=!1,_this.isCharacterJumpFrame=!1,_this.isCharacterJumpState=!1,_this.navigationAngularSpeed=0,_this.animationControllerTag="Animator",_this.animationStateMachine=!1,_this.animationStateParams=null,_this.showDebugColliders=!1,_this.colliderVisibility=0,_this.deltaTime=0,_this.jumpTimer=0,_this.playerControl=0,_this.playerInputX=0,_this.playerInputZ=0,_this.playerMouseX=0,_this.playerMouseY=0,_this.groundedMesh=null,_this.groundedPoint=null,_this.groundedAngle=0,_this.groundedNormal=null,_this.verticalVelocity=0,_this.rootmotionSpeed=0,_this.smoothDeltaTime=0,_this.animationState=null,_this.inputMovementVector=BABYLON.Vector3.Zero(),_this.playerLookRotation=BABYLON.Vector3.Zero(),_this.playerRotationVector=BABYLON.Vector2.Zero(),_this.playerMovementVelocity=BABYLON.Vector3.Zero(),_this.playerRotationQuaternion=BABYLON.Quaternion.Zero(),_this.onPreUpdateObservable=new BABYLON.Observable,_this.onBeforeMoveObservable=new BABYLON.Observable,_this.onPostUpdateObservable=new BABYLON.Observable,_this.pickingRay=null,_this.pickingHelper=null,_this.pickingOrigin=null,_this.pickingDirection=new BABYLON.Vector3(0,-1,0),_this.cameraRay=null,_this.cameraHelper=null,_this.cameraForward=new BABYLON.Vector3(0,0,0),_this.cameraDirection=new BABYLON.Vector3(0,0,0),_this}return __extends(UniversalPlayerController,_super),UniversalPlayerController.prototype.getPlayerInputX=function(){return this.playerInputX},UniversalPlayerController.prototype.getPlayerInputZ=function(){return this.playerInputZ},UniversalPlayerController.prototype.getPlayerMouseX=function(){return this.playerMouseX},UniversalPlayerController.prototype.getPlayerMouseY=function(){return this.playerMouseY},UniversalPlayerController.prototype.getPlayerJumping=function(){return this.isCharacterJumpState},UniversalPlayerController.prototype.getPlayerGrounded=function(){return this.isCharacterGrounded},UniversalPlayerController.prototype.getGroundedMesh=function(){return this.groundedMesh},UniversalPlayerController.prototype.getGroundedPoint=function(){return this.groundedPoint},UniversalPlayerController.prototype.getGroundedAngle=function(){return this.groundedAngle},UniversalPlayerController.prototype.getGroundedNormal=function(){return this.groundedNormal},UniversalPlayerController.prototype.getCameraBoomNode=function(){return this.cameraNode},UniversalPlayerController.prototype.getCameraTransform=function(){return this.cameraPivot},UniversalPlayerController.prototype.getAnimationState=function(){return this.animationState},UniversalPlayerController.prototype.getCharacterController=function(){return this.characterController},UniversalPlayerController.prototype.awake=function(){this.awakePlayerController()},UniversalPlayerController.prototype.start=function(){this.startPlayerController()},UniversalPlayerController.prototype.update=function(){this.updatePlayerController()},UniversalPlayerController.prototype.late=function(){this.latePlayerController()},UniversalPlayerController.prototype.after=function(){this.afterPlayerController()},UniversalPlayerController.prototype.destroy=function(){this.destroyPlayerController()},UniversalPlayerController.prototype.setPlayerControl=function(mode){this.playerControl=mode;this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing||this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward?this.showAvatarSkins(!0):this.showAvatarSkins(!1);this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward?this.forwardCamera=!0:this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing&&(this.forwardCamera=!1)},UniversalPlayerController.prototype.togglePlayerControl=function(){this.toggleView===!0&&(this.playerControl===PROJECT.PlayerInputControl.FirstPersonStrafing?this.forwardCamera===!0?this.setPlayerControl(PROJECT.PlayerInputControl.ThirdPersonForward):this.setPlayerControl(PROJECT.PlayerInputControl.ThirdPersonStrafing):this.setPlayerControl(PROJECT.PlayerInputControl.FirstPersonStrafing))},UniversalPlayerController.prototype.showAvatarSkins=function(show){this.avatarSkins!=null&&this.avatarSkins.forEach(function(skin){skin.isVisible=show})},UniversalPlayerController.prototype.attachPlayerCamera=function(player){if(this.cameraNode==null){var playerCamera=player<=0||player>4?1:player;this.cameraNode=PROJECT.UniversalCameraSystem.GetCameraTransform(this.scene,playerCamera);this.cameraNode!=null?(this.cameraNode.parent=this.cameraPivot,this.cameraNode.position.copyFrom(this.boomPosition),this.cameraNode.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),this.cameraDistance=this.cameraNode.position.length(),this.dollyDirection.copyFrom(this.cameraNode.position),this.dollyDirection.normalize()):BABYLON.SceneManager.LogWarning("Failed to locate player camera for: "+this.transform.name)}},UniversalPlayerController.prototype.attachAnimationController=function(){if(this.animationState==null&&this.animationControllerTag!=null&&this.animationControllerTag!==""){var botmesh=null;botmesh=this.hasTransformTags(this.animationControllerTag)?this.transform:this.getChildWithTags(this.animationControllerTag,!1);botmesh!=null?this.animationState=BABYLON.SceneManager.FindScriptComponent(botmesh,"BABYLON.AnimationState"):BABYLON.SceneManager.LogWarning("Failed to locate bot mesh with tag: "+this.animationControllerTag)}},UniversalPlayerController.prototype.resetPlayerRotation=function(){this.transform.rotationQuaternion.toEulerAnglesToRef(this.rotationEulers);this.playerRotationVector.x=this.rotationEulers.x;this.playerRotationVector.y=this.rotationEulers.y},UniversalPlayerController.prototype.awakePlayerController=function(){var _this=this,boomPositionData,sphereRadius,pcontrol,testPivot;if(this.gravityForce=this.getProperty("gravityForce",this.gravityForce),this.rotateCamera=this.getProperty("rotateCamera",this.rotateCamera),this.moveCharacter=this.getProperty("moveCharacter",this.moveCharacter),this.slopeForce=this.getProperty("slopeForce",this.slopeForce),this.rayLength=this.getProperty("rayLength",this.rayLength),this.rayOrigin=this.getProperty("rayOrigin",this.rayOrigin),this.maxAngle=this.getProperty("maxAngle",this.maxAngle),this.speedFactor=this.getProperty("speedFactor",this.speedFactor),this.moveSpeed=this.getProperty("moveSpeed",this.moveSpeed),this.lookSpeed=this.getProperty("lookSpeed",this.lookSpeed),this.jumpSpeed=this.getProperty("jumpSpeed",this.jumpSpeed),this.jumpDelay=this.getProperty("jumpDelay",this.jumpDelay),this.eyesHeight=this.getProperty("eyesHeight",this.eyesHeight),this.pivotHeight=this.getProperty("pivotHeight",this.pivotHeight),this.topLookLimit=this.getProperty("topLookLimit",this.topLookLimit),this.downLookLimit=this.getProperty("downLookLimit",this.downLookLimit),this.lowTurnSpeed=this.getProperty("lowTurnSpeed",this.lowTurnSpeed),this.highTurnSpeed=this.getProperty("highTurnSpeed",this.highTurnSpeed),this.enableInput=this.getProperty("enableInput",this.enableInput),this.rootMotion=this.getProperty("rootMotion",this.rootMotion),this.playerNumber=this.getProperty("playerNumber",this.playerNumber),this.attachCamera=this.getProperty("attachCamera",this.attachCamera),this.freeLooking=this.getProperty("freeLooking",this.freeLooking),this.toggleView=this.getProperty("toggleView",this.toggleView),this.avatarSkinTag=this.getProperty("avatarSkinTag",this.avatarSkinTag),this.cameraCollisions=this.getProperty("cameraCollisions",this.cameraCollisions),this.cameraSmoothing=this.getProperty("cameraSmoothing",this.cameraSmoothing),this.distanceFactor=this.getProperty("distanceFactor",this.distanceFactor),this.minimumDistance=this.getProperty("minimumDistance",this.minimumDistance),this.stoppingPower=this.getProperty("stoppingPower",this.stoppingPower),this.takeoffPower=this.getProperty("takeoffPower",this.takeoffPower),this.acceleration=this.getProperty("acceleration",this.acceleration),this.animationControllerTag=this.getProperty("animationControllerTag",this.animationControllerTag),this.animationStateMachine=this.getProperty("animationStateMachine",this.animationStateMachine),this.animationStateParams=this.getProperty("animationStateParams",this.animationStateParams),boomPositionData=this.getProperty("boomPosition"),boomPositionData!=null&&(this.boomPosition=BABYLON.Utilities.ParseVector3(boomPositionData)),sphereRadius=this.getProperty("sphereRadius",.5),this.raycastShape=BABYLON.SceneManager.CreatePhysicsSphereShape(sphereRadius),this.abstractMesh=this.getAbstractMesh(),this.showDebugColliders=BABYLON.Utilities.ShowDebugColliders(),this.colliderVisibility=BABYLON.Utilities.ColliderVisibility(),this.avatarSkinTag!=null&&this.avatarSkinTag!==""&&(this.avatarSkins=this.getChildrenWithTags(this.avatarSkinTag,!1)),pcontrol=this.getProperty("playerControl",this.playerControl),this.setPlayerControl(pcontrol),this.resetPlayerRotation(),this.cameraPivot=new BABYLON.Mesh(this.transform.name+".CameraPivot",this.scene),this.cameraPivot.parent=null,this.cameraPivot.position=this.transform.position.clone(),this.cameraPivot.rotationQuaternion=this.transform.rotationQuaternion.clone(),this.cameraPivot.checkCollisions=!1,this.cameraPivot.isPickable=!1,this.showDebugColliders===!0&&(testPivot=BABYLON.MeshBuilder.CreateBox("TestPivot",{width:.25,height:.25,depth:.5},this.scene),testPivot.parent=this.cameraPivot,testPivot.position.set(0,0,0),testPivot.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),testPivot.visibility=.5,testPivot.checkCollisions=!1,testPivot.isPickable=!1),BABYLON.SceneManager.OnKeyboardPress(this.keyboardCamera,function(){_this.togglePlayerControl()}),BABYLON.SceneManager.OnGamepadButtonPress(this.buttonCamera,function(){_this.togglePlayerControl()}),this.navigationAgent=this.getComponent("BABYLON.NavigationAgent"),this.characterController=this.getComponent("BABYLON.CharacterController"),this.characterController!=null?BABYLON.SceneManager.LogWarning("Starting player controller in physic engine mode for: "+this.transform.name):BABYLON.SceneManager.LogWarning("Starting player controller in check collisions mode for: "+this.transform.name),this.characterController==null&&this.abstractMesh!=null&&(this.abstractMesh.checkCollisions=!0,this.abstractMesh.isPickable=!0,this.showDebugColliders===!0&&this.transform._debugCollider==null)){var capsuleSize=this.abstractMesh.ellipsoid.clone(),debugName=this.transform.name+".Debug",debugCapsule=BABYLON.MeshBuilder.CreateSphere(debugName,{segments:16,diameterX:capsuleSize.x*2,diameterY:capsuleSize.y*2,diameterZ:capsuleSize.z*2},this.scene);debugCapsule.position.set(0,0,0);debugCapsule.rotationQuaternion=this.transform.rotationQuaternion.clone();debugCapsule.setParent(this.transform);debugCapsule.position.set(0,0,0);debugCapsule.visibility=this.colliderVisibility;debugCapsule.material=BABYLON.Utilities.GetColliderMaterial(this.scene);debugCapsule.checkCollisions=!1;debugCapsule.isPickable=!1;this.transform._debugCollider=debugCapsule}},UniversalPlayerController.prototype.startPlayerController=function(){this.attachCamera===!0&&this.attachPlayerCamera(this.playerNumber)},UniversalPlayerController.prototype.updatePlayerController=function(){var movementSpeed,locomotionSpeed,strafingTurnRatio,strafingTurnSpeed,forwardTurnRatio,forwardTurnSpeed,playerMovementLength,finalMovementLength;(this.animationStateMachine===!0&&this.attachAnimationController(),this.deltaTime=this.getDeltaSeconds(),this.smoothDeltaTime=BABYLON.System.SmoothDeltaFactor*this.deltaTime+(1-BABYLON.System.SmoothDeltaFactor)*this.smoothDeltaTime,this.jumpTimer>0&&(this.jumpTimer-=this.deltaTime,this.jumpTimer<0&&(this.jumpTimer=0)),this.enableInput!==!1)&&(this.playerInputX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Horizontal,this.playerNumber),this.playerInputZ=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Vertical,this.playerNumber),this.playerMouseX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseX,this.playerNumber),this.playerMouseY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseY,this.playerNumber),this.inputMovementVector.set(this.playerInputX,0,this.playerInputZ),BABYLON.Utilities.ClampMagnitudeVector3ToRef(this.inputMovementVector,1,this.inputMovementVector),this.inputMagnitude=this.inputMovementVector.length(),this.onPreUpdateObservable.hasObservers()===!0&&this.onPreUpdateObservable.notifyObservers(this.transform),this.cameraForwardVector.copyFrom(this.cameraPivot.forward),this.cameraForwardVector.y=0,this.cameraForwardVector.normalize(),this.cameraForwardVector.scaleToRef(this.playerInputZ,this.desiredForwardVector),this.cameraRightVector.copyFrom(this.cameraPivot.right),this.cameraRightVector.y=0,this.cameraRightVector.normalize(),this.cameraRightVector.scaleToRef(this.playerInputX,this.desiredRightVector),this.playerRotationVector.y+=this.playerMouseX*this.lookSpeed*this.deltaTime,this.playerRotationVector.x+=-this.playerMouseY*this.lookSpeed*this.deltaTime,this.playerRotationVector.x=BABYLON.Scalar.Clamp(this.playerRotationVector.x,-BABYLON.Tools.ToRadians(this.downLookLimit),BABYLON.Tools.ToRadians(this.topLookLimit)),movementSpeed=this.inputMagnitude*this.moveSpeed*this.deltaTime*this.speedFactor,locomotionSpeed=this.rootmotionSpeed*this.speedFactor,this.playerControl===PROJECT.PlayerInputControl.FirstPersonStrafing?(this.desiredForwardVector.addToRef(this.desiredRightVector,this.playerMovementVelocity),this.rootMotion===!0?this.playerMovementVelocity.scaleInPlace(locomotionSpeed):this.playerMovementVelocity.scaleInPlace(movementSpeed),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.playerRotationVector.y,0,this.transform.rotationQuaternion)):this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing?(this.desiredForwardVector.addToRef(this.desiredRightVector,this.playerMovementVelocity),this.rootMotion===!0?this.playerMovementVelocity.scaleInPlace(locomotionSpeed):this.playerMovementVelocity.scaleInPlace(movementSpeed),this.freeLooking===!0?this.inputMagnitude>0&&(strafingTurnRatio=this.playerMovementVelocity.length()/this.moveSpeed,strafingTurnSpeed=BABYLON.Scalar.Lerp(this.highTurnSpeed,this.lowTurnSpeed,strafingTurnRatio),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.playerRotationVector.y,0,this.playerRotationQuaternion),BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.playerRotationQuaternion,strafingTurnSpeed*this.deltaTime,this.transform.rotationQuaternion)):BABYLON.Quaternion.FromEulerAnglesToRef(0,this.playerRotationVector.y,0,this.transform.rotationQuaternion)):this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward&&(this.desiredForwardVector.addToRef(this.desiredRightVector,this.playerLookRotation),this.rootMotion===!0?this.transform.forward.scaleToRef(locomotionSpeed,this.playerMovementVelocity):this.transform.forward.scaleToRef(movementSpeed,this.playerMovementVelocity),this.inputMagnitude>0&&(forwardTurnRatio=this.playerMovementVelocity.length()/this.moveSpeed,forwardTurnSpeed=BABYLON.Scalar.Lerp(this.highTurnSpeed,this.lowTurnSpeed,forwardTurnRatio),BABYLON.Utilities.LookRotationToRef(this.playerLookRotation,this.playerRotationQuaternion),BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.playerRotationQuaternion,forwardTurnSpeed*this.deltaTime,this.transform.rotationQuaternion))),this.acceleration===!0?(this.takeoffPower<.1&&(this.takeoffPower=.1),this.stoppingPower<.1&&(this.stoppingPower=.1),BABYLON.Vector3.LerpToRef(this.movementVelocity,this.playerMovementVelocity,this.takeoffPower*this.smoothDeltaTime,this.movementVelocity),playerMovementLength=this.playerMovementVelocity.length(),finalMovementLength=this.movementVelocity.length(),playerMovementLength===0&&finalMovementLength>0&&finalMovementLength<this.stoppingPower*.01&&this.movementVelocity.copyFrom(this.playerMovementVelocity)):this.movementVelocity.copyFrom(this.playerMovementVelocity),this.isCharacterGrounded=!0,this.isCharacterJumpFrame=!1,this.isCharacterNavigating=this.navigationAgent!=null&&this.navigationAgent.isNavigating(),this.navigationAngularSpeed=this.navigationAgent!=null?this.navigationAgent.angularSpeed:0,this.characterController!=null?this.updateCharacterController():this.updateCheckCollisions(),this.animationState!=null&&this.animationStateMachine===!0&&(this.validateAnimationStateParams(),this.animationState.setFloat(this.animationStateParams.horizontalInput,this.playerInputX),this.animationState.setFloat(this.animationStateParams.verticalInput,this.playerInputZ),this.animationState.setFloat(this.animationStateParams.mouseXInput,this.playerMouseX),this.animationState.setFloat(this.animationStateParams.mouseYInput,this.playerMouseY),this.animationState.setFloat(this.animationStateParams.speedInput,this.inputMagnitude),this.animationState.setBool(this.animationStateParams.jumpedInput,this.isCharacterJumpFrame),this.animationState.setBool(this.animationStateParams.jumpingInput,this.isCharacterJumpState),this.animationState.setBool(this.animationStateParams.groundedInput,this.isCharacterGrounded),this.isCharacterNavigating===!0),this.onPostUpdateObservable.hasObservers()===!0&&this.onPostUpdateObservable.notifyObservers(this.transform))},UniversalPlayerController.prototype.updateCharacterController=function(){this.moveCharacter===!0&&this.characterController!=null&&(this.isCharacterGrounded=this.characterController.isGrounded(),this.groundedMesh=null,this.groundedPoint=null,this.groundedNormal=null,this.groundedAngle=this.groundedNormal!=null?Math.abs(BABYLON.Utilities.GetAngle(this.groundedNormal,this.transform.forward)-90):0,this.isCharacterNavigating===!1?this.isCharacterGrounded===!0&&(this.isCharacterJumpState===!0&&(this.jumpDelay>0&&(this.jumpTimer=this.jumpDelay+this.deltaTime),this.isCharacterJumpState=!1),this.jumpTimer<=0&&(this.isCharacterJumpFrame=BABYLON.SceneManager.GetKeyboardInput(this.keyboardJump)||BABYLON.SceneManager.GetGamepadButtonInput(this.buttonJump)),this.isCharacterJumpFrame===!0&&(this.isCharacterJumpState=!0,this.characterController.jump(this.jumpSpeed)),this.onBeforeMoveObservable.hasObservers()===!0&&this.onBeforeMoveObservable.notifyObservers(this.transform),this.characterController.move(this.movementVelocity)):this.characterController.setGhostWorldPosition(this.transform.position))},UniversalPlayerController.prototype.updateCheckCollisions=function(){var pick,slopeFactor;this.moveCharacter===!0&&this.abstractMesh!=null&&(pick=this.pickCheckCollisionsRaycast(),this.isCharacterGrounded=pick!=null&&pick.hit,this.groundedMesh=pick!=null&&pick.hit?pick.pickedMesh:null,this.groundedPoint=pick!=null&&pick.hit?pick.pickedPoint:null,this.groundedNormal=pick!=null&&pick.hit?pick.getNormal(!0):null,this.groundedAngle=this.groundedNormal!=null?Math.abs(BABYLON.Utilities.GetAngle(this.groundedNormal,this.transform.forward)-90):0,this.gravityForce>0&&(this.verticalVelocity-=this.deltaTime*this.gravityForce),this.isCharacterNavigating===!1&&(this.isCharacterGrounded===!0&&(slopeFactor=this.maxAngle>0&&this.groundedAngle>0&&this.groundedAngle<this.maxAngle?0:this.slopeForce,this.verticalVelocity=Math.max(-slopeFactor,this.verticalVelocity),this.isCharacterJumpState===!0&&(this.jumpDelay>0&&(this.jumpTimer=this.jumpDelay+this.deltaTime),this.isCharacterJumpState=!1),this.jumpTimer<=0&&(this.isCharacterJumpFrame=BABYLON.SceneManager.GetKeyboardInput(this.keyboardJump)||BABYLON.SceneManager.GetGamepadButtonInput(this.buttonJump)),this.isCharacterJumpFrame===!0&&(this.isCharacterJumpState=!0,this.verticalVelocity=this.jumpSpeed*.015)),this.movementVelocity.y=this.verticalVelocity,this.onBeforeMoveObservable.hasObservers()===!0&&this.onBeforeMoveObservable.notifyObservers(this.transform),this.abstractMesh.moveWithCollisions(this.movementVelocity)))},UniversalPlayerController.prototype.pickCheckCollisionsRaycast=function(fastCheck){var _this=this,raycastLength;return(fastCheck===void 0&&(fastCheck=!0),this.abstractMesh==null)?null:(this.rayLength<=0&&(this.rayLength=.1),raycastLength=this.rayLength/this.transform.scaling.y+.05,this.pickingRay==null&&(this.pickingOrigin==null&&(this.pickingOrigin=new BABYLON.Vector3(0,this.rayOrigin,0)),this.pickingRay=new BABYLON.Ray(this.pickingOrigin,this.pickingDirection,raycastLength)),this.pickingHelper==null&&(this.pickingHelper=new BABYLON.RayHelper(this.pickingRay),this.pickingOrigin==null&&(this.pickingOrigin=new BABYLON.Vector3(0,this.rayOrigin,0)),this.pickingHelper.attachToMesh(this.abstractMesh,this.pickingDirection,this.pickingOrigin,raycastLength),this.showDebugColliders===!0&&this.pickingHelper.show(this.scene,new BABYLON.Color3(1,0,0))),this.pickingRay!=null?this.scene.pickWithRay(this.pickingRay,function(mesh){return mesh!=_this.abstractMesh&&mesh.checkCollisions===!0},fastCheck):null)},UniversalPlayerController.prototype.pickCameraCollisionsRaycast=function(origin,direction,rayLength,fastCheck){var _this=this;return(fastCheck===void 0&&(fastCheck=!0),this.abstractMesh==null)?null:(this.cameraRay==null&&(this.cameraRay=new BABYLON.Ray(origin,direction,rayLength)),this.cameraRay!=null&&(this.cameraRay.origin.copyFrom(origin),this.cameraRay.direction.copyFrom(direction),this.cameraRay.length=rayLength),this.cameraHelper==null&&(this.cameraHelper=new BABYLON.RayHelper(this.cameraRay),this.showDebugColliders===!0&&this.cameraHelper.show(this.scene,new BABYLON.Color3(1,0,0))),this.cameraRay!=null?this.scene.pickWithRay(this.cameraRay,function(mesh){return mesh!=_this.abstractMesh&&mesh.checkCollisions===!0},fastCheck):null)},UniversalPlayerController.prototype.latePlayerController=function(){var allowRotation,maxDistance,parentNode,contact,distance,raycast,pick;this.enableInput!==!1&&(allowRotation=this.rotateCamera,this.cameraPivot!=null&&(this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing||this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward?this.cameraPivotOffset.set(0,this.pivotHeight,0):this.cameraPivotOffset.set(0,this.eyesHeight,0),BABYLON.Utilities.GetAbsolutePositionToRef(this.transform,this.cameraPivot.position,this.cameraPivotOffset),allowRotation===!0&&BABYLON.Quaternion.FromEulerAnglesToRef(this.playerRotationVector.x,this.playerRotationVector.y,0,this.cameraPivot.rotationQuaternion)),allowRotation===!0&&this.cameraNode!=null&&(this.cameraSmoothing<=0&&(this.cameraSmoothing=5),this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing||this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward?this.cameraCollisions===!0?(maxDistance=Math.abs(this.boomPosition.z),parentNode=this.cameraNode.parent,this.dollyDirection.scaleToRef(maxDistance,this.scaledMaxDirection),this.dollyDirection.scaleToRef(this.cameraDistance,this.scaledCamDirection),BABYLON.Utilities.GetAbsolutePositionToRef(parentNode,this.parentNodePosition),BABYLON.Utilities.TransformPointToRef(parentNode,this.scaledMaxDirection,this.maximumCameraPos),contact=!1,distance=0,this.characterController!=null?(raycast=BABYLON.SceneManager.PhysicsShapecastToPoint(this.scene,this.raycastShape,this.parentNodePosition,this.maximumCameraPos,this.raycastGroup,this.raycastMask),contact=raycast!=null&&raycast.hasHit===!0&&raycast.collisionObject!=null&&raycast.collisionObject.entity!=null,distance=raycast!=null&&raycast.hasHit===!0?raycast.hitDistance:0):(this.cameraForward.set(0,0,-1),BABYLON.Utilities.TransformPointToRef(parentNode,this.cameraForward,this.cameraForward),this.cameraForward.subtractToRef(this.parentNodePosition,this.cameraDirection),this.cameraDirection.normalize(),pick=this.pickCameraCollisionsRaycast(this.parentNodePosition,this.cameraDirection,this.maximumCameraPos.length()),contact=pick!=null&&pick.hit,distance=pick!=null&&pick.distance),contact===!0?(this.cameraDistance=BABYLON.Scalar.Clamp(distance*this.distanceFactor,this.minimumDistance,maxDistance),(this.cameraNode.position.x!==this.scaledCamDirection.x||this.cameraNode.position.y!==this.scaledCamDirection.y||this.cameraNode.position.z!==this.scaledCamDirection.z)&&BABYLON.Vector3.LerpToRef(this.cameraNode.position,this.scaledCamDirection,this.deltaTime*this.cameraSmoothing,this.cameraNode.position)):(this.cameraNode.position.x!==this.boomPosition.x||this.cameraNode.position.y!==this.boomPosition.y||this.cameraNode.position.z!==this.boomPosition.z)&&BABYLON.Vector3.LerpToRef(this.cameraNode.position,this.boomPosition,this.deltaTime*this.cameraSmoothing,this.cameraNode.position)):(this.cameraNode.position.x!==this.boomPosition.x||this.cameraNode.position.y!==this.boomPosition.y||this.cameraNode.position.z!==this.boomPosition.z)&&BABYLON.Vector3.LerpToRef(this.cameraNode.position,this.boomPosition,this.deltaTime*this.cameraSmoothing,this.cameraNode.position):(this.cameraNode.position.x!==0||this.cameraNode.position.y!==0||this.cameraNode.position.z!==0)&&this.cameraNode.position.set(0,0,0)))},UniversalPlayerController.prototype.afterPlayerController=function(){this.enableInput!==!1&&(this.rootmotionSpeed=0,this.animationState!=null&&this.animationStateMachine===!0&&(this.rootmotionSpeed=this.animationState.getRootMotionSpeed()))},UniversalPlayerController.prototype.destroyPlayerController=function(){this.cameraPivot=null;this.cameraNode=null;this.animationState=null;this.characterController=null;this.onPreUpdateObservable.clear();this.onPreUpdateObservable=null;this.onBeforeMoveObservable.clear();this.onBeforeMoveObservable=null;this.onPostUpdateObservable.clear();this.onPostUpdateObservable=null},UniversalPlayerController.prototype.validateAnimationStateParams=function(){this.animationStateParams==null&&(this.animationStateParams={horizontalInput:"Horizontal",verticalInput:"Vertical",mouseXInput:"MouseX",mouseYInput:"MouseY",speedInput:"Speed",jumpedInput:"Jumped",jumpingInput:"Jumping",groundedInput:"Grounded"})},UniversalPlayerController}(BABYLON.ScriptComponent),PlayerInputControl;PROJECT.UniversalPlayerController=UniversalPlayerController,function(PlayerInputControl){PlayerInputControl[PlayerInputControl.FirstPersonStrafing=0]="FirstPersonStrafing";PlayerInputControl[PlayerInputControl.ThirdPersonStrafing=1]="ThirdPersonStrafing";PlayerInputControl[PlayerInputControl.ThirdPersonForward=2]="ThirdPersonForward"}(PlayerInputControl=PROJECT.PlayerInputControl||(PROJECT.PlayerInputControl={}))}(PROJECT||(PROJECT={})),function(PROJECT){var FxParticleSystem=function(_super){function FxParticleSystem(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.m_particleEmitter=null,_this.m_particleSystem=null,_this}return __extends(FxParticleSystem,_super),FxParticleSystem.prototype.getParticleEmitter=function(){return this.m_particleEmitter},FxParticleSystem.prototype.getParticleSystem=function(){return this.m_particleSystem},FxParticleSystem.prototype.awake=function(){var rootUrl=BABYLON.SceneManager.GetRootUrl(this.scene),classType=this.getProperty("classType",0),particleText=this.getProperty("base64ParticleSystem"),playOnAwake=this.getProperty("playOnAwake",!1),particleTexture=this.getProperty("particleTexture"),particleJson,particleParsed;this.m_particleEmitter=this.getAbstractMesh();this.m_particleEmitter==null&&(this.m_particleEmitter=BABYLON.Mesh.CreateBox(this.transform.name+".Emitter",.25,this.scene),this.m_particleEmitter.parent=this.transform,this.m_particleEmitter.position.set(0,0,0),this.m_particleEmitter.isVisible=!1,this.m_particleEmitter.isPickable=!1,this.m_particleEmitter.material=BABYLON.Utilities.GetColliderMaterial(this.scene));particleText!=null&&particleText!==""&&(particleJson=window.atob(particleText),particleJson!=null&&particleJson!==""&&(particleParsed=JSON.parse(particleJson),particleParsed!=null&&(particleParsed.texture!=null&&particleTexture!=null&&(particleParsed.texture.name=particleTexture.filename,particleParsed.texture.url=particleTexture.filename),this.m_particleSystem=classType===1?BABYLON.GPUParticleSystem.Parse(particleParsed,this.scene,rootUrl):BABYLON.ParticleSystem.Parse(particleParsed,this.scene,rootUrl),this.m_particleSystem!=null&&(this.m_particleEmitter!=null&&(this.m_particleSystem.emitter=this.m_particleEmitter),playOnAwake===!1&&this.m_particleSystem.stop()))))},FxParticleSystem.prototype.destroy=function(){this.m_particleEmitter=null;this.m_particleSystem!=null&&(this.m_particleSystem.dispose(),this.m_particleSystem=null)},FxParticleSystem}(BABYLON.ScriptComponent);PROJECT.FxParticleSystem=FxParticleSystem}(PROJECT||(PROJECT={})),function(PROJECT){var SkyMaterialSystem=function(_super){function SkyMaterialSystem(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.skyfog=!1,_this.skysize=1e3,_this.probesize=128,_this.reflections=!1,_this.reflectlevel=1,_this.skytintcolor=new BABYLON.Color3(1,1,1),_this.m_skyboxMesh=null,_this.m_skyMaterial=null,_this.m_reflectProbe=null,_this}return __extends(SkyMaterialSystem,_super),SkyMaterialSystem.prototype.getSkyboxMesh=function(){return this.m_skyboxMesh},SkyMaterialSystem.prototype.getSkyMaterial=function(){return this.m_skyMaterial},SkyMaterialSystem.prototype.getReflectionProbe=function(){return this.m_reflectProbe},SkyMaterialSystem.prototype.awake=function(){this.awakeSkyboxMaterial()},SkyMaterialSystem.prototype.start=function(){},SkyMaterialSystem.prototype.update=function(){},SkyMaterialSystem.prototype.late=function(){},SkyMaterialSystem.prototype.after=function(){},SkyMaterialSystem.prototype.destroy=function(){this.destroySkyboxMaterial()},SkyMaterialSystem.prototype.awakeSkyboxMaterial=function(){var tintColor,camOffsetData;this.skyfog=this.getProperty("skyfog",this.skyfog);this.skysize=this.getProperty("skysize",this.skysize);this.probesize=this.getProperty("probesize",this.probesize);this.reflections=this.getProperty("reflections",this.reflections);this.reflectlevel=this.getProperty("reflectlevel",this.reflectlevel);tintColor=this.getProperty("tintColor");tintColor!=null&&(this.skytintcolor=BABYLON.Utilities.ParseColor3(tintColor));this.m_skyboxMesh=BABYLON.Mesh.CreateBox("Ambient Skybox",this.skysize,this.scene);this.m_skyboxMesh.position.set(0,0,0);this.m_skyboxMesh.infiniteDistance=!0;this.m_skyboxMesh.applyFog=this.skyfog;this.scene.useRightHandedSystem===!0&&(this.m_skyboxMesh.scaling.x*=-1);this.m_skyMaterial=new BABYLON.SkyMaterial(this.transform.name+".SkyMaterial",this.scene);this.m_skyMaterial.backFaceCulling=!1;this.setSkyboxTintColor(this.skytintcolor);this.m_skyMaterial.luminance=this.getProperty("luminance",this.m_skyMaterial.luminance);this.m_skyMaterial.turbidity=this.getProperty("turbidity",this.m_skyMaterial.turbidity);this.m_skyMaterial.rayleigh=this.getProperty("rayleigh",this.m_skyMaterial.rayleigh);this.m_skyMaterial.mieCoefficient=this.getProperty("miecoefficient",this.m_skyMaterial.mieCoefficient);this.m_skyMaterial.mieDirectionalG=this.getProperty("miedirectionalg",this.m_skyMaterial.mieDirectionalG);this.m_skyMaterial.distance=this.getProperty("distance",this.m_skyMaterial.distance);this.m_skyMaterial.inclination=this.getProperty("inclination",this.m_skyMaterial.inclination);this.m_skyMaterial.azimuth=this.getProperty("azimuth",this.m_skyMaterial.azimuth);camOffsetData=this.getProperty("cameraoffset");camOffsetData!=null&&(this.m_skyMaterial.cameraOffset=BABYLON.Utilities.ParseVector3(camOffsetData));this.m_skyMaterial.useSunPosition=this.getProperty("usesunposition",this.m_skyMaterial.useSunPosition);this.m_skyMaterial.sunPosition=new BABYLON.Vector3(0,50,0);this.scene.metadata!=null&&this.scene.metadata.unity!=null&&this.scene.metadata.unity&&this.scene.metadata.unity.sunposition!=null&&(this.m_skyMaterial.sunPosition=BABYLON.Utilities.ParseVector3(this.scene.metadata.unity.sunposition));this.m_skyboxMesh.material=this.m_skyMaterial;this.reflections===!0&&(this.m_reflectProbe=new BABYLON.ReflectionProbe("Skybox-ReflectionProbe",this.probesize,this.scene),this.m_reflectProbe.renderList.push(this.m_skyboxMesh),this.scene.customRenderTargets.push(this.m_reflectProbe.cubeTexture),this.scene.environmentTexture=this.m_reflectProbe.cubeTexture,this.scene.environmentIntensity=this.reflectlevel)},SkyMaterialSystem.prototype.destroySkyboxMaterial=function(){this.m_skyboxMesh!=null&&(this.m_skyboxMesh.dispose(),this.m_skyboxMesh=null);this.m_reflectProbe!=null&&(this.m_reflectProbe.dispose(),this.m_reflectProbe=null);this.m_skyMaterial!=null&&(this.m_skyMaterial.dispose(),this.m_skyMaterial=null)},SkyMaterialSystem.prototype.setSkyboxTintColor=function(color){for(var colors=[],numVertices=this.m_skyboxMesh.getTotalVertices(),i=0;i<numVertices;++i)colors.push(color.r,color.g,color.b,1);this.m_skyboxMesh.setVerticesData("color",colors);this.m_skyboxMesh.useVertexColors=!0},SkyMaterialSystem}(BABYLON.ScriptComponent);PROJECT.SkyMaterialSystem=SkyMaterialSystem}(PROJECT||(PROJECT={})),function(PROJECT){var WaterMaterialSystem=function(_super){function WaterMaterialSystem(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.waterTag="Water",_this.targetSize=new BABYLON.Vector2(128,128),_this.renderSize=new BABYLON.Vector2(512,512),_this.depthFactor=1,_this.reflectSkybox=!0,_this.subDivisions=32,_this.heightOffset=1,_this.windDirection=new BABYLON.Vector2(0,1),_this.windForce=6,_this.waveSpeed=1,_this.waveLength=.4,_this.waveHeight=.4,_this.bumpHeight=.4,_this.waterColor=new BABYLON.Color3(.1,.1,.6),_this.colorBlendFactor=.2,_this.waterColor2=new BABYLON.Color3(.1,.1,.6),_this.colorBlendFactor2=.2,_this.disableClipPlane=!1,_this.m_waterGeometry=null,_this.m_waterMaterial=null,_this}return __extends(WaterMaterialSystem,_super),WaterMaterialSystem.prototype.getWaterGeometry=function(){return this.m_waterGeometry},WaterMaterialSystem.prototype.getWaterMaterial=function(){return this.m_waterMaterial},WaterMaterialSystem.prototype.awake=function(){var _this=this,wcolor1,wcolor2,wdirection,itargetsize,irendersize,bumpTexture,bumpTextureData,skyboxMesh,waterMeshes;this.waterTag=this.getProperty("watertag",this.waterTag);this.depthFactor=this.getProperty("depthfactor",this.depthFactor);this.subDivisions=this.getProperty("subdivisions",this.subDivisions);this.heightOffset=this.getProperty("heightoffset",this.heightOffset);this.reflectSkybox=this.getProperty("reflectskybox",this.reflectSkybox);this.windForce=this.getProperty("windforce",this.windForce);this.waveSpeed=this.getProperty("wavespeed",this.waveSpeed);this.waveLength=this.getProperty("wavelength",this.waveLength);this.waveHeight=this.getProperty("waveheight",this.waveHeight);this.bumpHeight=this.getProperty("bumpheight",this.bumpHeight);this.bumpSuperimpose=this.getProperty("bumpsuperimpose",this.bumpSuperimpose);this.bumpAffectsReflection=this.getProperty("bumpaffectsreflection",this.bumpAffectsReflection);this.colorBlendFactor=this.getProperty("colorblendfactor",this.colorBlendFactor);this.colorBlendFactor2=this.getProperty("colorblendfactor2",this.colorBlendFactor2);this.disableClipPlane=this.getProperty("disableclipplane",this.disableClipPlane);this.fresnelSeparate=this.getProperty("fresnelseparate",this.fresnelSeparate);wcolor1=this.getProperty("watercolor");this.waterColor=BABYLON.Utilities.ParseColor3(wcolor1);wcolor2=this.getProperty("watercolor2");this.waterColor2=BABYLON.Utilities.ParseColor3(wcolor2);wdirection=this.getProperty("winddirection");this.windDirection=BABYLON.Utilities.ParseVector2(wdirection);itargetsize=this.getProperty("targetsize");itargetsize!=null&&(this.targetSize=BABYLON.Utilities.ParseVector2(itargetsize));irendersize=this.getProperty("rendersize");irendersize!=null&&(this.renderSize=BABYLON.Utilities.ParseVector2(irendersize));bumpTexture=null;bumpTextureData=this.getProperty("bumptexture");bumpTextureData!=null&&(bumpTexture=BABYLON.Utilities.ParseTexture(bumpTextureData,this.scene));bumpTexture!=null?(this.m_waterMaterial=new BABYLON.WaterMaterial(this.transform.name+".Water",this.scene,this.renderSize),this.m_waterMaterial.bumpTexture=bumpTexture,this.m_waterMaterial.windDirection=this.windDirection,this.m_waterMaterial.windForce=this.windForce,this.m_waterMaterial.waveSpeed=this.waveSpeed,this.m_waterMaterial.waveLength=this.waveLength,this.m_waterMaterial.waveHeight=this.waveHeight,this.m_waterMaterial.bumpHeight=this.bumpHeight,this.m_waterMaterial.bumpSuperimpose=this.bumpSuperimpose,this.m_waterMaterial.bumpAffectsReflection=this.bumpAffectsReflection,this.m_waterMaterial.waterColor=this.waterColor,this.m_waterMaterial.colorBlendFactor=this.colorBlendFactor,this.m_waterMaterial.waterColor2=this.waterColor2,this.m_waterMaterial.colorBlendFactor2=this.colorBlendFactor2,this.m_waterMaterial.disableClipPlane=this.disableClipPlane,this.m_waterMaterial.fresnelSeparate=this.fresnelSeparate,this.reflectSkybox===!0&&(skyboxMesh=BABYLON.SceneManager.GetAmbientSkybox(this.scene),skyboxMesh!=null&&this.m_waterMaterial.addToRenderList(skyboxMesh)),this.waterTag!=null&&this.waterTag!==""&&(waterMeshes=this.scene.getMeshesByTags(this.waterTag),waterMeshes!=null&&waterMeshes.length>0&&waterMeshes.forEach(function(mesh){_this.m_waterMaterial.addToRenderList(mesh)})),this.m_waterGeometry=BABYLON.Mesh.CreateGround(this.transform.name+".WaterMesh",this.targetSize.x,this.targetSize.y,this.subDivisions,this.scene,!1),this.m_waterGeometry.parent=this.transform,this.m_waterGeometry.position.set(0,this.heightOffset,0),this.depthFactor>0&&(this.m_waterGeometry.scaling.y*=this.depthFactor),this.m_waterGeometry.material=this.m_waterMaterial):BABYLON.SceneManager.LogWarning("No supported water bump texture for: "+this.transform.name)},WaterMaterialSystem.prototype.start=function(){},WaterMaterialSystem.prototype.update=function(){},WaterMaterialSystem.prototype.late=function(){},WaterMaterialSystem.prototype.after=function(){},WaterMaterialSystem.prototype.destroy=function(){},WaterMaterialSystem}(BABYLON.ScriptComponent);PROJECT.WaterMaterialSystem=WaterMaterialSystem}(PROJECT||(PROJECT={})),function(PROJECT){var SimpleFollowCamera=function(_super){function SimpleFollowCamera(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.smoothFollow=0,_this.smoothRotate=0,_this.matchRotation=!1,_this.followTarget=null,_this.targetPosition=BABYLON.Vector3.Zero(),_this.targetRotation=BABYLON.Quaternion.Zero(),_this}return __extends(SimpleFollowCamera,_super),SimpleFollowCamera.prototype.awake=function(){this.smoothFollow=this.getProperty("smoothFollow",this.smoothFollow);this.smoothRotate=this.getProperty("smoothRotate",this.smoothRotate);this.matchRotation=this.getProperty("matchRotation",this.matchRotation);var ftarget=this.getProperty("followTarget");ftarget!=null&&(this.followTarget=BABYLON.Utilities.ParseTransformByID(ftarget,this.scene),this.followTarget!=null&&BABYLON.Utilities.ValidateTransformQuaternion(this.followTarget));BABYLON.Utilities.ValidateTransformQuaternion(this.transform)},SimpleFollowCamera.prototype.start=function(){BABYLON.SceneManager.ConsoleLog("Starting simple follow target for: "+this.transform.name)},SimpleFollowCamera.prototype.late=function(){if(this.followTarget!=null){var deltaTime=this.getDeltaSeconds();BABYLON.Utilities.GetAbsolutePositionToRef(this.followTarget,this.targetPosition);this.targetRotation.copyFrom(this.followTarget.absoluteRotationQuaternion);this.smoothFollow>0?BABYLON.Vector3.LerpToRef(this.transform.position,this.targetPosition,deltaTime*this.smoothFollow,this.transform.position):this.transform.position.copyFrom(this.targetPosition);this.matchRotation===!0&&(this.smoothRotate>0?BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.targetRotation,deltaTime*this.smoothRotate,this.transform.rotationQuaternion):this.transform.rotationQuaternion.copyFrom(this.targetRotation))}},SimpleFollowCamera}(BABYLON.ScriptComponent);PROJECT.SimpleFollowCamera=SimpleFollowCamera}(PROJECT||(PROJECT={})),function(PROJECT){var SmoothFollowTarget=function(_super){function SmoothFollowTarget(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.target=null,_this.targetHeight=1.75,_this.followHeight=1.75,_this.heightDamping=12,_this.rotationDamping=3,_this.minimumDistance=6,_this.maximumDistance=8,_this.startBehindTarget=!0,_this.followBehindTarget=!0,_this.targetPosition=BABYLON.Vector3.Zero(),_this.targetAngles=new BABYLON.Vector3(0,0,0),_this.transformAngles=new BABYLON.Vector3(0,0,0),_this.positionBuffer=new BABYLON.Vector3(0,0,0),_this.rotationBuffer=new BABYLON.Quaternion(0,0,0,1),_this.tempRotationBuffer=new BABYLON.Vector3(0,0,0),_this}return __extends(SmoothFollowTarget,_super),SmoothFollowTarget.prototype.awake=function(){this.targetHeight=this.getProperty("targetHeight",this.targetHeight);this.followHeight=this.getProperty("followHeight",this.followHeight);this.heightDamping=this.getProperty("heightDamping",this.heightDamping);this.rotationDamping=this.getProperty("rotationDamping",this.rotationDamping);this.minimumDistance=this.getProperty("minimumDistance",this.minimumDistance);this.maximumDistance=this.getProperty("maximumDistance",this.maximumDistance);this.startBehindTarget=this.getProperty("startBehindTarget",this.startBehindTarget);this.followBehindTarget=this.getProperty("followBehindTarget",this.followBehindTarget);this.rotationDamping<=0&&(this.rotationDamping=3);this.heightDamping<=0&&(this.heightDamping=12);var followTarget=this.getProperty("target");followTarget!=null&&(this.target=BABYLON.Utilities.ParseTransformByID(followTarget,this.scene))},SmoothFollowTarget.prototype.start=function(){this.target!=null&&this.startBehindTarget===!0},SmoothFollowTarget.prototype.late=function(){var deltaTime;if(this.target!=null){if(this.targetPosition.copyFrom(this.target.position),this.followBehindTarget===!0){deltaTime=this.getDeltaSeconds();BABYLON.Utilities.ToEulerToRef(this.target.rotationQuaternion,this.targetAngles);BABYLON.Utilities.ToEulerToRef(this.transform.rotationQuaternion,this.transformAngles);var wantedHeight=this.targetPosition.y+this.followHeight,currentHeight=BABYLON.Scalar.Lerp(this.transform.position.y,wantedHeight,this.heightDamping*deltaTime),wantedRotationAngle=this.targetAngles.y,currentRotationAngle=BABYLON.Scalar.LerpAngle(this.transformAngles.y,wantedRotationAngle,this.rotationDamping*deltaTime),wantedTargetDistance=BABYLON.Scalar.Lerp(this.minimumDistance,this.maximumDistance,1);BABYLON.Utilities.FromEulerToRef(0,currentRotationAngle,0,this.rotationBuffer);BABYLON.Utilities.MultiplyQuaternionByVectorToRef(this.rotationBuffer,BABYLON.Vector3.Forward(),this.tempRotationBuffer);this.tempRotationBuffer.scaleInPlace(wantedTargetDistance);this.positionBuffer.copyFrom(this.targetPosition);this.positionBuffer.subtractInPlace(this.tempRotationBuffer);this.transform.position.set(this.positionBuffer.x,currentHeight,this.positionBuffer.z)}this.targetPosition.y+=this.targetHeight;this.transform.lookAt(this.targetPosition)}},SmoothFollowTarget.prototype.destroy=function(){this.target=null;this.targetAngles=null;this.transformAngles=null;this.positionBuffer=null;this.rotationBuffer=null;this.tempRotationBuffer=null},SmoothFollowTarget}(BABYLON.ScriptComponent);PROJECT.SmoothFollowTarget=SmoothFollowTarget}(PROJECT||(PROJECT={})),function(PROJECT){var WaypointTargetManager=function(_super){function WaypointTargetManager(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this._waypointMeshLines=null,_this._waypointSplineCurve=null,_this._waypointTransformNodes=null,_this._waypointSplinePositions=null,_this._waypointSphereMaterial=null,_this.resolution=1,_this.closedLoop=!0,_this.drawLines=!1,_this.drawPoints=!1,_this.drawTraces=!1,_this.pointSize=.5,_this.lineHeight=.25,_this.lineColor=new BABYLON.Color3(1,1,1),_this.pointColor=new BABYLON.Color3(1,1,1),_this.traceColor=new BABYLON.Color3(1,1,1),_this}return __extends(WaypointTargetManager,_super),WaypointTargetManager.prototype.getSplineCurve=function(){return this._waypointSplineCurve},WaypointTargetManager.prototype.getSplineCurveLength=function(){return this._waypointSplineCurve!=null?this._waypointSplineCurve.length():0},WaypointTargetManager.prototype.getSplineCurvePositions=function(){return this._waypointSplinePositions},WaypointTargetManager.prototype.getControlPointTransforms=function(){return this._waypointTransformNodes},WaypointTargetManager.prototype.awake=function(){var _this=this,controlPoints_1;this.resolution=this.getProperty("resolution",this.resolution);this.closedLoop=this.getProperty("closedLoop",this.closedLoop);this.drawLines=this.getProperty("drawLines",this.drawLines);this.drawPoints=this.getProperty("drawPoints",this.drawPoints);this.drawTraces=this.getProperty("drawTraces",this.drawTraces);this.pointSize=this.getProperty("pointSize",this.pointSize);this.lineHeight=this.getProperty("lineHeight",this.lineHeight);var lcolor=this.getProperty("lineColor"),pcolor=this.getProperty("pointColor"),tcolor=this.getProperty("traceColor");this.lineColor=BABYLON.Utilities.ParseColor3(lcolor,this.lineColor);this.pointColor=BABYLON.Utilities.ParseColor3(pcolor,this.pointColor);this.traceColor=BABYLON.Utilities.ParseColor3(tcolor,this.traceColor);this._waypointSphereMaterial=new BABYLON.StandardMaterial(this.transform.name+".SplineMaterial",this.scene);this._waypointSphereMaterial.diffuseColor=this.pointColor;this._waypointTransformNodes=this.transform.getChildren(null,!0);this._waypointTransformNodes!=null&&this._waypointTransformNodes.length>0&&(controlPoints_1=[],this._waypointTransformNodes.forEach(function(transform){if(BABYLON.Utilities.ValidateTransformQuaternion(transform),controlPoints_1.push(BABYLON.Utilities.GetAbsolutePosition(transform)),_this.drawPoints===!0){var controlPoint=BABYLON.MeshBuilder.CreateSphere(transform.name+".WireSphere",{segments:24,diameter:_this.pointSize*2},_this.scene);controlPoint.parent=transform;controlPoint.position.set(0,0,0);controlPoint.visibility=.25;controlPoint.isVisible=!0;controlPoint.material=_this._waypointSphereMaterial}}),this._waypointSplineCurve=BABYLON.Curve3.CreateCatmullRomSpline(controlPoints_1,this.resolution,this.closedLoop),this._waypointSplineCurve!=null&&(this._waypointSplinePositions=this._waypointSplineCurve.getPoints()),this._waypointSplinePositions!=null&&BABYLON.SceneManager.ConsoleWarn("DEBUG: Waypoint Manager - "+this.transform.name+": ("+this._waypointTransformNodes.length+" - "+this._waypointSplinePositions.length+" - "+this._waypointSplineCurve.length().toFixed(2)+")"))},WaypointTargetManager.prototype.start=function(){this._waypointSplinePositions!=null&&this.drawLines===!0&&(this._waypointMeshLines=BABYLON.MeshBuilder.CreateLines(this.transform.name+".SplineMesh",{points:this._waypointSplinePositions},this.scene),this._waypointMeshLines.parent=this.transform,this._waypointMeshLines.color=this.lineColor,this._waypointMeshLines.position.y+=this.lineHeight)},WaypointTargetManager.prototype.destroy=function(){this.lineColor=null;this._waypointSplineCurve=null;this._waypointTransformNodes=null;this._waypointSplinePositions=null;this._waypointMeshLines!=null&&(this._waypointMeshLines.dispose(),this._waypointMeshLines=null)},WaypointTargetManager}(BABYLON.ScriptComponent);PROJECT.WaypointTargetManager=WaypointTargetManager}(PROJECT||(PROJECT={})),function(PROJECT){var DebugInformation=function(_super){function DebugInformation(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.keys=!0,_this.show=!0,_this.popup=!1,_this.views=!1,_this.xbox=!1,_this.color=BABYLON.Color3.Green(),_this}return __extends(DebugInformation,_super),DebugInformation.prototype.awake=function(){this.keys=this.getProperty("enableDebugKeys",this.keys);this.show=this.getProperty("showDebugLabels",this.show);this.popup=this.getProperty("popupDebugPanel",this.popup);this.views=this.getProperty("togglePlayerViews",this.views);this.xbox=this.getProperty("allowXboxLiveSignIn",this.xbox);var debugLabelColor=this.getProperty("debugOutputTextColor");debugLabelColor!=null&&(this.color=BABYLON.Utilities.ParseColor3(debugLabelColor));BABYLON.SceneManager.IsWindows()&&(this.popup=!1);BABYLON.SceneManager.LogMessage("Debug information overlay loaded")},DebugInformation.prototype.start=function(){var _this=this,printColor,graphicsVersion;this.show===!0;this.keys===!0&&(this.views===!0&&(BABYLON.SceneManager.LogMessage("Enable Multiplayer Keys"),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num1,function(){PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(_this.scene,1);BABYLON.SceneManager.LogMessage("1 player pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num2,function(){PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(_this.scene,2);BABYLON.SceneManager.LogMessage("2 players pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num3,function(){PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(_this.scene,3);BABYLON.SceneManager.LogMessage("3 players pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num4,function(){PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(_this.scene,4);BABYLON.SceneManager.LogMessage("4 players pressed")})),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.R,function(){window.location.reload()}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.I,function(){_this.popup===!0?BABYLON.SceneManager.PopupDebug(_this.scene):BABYLON.SceneManager.ToggleDebug(_this.scene,!0,null)}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.F,function(){}));printColor=this.scene.getEngine().webGLVersion<2?"red":this.color.toHexString();graphicsVersion=BABYLON.SceneManager.GetWebGLVersionString(this.scene);BABYLON.Utilities.PrintToScreen(graphicsVersion,printColor)},DebugInformation.prototype.destroy=function(){},DebugInformation}(BABYLON.ScriptComponent);PROJECT.DebugInformation=DebugInformation}(PROJECT||(PROJECT={})),function(PROJECT){var TestNavigationAgent=function(_super){function TestNavigationAgent(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.m_playerAgent=null,_this}return __extends(TestNavigationAgent,_super),TestNavigationAgent.prototype.start=function(){var _this=this;this.doPointerCancel();this.scene.onPointerObservable.add(function(pointerInfo){switch(pointerInfo.type){case BABYLON.PointerEventTypes.POINTERDOWN:pointerInfo.pickInfo.hit&&_this.doPointerDown(pointerInfo)}});this.m_playerAgent=this.getComponent("BABYLON.NavigationAgent");this.m_playerAgent!=null?BABYLON.SceneManager.LogMessage("Test navigation mesh agent for: "+this.transform.name):BABYLON.SceneManager.LogMessage("Failed to locate test nav mesh agent for: "+this.transform.name)},TestNavigationAgent.prototype.doPointerCancel=function(){var canvas=this.scene.getEngine().getRenderingCanvas();canvas.oncontextmenu=function(e){e.preventDefault()}},TestNavigationAgent.prototype.doPointerDown=function(pointerInfo){var pickinfo=this.scene.pick(this.scene.pointerX,this.scene.pointerY);pickinfo.hit&&this.m_playerAgent!=null&&(pointerInfo.event.button===0?this.m_playerAgent.setDestination(pickinfo.pickedPoint):this.m_playerAgent.teleport(pickinfo.pickedPoint))},TestNavigationAgent}(BABYLON.ScriptComponent);PROJECT.TestNavigationAgent=TestNavigationAgent}(PROJECT||(PROJECT={})),function(PROJECT){var TestRootMotion=function(_super){function TestRootMotion(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.motionType=0,_this.speedFactor=1,_this.startingOffset=0,_this.overrideSpeed=0,_this.overrideRotate=0,_this.attachToParent=!1,_this.updatePosition=!0,_this.updateRotation=!0,_this.rootMotionAngle=0,_this.rootMotionSpeed=0,_this.m_animator=null,_this.m_transform=null,_this.m_character=null,_this.m_rigidbody=null,_this.m_velocity=new BABYLON.Vector3(0,0,0),_this.lowestFrameTime=1,_this.highestFrameTime=0,_this}return __extends(TestRootMotion,_super),TestRootMotion.prototype.awake=function(){this.motionType=this.getProperty("motionType",this.motionType);this.speedFactor=this.getProperty("speedFactor",this.speedFactor);this.overrideSpeed=this.getProperty("overrideSpeed",this.overrideSpeed);this.overrideRotate=this.getProperty("overrideRotate",this.overrideRotate);this.startingOffset=this.getProperty("startingOffset",this.startingOffset);this.updatePosition=this.getProperty("updatePosition",this.updatePosition);this.updateRotation=this.getProperty("updateRotation",this.updateRotation);this.attachToParent=this.getProperty("attachToParent",this.attachToParent)},TestRootMotion.prototype.start=function(){this.m_animator=this.getComponent("BABYLON.AnimationState");this.m_animator==null&&BABYLON.SceneManager.LogWarning("Test Root Motion: Failed to locate animation state for: "+this.transform.name);this.m_transform=this.attachToParent===!0&&this.transform.parent!=null?this.transform.parent:this.transform;this.m_transform!=null?this.motionType===1?(this.m_rigidbody=BABYLON.SceneManager.FindScriptComponent(this.m_transform,"BABYLON.RigidbodyPhysics"),this.m_rigidbody==null&&BABYLON.SceneManager.LogWarning("Test Root Motion: Failed to locate rigidbody physics for: "+this.m_transform.name)):this.motionType===2&&(this.m_character=BABYLON.SceneManager.FindScriptComponent(this.m_transform,"BABYLON.CharacterController"),this.m_character==null&&BABYLON.SceneManager.LogWarning("Test Root Motion: Failed to locate character controller for: "+this.m_transform.name)):BABYLON.SceneManager.LogWarning("Test Root Motion: Failed to locate root transform for: "+this.transform.name);this.m_transform.position.z+=this.startingOffset},TestRootMotion.prototype.update=function(){var frameTime,msg;this.m_animator!=null&&(this.rootMotionAngle=this.m_animator.getRootMotionAngle(),this.rootMotionSpeed=this.m_animator.getRootMotionSpeed(),frameTime=this.m_animator.getAnimationTime(),frameTime<this.lowestFrameTime&&(this.lowestFrameTime=frameTime),frameTime>this.highestFrameTime&&(this.highestFrameTime=frameTime),msg="Angle: "+this.rootMotionAngle.toFixed(3)+" --> Speed: "+this.rootMotionSpeed.toFixed(3)+" --> Frame: "+frameTime+" --> Lowest Frame: "+this.lowestFrameTime+" --> Highest Frame: "+this.highestFrameTime,BABYLON.Utilities.PrintToScreen(msg,"red"));this.turn();this.move()},TestRootMotion.prototype.turn=function(){if(this.m_animator!=null&&this.m_transform!=null&&this.updateRotation===!0){var rotationSpeed=this.overrideRotate>0?BABYLON.Tools.ToRadians(this.overrideRotate)*this.getDeltaSeconds():this.rootMotionAngle;this.m_transform.addRotation(0,rotationSpeed,0)}},TestRootMotion.prototype.move=function(){if(this.m_animator!=null&&this.m_transform!=null&&this.updatePosition==!0){var forwardSpeed=this.overrideSpeed>0?this.overrideSpeed*this.getDeltaSeconds():this.rootMotionSpeed;this.m_transform.forward.scaleToRef(forwardSpeed,this.m_velocity);this.motionType===0?this.m_transform.position.addInPlace(this.m_velocity):this.motionType===1&&this.m_rigidbody!=null?this.m_rigidbody.setLinearVelocity(this.m_velocity):this.motionType===2&&this.m_character!=null&&this.m_character.move(this.m_velocity)}},TestRootMotion}(BABYLON.ScriptComponent);PROJECT.TestRootMotion=TestRootMotion}(PROJECT||(PROJECT={})),function(BABYLON){var PerlinNoiseGenerator=function(){function PerlinNoiseGenerator(){}return PerlinNoiseGenerator.rand_vect=function(){var theta=Math.random()*2*Math.PI;return{x:Math.cos(theta),y:Math.sin(theta)}},PerlinNoiseGenerator.dot_prod_grid=function(x,y,vx,vy){var g_vect,d_vect={x:x-vx,y:y-vy};return PerlinNoiseGenerator.gradients[[vx,vy]]?g_vect=PerlinNoiseGenerator.gradients[[vx,vy]]:(g_vect=PerlinNoiseGenerator.rand_vect(),PerlinNoiseGenerator.gradients[[vx,vy]]=g_vect),d_vect.x*g_vect.x+d_vect.y*g_vect.y},PerlinNoiseGenerator.smootherstep=function(x){return 6*Math.pow(x,5)-15*Math.pow(x,4)+10*Math.pow(x,3)},PerlinNoiseGenerator.interp=function(x,a,b){return a+PerlinNoiseGenerator.smootherstep(x)*(b-a)},PerlinNoiseGenerator.seed=function(){PerlinNoiseGenerator.gradients={}},PerlinNoiseGenerator.generate=function(x,y){var xf=Math.floor(x),yf=Math.floor(y),tl=PerlinNoiseGenerator.dot_prod_grid(x,y,xf,yf),tr=PerlinNoiseGenerator.dot_prod_grid(x,y,xf+1,yf),bl=PerlinNoiseGenerator.dot_prod_grid(x,y,xf,yf+1),br=PerlinNoiseGenerator.dot_prod_grid(x,y,xf+1,yf+1),xt=PerlinNoiseGenerator.interp(x-xf,tl,tr),xb=PerlinNoiseGenerator.interp(x-xf,bl,br);return PerlinNoiseGenerator.interp(y-yf,xt,xb)},PerlinNoiseGenerator.gradients={},PerlinNoiseGenerator}();BABYLON.PerlinNoiseGenerator=PerlinNoiseGenerator}(BABYLON||(BABYLON={}));BABYLON.PerlinNoiseGenerator.seed(),function(MVRK){var CaptionManager=function(_super){function CaptionManager(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(CaptionManager,_super),CaptionManager.prototype.awake=function(){var DOMelement=this.getProperty("DomElement"),fontType=this.getProperty("fontType"),fontSize=this.getProperty("fontSize"),fontHexColor=this.getProperty("fontHexColor"),fontOutlineColor=this.getProperty("fontOutlineColor"),debugLanguageCode=this.getProperty("debugLanguageCode"),captionsDiv;debugLanguageCode!=null&&debugLanguageCode!==""&&BABYLON.SceneManager.SetWindowState("debugLocale",debugLanguageCode.toLowerCase());document.getElementById(DOMelement)||(captionsDiv=document.createElement("div"),captionsDiv.id=DOMelement,fontType&&(captionsDiv.style.fontFamily=fontType),fontSize&&(captionsDiv.style.fontSize=fontSize+"pt"),captionsDiv.style.zIndex="2",captionsDiv.style.position="absolute",captionsDiv.style.bottom="100px",captionsDiv.style.left="0",captionsDiv.style.right="0",captionsDiv.style.margin="0 auto",captionsDiv.style.textAlign="center",captionsDiv.style.fontWeight="bold",captionsDiv.style.userSelect="none",captionsDiv.style.pointerEvents="none",captionsDiv.style.color=fontHexColor,fontOutlineColor&&(captionsDiv.style.textShadow="0 0 1px "+fontOutlineColor+", 0 0 1px "+fontOutlineColor+", 0 0 1px "+fontOutlineColor+", 0 0 1px "+fontOutlineColor),document.body.append(captionsDiv))},CaptionManager}(BABYLON.ScriptComponent);MVRK.CaptionManager=CaptionManager}(MVRK||(MVRK={})),function(MVRK){var CaptionSystem=function(_super){function CaptionSystem(transform,scene,properties){var _this=_super.call(this,transform,scene,properties)||this;return _this.captionType=0,_this.displayTimer=5,_this.domElement=null,_this.textTracks=null,_this.userLocale="en",_this.logCaptions=!1,_this.m_captionSource=null,_this.m_captionTimer=0,_this.onUpdateCaptionObservable=new BABYLON.Observable,_this.transform.metadata==null&&(_this.transform.metadata={}),_this.transform.metadata.vtt=!0,_this}return __extends(CaptionSystem,_super),CaptionSystem.prototype.getUserLocale=function(){return this.userLocale},CaptionSystem.prototype.getCaptionType=function(){return this.captionType},CaptionSystem.prototype.awake=function(){this.awakeCaptionSystem()},CaptionSystem.prototype.start=function(){this.startCaptionSystem()},CaptionSystem.prototype.update=function(){this.updateCaptionSystem()},CaptionSystem.prototype.destroy=function(){this.destroyCaptionSystem()},CaptionSystem.prototype.awakeCaptionSystem=function(){var _a;this.captionType=this.getProperty("captionType",this.captionType);this.displayTimer=this.getProperty("displayTimer",this.displayTimer);this.domElement=this.getProperty("domElement",this.domElement);this.textTracks=this.getProperty("textTracks",this.textTracks);this.logCaptions=this.getProperty("logCaptions",this.logCaptions);this.userLocale=BABYLON.SceneManager.GetWindowState("debugLocale")||((_a=MVRK.System.GetUserInfo())===null||_a===void 0?void 0:_a.locale)||this.userLocale;this.userLocale==="zh"?this.userLocale="ch":this.userLocale==="ja"&&(this.userLocale="jp")},CaptionSystem.prototype.startCaptionSystem=function(){this.captionType===0?(this.m_captionSource=this.getComponent("BABYLON.WebVideoPlayer"),this.m_captionSource==null&&BABYLON.Tools.Warn("Failed to locate web video player component for: "+this.transform.name)):(this.m_captionSource=this.getComponent("BABYLON.AudioSource"),this.m_captionSource==null&&BABYLON.Tools.Warn("Failed to locate audio source component for: "+this.transform.name));this.m_captionSource!=null&&this.attachCaptionSystem();this.postCaptionMessage("")},CaptionSystem.prototype.updateCaptionSystem=function(){this.displayTimer>0&&this.m_captionTimer>0&&(this.m_captionTimer+=this.getDeltaSeconds(),this.m_captionTimer>=this.displayTimer&&this.postCaptionMessage(""))},CaptionSystem.prototype.destroyCaptionSystem=function(){this.textTracks=null;this.m_captionSource=null;this.m_captionElement=null;this.onUpdateCaptionObservable.clear();this.onUpdateCaptionObservable=null},CaptionSystem.prototype.attachCaptionSystem=function(){var _this=this,_a,_b,rootUrl=BABYLON.SceneManager.GetRootUrl(this.scene),index,textTrack,trackElement,video,audio;if(this.m_captionSource!=null&&this.userLocale!=null&&this.userLocale!==""&&this.textTracks!=null&&this.textTracks.length>0)for(index=0;index<this.textTracks.length;index++)if(textTrack=this.textTracks[index],textTrack.trackLanguage===this.userLocale){trackElement=document.createElement("track");trackElement.src=rootUrl+textTrack.trackAsset.filename;trackElement.kind=this.formatTextTrackKind(textTrack.trackKind);trackElement.label=textTrack.trackLabel;trackElement.srclang=textTrack.trackLanguage;trackElement.default=!1;trackElement.addEventListener("cuechange",function(event){var target=event.target,cue;target!=null&&target.track!=null&&target.track.activeCues!=null&&target.track.activeCues[0]!=null&&(cue=target.track.activeCues[0],cue.text!=null&&cue.text!==""&&(_this.logCaptions===!0&&console.log(cue.text),_this.postCaptionMessage(cue.text)))});this.m_captionSource instanceof BABYLON.WebVideoPlayer?(_a=this.m_captionSource.getVideoElement())===null||_a===void 0?void 0:_a.appendChild(trackElement):this.m_captionSource instanceof BABYLON.AudioSource&&((_b=this.m_captionSource.getAudioElement())===null||_b===void 0?void 0:_b.appendChild(trackElement));break}this.m_captionSource instanceof BABYLON.WebVideoPlayer?(video=this.m_captionSource.getVideoElement(),video!=null?MVRK.CaptionSystem.EnableDefaultTextTrack(video,!0):BABYLON.Tools.Warn("Null html video element for: "+this.transform.name)):this.m_captionSource instanceof BABYLON.AudioSource&&(audio=this.m_captionSource.getAudioElement(),audio!=null?MVRK.CaptionSystem.EnableDefaultTextTrack(audio,!0):BABYLON.Tools.Warn("Null html audio element for: "+this.transform.name))},CaptionSystem.prototype.postCaptionMessage=function(message){this.m_captionTimer=0;message!=null&&(this.onUpdateCaptionObservable.hasObservers()===!0&&this.onUpdateCaptionObservable.notifyObservers(message),this.domElement!=null&&(this.m_captionElement==null&&(this.m_captionElement=document.getElementById(this.domElement)),this.m_captionElement!=null&&(this.m_captionElement.innerHTML=message)),message!==""&&(this.m_captionTimer=1e-5))},CaptionSystem.prototype.formatTextTrackKind=function(kind){var result="subtitles";switch(kind){case 0:result="subtitles";break;case 1:result="captions";break;case 2:result="descriptions";break;case 3:result="chapters";break;case 4:result="metadata"}return result},CaptionSystem.EnableDefaultTextTrack=function(source,enable){source!=null&&source.textTracks!=null&&source.textTracks.length>0&&(source.textTracks[0].mode=enable===!0?"showing":"disabled")},CaptionSystem}(BABYLON.ScriptComponent);MVRK.CaptionSystem=CaptionSystem}(MVRK||(MVRK={})),function(MVRK){var SceneSoundSystem=function(_super){function SceneSoundSystem(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(SceneSoundSystem,_super),Object.defineProperty(SceneSoundSystem,"MUSIC",{get:function(){return SceneSoundSystem._MUSIC},enumerable:!1,configurable:!0}),Object.defineProperty(SceneSoundSystem,"SFX",{get:function(){return SceneSoundSystem._SFX},enumerable:!1,configurable:!0}),SceneSoundSystem.prototype.start=function(){var _a,musicNode=this.getChildNode("MUSIC"),soundNode,defaultMusicTrack;musicNode!=null&&(SceneSoundSystem._MUSIC=BABYLON.SceneManager.FindScriptComponent(musicNode,"MVRK.SoundManager"));soundNode=this.getChildNode("SFX");soundNode!=null&&(SceneSoundSystem._SFX=BABYLON.SceneManager.FindScriptComponent(soundNode,"MVRK.SoundManager"));defaultMusicTrack=this.getProperty("defaultMusicTrack");defaultMusicTrack!=null&&defaultMusicTrack!==""&&((_a=SceneSoundSystem.MUSIC)===null||_a===void 0?void 0:_a.playTrack(defaultMusicTrack))},SceneSoundSystem._MUSIC=null,SceneSoundSystem._SFX=null,SceneSoundSystem}(BABYLON.ScriptComponent);MVRK.SceneSoundSystem=SceneSoundSystem}(MVRK||(MVRK={})),function(MVRK){var SoundManager=function(_super){function SoundManager(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.isReady=!1,_this.groupName=null,_this.m_soundMap=null,_this.m_soundList=null,_this}return __extends(SoundManager,_super),SoundManager.prototype.getIsReady=function(){return this.isReady},SoundManager.prototype.getGroupName=function(){return this.groupName},SoundManager.prototype.awake=function(){this.groupName=this.getProperty("groupName",this.transform.name);this.m_soundMap=new Map;this.m_soundList=[];this.isReady=!1},SoundManager.prototype.start=function(){var audioTransforms=this.transform.getChildren(null,!0),index,audioTrackNode,audioSource;if(audioTransforms!=null&&audioTransforms.length>0)for(index=0;index<audioTransforms.length;index++)audioTrackNode=audioTransforms[index],audioSource=BABYLON.SceneManager.FindScriptComponent(audioTrackNode,"BABYLON.AudioSource"),audioSource!=null&&(this.m_soundMap.set(audioTrackNode.name,audioSource),this.m_soundList.push(audioSource))},SoundManager.prototype.update=function(){},SoundManager.prototype.destroy=function(){this.m_soundList=null;this.m_soundMap.clear();this.m_soundMap=null},SoundManager.prototype.playTrack=function(name,time,offset,length){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.play(time,offset,length)},SoundManager.prototype.pauseTrack=function(name){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.pause()},SoundManager.prototype.pauseAllTracks=function(){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.pause()},SoundManager.prototype.stopTrack=function(name,time){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.stop(time)},SoundManager.prototype.stopAllTracks=function(time){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.stop(time)},SoundManager.prototype.muteTrack=function(name,time){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.mute(time)},SoundManager.prototype.unmuteTrack=function(name,time){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.unmute(time)},SoundManager.prototype.muteAllTracks=function(time){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.mute(time)},SoundManager.prototype.unmuteAllTracks=function(time){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.unmute(time)},SoundManager.prototype.setGroupVolume=function(volume,time){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.setVolume(volume,time)},SoundManager.prototype.getAudioSource=function(name){return this.m_soundMap.get(name)},SoundManager}(BABYLON.ScriptComponent);MVRK.SoundManager=SoundManager}(MVRK||(MVRK={})),function(MVRK){var VideoController=function(_super){function VideoController(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(VideoController,_super),VideoController.prototype.awake=function(){},VideoController.prototype.start=function(){},VideoController.prototype.update=function(){},VideoController.prototype.late=function(){},VideoController.prototype.after=function(){},VideoController.prototype.destroy=function(){},VideoController}(BABYLON.ScriptComponent);MVRK.VideoController=VideoController}(MVRK||(MVRK={})),function(MVRK){var InsideNotification=function(_super){function InsideNotification(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.abstractMesh=null,_this}return __extends(InsideNotification,_super),InsideNotification.prototype.awake=function(){this.abstractMesh=this.getAbstractMesh()},InsideNotification.prototype.update=function(){var cameraPos,JSON_1;MVRK.InsideNotification.CurrentRoom!==this.transform.name&&(cameraPos=this.scene.activeCamera.globalPosition,this.pointIsInside(cameraPos)&&(MVRK.InsideNotification.CurrentRoom=this.transform.name,JSON_1='{"command":"location","param1":"'+this.transform.name+'"}',BABYLON.SceneManager.PostWindowMessage(JSON_1,"*")))},InsideNotification.prototype.pointIsInside=function(point){if(this.abstractMesh!=null){var boundInfo=this.abstractMesh.getBoundingInfo(),max=boundInfo.boundingBox.maximumWorld,min=boundInfo.boundingBox.minimumWorld;if(point.x<min.x||point.x>max.x||point.y<min.y||point.y>max.y||point.z<min.z||point.z>max.z)return!1}return!0},InsideNotification.CurrentRoom="",InsideNotification}(BABYLON.ScriptComponent);MVRK.InsideNotification=InsideNotification}(MVRK||(MVRK={})),function(MVRK){var PopupTrigger=function(_super){function PopupTrigger(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.triggerType="vod",_this.triggerParam="defaultParam",_this.triggerFocus=null,_this.abstractMesh=null,_this.onPickTriggerObservable=new BABYLON.Observable,_this}return __extends(PopupTrigger,_super),PopupTrigger.prototype.awake=function(){var _this=this,nodeFocusData,JSON;this.triggerParam=this.getProperty("triggerParam",this.triggerParam);this.triggerType=this.getProperty("triggerType",this.triggerType);nodeFocusData=this.getProperty("triggerFocus");nodeFocusData!=null&&(this.triggerFocus=BABYLON.Utilities.ParseTransformByID(nodeFocusData,this.scene));this.abstractMesh=this.getAbstractMesh();JSON='{"command":"'+this.triggerType+'","param":"'+this.triggerParam+'"}';this.abstractMesh!=null&&(this.abstractMesh.actionManager=new BABYLON.ActionManager(this.scene));this.abstractMesh!=null&&this.abstractMesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPickTrigger},function(){_this.getComponent("PROJECT.LerpObject")==null&&(!_this.triggerFocus||_this.gradualFocus(),_this.onPickTriggerObservable.hasObservers()===!0&&_this.onPickTriggerObservable.notifyObservers(_this.abstractMesh),BABYLON.SceneManager.PostWindowMessage(JSON,"*"))}))},PopupTrigger.prototype.sendMessage=function(){var JSON='{"command":"'+this.triggerType+'","param":"'+this.triggerParam+'"}';BABYLON.SceneManager.PostWindowMessage(JSON,"*")},PopupTrigger.prototype.registerNewTrigger=function(){var _this=this,JSON='{"command":"'+this.triggerType+'","param":"'+this.triggerParam+'"}';this.abstractMesh!=null&&this.abstractMesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPickTrigger},function(){!_this.triggerFocus||_this.gradualFocus();_this.onPickTriggerObservable.hasObservers()===!0&&_this.onPickTriggerObservable.notifyObservers(_this.abstractMesh);BABYLON.SceneManager.PostWindowMessage(JSON,"*")}))},PopupTrigger.prototype.gradualFocus=function(){var camera=this.scene.activeCamera,empty=new BABYLON.Mesh("empty",this.scene),vecSource,vecDest;empty.position=camera.position.clone();empty.rotation=camera.rotation.clone();empty.movePOV(0,0,-2);vecSource=empty.position.clone();vecDest=this.triggerFocus.absolutePosition;this.scene.activeCamera.lockedTarget=vecSource;empty.dispose();this.lerpCameraView(vecSource,vecDest,0)},PopupTrigger.prototype.lerpCameraView=function(vecSource,vecDest,amount){var _this=this,newVec=BABYLON.Vector3.Lerp(vecSource,vecDest,amount);amount<1?setTimeout(function(){var newAmount=amount+.01;_this.scene.activeCamera.lockedTarget=newVec;_this.lerpCameraView(vecSource,vecDest,newAmount)},5):this.scene.activeCamera.lockedTarget=null},PopupTrigger}(BABYLON.ScriptComponent);MVRK.PopupTrigger=PopupTrigger}(MVRK||(MVRK={})),function(MVRK){var State=function(){function State(){}return State.prototype.tick=function(){},State}(),StatefulScriptComponent;MVRK.State=State;StatefulScriptComponent=function(_super){function StatefulScriptComponent(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this._currentState=null,_this.onStateChangeObservable=new BABYLON.Observable,_this}return __extends(StatefulScriptComponent,_super),StatefulScriptComponent.prototype.getCurrentState=function(){return this._currentState},StatefulScriptComponent.prototype.setState=function(newState,forced){return this._currentState===newState?!1:forced!=null&&forced==!0?(this._currentState&&this._currentState.onExit(),this._currentState=newState,newState.onEnter(),this.onStateChangeObservable.hasObservers()===!0&&this.onStateChangeObservable.notifyObservers(this._currentState),!0):newState.canChangeState()?(this._currentState&&this._currentState.onExit(),this._currentState=newState,newState.onEnter(),this.onStateChangeObservable.hasObservers()===!0&&this.onStateChangeObservable.notifyObservers(this._currentState),!0):(newState.onStateChangeFail(),!1)},StatefulScriptComponent}(BABYLON.ScriptComponent);MVRK.StatefulScriptComponent=StatefulScriptComponent}(MVRK||(MVRK={})),function(MVRK){var BillboardMesh=function(_super){function BillboardMesh(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(BillboardMesh,_super),BillboardMesh.prototype.awake=function(){this.camera=this.scene.activeCamera},BillboardMesh.prototype.update=function(){var absCameraPos=this.camera.globalPosition,absTransformPos=this.transform.absolutePosition,lookDirection=absCameraPos.subtract(absTransformPos).normalize().scale(-1);this.transform.lookAt(absTransformPos.add(lookDirection),null,null,null,BABYLON.Space.WORLD)},BillboardMesh}(BABYLON.ScriptComponent);MVRK.BillboardMesh=BillboardMesh}(MVRK||(MVRK={})),function(MVRK){var BlinkManager=function(_super){function BlinkManager(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.enableBlinking=!1,_this.blinkingState=!1,_this.blinkingTimer=0,_this.blinkTimeout=.5,_this.onBlinkUpdateObservable=new BABYLON.Observable,_this}return __extends(BlinkManager,_super),BlinkManager.prototype.awake=function(){this.blinkTimeout=this.getProperty("blinkTimeout",this.blinkTimeout)},BlinkManager.prototype.update=function(){this.enableBlinking===!0&&(this.blinkingTimer+=this.getDeltaSeconds(),this.blinkingTimer>=this.blinkTimeout&&(this.blinkingTimer=0,this.blinkingState=!this.blinkingState,this.onBlinkUpdateObservable.hasObservers()===!0&&this.onBlinkUpdateObservable.notifyObservers(this.blinkingState)))},BlinkManager.prototype.destroy=function(){this.onBlinkUpdateObservable.clear();this.onBlinkUpdateObservable=null},BlinkManager.prototype.enableBlinkMode=function(blinking){this.blinkingTimer=0;this.blinkingState=!1;this.enableBlinking=blinking},BlinkManager}(BABYLON.ScriptComponent);MVRK.BlinkManager=BlinkManager}(MVRK||(MVRK={})),function(MVRK){var FloatingAnimation=function(_super){function FloatingAnimation(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.floatSpeed=1,_this.floatDistance=.2,_this.randomOffset=.1,_this.initPosition=new BABYLON.Vector3(0,0,0),_this.floatingVector=new BABYLON.Vector3(0,0,0),_this}return __extends(FloatingAnimation,_super),FloatingAnimation.prototype.awake=function(){this.floatSpeed=this.getProperty("floatSpeed",this.floatSpeed);this.floatDistance=this.getProperty("floatDistance",this.floatDistance);this.randomOffset=BABYLON.Scalar.RandomRange(-Math.PI,Math.PI);this.initPosition.copyFrom(this.transform.position)},FloatingAnimation.prototype.update=function(){var time=this.getGameTime();this.floatingVector.set(0,Math.sin((time+this.randomOffset)*this.floatSpeed)*this.floatDistance,0);this.floatingVector.addToRef(this.initPosition,this.transform.position)},FloatingAnimation.prototype.destroy=function(){this.initPosition=null;this.floatingVector=null},FloatingAnimation}(BABYLON.ScriptComponent);MVRK.FloatingAnimation=FloatingAnimation}(MVRK||(MVRK={})),function(MVRK){var RotateTransform=function(_super){function RotateTransform(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.rotateSpeedX=0,_this.rotateSpeedY=0,_this.rotateSpeedZ=1,_this}return __extends(RotateTransform,_super),RotateTransform.prototype.awake=function(){this.rotateSpeedX=this.getProperty("rotateSpeedX",this.rotateSpeedX);this.rotateSpeedY=this.getProperty("rotateSpeedY",this.rotateSpeedY);this.rotateSpeedZ=this.getProperty("rotateSpeedZ",this.rotateSpeedZ);this.transform.rotation==null&&(this.transform.rotation=new BABYLON.Vector3(0,0,0));this.transform.rotationQuaternion!=null&&(this.transform.rotationQuaternion.toEulerAnglesToRef(this.transform.rotation),this.transform.rotationQuaternion=null)},RotateTransform.prototype.update=function(){var deltaTime=this.getDeltaSeconds();this.rotateSpeedX!==0&&(this.transform.rotation.x+=this.rotateSpeedX*deltaTime);this.rotateSpeedY!==0&&(this.transform.rotation.y+=this.rotateSpeedY*deltaTime);this.rotateSpeedZ!==0&&(this.transform.rotation.z+=this.rotateSpeedZ*deltaTime)},RotateTransform}(BABYLON.ScriptComponent);MVRK.RotateTransform=RotateTransform}(MVRK||(MVRK={})),function(MVRK){var RuntimeTexture=function(_super){function RuntimeTexture(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.m_dynamicTexture=null,_this.m_dynamicMaterial=null,_this}return __extends(RuntimeTexture,_super),RuntimeTexture.prototype.awake=function(){var textureUrl=this.getProperty("textureUrl"),invertAxis=this.getProperty("invertAxis",!1),genMipmaps=this.getProperty("genMipmaps",!1),materialIndex=this.getProperty("materialIndex",0),abstractMesh=this.getAbstractMesh(),mmat1;abstractMesh!=null&&(abstractMesh.material instanceof BABYLON.MultiMaterial?(mmat1=abstractMesh.material.clone(abstractMesh.material.name+"."+abstractMesh.name),this.m_dynamicMaterial=mmat1.subMaterials[materialIndex].clone(mmat1.subMaterials[materialIndex].name+"_"+abstractMesh.name),mmat1.subMaterials[materialIndex]=this.m_dynamicMaterial,abstractMesh.material=mmat1):(this.m_dynamicMaterial=abstractMesh.material.clone(abstractMesh.material.name+"."+abstractMesh.name),abstractMesh.material=this.m_dynamicMaterial),this.m_dynamicMaterial.unfreeze());textureUrl!=null&&textureUrl!==""&&this.setTextureUrl(textureUrl,invertAxis,genMipmaps)},RuntimeTexture.prototype.destroy=function(){this.m_dynamicTexture!=null&&(this.m_dynamicTexture.dispose(),this.m_dynamicTexture=null);this.m_dynamicMaterial!=null&&(this.m_dynamicMaterial.dispose(),this.m_dynamicMaterial=null)},RuntimeTexture.prototype.setTextureUrl=function(url,invertY,createMipmaps){invertY===void 0&&(invertY=!1);createMipmaps===void 0&&(createMipmaps=!1);this.m_dynamicTexture!=null&&(this.m_dynamicTexture.dispose(),this.m_dynamicTexture=null);this.m_dynamicTexture=new BABYLON.Texture(url,this.scene,!createMipmaps,invertY);this.m_dynamicMaterial!=null&&(this.m_dynamicMaterial instanceof BABYLON.PBRMaterial?this.m_dynamicMaterial.albedoTexture=this.m_dynamicTexture:this.m_dynamicMaterial instanceof BABYLON.StandardMaterial&&(this.m_dynamicMaterial.diffuseTexture=this.m_dynamicTexture))},RuntimeTexture}(BABYLON.ScriptComponent);MVRK.RuntimeTexture=RuntimeTexture}(MVRK||(MVRK={})),function(MVRK){var SpriteAnimation=function(_super){function SpriteAnimation(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.gridCols=1,_this.gridRows=1,_this.startRow=1,_this.bottomUp=!1,_this.timeInSeconds=1,_this.colWidth=0,_this.rowHeight=0,_this.animTimer=0,_this.tileIndex=0,_this.tileReset=0,_this.baseTexture=null,_this}return __extends(SpriteAnimation,_super),SpriteAnimation.prototype.awake=function(){var totalTiles,maxTileCount,mesh,pbrMaterial,stdMaterial,startRowOffset;this.gridCols=this.getProperty("gridCols",this.gridCols);this.gridRows=this.getProperty("gridRows",this.gridRows);this.startRow=this.getProperty("startRow",this.startRow);this.bottomUp=this.getProperty("bottomUp",this.bottomUp);this.timeInSeconds=this.getProperty("timeInSeconds",this.timeInSeconds);this.colWidth=1/this.gridCols;this.rowHeight=1/this.gridRows;this.tileIndex=0;this.tileReset=0;totalTiles=this.gridCols*this.gridRows;maxTileCount=this.getProperty("maxTileCount",0);maxTileCount>0&&maxTileCount<totalTiles&&(this.tileReset=maxTileCount);mesh=this.getAbstractMesh();mesh!=null&&mesh.material!=null&&(mesh.material instanceof BABYLON.PBRMaterial?(pbrMaterial=mesh.material.clone(mesh.name+"."+mesh.material.name),this.baseTexture=pbrMaterial.albedoTexture,mesh.material=pbrMaterial):mesh.material instanceof BABYLON.StandardMaterial&&(stdMaterial=mesh.material.clone(mesh.name+"."+mesh.material.name),this.baseTexture=stdMaterial.diffuseTexture,mesh.material=stdMaterial));this.baseTexture!=null&&(this.baseTexture.uScale=this.colWidth,this.baseTexture.vScale=this.rowHeight,startRowOffset=BABYLON.Scalar.Clamp((this.startRow-1)*this.rowHeight),this.baseTexture.uOffset=0,this.baseTexture.vOffset=this.bottomUp===!0?startRowOffset:1-startRowOffset-this.rowHeight,this.startRow>1&&(this.tileIndex=(this.startRow-1)*this.gridCols))},SpriteAnimation.prototype.start=function(){this.animTimer=0},SpriteAnimation.prototype.reset=function(){this.baseTexture!=null&&(this.baseTexture.uOffset=0,this.baseTexture.vOffset=this.bottomUp===!0?0:1-this.rowHeight)},SpriteAnimation.prototype.update=function(){this.timeInSeconds>0&&(this.animTimer+=this.getDeltaSeconds(),this.animTimer>=this.timeInSeconds&&(this.animTimer=0,this.animate()))},SpriteAnimation.prototype.animate=function(){this.baseTexture!=null&&(this.baseTexture.uOffset>=1-this.colWidth?(this.baseTexture.uOffset=0,this.bottomUp===!0?this.baseTexture.vOffset>=1-this.rowHeight?this.baseTexture.vOffset=0:this.baseTexture.vOffset+=this.rowHeight:this.baseTexture.vOffset<=0?this.baseTexture.vOffset=1-this.rowHeight:this.baseTexture.vOffset-=this.rowHeight,(this.baseTexture.vOffset<0||this.baseTexture.vOffset>0)&&(this.baseTexture.vOffset=BABYLON.Scalar.Clamp(this.baseTexture.vOffset))):this.baseTexture.uOffset+=this.colWidth,(this.baseTexture.uOffset<0||this.baseTexture.uOffset>0)&&(this.baseTexture.uOffset=BABYLON.Scalar.Clamp(this.baseTexture.uOffset)));this.tileReset>0&&(this.tileIndex++,this.tileIndex>=this.tileReset&&(this.tileIndex=0,this.reset()))},SpriteAnimation.prototype.destroy=function(){this.baseTexture=null},SpriteAnimation}(BABYLON.ScriptComponent);MVRK.SpriteAnimation=SpriteAnimation}(MVRK||(MVRK={})),function(MVRK){var SceneLoader=function(){function SceneLoader(){}return SceneLoader.SwitchScene=function(sceneFile){MVRK.SceneLoader.TeleFade.SceneFile=sceneFile;BABYLON.SceneManager.RegisterOnShowSceneLoader(function(){});var blanket=parent.window.document.getElementById("blanket");blanket==null&&(blanket=parent.window.document.createElement("div"),blanket.id="blanket",blanket.style.position="absolute",blanket.style.minHeight="100%",blanket.style.width="100%",blanket.style.height="100%",blanket.style.padding="0px",blanket.style.margin="0px",blanket.style.top="0",blanket.style.left="0",blanket.style.display="none",blanket.style.outline="none",blanket.style.overflow="hidden",blanket.style.opacity="0",blanket.style.zIndex="-1",blanket.style.backgroundColor="black",parent.window.document.body.appendChild(blanket));blanket!=null&&(blanket.style.zIndex="2001",blanket.style.display="block",blanket.style.opacity="0",MVRK.SceneLoader.FadeToBlack(blanket,MVRK.SceneLoader.TeleFade.Speed))},SceneLoader.FadeToBlack=function(blanket,speed){blanket!=null&&(speed<MVRK.SceneLoader.TeleFade.Limit?BABYLON.SceneManager.SetTimeout(MVRK.SceneLoader.TeleFade.Timeout,function(){blanket.style.opacity=(speed/(MVRK.SceneLoader.TeleFade.Limit-speed)).toString();MVRK.SceneLoader.FadeToBlack(blanket,speed*MVRK.SceneLoader.TeleFade.Multiplier)}):(blanket.style.zIndex="2001",blanket.style.display="block",blanket.style.opacity="1",BABYLON.SceneManager.ShowParentLoader(!0),BABYLON.SceneManager.LoadSceneFile(MVRK.SceneLoader.TeleFade.SceneFile)))},SceneLoader.FadeToScene=function(blanket,speed){blanket!=null&&(speed>.001?BABYLON.SceneManager.SetTimeout(MVRK.SceneLoader.TeleFade.Timeout,function(){blanket.style.opacity=(speed/(MVRK.SceneLoader.TeleFade.Limit-speed)).toString();MVRK.SceneLoader.FadeToScene(blanket,speed/MVRK.SceneLoader.TeleFade.Multiplier)}):(blanket.style.zIndex="-1",blanket.style.display="none",blanket.style.opacity="0"))},SceneLoader.LoadSceneComplete=function(){BABYLON.SceneManager.ShowParentLoader(!1);var blanket=parent.window.document.getElementById("blanket");blanket!=null&&MVRK.SceneLoader.FadeToScene(blanket,MVRK.SceneLoader.TeleFade.Limit)},SceneLoader.TeleFade={Speed:.01,Timeout:50,Multiplier:1.8,Limit:.4,SceneFile:null},SceneLoader}();MVRK.SceneLoader=SceneLoader}(MVRK||(MVRK={})),function(MVRK){var System=function(){function System(){}return System.GetUserInfo=function(){var result=null;return window.frameElement!=null&&parent!=null&&parent.window!=null?parent.window.getMVRKUser&&(result=parent.window.getMVRKUser()):window.getMVRKUser&&(result=window.getMVRKUser()),result==null&&(result={firstName:"Default",lastName:"Player",locale:"en",email:null}),result},System.GetGameLobbyInfo=function(){var result=null;return window.frameElement!=null&&parent!=null&&parent.window!=null?parent.window.getGameLobbyInfo&&(result=parent.window.getGameLobbyInfo()):window.getGameLobbyInfo&&(result=window.getGameLobbyInfo()),result==null&&(result={id:"12345"}),result},System}();MVRK.System=System}(MVRK||(MVRK={})),function(PROJECT){var AnchorInSpot=function(_super){function AnchorInSpot(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(AnchorInSpot,_super),AnchorInSpot.prototype.update=function(){this.getAbstractMesh().setPositionWithLocalVector(BABYLON.Vector3.Zero())},AnchorInSpot}(BABYLON.ScriptComponent);PROJECT.AnchorInSpot=AnchorInSpot}(PROJECT||(PROJECT={})),function(PROJECT){var Animator=function(){function Animator(name,animator){this.name=name;this.animator=animator}return Animator}(),AnimatorManager;PROJECT.Animator=Animator;AnimatorManager=function(_super){function AnimatorManager(transform,scene,properties){properties===void 0&&(properties={});var _this=_super.call(this,transform,scene,properties)||this;return _this.animators=[],_this.draggables=[],PROJECT.AnimatorManager._instance==null&&(PROJECT.AnimatorManager._instance=_this),_this}return __extends(AnimatorManager,_super),Object.defineProperty(AnimatorManager,"Instance",{get:function(){return AnimatorManager._instance},enumerable:!1,configurable:!0}),AnimatorManager.prototype.awake=function(){var _this=this,animatorObjectMetaData,draggables;BABYLON.SceneManager.SetWindowState("AnimatorManager",AnimatorManager.Instance);animatorObjectMetaData=this.getProperty("animators");draggables=this.getProperty("draggables");draggables.forEach(function(object){var node=_this.scene.getNodeByID(object.id);_this.draggables.push(node)});animatorObjectMetaData.forEach(function(object){var node=_this.scene.getNodeByID(object.id),animatorComponent=BABYLON.SceneManager.FindScriptComponent(node,"BABYLON.AnimationState"),animator=new Animator(node.name,animatorComponent);_this.animators.push(animator)});this.BindEndAnimationMessages(this.animators)},AnimatorManager.prototype.GetAnimator=function(name){var animator=null;return this.animators.forEach(function(object){if(object.name===name)return animator=object}),animator},AnimatorManager.prototype.BindEndAnimationMessages=function(){},AnimatorManager.prototype.ResetDraggables=function(){this.draggables.forEach(function(draggable){draggable.setPositionWithLocalVector(new BABYLON.Vector3(0,0,0))})},AnimatorManager}(BABYLON.ScriptComponent);PROJECT.AnimatorManager=AnimatorManager}(PROJECT||(PROJECT={})),function(PROJECT){var LimitedDrag=function(_super){function LimitedDrag(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.drag=null,_this.leftBound=0,_this.rightBound=1,_this.canDrag=!1,_this}return __extends(LimitedDrag,_super),LimitedDrag.prototype.awake=function(){var _this=this,abstractMesh=this.getAbstractMesh(),initialPosition=this.transform.absolutePosition;this.leftBound=this.getProperty("leftBound",this.leftBound);this.rightBound=this.getProperty("rightBound",this.rightBound);this.canDrag=this.getProperty("canDrag",this.canDrag);this.drag=new BABYLON.PointerDragBehavior({dragPlaneNormal:new BABYLON.Vector3(0,0,1)});abstractMesh!=null&&this.canDrag&&(abstractMesh.addBehavior(this.drag),this.scene.getEngine().getRenderingCanvas().addEventListener("mouseout",function(){abstractMesh.removeBehavior(_this.drag);abstractMesh.addBehavior(_this.drag);console.log("mouseout-document")}),this.drag.validateDrag=function(targetPosition){var localPosition=BABYLON.Utilities.InverseTransformPoint(_this.transform.parent,targetPosition),normalizedDragValue=BABYLON.Scalar.Normalize(_this.transform.getPositionExpressedInLocalSpace().x,0,1),drag={dragValue:normalizedDragValue};return(BABYLON.SceneManager.PostWindowMessage(JSON.stringify(drag),"*"),targetPosition.y!=initialPosition.y&&(targetPosition.y=initialPosition.y),localPosition.x<_this.leftBound)?!1:localPosition.x>_this.rightBound?!1:!0})},LimitedDrag.prototype.destroy=function(){this.drag=null},LimitedDrag}(BABYLON.ScriptComponent);PROJECT.LimitedDrag=LimitedDrag}(PROJECT||(PROJECT={})),function(PROJECT){var Pickable=function(_super){function Pickable(transform,scene,properties){return properties===void 0&&(properties={}),_super.call(this,transform,scene,properties)||this}return __extends(Pickable,_super),Pickable.prototype.awake=function(){},Pickable.prototype.start=function(){},Pickable.prototype.update=function(){},Pickable.prototype.late=function(){},Pickable.prototype.after=function(){},Pickable.prototype.destroy=function(){},Pickable}(BABYLON.ScriptComponent);PROJECT.Pickable=Pickable}(PROJECT||(PROJECT={})),function(PROJECT){var Rotator=function(_super){function Rotator(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.inertiaFactor=1,_this.speed=0,_this.drag=.86,_this.max=.05,_this.min=.0001,_this.lastSafePoint=null,_this._mouseObs=null,_this}return __extends(Rotator,_super),Rotator.prototype.awake=function(){this.inertiaFactor=this.getProperty("inertiaFactor",this.inertiaFactor);this.drag=this.getProperty("drag",this.drag);this.max=this.getProperty("maxSpeed",this.max);this.min=Math.PI*.0001;globalThis.rotator=this},Rotator.prototype.start=function(){if(this._abm=this.getAbstractMesh(),this._abm){var originalRotation=this._abm.rotationQuaternion.toEulerAngles();this._abm.rotationQuaternion=null;this._abm.rotation=originalRotation}this._animatior=PROJECT.AnimatorManager.Instance.GetAnimator("ThriveAnimator").animator},Rotator.prototype.update=function(){if(this._abm.setPositionWithLocalVector(BABYLON.Vector3.Zero()),this._animatior.getInteger("State")!==6){this._mouseObs&&this._removeMouseObs();return}this._mouseObs||this._addMouseObs();this._abm&&(this._abm.rotation.y+=this.speed*this.getDeltaSeconds(),this.speed*=this.drag,Math.abs(this.speed)<this.min&&(this.speed=0))},Rotator.prototype._addMouseObs=function(){var _this=this;this._mouseObs=this.scene.onPointerObservable.add(function(pointerInfo){var dir,xFactor,tS;switch(pointerInfo.type){case BABYLON.PointerEventTypes.POINTERDOWN:_this.lastSafePoint=new BABYLON.Vector2(pointerInfo.event.offsetX,pointerInfo.event.offsetY);break;case BABYLON.PointerEventTypes.POINTERUP:_this.lastSafePoint=null;break;case BABYLON.PointerEventTypes.POINTERMOVE:_this.lastSafePoint!==null&&(dir=_this.lastSafePoint.subtract(new BABYLON.Vector2(pointerInfo.event.offsetX,pointerInfo.event.offsetY)),xFactor=dir.x*_this.inertiaFactor,_this.lastSafePoint=new BABYLON.Vector2(pointerInfo.event.offsetX,pointerInfo.event.offsetY),tS=_this.speed+xFactor,_this.speed=Math.min(Math.max(tS,-_this.max),_this.max))}})},Rotator.prototype._removeMouseObs=function(){this.scene.onPointerObservable.remove(this._mouseObs);this._mouseObs=null},Rotator.prototype.destroy=function(){this._removeMouseObs()},Rotator}(BABYLON.ScriptComponent);PROJECT.Rotator=Rotator}(PROJECT||(PROJECT={})),function(PROJECT){var SessionDetail=function(_super){function SessionDetail(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.sessionTexture=null,_this}return __extends(SessionDetail,_super),SessionDetail.prototype.getSessionTexture=function(){return this.sessionTexture},SessionDetail.prototype.awake=function(){this.sessionTexture=this.getProperty("sessionTexture")},SessionDetail.prototype.destroy=function(){this.sessionTexture=null},SessionDetail}(BABYLON.ScriptComponent);PROJECT.SessionDetail=SessionDetail}(PROJECT||(PROJECT={})),function(PROJECT){var SessionManager=function(_super){function SessionManager(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.runtimeTexture=null,_this}return __extends(SessionManager,_super),SessionManager.prototype.awake=function(){var _this=this,monoliths;this.runtimeTexture=this.getComponent("MVRK.RuntimeTexture");monoliths=this.getProperty("monoliths");monoliths!=null&&monoliths.forEach(function(trigger){var monolith=BABYLON.Utilities.ParseTransformByID(trigger,_this.scene),popupTrigger;monolith!=null&&(popupTrigger=BABYLON.SceneManager.FindScriptComponent(monolith,"MVRK.PopupTrigger"),popupTrigger!=null&&popupTrigger.onPickTriggerObservable.add(function(eventData){_this.handleTriggerPick(eventData)}))})},SessionManager.prototype.destroy=function(){this.runtimeTexture=null},SessionManager.prototype.handleTriggerPick=function(mesh){var sessionDetail,textureData,rootUrl,texUrl;this.runtimeTexture!=null&&(sessionDetail=BABYLON.SceneManager.FindScriptComponent(mesh,"PROJECT.SessionDetail"),sessionDetail!=null&&(textureData=sessionDetail.getSessionTexture(),textureData!=null&&(rootUrl=BABYLON.SceneManager.GetRootUrl(this.scene),texUrl=rootUrl+textureData.filename,this.runtimeTexture.setTextureUrl(texUrl))))},SessionManager}(BABYLON.ScriptComponent);PROJECT.SessionManager=SessionManager}(PROJECT||(PROJECT={}))

// Project Shader Fixes
if (BABYLON.Effect.IncludesShadersStore["pbrBlockFinalColorComposition"]) BABYLON.Effect.IncludesShadersStore["pbrBlockFinalColorComposition"] = BABYLON.Effect.IncludesShadersStore["pbrBlockFinalColorComposition"].replace("finalColor.rgb*=lightmapColor.rgb", "finalColor.rgb*=(lightmapColor.rgb+finalEmissive.rgb)");
if (BABYLON.Effect.ShadersStore["defaultPixelShader"]) BABYLON.Effect.ShadersStore["defaultPixelShader"] = BABYLON.Effect.ShadersStore["defaultPixelShader"].replace("color.rgb *= lightmapColor.rgb", "color.rgb *= (lightmapColor.rgb + finalEmissive.rgb)");
