// Xbox Project Shim Services
var EnableXboxLiveServices=!0

// Verizon-VX360-3D.js
var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStatics(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b);d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;(y=0,t)&&(op=[op[0]&2,t.value]);switch(op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}t[2]&&_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g},MVRK,PROJECT,BABYLON;(function(PROJECT){var UniversalCameraSystem=function(_super){function UniversalCameraSystem(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.mainCamera=!1,_this.cameraType=0,_this.cameraInertia=.5,_this.cameraController=null,_this.virtualReality=null,_this.arcRotateConfig=null,_this.multiPlayerSetup=null,_this.editorPostProcessing=null,_this.m_cameraRig=null,_this}return __extends(UniversalCameraSystem,_super),UniversalCameraSystem.GetRenderingPipeline=function(){return PROJECT.UniversalCameraSystem.renderingPipeline},UniversalCameraSystem.IsCameraSystemReady=function(){return PROJECT.UniversalCameraSystem.cameraReady},UniversalCameraSystem.prototype.isMainCamera=function(){return this.mainCamera},UniversalCameraSystem.prototype.getCameraType=function(){return this.cameraType},UniversalCameraSystem.prototype.awake=function(){this.awakeCameraSystemState()},UniversalCameraSystem.prototype.start=function(){this.startCameraSystemState()},UniversalCameraSystem.prototype.update=function(){this.updateCameraSystemState()},UniversalCameraSystem.prototype.destroy=function(){this.destroyCameraSystemState()},UniversalCameraSystem.prototype.awakeCameraSystemState=function(){this.mainCamera=this.getTransformTag()==="MainCamera";this.cameraType=this.getProperty("mainCameraType",this.cameraType);this.cameraInertia=this.getProperty("setCameraInertia",this.cameraInertia);this.virtualReality=this.getProperty("virtualRealityRig",this.virtualReality);this.arcRotateConfig=this.getProperty("arcRotateConfig",this.arcRotateConfig);this.multiPlayerSetup=this.getProperty("multiPlayerSetup",this.multiPlayerSetup);this.cameraController=this.getProperty("cameraController",this.cameraController);this.editorPostProcessing=this.getProperty("renderingPipeline",this.editorPostProcessing)},UniversalCameraSystem.prototype.startCameraSystemState=function(){return __awaiter(this,void 0,void 0,function(){var webvrFloorMeshes,webvrHelperOptions,webvrImmersiveMode,webvrReferenceType,_a,cameraName,playerOneTransform,playerOneName,playerOneCamerax,playerTwoTransform,playerTwoName,playerTwoCamerax,playerThreeTransform,playerThreeName,playerThreeCamerax,playerFourTransform,playerFourName,playerFourCamerax,targetVector,defaultPipeline,colorGradingTexture,curve;return __generator(this,function(_b){switch(_b.label){case 0:return(BABYLON.Utilities.ValidateTransformQuaternion(this.transform),this.multiPlayerSetup!=null&&(PROJECT.UniversalCameraSystem.startupMode=this.multiPlayerSetup.playerStartupMode,PROJECT.UniversalCameraSystem.stereoCameras=this.multiPlayerSetup.stereoSideBySide),this.m_cameraRig=this.getCameraRig(),!(this.m_cameraRig!=null))?[3,5]:(this.m_cameraRig.inertia=this.cameraInertia,this.cameraController.attachControl===!0&&(this.m_cameraRig.parent=null,this.m_cameraRig.position.copyFrom(this.transform.position),this.m_cameraRig.rotationQuaternion=this.transform.rotationQuaternion!=null?this.transform.rotationQuaternion.clone():BABYLON.Quaternion.FromEulerAngles(this.transform.rotation.x,this.transform.rotation.y,this.transform.rotation.z),this.m_cameraRig instanceof BABYLON.FreeCamera&&(this.m_cameraRig.checkCollisions=this.cameraController.checkCollisions,this.m_cameraRig.applyGravity=this.cameraController.setApplyGravity),this.m_cameraRig.attachControl(this.cameraController.preventDefault)),!(this.cameraType===0))?[3,1]:(PROJECT.UniversalCameraSystem.PlayerOneCamera=this.m_cameraRig,PROJECT.UniversalCameraSystem.PlayerOneCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerOneCamera.transform=this.transform,[3,5]);case 1:if(!(this.cameraType===1))return[3,4];if(!(this.virtualReality!=null))return[3,3];webvrFloorMeshes=null;webvrHelperOptions=null;webvrImmersiveMode=this.virtualReality.immersiveExperience===1?"immersive-ar":"immersive-vr";webvrReferenceType="local-floor";switch(this.virtualReality.referenceSpaceType){case 0:webvrReferenceType="viewer";break;case 1:webvrReferenceType="local";break;case 2:webvrReferenceType="local-floor";break;case 3:webvrReferenceType="bounded-floor";break;case 4:webvrReferenceType="unbounded";break;default:webvrReferenceType="local-floor"}return(this.virtualReality.setFloorMeshesTags==null||this.virtualReality.setFloorMeshesTags==="")&&(this.virtualReality.setFloorMeshesTags="Navigation"),this.virtualReality.enableTeleportation===!0&&(webvrFloorMeshes=this.scene.getMeshesByTags(this.virtualReality.setFloorMeshesTags)),webvrHelperOptions=this.virtualReality.enableTeleportation===!0&&webvrFloorMeshes!=null&&webvrFloorMeshes.length>0?{floorMeshes:webvrFloorMeshes,renderingGroupId:this.virtualReality.renderingGroupNum,disableDefaultUI:this.virtualReality.disableUserInterface,disableTeleportation:this.virtualReality.enableTeleportation===!1,ignoreNativeCameraTransformation:this.virtualReality.ignoreNativeCamera,inputOptions:{doNotLoadControllerMeshes:this.virtualReality.experienceInputOptions.disableMeshLoad,forceInputProfile:this.virtualReality.experienceInputOptions.forceInputProfile,disableOnlineControllerRepository:this.virtualReality.experienceInputOptions.disableRepository,customControllersRepositoryURL:this.virtualReality.experienceInputOptions.customRepository,disableControllerAnimation:this.virtualReality.experienceInputOptions.disableModelAnim,controllerOptions:{disableMotionControllerAnimation:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlAnim,doNotLoadControllerMesh:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlMesh,forceControllerProfile:this.virtualReality.experienceInputOptions.controllerOptions.forceCtrlProfile,renderingGroupId:this.virtualReality.experienceInputOptions.controllerOptions.renderingGroup}},uiOptions:{sessionMode:webvrImmersiveMode,referenceSpaceType:webvrReferenceType}}:{renderingGroupId:this.virtualReality.renderingGroupNum,disableDefaultUI:this.virtualReality.disableUserInterface,disableTeleportation:this.virtualReality.enableTeleportation===!1,ignoreNativeCameraTransformation:this.virtualReality.ignoreNativeCamera,inputOptions:{doNotLoadControllerMeshes:this.virtualReality.experienceInputOptions.disableMeshLoad,forceInputProfile:this.virtualReality.experienceInputOptions.forceInputProfile,disableOnlineControllerRepository:this.virtualReality.experienceInputOptions.disableRepository,customControllersRepositoryURL:this.virtualReality.experienceInputOptions.customRepository,disableControllerAnimation:this.virtualReality.experienceInputOptions.disableModelAnim,controllerOptions:{disableMotionControllerAnimation:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlAnim,doNotLoadControllerMesh:this.virtualReality.experienceInputOptions.controllerOptions.disableCtrlMesh,forceControllerProfile:this.virtualReality.experienceInputOptions.controllerOptions.forceCtrlProfile,renderingGroupId:this.virtualReality.experienceInputOptions.controllerOptions.renderingGroup}},uiOptions:{sessionMode:webvrImmersiveMode,referenceSpaceType:webvrReferenceType}},_a=PROJECT.UniversalCameraSystem,[4,this.scene.createDefaultXRExperienceAsync(webvrHelperOptions)];case 2:_a.XRExperienceHelper=_b.sent();PROJECT.UniversalCameraSystem.XRExperienceHelper.baseExperience||BABYLON.Tools.Warn("WebXR not supported in current browser.");_b.label=3;case 3:return[3,5];case 4:this.cameraType===2?(cameraName=this.m_cameraRig.name,playerOneTransform=new BABYLON.TransformNode("Player Camera 1",this.scene),playerOneTransform.rotationQuaternion=this.transform.rotationQuaternion.clone(),playerOneTransform.position=this.transform.position.clone(),playerOneTransform.parent=this.transform.parent,playerOneName=cameraName+".1",playerOneCamerax=this.m_cameraRig.clone(playerOneName),playerOneCamerax.name=playerOneName,playerOneCamerax.parent=playerOneTransform,playerOneCamerax.position=new BABYLON.Vector3(0,0,0),playerOneCamerax.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),playerOneCamerax.viewport=new BABYLON.Viewport(0,0,0,0),playerOneCamerax.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerOneCamera=playerOneCamerax,PROJECT.UniversalCameraSystem.PlayerOneCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerOneCamera.transform=playerOneTransform,playerOneTransform.cameraRig=PROJECT.UniversalCameraSystem.PlayerOneCamera,playerTwoTransform=new BABYLON.TransformNode("Player Camera 2",this.scene),playerTwoTransform.rotationQuaternion=this.transform.rotationQuaternion.clone(),playerTwoTransform.position=this.transform.position.clone(),playerTwoTransform.parent=this.transform.parent,playerTwoName=cameraName+".2",playerTwoCamerax=this.m_cameraRig.clone(playerTwoName),playerTwoCamerax.name=playerTwoName,playerTwoCamerax.parent=playerTwoTransform,playerTwoCamerax.position=new BABYLON.Vector3(0,0,0),playerTwoCamerax.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),playerTwoCamerax.viewport=new BABYLON.Viewport(0,0,0,0),playerTwoCamerax.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerTwoCamera=playerTwoCamerax,PROJECT.UniversalCameraSystem.PlayerTwoCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerTwoCamera.transform=playerTwoTransform,playerTwoTransform.cameraRig=PROJECT.UniversalCameraSystem.PlayerTwoCamera,playerThreeTransform=new BABYLON.TransformNode("Player Camera 3",this.scene),playerThreeTransform.rotationQuaternion=this.transform.rotationQuaternion.clone(),playerThreeTransform.position=this.transform.position.clone(),playerThreeTransform.parent=this.transform.parent,playerThreeName=cameraName+".3",playerThreeCamerax=this.m_cameraRig.clone(playerThreeName),playerThreeCamerax.name=playerThreeName,playerThreeCamerax.parent=playerThreeTransform,playerThreeCamerax.position=new BABYLON.Vector3(0,0,0),playerThreeCamerax.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),playerThreeCamerax.viewport=new BABYLON.Viewport(0,0,0,0),playerThreeCamerax.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerThreeCamera=playerThreeCamerax,PROJECT.UniversalCameraSystem.PlayerThreeCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerThreeCamera.transform=playerThreeTransform,playerThreeTransform.cameraRig=PROJECT.UniversalCameraSystem.PlayerThreeCamera,playerFourTransform=new BABYLON.TransformNode("Player Camera 4",this.scene),playerFourTransform.rotationQuaternion=this.transform.rotationQuaternion.clone(),playerFourTransform.position=this.transform.position.clone(),playerFourTransform.parent=this.transform.parent,playerFourName=cameraName+".4",playerFourCamerax=this.m_cameraRig.clone(playerFourName),playerFourCamerax.name=playerFourName,playerFourCamerax.parent=playerFourTransform,playerFourCamerax.position=new BABYLON.Vector3(0,0,0),playerFourCamerax.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),playerFourCamerax.viewport=new BABYLON.Viewport(0,0,0,0),playerFourCamerax.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerFourCamera=playerFourCamerax,PROJECT.UniversalCameraSystem.PlayerFourCamera.inertia=this.cameraInertia,PROJECT.UniversalCameraSystem.PlayerFourCamera.transform=playerFourTransform,playerFourTransform.cameraRig=PROJECT.UniversalCameraSystem.PlayerFourCamera,PROJECT.UniversalCameraSystem.multiPlayerView=!0,PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(this.scene,PROJECT.UniversalCameraSystem.startupMode)):this.cameraType===3&&(targetVector=BABYLON.Utilities.ParseVector3(this.arcRotateConfig.target),this.m_cameraRig=new BABYLON.ArcRotateCamera(this.transform.name+".ArcRotate",this.arcRotateConfig.alpha,this.arcRotateConfig.beta,this.arcRotateConfig.radius,targetVector,this.scene),this.m_cameraRig.wheelPrecision=this.arcRotateConfig.wheel,this.scene.switchActiveCamera(this.m_cameraRig,!0));_b.label=5;case 5:return this.editorPostProcessing!=null&&this.editorPostProcessing.usePostProcessing===!0&&(PROJECT.UniversalCameraSystem.renderingPipeline=new BABYLON.DefaultRenderingPipeline("UniversalCameraSystem",this.editorPostProcessing.highDynamicRange,this.scene,this.scene.cameras,!0),PROJECT.UniversalCameraSystem.renderingPipeline.isSupported===!0?(defaultPipeline=PROJECT.UniversalCameraSystem.renderingPipeline,defaultPipeline.samples=this.editorPostProcessing.screenAntiAliasing.multiAntiAliasing,defaultPipeline.imageProcessingEnabled=this.editorPostProcessing.imageProcessingConfig.imageProcessing,defaultPipeline.imageProcessingEnabled&&(defaultPipeline.imageProcessing.contrast=this.editorPostProcessing.imageProcessingConfig.imageContrast,defaultPipeline.imageProcessing.exposure=this.editorPostProcessing.imageProcessingConfig.imageExposure,defaultPipeline.imageProcessing.colorGradingEnabled=this.editorPostProcessing.imageProcessingConfig.useColorGrading,defaultPipeline.imageProcessing.colorGradingEnabled&&this.editorPostProcessing.imageProcessingConfig.setGradingTexture!=null&&(colorGradingTexture=BABYLON.Utilities.ParseTexture(this.editorPostProcessing.imageProcessingConfig.setGradingTexture,this.scene,!0,!1),colorGradingTexture.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,colorGradingTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,defaultPipeline.imageProcessing.colorGradingTexture=colorGradingTexture,defaultPipeline.imageProcessing.colorGradingWithGreenDepth=!1),defaultPipeline.imageProcessing.colorCurvesEnabled=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.curvesEnabled,defaultPipeline.imageProcessing.colorCurvesEnabled&&(curve=new BABYLON.ColorCurves,curve.globalDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalDen,curve.globalExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalExp,curve.globalHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalHue,curve.globalSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.globalSat,curve.highlightsDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsDen,curve.highlightsExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsExp,curve.highlightsHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsHue,curve.highlightsSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.highlightsSat,curve.midtonesDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesDen,curve.midtonesExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesExp,curve.midtonesHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesHue,curve.midtonesSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.midtonesSat,curve.shadowsDensity=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsDen,curve.shadowsExposure=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsExp,curve.shadowsHue=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsHue,curve.shadowsSaturation=this.editorPostProcessing.imageProcessingConfig.imagingColorCurves.shadowsSat,defaultPipeline.imageProcessing.colorCurves=curve)),defaultPipeline.bloomEnabled=this.editorPostProcessing.bloomEffectProperties.bloomEnabled,defaultPipeline.bloomEnabled&&(defaultPipeline.bloomKernel=this.editorPostProcessing.bloomEffectProperties.bloomKernel,defaultPipeline.bloomScale=this.editorPostProcessing.bloomEffectProperties.bloomScale,defaultPipeline.bloomWeight=this.editorPostProcessing.bloomEffectProperties.bloomWeight,defaultPipeline.bloomThreshold=this.editorPostProcessing.bloomEffectProperties.bloomThreshold),defaultPipeline.chromaticAberrationEnabled=this.editorPostProcessing.chromaticAberration.aberrationEnabled,defaultPipeline.chromaticAberrationEnabled&&(defaultPipeline.chromaticAberration.aberrationAmount=this.editorPostProcessing.chromaticAberration.aberrationAmount,defaultPipeline.chromaticAberration.adaptScaleToCurrentViewport=this.editorPostProcessing.chromaticAberration.adaptScaleViewport,defaultPipeline.chromaticAberration.alphaMode=this.editorPostProcessing.chromaticAberration.alphaMode,defaultPipeline.chromaticAberration.alwaysForcePOT=this.editorPostProcessing.chromaticAberration.alwaysForcePOT,defaultPipeline.chromaticAberration.enablePixelPerfectMode=this.editorPostProcessing.chromaticAberration.pixelPerfectMode,defaultPipeline.chromaticAberration.forceFullscreenViewport=this.editorPostProcessing.chromaticAberration.fullscreenViewport),defaultPipeline.depthOfFieldEnabled=this.editorPostProcessing.focalDepthOfField.depthOfField,defaultPipeline.depthOfFieldEnabled&&defaultPipeline.depthOfField.isSupported&&(defaultPipeline.depthOfFieldBlurLevel=this.editorPostProcessing.focalDepthOfField.blurLevel,defaultPipeline.depthOfField.fStop=this.editorPostProcessing.focalDepthOfField.focalStop,defaultPipeline.depthOfField.focalLength=this.editorPostProcessing.focalDepthOfField.focalLength,defaultPipeline.depthOfField.focusDistance=this.editorPostProcessing.focalDepthOfField.focusDistance,defaultPipeline.depthOfField.lensSize=this.editorPostProcessing.focalDepthOfField.maxLensSize),defaultPipeline.fxaaEnabled=this.editorPostProcessing.screenAntiAliasing.fullScreenEnabled,defaultPipeline.fxaaEnabled&&(defaultPipeline.fxaa.samples=this.editorPostProcessing.screenAntiAliasing.screenAntiAliasing,defaultPipeline.fxaa.adaptScaleToCurrentViewport=this.editorPostProcessing.screenAntiAliasing.adaptScaleViewport),defaultPipeline.glowLayerEnabled=this.editorPostProcessing.glowLayerProperties.glowEnabled,defaultPipeline.glowLayerEnabled&&(defaultPipeline.glowLayer.intensity=this.editorPostProcessing.glowLayerProperties.glowIntensity,defaultPipeline.glowLayer.blurKernelSize=this.editorPostProcessing.glowLayerProperties.blurKernelSize),defaultPipeline.grainEnabled=this.editorPostProcessing.grainEffectProperties.grainEnabled,defaultPipeline.grainEnabled&&(defaultPipeline.grain.animated=this.editorPostProcessing.grainEffectProperties.grainAnimated,defaultPipeline.grain.intensity=this.editorPostProcessing.grainEffectProperties.grainIntensity,defaultPipeline.grain.adaptScaleToCurrentViewport=this.editorPostProcessing.grainEffectProperties.adaptScaleViewport),defaultPipeline.sharpenEnabled=this.editorPostProcessing.sharpEffectProperties.sharpenEnabled,defaultPipeline.sharpenEnabled&&(defaultPipeline.sharpen.edgeAmount=this.editorPostProcessing.sharpEffectProperties.sharpEdgeAmount,defaultPipeline.sharpen.colorAmount=this.editorPostProcessing.sharpEffectProperties.sharpColorAmount,defaultPipeline.sharpen.adaptScaleToCurrentViewport=this.editorPostProcessing.sharpEffectProperties.adaptScaleViewport)):BABYLON.Tools.Warn("Babylon.js default rendering pipeline not supported")),PROJECT.UniversalCameraSystem.cameraReady=!0,[2]}})})},UniversalCameraSystem.prototype.updateCameraSystemState=function(){this.m_cameraRig!=null&&(this.cameraType===0||this.cameraType===1||this.cameraType===2||this.cameraType===3)},UniversalCameraSystem.prototype.destroyCameraSystemState=function(){this.virtualReality=null},UniversalCameraSystem.GetWebXR=function(){return PROJECT.UniversalCameraSystem.XRExperienceHelper},UniversalCameraSystem.GetPlayerCamera=function(scene,player,detach){player===void 0&&(player=BABYLON.PlayerNumber.One);detach===void 0&&(detach=!1);var result=null;return PROJECT.UniversalCameraSystem.IsCameraSystemReady()&&(player===BABYLON.PlayerNumber.One&&PROJECT.UniversalCameraSystem.PlayerOneCamera!=null?result=PROJECT.UniversalCameraSystem.PlayerOneCamera:player===BABYLON.PlayerNumber.Two&&PROJECT.UniversalCameraSystem.PlayerTwoCamera!=null?result=PROJECT.UniversalCameraSystem.PlayerTwoCamera:player===BABYLON.PlayerNumber.Three&&PROJECT.UniversalCameraSystem.PlayerThreeCamera!=null?result=PROJECT.UniversalCameraSystem.PlayerThreeCamera:player===BABYLON.PlayerNumber.Four&&PROJECT.UniversalCameraSystem.PlayerFourCamera!=null&&(result=PROJECT.UniversalCameraSystem.PlayerFourCamera)),detach===!0&&parent!=null&&(result.parent=null),result},UniversalCameraSystem.GetCameraTransform=function(scene,player){player===void 0&&(player=BABYLON.PlayerNumber.One);var result=null;return PROJECT.UniversalCameraSystem.IsCameraSystemReady()&&(player===BABYLON.PlayerNumber.One&&PROJECT.UniversalCameraSystem.PlayerOneCamera!=null&&PROJECT.UniversalCameraSystem.PlayerOneCamera.transform!=null?result=PROJECT.UniversalCameraSystem.PlayerOneCamera.transform:player===BABYLON.PlayerNumber.Two&&PROJECT.UniversalCameraSystem.PlayerTwoCamera!=null&&PROJECT.UniversalCameraSystem.PlayerTwoCamera.transform!=null?result=PROJECT.UniversalCameraSystem.PlayerTwoCamera.transform:player===BABYLON.PlayerNumber.Three&&PROJECT.UniversalCameraSystem.PlayerThreeCamera!=null&&PROJECT.UniversalCameraSystem.PlayerThreeCamera.transform!=null?result=PROJECT.UniversalCameraSystem.PlayerThreeCamera.transform:player===BABYLON.PlayerNumber.Four&&PROJECT.UniversalCameraSystem.PlayerFourCamera!=null&&PROJECT.UniversalCameraSystem.PlayerFourCamera.transform!=null&&(result=PROJECT.UniversalCameraSystem.PlayerFourCamera.transform)),result},UniversalCameraSystem.IsStereoCameras=function(){return PROJECT.UniversalCameraSystem.stereoCameras},UniversalCameraSystem.IsMultiPlayerView=function(){return PROJECT.UniversalCameraSystem.multiPlayerView},UniversalCameraSystem.GetMultiPlayerCount=function(){return PROJECT.UniversalCameraSystem.multiPlayerCount},UniversalCameraSystem.ActivateMultiPlayerCameras=function(scene){var result=!1;return PROJECT.UniversalCameraSystem.multiPlayerCameras!=null&&PROJECT.UniversalCameraSystem.multiPlayerCameras.length>0&&(scene.activeCameras=PROJECT.UniversalCameraSystem.multiPlayerCameras,result=!0),result},UniversalCameraSystem.DisposeMultiPlayerCameras=function(){PROJECT.UniversalCameraSystem.PlayerOneCamera!=null&&(PROJECT.UniversalCameraSystem.PlayerOneCamera.dispose(),PROJECT.UniversalCameraSystem.PlayerOneCamera=null);PROJECT.UniversalCameraSystem.PlayerTwoCamera!=null&&(PROJECT.UniversalCameraSystem.PlayerTwoCamera.dispose(),PROJECT.UniversalCameraSystem.PlayerTwoCamera=null);PROJECT.UniversalCameraSystem.PlayerThreeCamera!=null&&(PROJECT.UniversalCameraSystem.PlayerThreeCamera.dispose(),PROJECT.UniversalCameraSystem.PlayerThreeCamera=null);PROJECT.UniversalCameraSystem.PlayerFourCamera!=null&&(PROJECT.UniversalCameraSystem.PlayerFourCamera.dispose(),PROJECT.UniversalCameraSystem.PlayerFourCamera=null)},UniversalCameraSystem.SetMultiPlayerViewLayout=function(scene,totalNumPlayers){var result=!1,players=BABYLON.Scalar.Clamp(totalNumPlayers,1,4);return PROJECT.UniversalCameraSystem.IsMultiPlayerView()?(PROJECT.UniversalCameraSystem.PlayerOneCamera!=null&&PROJECT.UniversalCameraSystem.PlayerTwoCamera!=null&&PROJECT.UniversalCameraSystem.PlayerThreeCamera!=null&&PROJECT.UniversalCameraSystem.PlayerFourCamera!=null?(PROJECT.UniversalCameraSystem.multiPlayerCameras=[],players===1?(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,0,1,1),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerOneCamera)):players===2?(PROJECT.UniversalCameraSystem.stereoCameras===!0?(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,0,.5,1),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(.5,0,.5,1)):(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,.5,1,.5),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(0,0,1,.5)),PROJECT.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerOneCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerTwoCamera)):players===3?(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,0,.5,1),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(.5,.5,.5,.5),PROJECT.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(.5,0,.5,.5),PROJECT.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(0,0,0,0),PROJECT.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerOneCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerTwoCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerThreeCamera)):players===4?(PROJECT.UniversalCameraSystem.PlayerOneCamera.viewport=new BABYLON.Viewport(0,.5,.5,.5),PROJECT.UniversalCameraSystem.PlayerTwoCamera.viewport=new BABYLON.Viewport(0,0,.5,.5),PROJECT.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerThreeCamera.viewport=new BABYLON.Viewport(.5,.5,.5,.5),PROJECT.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.PlayerFourCamera.viewport=new BABYLON.Viewport(.5,0,.5,.5),PROJECT.UniversalCameraSystem.PlayerFourCamera.setEnabled(!0),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerOneCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerTwoCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerThreeCamera),PROJECT.UniversalCameraSystem.multiPlayerCameras.push(PROJECT.UniversalCameraSystem.PlayerFourCamera)):BABYLON.Tools.Warn("Babylon.js camera rig invalid player count specified: "+players)):BABYLON.Tools.Warn("Babylon.js camera rig failed to initialize multi player cameras"),PROJECT.UniversalCameraSystem.multiPlayerCount=players,result=PROJECT.UniversalCameraSystem.ActivateMultiPlayerCameras(scene),result===!1&&BABYLON.Tools.Warn("Babylon.js camera rig failed to initialize multi player views")):BABYLON.Tools.Warn("Babylon.js camera rig multi player view option not enabled"),result},UniversalCameraSystem.PlayerOneCamera=null,UniversalCameraSystem.PlayerTwoCamera=null,UniversalCameraSystem.PlayerThreeCamera=null,UniversalCameraSystem.PlayerFourCamera=null,UniversalCameraSystem.XRExperienceHelper=null,UniversalCameraSystem.multiPlayerView=!1,UniversalCameraSystem.multiPlayerCount=1,UniversalCameraSystem.multiPlayerCameras=null,UniversalCameraSystem.stereoCameras=!0,UniversalCameraSystem.startupMode=1,UniversalCameraSystem.cameraReady=!1,UniversalCameraSystem.renderingPipeline=null,UniversalCameraSystem}(BABYLON.ScriptComponent);PROJECT.UniversalCameraSystem=UniversalCameraSystem})(PROJECT||(PROJECT={})),function(PROJECT){var DebugInformation=function(_super){function DebugInformation(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.keys=!0,_this.show=!0,_this.popup=!1,_this.views=!1,_this.xbox=!1,_this.color=BABYLON.Color3.Green(),_this}return __extends(DebugInformation,_super),DebugInformation.prototype.awake=function(){this.keys=this.getProperty("enableDebugKeys",this.keys);this.show=this.getProperty("showDebugLabels",this.show);this.popup=this.getProperty("popupDebugPanel",this.popup);this.views=this.getProperty("togglePlayerViews",this.views);this.xbox=this.getProperty("allowXboxLiveSignIn",this.xbox);var debugLabelColor=this.getProperty("debugOutputTextColor");debugLabelColor!=null&&(this.color=BABYLON.Utilities.ParseColor3(debugLabelColor));BABYLON.SceneManager.IsWindows()&&(this.popup=!1);console.log("Debug information overlay loaded")},DebugInformation.prototype.start=function(){var _this=this,printColor,graphicsVersion;this.show===!0;this.keys===!0&&(this.views===!0&&(console.log("Enable Multiplayer Keys"),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num1,function(){PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(_this.scene,1);console.log("1 player pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num2,function(){PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(_this.scene,2);console.log("2 players pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num3,function(){PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(_this.scene,3);console.log("3 players pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num4,function(){PROJECT.UniversalCameraSystem.SetMultiPlayerViewLayout(_this.scene,4);console.log("4 players pressed")})),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.R,function(){window.location.reload()}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.I,function(){_this.popup===!0?BABYLON.SceneManager.PopupDebug(_this.scene):BABYLON.SceneManager.ToggleDebug(_this.scene,!0,null)}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.F,function(){}));printColor=this.scene.getEngine().webGLVersion<2?"red":this.color.toHexString();graphicsVersion=BABYLON.SceneManager.GetWebGLVersionString(this.scene);BABYLON.Utilities.PrintToScreen(graphicsVersion,printColor)},DebugInformation.prototype.destroy=function(){},DebugInformation}(BABYLON.ScriptComponent);PROJECT.DebugInformation=DebugInformation}(PROJECT||(PROJECT={})),function(PROJECT){var TestNavigationAgent=function(_super){function TestNavigationAgent(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.m_playerAgent=null,_this}return __extends(TestNavigationAgent,_super),TestNavigationAgent.prototype.start=function(){var _this=this;this.doPointerCancel();this.scene.onPointerObservable.add(function(pointerInfo){switch(pointerInfo.type){case BABYLON.PointerEventTypes.POINTERDOWN:pointerInfo.pickInfo.hit&&_this.doPointerDown(pointerInfo)}});this.m_playerAgent=this.getComponent("BABYLON.NavigationAgent");this.m_playerAgent!=null?BABYLON.Tools.Log("Test navigation mesh agent for: "+this.transform.name):BABYLON.Tools.Warn("Failed to locate test nav mesh agent for: "+this.transform.name)},TestNavigationAgent.prototype.doPointerCancel=function(){var canvas=this.scene.getEngine().getRenderingCanvas();canvas.oncontextmenu=function(e){e.preventDefault()}},TestNavigationAgent.prototype.doPointerDown=function(pointerInfo){var pickinfo=this.scene.pick(this.scene.pointerX,this.scene.pointerY);pickinfo.hit&&this.m_playerAgent!=null&&(pointerInfo.event.button===0?this.m_playerAgent.setDestination(pickinfo.pickedPoint):this.m_playerAgent.teleport(pickinfo.pickedPoint))},TestNavigationAgent}(BABYLON.ScriptComponent);PROJECT.TestNavigationAgent=TestNavigationAgent}(PROJECT||(PROJECT={})),function(PROJECT){var UniversalPlayerController=function(_super){function UniversalPlayerController(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.enableInput=!1,_this.attachCamera=!1,_this.rotateCamera=!0,_this.moveCharacter=!0,_this.toggleView=!0,_this.freeLooking=!1,_this.rootMotion=!1,_this.gravityForce=.5,_this.slopeForce=0,_this.rayLength=1,_this.rayOrigin=0,_this.maxAngle=45,_this.speedFactor=1,_this.moveSpeed=5,_this.lookSpeed=2,_this.jumpSpeed=8,_this.jumpDelay=0,_this.eyesHeight=.25,_this.pivotHeight=.25,_this.topLookLimit=60,_this.downLookLimit=30,_this.lowTurnSpeed=15,_this.highTurnSpeed=25,_this.takeoffPower=2.5,_this.stoppingPower=5,_this.acceleration=!1,_this.avatarSkinTag="Skin",_this.distanceFactor=.85,_this.cameraSmoothing=5,_this.cameraCollisions=!0,_this.inputMagnitude=0,_this.minimumDistance=.85,_this.buttonJump=BABYLON.Xbox360Button.A,_this.keyboardJump=BABYLON.UserInputKey.SpaceBar,_this.buttonCamera=BABYLON.Xbox360Button.Y,_this.keyboardCamera=BABYLON.UserInputKey.P,_this.playerNumber=BABYLON.PlayerNumber.One,_this.boomPosition=new BABYLON.Vector3(0,0,0),_this.movementVelocity=BABYLON.Vector3.Zero(),_this.abstractMesh=null,_this.cameraDistance=0,_this.forwardCamera=!1,_this.dollyDirection=BABYLON.Vector3.Zero(),_this.rotationEulers=BABYLON.Vector3.Zero(),_this.cameraPivotOffset=BABYLON.Vector3.Zero(),_this.cameraForwardVector=new BABYLON.Vector3(0,0,0),_this.cameraRightVector=new BABYLON.Vector3(0,0,0),_this.desiredForwardVector=new BABYLON.Vector3(0,0,0),_this.desiredRightVector=new BABYLON.Vector3(0,0,0),_this.scaledCamDirection=BABYLON.Vector3.Zero(),_this.scaledMaxDirection=BABYLON.Vector3.Zero(),_this.parentNodePosition=BABYLON.Vector3.Zero(),_this.maximumCameraPos=BABYLON.Vector3.Zero(),_this.raycastShape=null,_this.raycastGroup=BABYLON.CollisionFilters.DefaultFilter,_this.raycastMask=BABYLON.CollisionFilters.AllFilter^BABYLON.CollisionFilters.CharacterFilter,_this.avatarSkins=null,_this.cameraNode=null,_this.cameraPivot=null,_this.navigationAgent=null,_this.characterController=null,_this.isCharacterNavigating=!1,_this.isCharacterGrounded=!1,_this.isCharacterJumpFrame=!1,_this.isCharacterJumpState=!1,_this.navigationAngularSpeed=0,_this.animationControllerTag="Animator",_this.animationStateMachine=!1,_this.animationStateParams=null,_this.showDebugColliders=!1,_this.colliderVisibility=0,_this.deltaTime=0,_this.jumpTimer=0,_this.playerControl=0,_this.playerInputX=0,_this.playerInputZ=0,_this.playerMouseX=0,_this.playerMouseY=0,_this.groundedMesh=null,_this.groundedPoint=null,_this.groundedAngle=0,_this.groundedNormal=null,_this.verticalVelocity=0,_this.rootmotionSpeed=0,_this.smoothDeltaTime=0,_this.animationState=null,_this.inputMovementVector=BABYLON.Vector3.Zero(),_this.playerLookRotation=BABYLON.Vector3.Zero(),_this.playerRotationVector=BABYLON.Vector2.Zero(),_this.playerMovementVelocity=BABYLON.Vector3.Zero(),_this.playerRotationQuaternion=BABYLON.Quaternion.Zero(),_this.onPreUpdateObservable=new BABYLON.Observable,_this.onBeforeMoveObservable=new BABYLON.Observable,_this.onPostUpdateObservable=new BABYLON.Observable,_this.pickingRay=null,_this.pickingHelper=null,_this.pickingOrigin=null,_this.pickingDirection=new BABYLON.Vector3(0,-1,0),_this.cameraRay=null,_this.cameraHelper=null,_this.cameraForward=new BABYLON.Vector3(0,0,0),_this.cameraDirection=new BABYLON.Vector3(0,0,0),_this}return __extends(UniversalPlayerController,_super),UniversalPlayerController.prototype.getPlayerInputX=function(){return this.playerInputX},UniversalPlayerController.prototype.getPlayerInputZ=function(){return this.playerInputZ},UniversalPlayerController.prototype.getPlayerMouseX=function(){return this.playerMouseX},UniversalPlayerController.prototype.getPlayerMouseY=function(){return this.playerMouseY},UniversalPlayerController.prototype.getPlayerJumping=function(){return this.isCharacterJumpState},UniversalPlayerController.prototype.getPlayerGrounded=function(){return this.isCharacterGrounded},UniversalPlayerController.prototype.getGroundedMesh=function(){return this.groundedMesh},UniversalPlayerController.prototype.getGroundedPoint=function(){return this.groundedPoint},UniversalPlayerController.prototype.getGroundedAngle=function(){return this.groundedAngle},UniversalPlayerController.prototype.getGroundedNormal=function(){return this.groundedNormal},UniversalPlayerController.prototype.getCameraBoomNode=function(){return this.cameraNode},UniversalPlayerController.prototype.getCameraTransform=function(){return this.cameraPivot},UniversalPlayerController.prototype.getAnimationState=function(){return this.animationState},UniversalPlayerController.prototype.getCharacterController=function(){return this.characterController},UniversalPlayerController.prototype.awake=function(){this.awakePlayerController()},UniversalPlayerController.prototype.start=function(){this.startPlayerController()},UniversalPlayerController.prototype.update=function(){this.updatePlayerController()},UniversalPlayerController.prototype.late=function(){this.latePlayerController()},UniversalPlayerController.prototype.after=function(){this.afterPlayerController()},UniversalPlayerController.prototype.destroy=function(){this.destroyPlayerController()},UniversalPlayerController.prototype.setPlayerControl=function(mode){this.playerControl=mode;this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing||this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward?this.showAvatarSkins(!0):this.showAvatarSkins(!1);this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward?this.forwardCamera=!0:this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing&&(this.forwardCamera=!1)},UniversalPlayerController.prototype.togglePlayerControl=function(){this.toggleView===!0&&(this.playerControl===PROJECT.PlayerInputControl.FirstPersonStrafing?this.forwardCamera===!0?this.setPlayerControl(PROJECT.PlayerInputControl.ThirdPersonForward):this.setPlayerControl(PROJECT.PlayerInputControl.ThirdPersonStrafing):this.setPlayerControl(PROJECT.PlayerInputControl.FirstPersonStrafing))},UniversalPlayerController.prototype.showAvatarSkins=function(show){this.avatarSkins!=null&&this.avatarSkins.forEach(function(skin){skin.isVisible=show})},UniversalPlayerController.prototype.attachPlayerCamera=function(player){if(this.cameraNode==null){var playerCamera=player<=0||player>4?1:player;this.cameraNode=PROJECT.UniversalCameraSystem.GetCameraTransform(this.scene,playerCamera);this.cameraNode!=null?(this.cameraNode.parent=this.cameraPivot,this.cameraNode.position.copyFrom(this.boomPosition),this.cameraNode.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),this.cameraDistance=this.cameraNode.position.length(),this.dollyDirection.copyFrom(this.cameraNode.position),this.dollyDirection.normalize()):BABYLON.Tools.Warn("Failed to locate player camera for: "+this.transform.name)}},UniversalPlayerController.prototype.attachAnimationController=function(){if(this.animationState==null&&this.animationControllerTag!=null&&this.animationControllerTag!==""){var botmesh=null;botmesh=this.hasTransformTags(this.animationControllerTag)?this.transform:this.getChildWithTags(this.animationControllerTag,!1);botmesh!=null?this.animationState=BABYLON.SceneManager.FindScriptComponent(botmesh,"BABYLON.AnimationState"):BABYLON.Tools.Warn("Failed to locate bot mesh with tag: "+this.animationControllerTag)}},UniversalPlayerController.prototype.resetPlayerRotation=function(){this.transform.rotationQuaternion.toEulerAnglesToRef(this.rotationEulers);this.playerRotationVector.x=this.rotationEulers.x;this.playerRotationVector.y=this.rotationEulers.y},UniversalPlayerController.prototype.awakePlayerController=function(){var _this=this,boomPositionData,sphereRadius,pcontrol,testPivot;if(this.gravityForce=this.getProperty("gravityForce",this.gravityForce),this.rotateCamera=this.getProperty("rotateCamera",this.rotateCamera),this.moveCharacter=this.getProperty("moveCharacter",this.moveCharacter),this.slopeForce=this.getProperty("slopeForce",this.slopeForce),this.rayLength=this.getProperty("rayLength",this.rayLength),this.rayOrigin=this.getProperty("rayOrigin",this.rayOrigin),this.maxAngle=this.getProperty("maxAngle",this.maxAngle),this.speedFactor=this.getProperty("speedFactor",this.speedFactor),this.moveSpeed=this.getProperty("moveSpeed",this.moveSpeed),this.lookSpeed=this.getProperty("lookSpeed",this.lookSpeed),this.jumpSpeed=this.getProperty("jumpSpeed",this.jumpSpeed),this.jumpDelay=this.getProperty("jumpDelay",this.jumpDelay),this.eyesHeight=this.getProperty("eyesHeight",this.eyesHeight),this.pivotHeight=this.getProperty("pivotHeight",this.pivotHeight),this.topLookLimit=this.getProperty("topLookLimit",this.topLookLimit),this.downLookLimit=this.getProperty("downLookLimit",this.downLookLimit),this.lowTurnSpeed=this.getProperty("lowTurnSpeed",this.lowTurnSpeed),this.highTurnSpeed=this.getProperty("highTurnSpeed",this.highTurnSpeed),this.enableInput=this.getProperty("enableInput",this.enableInput),this.rootMotion=this.getProperty("rootMotion",this.rootMotion),this.playerNumber=this.getProperty("playerNumber",this.playerNumber),this.attachCamera=this.getProperty("attachCamera",this.attachCamera),this.freeLooking=this.getProperty("freeLooking",this.freeLooking),this.toggleView=this.getProperty("toggleView",this.toggleView),this.avatarSkinTag=this.getProperty("avatarSkinTag",this.avatarSkinTag),this.cameraCollisions=this.getProperty("cameraCollisions",this.cameraCollisions),this.cameraSmoothing=this.getProperty("cameraSmoothing",this.cameraSmoothing),this.distanceFactor=this.getProperty("distanceFactor",this.distanceFactor),this.minimumDistance=this.getProperty("minimumDistance",this.minimumDistance),this.stoppingPower=this.getProperty("stoppingPower",this.stoppingPower),this.takeoffPower=this.getProperty("takeoffPower",this.takeoffPower),this.acceleration=this.getProperty("acceleration",this.acceleration),this.animationControllerTag=this.getProperty("animationControllerTag",this.animationControllerTag),this.animationStateMachine=this.getProperty("animationStateMachine",this.animationStateMachine),this.animationStateParams=this.getProperty("animationStateParams",this.animationStateParams),boomPositionData=this.getProperty("boomPosition"),boomPositionData!=null&&(this.boomPosition=BABYLON.Utilities.ParseVector3(boomPositionData)),sphereRadius=this.getProperty("sphereRadius",.5),this.raycastShape=BABYLON.SceneManager.CreatePhysicsSphereShape(sphereRadius),this.abstractMesh=this.getAbstractMesh(),this.showDebugColliders=BABYLON.Utilities.ShowDebugColliders(),this.colliderVisibility=BABYLON.Utilities.ColliderVisibility(),this.avatarSkinTag!=null&&this.avatarSkinTag!==""&&(this.avatarSkins=this.getChildrenWithTags(this.avatarSkinTag,!1)),pcontrol=this.getProperty("playerControl",this.playerControl),this.setPlayerControl(pcontrol),this.resetPlayerRotation(),this.cameraPivot=new BABYLON.Mesh(this.transform.name+".CameraPivot",this.scene),this.cameraPivot.parent=null,this.cameraPivot.position=this.transform.position.clone(),this.cameraPivot.rotationQuaternion=this.transform.rotationQuaternion.clone(),this.cameraPivot.checkCollisions=!1,this.cameraPivot.isPickable=!1,this.showDebugColliders===!0&&(testPivot=BABYLON.MeshBuilder.CreateBox("TestPivot",{width:.25,height:.25,depth:.5},this.scene),testPivot.parent=this.cameraPivot,testPivot.position.set(0,0,0),testPivot.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),testPivot.visibility=.5,testPivot.checkCollisions=!1,testPivot.isPickable=!1),BABYLON.SceneManager.OnKeyboardPress(this.keyboardCamera,function(){_this.togglePlayerControl()}),BABYLON.SceneManager.OnGamepadButtonPress(this.buttonCamera,function(){_this.togglePlayerControl()}),this.navigationAgent=this.getComponent("BABYLON.NavigationAgent"),this.characterController=this.getComponent("BABYLON.CharacterController"),this.characterController!=null?BABYLON.Tools.Warn("Starting player controller in physic engine mode for: "+this.transform.name):BABYLON.Tools.Warn("Starting player controller in check collisions mode for: "+this.transform.name),this.characterController==null&&this.abstractMesh!=null&&(this.abstractMesh.checkCollisions=!0,this.abstractMesh.isPickable=!0,this.showDebugColliders===!0&&this.transform._debugCollider==null)){var capsuleSize=this.abstractMesh.ellipsoid.clone(),debugName=this.transform.name+".Debug",debugCapsule=BABYLON.MeshBuilder.CreateSphere(debugName,{segments:16,diameterX:capsuleSize.x*2,diameterY:capsuleSize.y*2,diameterZ:capsuleSize.z*2},this.scene);debugCapsule.position.set(0,0,0);debugCapsule.rotationQuaternion=this.transform.rotationQuaternion.clone();debugCapsule.setParent(this.transform);debugCapsule.position.set(0,0,0);debugCapsule.visibility=this.colliderVisibility;debugCapsule.material=BABYLON.Utilities.GetColliderMaterial(this.scene);debugCapsule.checkCollisions=!1;debugCapsule.isPickable=!1;this.transform._debugCollider=debugCapsule}},UniversalPlayerController.prototype.startPlayerController=function(){this.attachCamera===!0&&this.attachPlayerCamera(this.playerNumber)},UniversalPlayerController.prototype.updatePlayerController=function(){var movementSpeed,locomotionSpeed,strafingTurnRatio,strafingTurnSpeed,forwardTurnRatio,forwardTurnSpeed,playerMovementLength,finalMovementLength;(this.animationStateMachine===!0&&this.attachAnimationController(),this.deltaTime=this.getDeltaSeconds(),this.smoothDeltaTime=BABYLON.System.SmoothDeltaFactor*this.deltaTime+(1-BABYLON.System.SmoothDeltaFactor)*this.smoothDeltaTime,this.jumpTimer>0&&(this.jumpTimer-=this.deltaTime,this.jumpTimer<0&&(this.jumpTimer=0)),this.enableInput!==!1)&&(this.playerInputX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Horizontal,this.playerNumber),this.playerInputZ=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Vertical,this.playerNumber),this.playerMouseX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseX,this.playerNumber),this.playerMouseY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseY,this.playerNumber),this.inputMovementVector.set(this.playerInputX,0,this.playerInputZ),BABYLON.Utilities.ClampMagnitudeVector3ToRef(this.inputMovementVector,1,this.inputMovementVector),this.inputMagnitude=this.inputMovementVector.length(),this.onPreUpdateObservable.hasObservers()===!0&&this.onPreUpdateObservable.notifyObservers(this.transform),this.cameraForwardVector.copyFrom(this.cameraPivot.forward),this.cameraForwardVector.y=0,this.cameraForwardVector.normalize(),this.cameraForwardVector.scaleToRef(this.playerInputZ,this.desiredForwardVector),this.cameraRightVector.copyFrom(this.cameraPivot.right),this.cameraRightVector.y=0,this.cameraRightVector.normalize(),this.cameraRightVector.scaleToRef(this.playerInputX,this.desiredRightVector),this.playerRotationVector.y+=this.playerMouseX*this.lookSpeed*this.deltaTime,this.playerRotationVector.x+=-this.playerMouseY*this.lookSpeed*this.deltaTime,this.playerRotationVector.x=BABYLON.Scalar.Clamp(this.playerRotationVector.x,-BABYLON.Tools.ToRadians(this.downLookLimit),BABYLON.Tools.ToRadians(this.topLookLimit)),movementSpeed=this.inputMagnitude*this.moveSpeed*this.deltaTime*this.speedFactor,locomotionSpeed=this.rootmotionSpeed*this.speedFactor,this.playerControl===PROJECT.PlayerInputControl.FirstPersonStrafing?(this.desiredForwardVector.addToRef(this.desiredRightVector,this.playerMovementVelocity),this.rootMotion===!0?this.playerMovementVelocity.scaleInPlace(locomotionSpeed):this.playerMovementVelocity.scaleInPlace(movementSpeed),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.playerRotationVector.y,0,this.transform.rotationQuaternion)):this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing?(this.desiredForwardVector.addToRef(this.desiredRightVector,this.playerMovementVelocity),this.rootMotion===!0?this.playerMovementVelocity.scaleInPlace(locomotionSpeed):this.playerMovementVelocity.scaleInPlace(movementSpeed),this.freeLooking===!0?this.inputMagnitude>0&&(strafingTurnRatio=this.playerMovementVelocity.length()/this.moveSpeed,strafingTurnSpeed=BABYLON.Scalar.Lerp(this.highTurnSpeed,this.lowTurnSpeed,strafingTurnRatio),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.playerRotationVector.y,0,this.playerRotationQuaternion),BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.playerRotationQuaternion,strafingTurnSpeed*this.deltaTime,this.transform.rotationQuaternion)):BABYLON.Quaternion.FromEulerAnglesToRef(0,this.playerRotationVector.y,0,this.transform.rotationQuaternion)):this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward&&(this.desiredForwardVector.addToRef(this.desiredRightVector,this.playerLookRotation),this.rootMotion===!0?this.transform.forward.scaleToRef(locomotionSpeed,this.playerMovementVelocity):this.transform.forward.scaleToRef(movementSpeed,this.playerMovementVelocity),this.inputMagnitude>0&&(forwardTurnRatio=this.playerMovementVelocity.length()/this.moveSpeed,forwardTurnSpeed=BABYLON.Scalar.Lerp(this.highTurnSpeed,this.lowTurnSpeed,forwardTurnRatio),BABYLON.Utilities.LookRotationToRef(this.playerLookRotation,this.playerRotationQuaternion),BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.playerRotationQuaternion,forwardTurnSpeed*this.deltaTime,this.transform.rotationQuaternion))),this.acceleration===!0?(this.takeoffPower<.1&&(this.takeoffPower=.1),this.stoppingPower<.1&&(this.stoppingPower=.1),BABYLON.Vector3.LerpToRef(this.movementVelocity,this.playerMovementVelocity,this.takeoffPower*this.smoothDeltaTime,this.movementVelocity),playerMovementLength=this.playerMovementVelocity.length(),finalMovementLength=this.movementVelocity.length(),playerMovementLength===0&&finalMovementLength>0&&finalMovementLength<this.stoppingPower*.01&&this.movementVelocity.copyFrom(this.playerMovementVelocity)):this.movementVelocity.copyFrom(this.playerMovementVelocity),this.isCharacterGrounded=!0,this.isCharacterJumpFrame=!1,this.isCharacterNavigating=this.navigationAgent!=null&&this.navigationAgent.isNavigating(),this.navigationAngularSpeed=this.navigationAgent!=null?this.navigationAgent.angularSpeed:0,this.characterController!=null?this.updateCharacterController():this.updateCheckCollisions(),this.animationState!=null&&this.animationStateMachine===!0&&(this.validateAnimationStateParams(),this.animationState.setFloat(this.animationStateParams.horizontalInput,this.playerInputX),this.animationState.setFloat(this.animationStateParams.verticalInput,this.playerInputZ),this.animationState.setFloat(this.animationStateParams.mouseXInput,this.playerMouseX),this.animationState.setFloat(this.animationStateParams.mouseYInput,this.playerMouseY),this.animationState.setFloat(this.animationStateParams.speedInput,this.inputMagnitude),this.animationState.setBool(this.animationStateParams.jumpedInput,this.isCharacterJumpFrame),this.animationState.setBool(this.animationStateParams.jumpingInput,this.isCharacterJumpState),this.animationState.setBool(this.animationStateParams.groundedInput,this.isCharacterGrounded),this.isCharacterNavigating===!0),this.onPostUpdateObservable.hasObservers()===!0&&this.onPostUpdateObservable.notifyObservers(this.transform))},UniversalPlayerController.prototype.updateCharacterController=function(){this.moveCharacter===!0&&this.characterController!=null&&(this.isCharacterGrounded=this.characterController.isGrounded(),this.groundedMesh=null,this.groundedPoint=null,this.groundedNormal=null,this.groundedAngle=this.groundedNormal!=null?Math.abs(BABYLON.Utilities.GetAngle(this.groundedNormal,this.transform.forward)-90):0,this.isCharacterNavigating===!1?this.isCharacterGrounded===!0&&(this.isCharacterJumpState===!0&&(this.jumpDelay>0&&(this.jumpTimer=this.jumpDelay+this.deltaTime),this.isCharacterJumpState=!1),this.jumpTimer<=0&&(this.isCharacterJumpFrame=BABYLON.SceneManager.GetKeyboardInput(this.keyboardJump)||BABYLON.SceneManager.GetGamepadButtonInput(this.buttonJump)),this.isCharacterJumpFrame===!0&&(this.isCharacterJumpState=!0,this.characterController.jump(this.jumpSpeed)),this.onBeforeMoveObservable.hasObservers()===!0&&this.onBeforeMoveObservable.notifyObservers(this.transform),this.characterController.move(this.movementVelocity)):this.characterController.setGhostWorldPosition(this.transform.position))},UniversalPlayerController.prototype.updateCheckCollisions=function(){var pick,slopeFactor;this.moveCharacter===!0&&this.abstractMesh!=null&&(pick=this.pickCheckCollisionsRaycast(),this.isCharacterGrounded=pick!=null&&pick.hit,this.groundedMesh=pick!=null&&pick.hit?pick.pickedMesh:null,this.groundedPoint=pick!=null&&pick.hit?pick.pickedPoint:null,this.groundedNormal=pick!=null&&pick.hit?pick.getNormal(!0):null,this.groundedAngle=this.groundedNormal!=null?Math.abs(BABYLON.Utilities.GetAngle(this.groundedNormal,this.transform.forward)-90):0,this.gravityForce>0&&(this.verticalVelocity-=this.deltaTime*this.gravityForce),this.isCharacterNavigating===!1&&(this.isCharacterGrounded===!0&&(slopeFactor=this.maxAngle>0&&this.groundedAngle>0&&this.groundedAngle<this.maxAngle?0:this.slopeForce,this.verticalVelocity=Math.max(-slopeFactor,this.verticalVelocity),this.isCharacterJumpState===!0&&(this.jumpDelay>0&&(this.jumpTimer=this.jumpDelay+this.deltaTime),this.isCharacterJumpState=!1),this.jumpTimer<=0&&(this.isCharacterJumpFrame=BABYLON.SceneManager.GetKeyboardInput(this.keyboardJump)||BABYLON.SceneManager.GetGamepadButtonInput(this.buttonJump)),this.isCharacterJumpFrame===!0&&(this.isCharacterJumpState=!0,this.verticalVelocity=this.jumpSpeed*.015)),this.movementVelocity.y=this.verticalVelocity,this.onBeforeMoveObservable.hasObservers()===!0&&this.onBeforeMoveObservable.notifyObservers(this.transform),this.abstractMesh.moveWithCollisions(this.movementVelocity)))},UniversalPlayerController.prototype.pickCheckCollisionsRaycast=function(fastCheck){var _this=this,raycastLength;return(fastCheck===void 0&&(fastCheck=!0),this.abstractMesh==null)?null:(this.rayLength<=0&&(this.rayLength=.1),raycastLength=this.rayLength/this.transform.scaling.y+.05,this.pickingRay==null&&(this.pickingOrigin==null&&(this.pickingOrigin=new BABYLON.Vector3(0,this.rayOrigin,0)),this.pickingRay=new BABYLON.Ray(this.pickingOrigin,this.pickingDirection,raycastLength)),this.pickingHelper==null&&(this.pickingHelper=new BABYLON.RayHelper(this.pickingRay),this.pickingOrigin==null&&(this.pickingOrigin=new BABYLON.Vector3(0,this.rayOrigin,0)),this.pickingHelper.attachToMesh(this.abstractMesh,this.pickingDirection,this.pickingOrigin,raycastLength),this.showDebugColliders===!0&&this.pickingHelper.show(this.scene,new BABYLON.Color3(1,0,0))),this.pickingRay!=null?this.scene.pickWithRay(this.pickingRay,function(mesh){return mesh!=_this.abstractMesh&&mesh.checkCollisions===!0},fastCheck):null)},UniversalPlayerController.prototype.pickCameraCollisionsRaycast=function(origin,direction,rayLength,fastCheck){var _this=this;return(fastCheck===void 0&&(fastCheck=!0),this.abstractMesh==null)?null:(this.cameraRay==null&&(this.cameraRay=new BABYLON.Ray(origin,direction,rayLength)),this.cameraRay!=null&&(this.cameraRay.origin.copyFrom(origin),this.cameraRay.direction.copyFrom(direction),this.cameraRay.length=rayLength),this.cameraHelper==null&&(this.cameraHelper=new BABYLON.RayHelper(this.cameraRay),this.showDebugColliders===!0&&this.cameraHelper.show(this.scene,new BABYLON.Color3(1,0,0))),this.cameraRay!=null?this.scene.pickWithRay(this.cameraRay,function(mesh){return mesh!=_this.abstractMesh&&mesh.checkCollisions===!0},fastCheck):null)},UniversalPlayerController.prototype.latePlayerController=function(){var allowRotation,maxDistance,parentNode,contact,distance,raycast,pick;this.enableInput!==!1&&(allowRotation=this.rotateCamera,this.cameraPivot!=null&&(this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing||this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward?this.cameraPivotOffset.set(0,this.pivotHeight,0):this.cameraPivotOffset.set(0,this.eyesHeight,0),BABYLON.Utilities.GetAbsolutePositionToRef(this.transform,this.cameraPivot.position,this.cameraPivotOffset),allowRotation===!0&&BABYLON.Quaternion.FromEulerAnglesToRef(this.playerRotationVector.x,this.playerRotationVector.y,0,this.cameraPivot.rotationQuaternion)),allowRotation===!0&&this.cameraNode!=null&&(this.cameraSmoothing<=0&&(this.cameraSmoothing=5),this.playerControl===PROJECT.PlayerInputControl.ThirdPersonStrafing||this.playerControl===PROJECT.PlayerInputControl.ThirdPersonForward?this.cameraCollisions===!0?(maxDistance=Math.abs(this.boomPosition.z),parentNode=this.cameraNode.parent,this.dollyDirection.scaleToRef(maxDistance,this.scaledMaxDirection),this.dollyDirection.scaleToRef(this.cameraDistance,this.scaledCamDirection),BABYLON.Utilities.GetAbsolutePositionToRef(parentNode,this.parentNodePosition),BABYLON.Utilities.TransformPointToRef(parentNode,this.scaledMaxDirection,this.maximumCameraPos),contact=!1,distance=0,this.characterController!=null?(raycast=BABYLON.SceneManager.PhysicsShapecastToPoint(this.scene,this.raycastShape,this.parentNodePosition,this.maximumCameraPos,this.raycastGroup,this.raycastMask),contact=raycast!=null&&raycast.hasHit===!0&&raycast.collisionObject!=null&&raycast.collisionObject.entity!=null,distance=raycast!=null&&raycast.hasHit===!0?raycast.hitDistance:0):(this.cameraForward.set(0,0,-1),BABYLON.Utilities.TransformPointToRef(parentNode,this.cameraForward,this.cameraForward),this.cameraForward.subtractToRef(this.parentNodePosition,this.cameraDirection),this.cameraDirection.normalize(),pick=this.pickCameraCollisionsRaycast(this.parentNodePosition,this.cameraDirection,this.maximumCameraPos.length()),contact=pick!=null&&pick.hit,distance=pick!=null&&pick.distance),contact===!0?(this.cameraDistance=BABYLON.Scalar.Clamp(distance*this.distanceFactor,this.minimumDistance,maxDistance),(this.cameraNode.position.x!==this.scaledCamDirection.x||this.cameraNode.position.y!==this.scaledCamDirection.y||this.cameraNode.position.z!==this.scaledCamDirection.z)&&BABYLON.Vector3.LerpToRef(this.cameraNode.position,this.scaledCamDirection,this.deltaTime*this.cameraSmoothing,this.cameraNode.position)):(this.cameraNode.position.x!==this.boomPosition.x||this.cameraNode.position.y!==this.boomPosition.y||this.cameraNode.position.z!==this.boomPosition.z)&&BABYLON.Vector3.LerpToRef(this.cameraNode.position,this.boomPosition,this.deltaTime*this.cameraSmoothing,this.cameraNode.position)):(this.cameraNode.position.x!==this.boomPosition.x||this.cameraNode.position.y!==this.boomPosition.y||this.cameraNode.position.z!==this.boomPosition.z)&&BABYLON.Vector3.LerpToRef(this.cameraNode.position,this.boomPosition,this.deltaTime*this.cameraSmoothing,this.cameraNode.position):(this.cameraNode.position.x!==0||this.cameraNode.position.y!==0||this.cameraNode.position.z!==0)&&this.cameraNode.position.set(0,0,0)))},UniversalPlayerController.prototype.afterPlayerController=function(){this.enableInput!==!1&&(this.rootmotionSpeed=0,this.animationState!=null&&this.animationStateMachine===!0&&(this.rootmotionSpeed=this.animationState.getRootMotionSpeed()))},UniversalPlayerController.prototype.destroyPlayerController=function(){this.cameraPivot=null;this.cameraNode=null;this.animationState=null;this.characterController=null;this.onPreUpdateObservable.clear();this.onPreUpdateObservable=null;this.onBeforeMoveObservable.clear();this.onBeforeMoveObservable=null;this.onPostUpdateObservable.clear();this.onPostUpdateObservable=null},UniversalPlayerController.prototype.validateAnimationStateParams=function(){this.animationStateParams==null&&(this.animationStateParams={horizontalInput:"Horizontal",verticalInput:"Vertical",mouseXInput:"MouseX",mouseYInput:"MouseY",speedInput:"Speed",jumpedInput:"Jumped",jumpingInput:"Jumping",groundedInput:"Grounded"})},UniversalPlayerController}(BABYLON.ScriptComponent),PlayerInputControl;PROJECT.UniversalPlayerController=UniversalPlayerController,function(PlayerInputControl){PlayerInputControl[PlayerInputControl.FirstPersonStrafing=0]="FirstPersonStrafing";PlayerInputControl[PlayerInputControl.ThirdPersonStrafing=1]="ThirdPersonStrafing";PlayerInputControl[PlayerInputControl.ThirdPersonForward=2]="ThirdPersonForward"}(PlayerInputControl=PROJECT.PlayerInputControl||(PROJECT.PlayerInputControl={}))}(PROJECT||(PROJECT={})),function(PROJECT){var FxParticleSystem=function(_super){function FxParticleSystem(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.m_particleEmitter=null,_this.m_particleSystem=null,_this}return __extends(FxParticleSystem,_super),FxParticleSystem.prototype.getParticleEmitter=function(){return this.m_particleEmitter},FxParticleSystem.prototype.getParticleSystem=function(){return this.m_particleSystem},FxParticleSystem.prototype.awake=function(){var rootUrl=BABYLON.SceneManager.GetRootUrl(this.scene),classType=this.getProperty("classType",0),particleText=this.getProperty("base64ParticleSystem"),playOnAwake=this.getProperty("playOnAwake",!1),particleTexture=this.getProperty("particleTexture"),particleJson,particleParsed;this.m_particleEmitter=this.getAbstractMesh();this.m_particleEmitter==null&&(this.m_particleEmitter=BABYLON.Mesh.CreateBox(this.transform.name+".Emitter",.25,this.scene),this.m_particleEmitter.parent=this.transform,this.m_particleEmitter.position.set(0,0,0),this.m_particleEmitter.isVisible=!1,this.m_particleEmitter.isPickable=!1,this.m_particleEmitter.material=BABYLON.Utilities.GetColliderMaterial(this.scene));particleText!=null&&particleText!==""&&(particleJson=window.atob(particleText),particleJson!=null&&particleJson!==""&&(particleParsed=JSON.parse(particleJson),particleParsed!=null&&(particleParsed.texture!=null&&particleTexture!=null&&(particleParsed.texture.name=particleTexture.filename,particleParsed.texture.url=particleTexture.filename),this.m_particleSystem=classType===1?BABYLON.GPUParticleSystem.Parse(particleParsed,this.scene,rootUrl):BABYLON.ParticleSystem.Parse(particleParsed,this.scene,rootUrl),this.m_particleSystem!=null&&(this.m_particleEmitter!=null&&(this.m_particleSystem.emitter=this.m_particleEmitter),playOnAwake===!1&&this.m_particleSystem.stop()))))},FxParticleSystem.prototype.destroy=function(){this.m_particleEmitter=null;this.m_particleSystem!=null&&(this.m_particleSystem.dispose(),this.m_particleSystem=null)},FxParticleSystem}(BABYLON.ScriptComponent);PROJECT.FxParticleSystem=FxParticleSystem}(PROJECT||(PROJECT={})),function(PROJECT){var SkyMaterialSystem=function(_super){function SkyMaterialSystem(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.skyfog=!1,_this.skysize=1e3,_this.probesize=128,_this.reflections=!1,_this.reflectlevel=1,_this.skytintcolor=new BABYLON.Color3(1,1,1),_this.m_skyboxMesh=null,_this.m_skyMaterial=null,_this.m_reflectProbe=null,_this}return __extends(SkyMaterialSystem,_super),SkyMaterialSystem.prototype.getSkyboxMesh=function(){return this.m_skyboxMesh},SkyMaterialSystem.prototype.getSkyMaterial=function(){return this.m_skyMaterial},SkyMaterialSystem.prototype.getReflectionProbe=function(){return this.m_reflectProbe},SkyMaterialSystem.prototype.awake=function(){this.awakeSkyboxMaterial()},SkyMaterialSystem.prototype.start=function(){},SkyMaterialSystem.prototype.update=function(){},SkyMaterialSystem.prototype.late=function(){},SkyMaterialSystem.prototype.after=function(){},SkyMaterialSystem.prototype.destroy=function(){this.destroySkyboxMaterial()},SkyMaterialSystem.prototype.awakeSkyboxMaterial=function(){var tintColor,camOffsetData;this.skyfog=this.getProperty("skyfog",this.skyfog);this.skysize=this.getProperty("skysize",this.skysize);this.probesize=this.getProperty("probesize",this.probesize);this.reflections=this.getProperty("reflections",this.reflections);this.reflectlevel=this.getProperty("reflectlevel",this.reflectlevel);tintColor=this.getProperty("tintColor");tintColor!=null&&(this.skytintcolor=BABYLON.Utilities.ParseColor3(tintColor));this.m_skyboxMesh=BABYLON.Mesh.CreateBox("Ambient Skybox",this.skysize,this.scene);this.m_skyboxMesh.position.set(0,0,0);this.m_skyboxMesh.infiniteDistance=!0;this.m_skyboxMesh.applyFog=this.skyfog;this.scene.useRightHandedSystem===!0&&(this.m_skyboxMesh.scaling.x*=-1);this.m_skyMaterial=new BABYLON.SkyMaterial(this.transform.name+".SkyMaterial",this.scene);this.m_skyMaterial.backFaceCulling=!1;this.setSkyboxTintColor(this.skytintcolor);this.m_skyMaterial.luminance=this.getProperty("luminance",this.m_skyMaterial.luminance);this.m_skyMaterial.turbidity=this.getProperty("turbidity",this.m_skyMaterial.turbidity);this.m_skyMaterial.rayleigh=this.getProperty("rayleigh",this.m_skyMaterial.rayleigh);this.m_skyMaterial.mieCoefficient=this.getProperty("miecoefficient",this.m_skyMaterial.mieCoefficient);this.m_skyMaterial.mieDirectionalG=this.getProperty("miedirectionalg",this.m_skyMaterial.mieDirectionalG);this.m_skyMaterial.distance=this.getProperty("distance",this.m_skyMaterial.distance);this.m_skyMaterial.inclination=this.getProperty("inclination",this.m_skyMaterial.inclination);this.m_skyMaterial.azimuth=this.getProperty("azimuth",this.m_skyMaterial.azimuth);camOffsetData=this.getProperty("cameraoffset");camOffsetData!=null&&(this.m_skyMaterial.cameraOffset=BABYLON.Utilities.ParseVector3(camOffsetData));this.m_skyMaterial.useSunPosition=this.getProperty("usesunposition",this.m_skyMaterial.useSunPosition);this.m_skyMaterial.sunPosition=new BABYLON.Vector3(0,50,0);this.scene.metadata!=null&&this.scene.metadata.unity!=null&&this.scene.metadata.unity&&this.scene.metadata.unity.sunposition!=null&&(this.m_skyMaterial.sunPosition=BABYLON.Utilities.ParseVector3(this.scene.metadata.unity.sunposition));this.m_skyboxMesh.material=this.m_skyMaterial;this.reflections===!0&&(this.m_reflectProbe=new BABYLON.ReflectionProbe("Skybox-ReflectionProbe",this.probesize,this.scene),this.m_reflectProbe.renderList.push(this.m_skyboxMesh),this.scene.customRenderTargets.push(this.m_reflectProbe.cubeTexture),this.scene.environmentTexture=this.m_reflectProbe.cubeTexture,this.scene.environmentIntensity=this.reflectlevel)},SkyMaterialSystem.prototype.destroySkyboxMaterial=function(){this.m_skyboxMesh!=null&&(this.m_skyboxMesh.dispose(),this.m_skyboxMesh=null);this.m_reflectProbe!=null&&(this.m_reflectProbe.dispose(),this.m_reflectProbe=null);this.m_skyMaterial!=null&&(this.m_skyMaterial.dispose(),this.m_skyMaterial=null)},SkyMaterialSystem.prototype.setSkyboxTintColor=function(color){for(var colors=[],numVertices=this.m_skyboxMesh.getTotalVertices(),i=0;i<numVertices;++i)colors.push(color.r,color.g,color.b,1);this.m_skyboxMesh.setVerticesData("color",colors);this.m_skyboxMesh.useVertexColors=!0},SkyMaterialSystem}(BABYLON.ScriptComponent);PROJECT.SkyMaterialSystem=SkyMaterialSystem}(PROJECT||(PROJECT={})),function(PROJECT){var WaterMaterialSystem=function(_super){function WaterMaterialSystem(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.waterTag="Water",_this.targetSize=new BABYLON.Vector2(128,128),_this.renderSize=new BABYLON.Vector2(512,512),_this.depthFactor=1,_this.reflectSkybox=!0,_this.subDivisions=32,_this.heightOffset=1,_this.windDirection=new BABYLON.Vector2(0,1),_this.windForce=6,_this.waveSpeed=1,_this.waveLength=.4,_this.waveHeight=.4,_this.bumpHeight=.4,_this.waterColor=new BABYLON.Color3(.1,.1,.6),_this.colorBlendFactor=.2,_this.waterColor2=new BABYLON.Color3(.1,.1,.6),_this.colorBlendFactor2=.2,_this.disableClipPlane=!1,_this.m_waterGeometry=null,_this.m_waterMaterial=null,_this}return __extends(WaterMaterialSystem,_super),WaterMaterialSystem.prototype.getWaterGeometry=function(){return this.m_waterGeometry},WaterMaterialSystem.prototype.getWaterMaterial=function(){return this.m_waterMaterial},WaterMaterialSystem.prototype.awake=function(){var _this=this,wcolor1,wcolor2,wdirection,itargetsize,irendersize,bumpTexture,bumpTextureData,skyboxMesh,waterMeshes;this.waterTag=this.getProperty("watertag",this.waterTag);this.depthFactor=this.getProperty("depthfactor",this.depthFactor);this.subDivisions=this.getProperty("subdivisions",this.subDivisions);this.heightOffset=this.getProperty("heightoffset",this.heightOffset);this.reflectSkybox=this.getProperty("reflectskybox",this.reflectSkybox);this.windForce=this.getProperty("windforce",this.windForce);this.waveSpeed=this.getProperty("wavespeed",this.waveSpeed);this.waveLength=this.getProperty("wavelength",this.waveLength);this.waveHeight=this.getProperty("waveheight",this.waveHeight);this.bumpHeight=this.getProperty("bumpheight",this.bumpHeight);this.bumpSuperimpose=this.getProperty("bumpsuperimpose",this.bumpSuperimpose);this.bumpAffectsReflection=this.getProperty("bumpaffectsreflection",this.bumpAffectsReflection);this.colorBlendFactor=this.getProperty("colorblendfactor",this.colorBlendFactor);this.colorBlendFactor2=this.getProperty("colorblendfactor2",this.colorBlendFactor2);this.disableClipPlane=this.getProperty("disableclipplane",this.disableClipPlane);this.fresnelSeparate=this.getProperty("fresnelseparate",this.fresnelSeparate);wcolor1=this.getProperty("watercolor");this.waterColor=BABYLON.Utilities.ParseColor3(wcolor1);wcolor2=this.getProperty("watercolor2");this.waterColor2=BABYLON.Utilities.ParseColor3(wcolor2);wdirection=this.getProperty("winddirection");this.windDirection=BABYLON.Utilities.ParseVector2(wdirection);itargetsize=this.getProperty("targetsize");itargetsize!=null&&(this.targetSize=BABYLON.Utilities.ParseVector2(itargetsize));irendersize=this.getProperty("rendersize");irendersize!=null&&(this.renderSize=BABYLON.Utilities.ParseVector2(irendersize));bumpTexture=null;bumpTextureData=this.getProperty("bumptexture");bumpTextureData!=null&&(bumpTexture=BABYLON.Utilities.ParseTexture(bumpTextureData,this.scene));bumpTexture!=null?(this.m_waterMaterial=new BABYLON.WaterMaterial(this.transform.name+".Water",this.scene,this.renderSize),this.m_waterMaterial.bumpTexture=bumpTexture,this.m_waterMaterial.windDirection=this.windDirection,this.m_waterMaterial.windForce=this.windForce,this.m_waterMaterial.waveSpeed=this.waveSpeed,this.m_waterMaterial.waveLength=this.waveLength,this.m_waterMaterial.waveHeight=this.waveHeight,this.m_waterMaterial.bumpHeight=this.bumpHeight,this.m_waterMaterial.bumpSuperimpose=this.bumpSuperimpose,this.m_waterMaterial.bumpAffectsReflection=this.bumpAffectsReflection,this.m_waterMaterial.waterColor=this.waterColor,this.m_waterMaterial.colorBlendFactor=this.colorBlendFactor,this.m_waterMaterial.waterColor2=this.waterColor2,this.m_waterMaterial.colorBlendFactor2=this.colorBlendFactor2,this.m_waterMaterial.disableClipPlane=this.disableClipPlane,this.m_waterMaterial.fresnelSeparate=this.fresnelSeparate,this.reflectSkybox===!0&&(skyboxMesh=BABYLON.SceneManager.GetAmbientSkybox(this.scene),skyboxMesh!=null&&this.m_waterMaterial.addToRenderList(skyboxMesh)),this.waterTag!=null&&this.waterTag!==""&&(waterMeshes=this.scene.getMeshesByTags(this.waterTag),waterMeshes!=null&&waterMeshes.length>0&&waterMeshes.forEach(function(mesh){_this.m_waterMaterial.addToRenderList(mesh)})),this.m_waterGeometry=BABYLON.Mesh.CreateGround(this.transform.name+".WaterMesh",this.targetSize.x,this.targetSize.y,this.subDivisions,this.scene,!1),this.m_waterGeometry.parent=this.transform,this.m_waterGeometry.position.set(0,this.heightOffset,0),this.depthFactor>0&&(this.m_waterGeometry.scaling.y*=this.depthFactor),this.m_waterGeometry.material=this.m_waterMaterial):BABYLON.Tools.Warn("No supported water bump texture for: "+this.transform.name)},WaterMaterialSystem.prototype.start=function(){},WaterMaterialSystem.prototype.update=function(){},WaterMaterialSystem.prototype.late=function(){},WaterMaterialSystem.prototype.after=function(){},WaterMaterialSystem.prototype.destroy=function(){},WaterMaterialSystem}(BABYLON.ScriptComponent);PROJECT.WaterMaterialSystem=WaterMaterialSystem}(PROJECT||(PROJECT={})),function(PROJECT){var SimpleFollowCamera=function(_super){function SimpleFollowCamera(transform,scene,properties){var _this,ftarget;return properties===void 0&&(properties={}),_this=_super.call(this,transform,scene,properties)||this,_this.smoothFollow=0,_this.smoothRotate=0,_this.matchRotation=!1,_this.followTarget=null,_this.targetPosition=BABYLON.Vector3.Zero(),_this.targetRotation=BABYLON.Quaternion.Zero(),_this.smoothFollow=_this.getProperty("smoothFollow",_this.smoothFollow),_this.smoothRotate=_this.getProperty("smoothRotate",_this.smoothRotate),_this.matchRotation=_this.getProperty("matchRotation",_this.matchRotation),ftarget=_this.getProperty("followTarget"),ftarget!=null&&(_this.followTarget=BABYLON.Utilities.ParseTransformByID(ftarget,_this.scene),_this.followTarget!=null&&BABYLON.Utilities.ValidateTransformQuaternion(_this.followTarget)),BABYLON.Utilities.ValidateTransformQuaternion(_this.transform),_this}return __extends(SimpleFollowCamera,_super),SimpleFollowCamera.prototype.start=function(){console.log("Starting simple follow target for: "+this.transform.name)},SimpleFollowCamera.prototype.late=function(){if(this.followTarget!=null){var deltaTime=this.getDeltaSeconds();BABYLON.Utilities.GetAbsolutePositionToRef(this.followTarget,this.targetPosition);this.targetRotation.copyFrom(this.followTarget.absoluteRotationQuaternion);this.smoothFollow>0?BABYLON.Vector3.LerpToRef(this.transform.position,this.targetPosition,deltaTime*this.smoothFollow,this.transform.position):this.transform.position.copyFrom(this.targetPosition);this.matchRotation===!0&&(this.smoothRotate>0?BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.targetRotation,deltaTime*this.smoothRotate,this.transform.rotationQuaternion):this.transform.rotationQuaternion.copyFrom(this.targetRotation))}},SimpleFollowCamera}(BABYLON.ScriptComponent);PROJECT.SimpleFollowCamera=SimpleFollowCamera}(PROJECT||(PROJECT={})),function(PROJECT){var SmoothFollowTarget=function(_super){function SmoothFollowTarget(transform,scene,properties){var _this,followTarget;return properties===void 0&&(properties={}),_this=_super.call(this,transform,scene,properties)||this,_this.target=null,_this.targetHeight=1.75,_this.followHeight=1.75,_this.heightDamping=12,_this.rotationDamping=3,_this.minimumDistance=6,_this.maximumDistance=8,_this.startBehindTarget=!0,_this.followBehindTarget=!0,_this.targetPosition=BABYLON.Vector3.Zero(),_this.targetAngles=new BABYLON.Vector3(0,0,0),_this.transformAngles=new BABYLON.Vector3(0,0,0),_this.positionBuffer=new BABYLON.Vector3(0,0,0),_this.rotationBuffer=new BABYLON.Quaternion(0,0,0,1),_this.tempRotationBuffer=new BABYLON.Vector3(0,0,0),_this.targetHeight=_this.getProperty("targetHeight",_this.targetHeight),_this.followHeight=_this.getProperty("followHeight",_this.followHeight),_this.heightDamping=_this.getProperty("heightDamping",_this.heightDamping),_this.rotationDamping=_this.getProperty("rotationDamping",_this.rotationDamping),_this.minimumDistance=_this.getProperty("minimumDistance",_this.minimumDistance),_this.maximumDistance=_this.getProperty("maximumDistance",_this.maximumDistance),_this.startBehindTarget=_this.getProperty("startBehindTarget",_this.startBehindTarget),_this.followBehindTarget=_this.getProperty("followBehindTarget",_this.followBehindTarget),_this.rotationDamping<=0&&(_this.rotationDamping=3),_this.heightDamping<=0&&(_this.heightDamping=12),followTarget=_this.getProperty("target"),followTarget!=null&&(_this.target=BABYLON.Utilities.ParseTransformByID(followTarget,_this.scene)),_this}return __extends(SmoothFollowTarget,_super),SmoothFollowTarget.prototype.start=function(){this.target!=null&&this.startBehindTarget===!0},SmoothFollowTarget.prototype.late=function(){var deltaTime;if(this.target!=null){if(this.targetPosition.copyFrom(this.target.position),this.followBehindTarget===!0){deltaTime=this.getDeltaSeconds();BABYLON.Utilities.ToEulerToRef(this.target.rotationQuaternion,this.targetAngles);BABYLON.Utilities.ToEulerToRef(this.transform.rotationQuaternion,this.transformAngles);var wantedHeight=this.targetPosition.y+this.followHeight,currentHeight=BABYLON.Scalar.Lerp(this.transform.position.y,wantedHeight,this.heightDamping*deltaTime),wantedRotationAngle=this.targetAngles.y,currentRotationAngle=BABYLON.Scalar.LerpAngle(this.transformAngles.y,wantedRotationAngle,this.rotationDamping*deltaTime),wantedTargetDistance=BABYLON.Scalar.Lerp(this.minimumDistance,this.maximumDistance,1);BABYLON.Utilities.FromEulerToRef(0,currentRotationAngle,0,this.rotationBuffer);BABYLON.Utilities.MultiplyQuaternionByVectorToRef(this.rotationBuffer,BABYLON.Vector3.Forward(),this.tempRotationBuffer);this.tempRotationBuffer.scaleInPlace(wantedTargetDistance);this.positionBuffer.copyFrom(this.targetPosition);this.positionBuffer.subtractInPlace(this.tempRotationBuffer);this.transform.position.set(this.positionBuffer.x,currentHeight,this.positionBuffer.z)}this.targetPosition.y+=this.targetHeight;this.transform.lookAt(this.targetPosition)}},SmoothFollowTarget.prototype.destroy=function(){this.target=null;this.targetAngles=null;this.transformAngles=null;this.positionBuffer=null;this.rotationBuffer=null;this.tempRotationBuffer=null},SmoothFollowTarget}(BABYLON.ScriptComponent);PROJECT.SmoothFollowTarget=SmoothFollowTarget}(PROJECT||(PROJECT={})),function(PROJECT){var WaypointTargetManager=function(_super){function WaypointTargetManager(transform,scene,properties){var _this,controlPoints_1;properties===void 0&&(properties={});_this=_super.call(this,transform,scene,properties)||this;_this._waypointMeshLines=null;_this._waypointSplineCurve=null;_this._waypointTransformNodes=null;_this._waypointSplinePositions=null;_this._waypointSphereMaterial=null;_this.resolution=1;_this.closedLoop=!0;_this.drawLines=!1;_this.drawPoints=!1;_this.drawTraces=!1;_this.pointSize=.5;_this.lineHeight=.25;_this.lineColor=new BABYLON.Color3(1,1,1);_this.pointColor=new BABYLON.Color3(1,1,1);_this.traceColor=new BABYLON.Color3(1,1,1);_this.resolution=_this.getProperty("resolution",_this.resolution);_this.closedLoop=_this.getProperty("closedLoop",_this.closedLoop);_this.drawLines=_this.getProperty("drawLines",_this.drawLines);_this.drawPoints=_this.getProperty("drawPoints",_this.drawPoints);_this.drawTraces=_this.getProperty("drawTraces",_this.drawTraces);_this.pointSize=_this.getProperty("pointSize",_this.pointSize);_this.lineHeight=_this.getProperty("lineHeight",_this.lineHeight);var lcolor=_this.getProperty("lineColor"),pcolor=_this.getProperty("pointColor"),tcolor=_this.getProperty("traceColor");return _this.lineColor=BABYLON.Utilities.ParseColor3(lcolor,_this.lineColor),_this.pointColor=BABYLON.Utilities.ParseColor3(pcolor,_this.pointColor),_this.traceColor=BABYLON.Utilities.ParseColor3(tcolor,_this.traceColor),_this._waypointSphereMaterial=new BABYLON.StandardMaterial(_this.transform.name+".SplineMaterial",_this.scene),_this._waypointSphereMaterial.diffuseColor=_this.pointColor,_this._waypointTransformNodes=_this.transform.getChildren(null,!0),_this._waypointTransformNodes!=null&&_this._waypointTransformNodes.length>0&&(controlPoints_1=[],_this._waypointTransformNodes.forEach(function(transform){if(BABYLON.Utilities.ValidateTransformQuaternion(transform),controlPoints_1.push(BABYLON.Utilities.GetAbsolutePosition(transform)),_this.drawPoints===!0){var controlPoint=BABYLON.MeshBuilder.CreateSphere(transform.name+".WireSphere",{segments:24,diameter:_this.pointSize*2},_this.scene);controlPoint.parent=transform;controlPoint.position.set(0,0,0);controlPoint.visibility=.25;controlPoint.isVisible=!0;controlPoint.material=_this._waypointSphereMaterial}}),_this._waypointSplineCurve=BABYLON.Curve3.CreateCatmullRomSpline(controlPoints_1,_this.resolution,_this.closedLoop),_this._waypointSplineCurve!=null&&(_this._waypointSplinePositions=_this._waypointSplineCurve.getPoints()),_this._waypointSplinePositions!=null&&console.warn("DEBUG: Waypoint Manager - "+_this.transform.name+": ("+_this._waypointTransformNodes.length+" - "+_this._waypointSplinePositions.length+" - "+_this._waypointSplineCurve.length().toFixed(2)+")")),_this}return __extends(WaypointTargetManager,_super),WaypointTargetManager.prototype.getSplineCurve=function(){return this._waypointSplineCurve},WaypointTargetManager.prototype.getSplineCurveLength=function(){return this._waypointSplineCurve!=null?this._waypointSplineCurve.length():0},WaypointTargetManager.prototype.getSplineCurvePositions=function(){return this._waypointSplinePositions},WaypointTargetManager.prototype.getControlPointTransforms=function(){return this._waypointTransformNodes},WaypointTargetManager.prototype.start=function(){this._waypointSplinePositions!=null&&this.drawLines===!0&&(this._waypointMeshLines=BABYLON.MeshBuilder.CreateLines(this.transform.name+".SplineMesh",{points:this._waypointSplinePositions},this.scene),this._waypointMeshLines.parent=this.transform,this._waypointMeshLines.color=this.lineColor,this._waypointMeshLines.position.y+=this.lineHeight)},WaypointTargetManager.prototype.destroy=function(){this.lineColor=null;this._waypointSplineCurve=null;this._waypointTransformNodes=null;this._waypointSplinePositions=null;this._waypointMeshLines!=null&&(this._waypointMeshLines.dispose(),this._waypointMeshLines=null)},WaypointTargetManager}(BABYLON.ScriptComponent);PROJECT.WaypointTargetManager=WaypointTargetManager}(PROJECT||(PROJECT={})),function(BABYLON){var PerlinNoiseGenerator=function(){function PerlinNoiseGenerator(){}return PerlinNoiseGenerator.rand_vect=function(){var theta=Math.random()*2*Math.PI;return{x:Math.cos(theta),y:Math.sin(theta)}},PerlinNoiseGenerator.dot_prod_grid=function(x,y,vx,vy){var g_vect,d_vect={x:x-vx,y:y-vy};return PerlinNoiseGenerator.gradients[[vx,vy]]?g_vect=PerlinNoiseGenerator.gradients[[vx,vy]]:(g_vect=PerlinNoiseGenerator.rand_vect(),PerlinNoiseGenerator.gradients[[vx,vy]]=g_vect),d_vect.x*g_vect.x+d_vect.y*g_vect.y},PerlinNoiseGenerator.smootherstep=function(x){return 6*Math.pow(x,5)-15*Math.pow(x,4)+10*Math.pow(x,3)},PerlinNoiseGenerator.interp=function(x,a,b){return a+PerlinNoiseGenerator.smootherstep(x)*(b-a)},PerlinNoiseGenerator.seed=function(){PerlinNoiseGenerator.gradients={}},PerlinNoiseGenerator.generate=function(x,y){var xf=Math.floor(x),yf=Math.floor(y),tl=PerlinNoiseGenerator.dot_prod_grid(x,y,xf,yf),tr=PerlinNoiseGenerator.dot_prod_grid(x,y,xf+1,yf),bl=PerlinNoiseGenerator.dot_prod_grid(x,y,xf,yf+1),br=PerlinNoiseGenerator.dot_prod_grid(x,y,xf+1,yf+1),xt=PerlinNoiseGenerator.interp(x-xf,tl,tr),xb=PerlinNoiseGenerator.interp(x-xf,bl,br);return PerlinNoiseGenerator.interp(y-yf,xt,xb)},PerlinNoiseGenerator.gradients={},PerlinNoiseGenerator}();BABYLON.PerlinNoiseGenerator=PerlinNoiseGenerator}(BABYLON||(BABYLON={}));BABYLON.PerlinNoiseGenerator.seed(),function(PROJECT){var AutoBodyGarage=function(_super){function AutoBodyGarage(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.m_bodyMaterial=null,_this.m_bodyAbtractMesh=null,_this}return __extends(AutoBodyGarage,_super),AutoBodyGarage.prototype.awake=function(){var mainMaterialIndex=this.getProperty("mainMaterialIndex",0),mainBodyTransform=this.getProperty("mainBodyTransform"),mainBodyUnityColor=this.getProperty("mainBodyPaintColor"),mainBodyPaintColor=BABYLON.Utilities.ParseColor3(mainBodyUnityColor,BABYLON.Color3.White()),multiMaterial,copyMaterial,subMaterial;mainBodyTransform!=null&&(this.m_bodyAbtractMesh=BABYLON.Utilities.ParseChildTransform(this.transform,mainBodyTransform),this.m_bodyAbtractMesh!=null?(this.m_bodyAbtractMesh.material instanceof BABYLON.MultiMaterial?(multiMaterial=this.m_bodyAbtractMesh.material,multiMaterial.subMaterials!=null&&multiMaterial.subMaterials.length>mainMaterialIndex&&(copyMaterial=multiMaterial.clone(multiMaterial.name+"."+this.transform.name),subMaterial=copyMaterial.subMaterials[mainMaterialIndex],copyMaterial.subMaterials[mainMaterialIndex]=subMaterial.clone(subMaterial.name+"."+this.transform.name),this.m_bodyMaterial=copyMaterial.subMaterials[mainMaterialIndex],this.m_bodyAbtractMesh.material=copyMaterial)):(this.m_bodyMaterial=this.m_bodyAbtractMesh.material.clone(this.m_bodyAbtractMesh.material.name+"."+this.transform.name),this.m_bodyAbtractMesh.material=this.m_bodyMaterial),this.m_bodyMaterial!=null&&(this.m_bodyMaterial.isFrozen&&this.m_bodyMaterial.unfreeze(),this.m_bodyMaterial.albedoColor.copyFrom(mainBodyPaintColor),this.m_bodyMaterial.freeze())):BABYLON.Tools.Warn("Failed to find auto body mesh for: "+this.transform.name))},AutoBodyGarage.prototype.setupVehicleMaterials=function(bodyColor,wheelColor,wheelType,decalIndex){wheelColor===void 0&&(wheelColor=null);wheelType===void 0&&(wheelType=0);decalIndex===void 0&&(decalIndex=0);this.m_bodyMaterial!=null&&(this.m_bodyMaterial.isFrozen&&this.m_bodyMaterial.unfreeze(),this.m_bodyMaterial.albedoColor.copyFrom(bodyColor),this.m_bodyMaterial.freeze())},AutoBodyGarage}(BABYLON.ScriptComponent);PROJECT.AutoBodyGarage=AutoBodyGarage}(PROJECT||(PROJECT={})),function(PROJECT){var RaceTrackManager=function(_super){function RaceTrackManager(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.trackNodes=null,_this.raceLineData_1=null,_this.raceLineData_2=null,_this.raceLineData_3=null,_this.raceLineData_4=null,_this.raceLineData_5=null,_this.raceLineColor_1=null,_this.raceLineColor_2=null,_this.raceLineColor_3=null,_this.raceLineColor_4=null,_this.raceLineColor_5=null,_this.debugMeshLines_1=null,_this.debugMeshLines_2=null,_this.debugMeshLines_3=null,_this.debugMeshLines_4=null,_this.debugMeshLines_5=null,_this.drawDebugLines=!1,_this}return __extends(RaceTrackManager,_super),RaceTrackManager.prototype.getTrackNodes=function(){return this.trackNodes},RaceTrackManager.prototype.getControlPoints=function(line){var result=null;switch(line){case 0:result=this.raceLineData_1;break;case 1:result=this.raceLineData_2;break;case 2:result=this.raceLineData_3;break;case 3:result=this.raceLineData_4;break;case 4:result=this.raceLineData_5}return result},RaceTrackManager.prototype.awake=function(){this.trackNodes=this.getProperty("TrackNodes",this.trackNodes);this.raceLineData_1=this.getProperty("RaceLineData_1",this.raceLineData_1);this.raceLineData_2=this.getProperty("RaceLineData_2",this.raceLineData_2);this.raceLineData_3=this.getProperty("RaceLineData_3",this.raceLineData_3);this.raceLineData_4=this.getProperty("RaceLineData_4",this.raceLineData_4);this.raceLineData_5=this.getProperty("RaceLineData_5",this.raceLineData_5);this.raceLineColor_1=this.getProperty("RaceLineColor_1",this.raceLineColor_1);this.raceLineColor_2=this.getProperty("RaceLineColor_2",this.raceLineColor_2);this.raceLineColor_3=this.getProperty("RaceLineColor_3",this.raceLineColor_3);this.raceLineColor_4=this.getProperty("RaceLineColor_4",this.raceLineColor_4);this.raceLineColor_5=this.getProperty("RaceLineColor_5",this.raceLineColor_5);this.drawDebugLines=this.getProperty("DrawDebugLines",this.drawDebugLines)},RaceTrackManager.prototype.start=function(){var _this=this;if(this.drawDebugLines===!0){var index_1=0,pointSize_1=.5,debugLines_1=new BABYLON.TransformNode(this.transform.name+".DebugLines",this.scene);if(debugLines_1.position.set(0,0,0),debugLines_1.rotationQuaternion=new BABYLON.Quaternion(0,0,0,1),this.trackNodes!=null&&this.trackNodes.length>0){var trackNodePos_1_1=[],trackNodeCol_1=BABYLON.Color3.White(),trackNodeMat_1_1=new BABYLON.StandardMaterial(this.transform.name+".NodeMaterial",this.scene);trackNodeMat_1_1.diffuseColor=trackNodeCol_1;index_1=0;this.trackNodes.forEach(function(node){var trackNodePosition=new BABYLON.Vector3(node.position.x,node.position.y,node.position.z),trackNodeRotation=new BABYLON.Quaternion(node.rotation.x,node.rotation.y,node.rotation.z,node.rotation.w),trackNode;trackNodePos_1_1.push(trackNodePosition);trackNode=BABYLON.MeshBuilder.CreateCylinder(_this.transform.name+".TrackNode_"+index_1,{diameterTop:0,diameterBottom:pointSize_1*2,height:2},_this.scene);trackNode.parent=debugLines_1;trackNode.position.copyFrom(trackNodePosition);trackNode.position.y+=.5;trackNode.rotationQuaternion=trackNodeRotation.multiply(BABYLON.Utilities.FromEuler(90,0,0));trackNode.material=trackNodeMat_1_1;index_1++})}if(this.raceLineData_5!=null&&this.raceLineData_5.length>0){var raceLinePos_5_1=[],raceLineCol_5=this.raceLineColor_5!=null?new BABYLON.Color3(this.raceLineColor_5.r,this.raceLineColor_5.g,this.raceLineColor_5.b):BABYLON.Color3.White(),raceLineMat_5_1=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_5",this.scene);raceLineMat_5_1.diffuseColor=raceLineCol_5;index_1=0;this.raceLineData_5.forEach(function(point){var raceLinePoint=new BABYLON.Vector3(point.position.x,point.position.y,point.position.z),controlPoint_5;raceLinePos_5_1.push(raceLinePoint);controlPoint_5=BABYLON.MeshBuilder.CreateSphere(_this.transform.name+".ControlPoint_5_"+index_1,{segments:24,diameter:pointSize_1*2},_this.scene);controlPoint_5.parent=debugLines_1;controlPoint_5.position.copyFrom(raceLinePoint);controlPoint_5.position.y+=.5;controlPoint_5.material=raceLineMat_5_1;index_1++});this.debugMeshLines_5=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_5",{points:raceLinePos_5_1},this.scene);this.debugMeshLines_5.parent=debugLines_1;this.debugMeshLines_5.position.y+=.5;this.debugMeshLines_5.color=raceLineCol_5}if(this.raceLineData_4!=null&&this.raceLineData_4.length>0){var raceLinePos_4_1=[],raceLineCol_4=this.raceLineColor_4!=null?new BABYLON.Color3(this.raceLineColor_4.r,this.raceLineColor_4.g,this.raceLineColor_4.b):BABYLON.Color3.White(),raceLineMat_4_1=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_4",this.scene);raceLineMat_4_1.diffuseColor=raceLineCol_4;index_1=0;this.raceLineData_4.forEach(function(point){var raceLinePoint=new BABYLON.Vector3(point.position.x,point.position.y,point.position.z),controlPoint_4;raceLinePos_4_1.push(raceLinePoint);controlPoint_4=BABYLON.MeshBuilder.CreateSphere(_this.transform.name+".ControlPoint_4_"+index_1,{segments:24,diameter:pointSize_1*2},_this.scene);controlPoint_4.parent=debugLines_1;controlPoint_4.position.copyFrom(raceLinePoint);controlPoint_4.position.y+=.5;controlPoint_4.material=raceLineMat_4_1;index_1++});this.debugMeshLines_4=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_4",{points:raceLinePos_4_1},this.scene);this.debugMeshLines_4.parent=debugLines_1;this.debugMeshLines_4.position.y+=.5;this.debugMeshLines_4.color=raceLineCol_4}if(this.raceLineData_3!=null&&this.raceLineData_3.length>0){var raceLinePos_3_1=[],raceLineCol_3=this.raceLineColor_3!=null?new BABYLON.Color3(this.raceLineColor_3.r,this.raceLineColor_3.g,this.raceLineColor_3.b):BABYLON.Color3.White(),raceLineMat_3_1=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_3",this.scene);raceLineMat_3_1.diffuseColor=raceLineCol_3;index_1=0;this.raceLineData_3.forEach(function(point){var raceLinePoint=new BABYLON.Vector3(point.position.x,point.position.y,point.position.z),controlPoint_3;raceLinePos_3_1.push(raceLinePoint);controlPoint_3=BABYLON.MeshBuilder.CreateSphere(_this.transform.name+".ControlPoint_3_"+index_1,{segments:24,diameter:pointSize_1*2},_this.scene);controlPoint_3.parent=debugLines_1;controlPoint_3.position.copyFrom(raceLinePoint);controlPoint_3.position.y+=.5;controlPoint_3.material=raceLineMat_3_1;index_1++});this.debugMeshLines_3=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_3",{points:raceLinePos_3_1},this.scene);this.debugMeshLines_3.parent=debugLines_1;this.debugMeshLines_3.position.y+=.5;this.debugMeshLines_3.color=raceLineCol_3}if(this.raceLineData_2!=null&&this.raceLineData_2.length>0){var raceLinePos_2_1=[],raceLineCol_2=this.raceLineColor_2!=null?new BABYLON.Color3(this.raceLineColor_2.r,this.raceLineColor_2.g,this.raceLineColor_2.b):BABYLON.Color3.White(),raceLineMat_2_1=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_2",this.scene);raceLineMat_2_1.diffuseColor=raceLineCol_2;index_1=0;this.raceLineData_2.forEach(function(point){var raceLinePoint=new BABYLON.Vector3(point.position.x,point.position.y,point.position.z),controlPoint_2;raceLinePos_2_1.push(raceLinePoint);controlPoint_2=BABYLON.MeshBuilder.CreateSphere(_this.transform.name+".ControlPoint_2_"+index_1,{segments:24,diameter:pointSize_1*2},_this.scene);controlPoint_2.parent=debugLines_1;controlPoint_2.position.copyFrom(raceLinePoint);controlPoint_2.position.y+=.5;controlPoint_2.material=raceLineMat_2_1;index_1++});this.debugMeshLines_2=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_2",{points:raceLinePos_2_1},this.scene);this.debugMeshLines_2.parent=debugLines_1;this.debugMeshLines_2.position.y+=.5;this.debugMeshLines_2.color=raceLineCol_2}if(this.raceLineData_1!=null&&this.raceLineData_1.length>0){var raceLinePos_1_1=[],raceLineCol_1=this.raceLineColor_1!=null?new BABYLON.Color3(this.raceLineColor_1.r,this.raceLineColor_1.g,this.raceLineColor_1.b):BABYLON.Color3.White(),raceLineMat_1_1=new BABYLON.StandardMaterial(this.transform.name+".PointMaterial_1",this.scene);raceLineMat_1_1.diffuseColor=raceLineCol_1;index_1=0;this.raceLineData_1.forEach(function(point){var raceLinePoint=new BABYLON.Vector3(point.position.x,point.position.y,point.position.z),controlPoint_1;raceLinePos_1_1.push(raceLinePoint);controlPoint_1=BABYLON.MeshBuilder.CreateSphere(_this.transform.name+".ControlPoint_1_"+index_1,{segments:24,diameter:pointSize_1*2},_this.scene);controlPoint_1.parent=debugLines_1;controlPoint_1.position.copyFrom(raceLinePoint);controlPoint_1.position.y+=.5;controlPoint_1.material=raceLineMat_1_1;index_1++});this.debugMeshLines_1=BABYLON.MeshBuilder.CreateLines(this.transform.name+".RaceLine_1",{points:raceLinePos_1_1},this.scene);this.debugMeshLines_1.parent=debugLines_1;this.debugMeshLines_1.position.y+=.5;this.debugMeshLines_1.color=raceLineCol_1}}},RaceTrackManager.prototype.destroy=function(){},RaceTrackManager}(BABYLON.ScriptComponent);PROJECT.RaceTrackManager=RaceTrackManager}(PROJECT||(PROJECT={})),function(PROJECT){var SkidMarkSection=function(){function SkidMarkSection(){this.Pos=BABYLON.Vector3.Zero();this.Normal=BABYLON.Vector3.Zero();this.Tangent=BABYLON.Vector4.Zero();this.Posl=BABYLON.Vector3.Zero();this.Posr=BABYLON.Vector3.Zero();this.Intensity=0;this.LastIndex=-1}return SkidMarkSection}(),SkidMarkManager;PROJECT.SkidMarkSection=SkidMarkSection;SkidMarkManager=function(_super){function SkidMarkManager(transform,scene,properties){properties===void 0&&(properties={});var _this=_super.call(this,transform,scene,properties)||this;return SkidMarkManager.MAX_MARKS=_this.getProperty("maxSections",SkidMarkManager.MAX_MARKS),SkidMarkManager.MARK_COLOR=BABYLON.Utilities.ParseColor3(_this.getProperty("textureColor"),SkidMarkManager.MARK_COLOR),SkidMarkManager.MARK_WIDTH=_this.getProperty("textureWidth",SkidMarkManager.MARK_WIDTH),SkidMarkManager.GROUND_OFFSET=_this.getProperty("groundOffset",SkidMarkManager.GROUND_OFFSET),SkidMarkManager.GPU_TRIANGLES=_this.getProperty("gpuQuadIndices",SkidMarkManager.GPU_TRIANGLES),SkidMarkManager.TEXTURE_MARKS=_this.getProperty("textureMarks",SkidMarkManager.TEXTURE_MARKS),SkidMarkManager.TEX_INTENSITY=_this.getProperty("textureIntensity",SkidMarkManager.TEX_INTENSITY),SkidMarkManager.MIN_DISTANCE=_this.getProperty("textureDistance",SkidMarkManager.MIN_DISTANCE),SkidMarkManager.MIN_SQR_DISTANCE=SkidMarkManager.MIN_DISTANCE*SkidMarkManager.MIN_DISTANCE,_this}return __extends(SkidMarkManager,_super),SkidMarkManager.prototype.start=function(){SkidMarkManager.CreateSkidMarkManager(this.scene)},SkidMarkManager.prototype.update=function(){SkidMarkManager.UpdateSkidMarkManager()},SkidMarkManager.AddSkidMarkSegment=function(pos,normal,intensity,lastIndex){var sqrDistance,curSection,lastSection,curIndex;if(SkidMarkManager.SkidMarkMesh==null)return null;if(SkidMarkManager.TempVector3_POS.set(0,0,0),SkidMarkManager.TempVector3_DIR.set(0,0,0),SkidMarkManager.TempVector3_XDIR.set(0,0,0),SkidMarkManager.TempVector3_SDIR.set(0,0,0),intensity>1)intensity=1;else if(intensity<0)return-1;return lastIndex>0&&(pos.subtractToRef(SkidMarkManager.SkidMarkSections[lastIndex].Pos,SkidMarkManager.TempVector3_POS),sqrDistance=SkidMarkManager.TempVector3_POS.lengthSquared(),sqrDistance<SkidMarkManager.MIN_SQR_DISTANCE)?lastIndex:(curSection=SkidMarkManager.SkidMarkSections[SkidMarkManager.SkidMarkIndex],normal.scaleToRef(SkidMarkManager.GROUND_OFFSET,SkidMarkManager.TempVector3_POS),pos.addToRef(SkidMarkManager.TempVector3_POS,curSection.Pos),curSection.Normal.copyFrom(normal),curSection.Intensity=intensity*SkidMarkManager.TEX_INTENSITY,curSection.LastIndex=lastIndex,lastIndex!=-1&&(lastSection=SkidMarkManager.SkidMarkSections[lastIndex],curSection.Pos.subtractToRef(lastSection.Pos,SkidMarkManager.TempVector3_DIR),BABYLON.Vector3.CrossToRef(SkidMarkManager.TempVector3_DIR,normal,SkidMarkManager.TempVector3_XDIR),SkidMarkManager.TempVector3_XDIR.normalizeToRef(SkidMarkManager.TempVector3_XDIR),SkidMarkManager.TempVector3_XDIR.scaleToRef(SkidMarkManager.MARK_WIDTH*.5,SkidMarkManager.TempVector3_SDIR),curSection.Pos.addToRef(SkidMarkManager.TempVector3_SDIR,curSection.Posl),curSection.Pos.subtractToRef(SkidMarkManager.TempVector3_SDIR,curSection.Posr),curSection.Tangent.set(SkidMarkManager.TempVector3_XDIR.x,SkidMarkManager.TempVector3_XDIR.y,SkidMarkManager.TempVector3_XDIR.z,1),lastSection.LastIndex===-1&&(curSection.Pos.addToRef(SkidMarkManager.TempVector3_SDIR,lastSection.Posl),curSection.Pos.subtractToRef(SkidMarkManager.TempVector3_SDIR,lastSection.Posr),lastSection.Tangent.copyFrom(curSection.Tangent))),SkidMarkManager.AddSkidMarkVertexData(),curIndex=SkidMarkManager.SkidMarkIndex,SkidMarkManager.SkidMarkIndex=++SkidMarkManager.SkidMarkIndex%SkidMarkManager.MAX_MARKS,curIndex)},SkidMarkManager.CreateSkidMarkManager=function(scene){var skidmarkMaterial,i,vertexData;if(SkidMarkManager.SkidMarkMesh==null){for(skidmarkMaterial=new BABYLON.StandardMaterial("SkidMarkMaterial",scene),skidmarkMaterial.backFaceCulling=!1,skidmarkMaterial.disableLighting=!0,skidmarkMaterial.emissiveColor=SkidMarkManager.MARK_COLOR,skidmarkMaterial.diffuseColor=SkidMarkManager.MARK_COLOR,skidmarkMaterial.diffuseTexture=BABYLON.Utilities.ParseTexture(SkidMarkManager.TEXTURE_MARKS,scene),skidmarkMaterial.diffuseTexture!=null&&(skidmarkMaterial.diffuseTexture.hasAlpha=!0,skidmarkMaterial.useAlphaFromDiffuseTexture=!0),skidmarkMaterial.freeze(),SkidMarkManager.SkidMarkMesh=new BABYLON.Mesh("SkidMarkMesh",scene),SkidMarkManager.SkidMarkMesh.material=skidmarkMaterial,SkidMarkManager.SkidMarkMesh.alwaysSelectAsActiveMesh=!0,SkidMarkManager.SkidMarkMesh.doNotSyncBoundingInfo=!0,SkidMarkManager.SkidMarkMesh.receiveShadows=!1,SkidMarkManager.SkidMarkMesh.checkCollisions=!1,SkidMarkManager.SkidMarkMesh.useVertexColors=!0,SkidMarkManager.SkidMarkMesh.hasVertexAlpha=!0,SkidMarkManager.SkidMarkMesh.isPickable=!1,SkidMarkManager.SkidMarkSections=new Array(SkidMarkManager.MAX_MARKS),i=0;i<SkidMarkManager.SkidMarkSections.length;i++)SkidMarkManager.SkidMarkSections[i]=new SkidMarkSection;SkidMarkManager.SkidBufferPositions=new Float32Array(SkidMarkManager.MAX_MARKS*12);SkidMarkManager.SkidBufferNormals=new Float32Array(SkidMarkManager.MAX_MARKS*12);SkidMarkManager.SkidBufferTangents=new Float32Array(SkidMarkManager.MAX_MARKS*16);SkidMarkManager.SkidBufferColors=new Float32Array(SkidMarkManager.MAX_MARKS*16);SkidMarkManager.SkidBufferUvs=new Float32Array(SkidMarkManager.MAX_MARKS*8);SkidMarkManager.SkidBufferIndices=new Int32Array(SkidMarkManager.MAX_MARKS*6);vertexData=new BABYLON.VertexData;vertexData.positions=SkidMarkManager.SkidBufferPositions;vertexData.normals=SkidMarkManager.SkidBufferNormals;vertexData.tangents=SkidMarkManager.SkidBufferTangents;vertexData.colors=SkidMarkManager.SkidBufferColors;vertexData.uvs=SkidMarkManager.SkidBufferUvs;vertexData.indices=SkidMarkManager.SkidBufferIndices;vertexData.applyToMesh(SkidMarkManager.SkidMarkMesh,!0);SkidMarkManager.SkidMarkMesh.freezeWorldMatrix()}},SkidMarkManager.AddSkidMarkVertexData=function(){var curr=SkidMarkManager.SkidMarkSections[SkidMarkManager.SkidMarkIndex],last,index;curr.LastIndex!==-1&&(last=SkidMarkManager.SkidMarkSections[curr.LastIndex],SkidMarkManager.SkidMarkUpdated=!0,index=SkidMarkManager.SkidMarkIndex*4+0,SkidMarkManager.SkidBufferPositions[index*3]=last.Posl.x,SkidMarkManager.SkidBufferPositions[index*3+1]=last.Posl.y,SkidMarkManager.SkidBufferPositions[index*3+2]=last.Posl.z,index=SkidMarkManager.SkidMarkIndex*4+1,SkidMarkManager.SkidBufferPositions[index*3]=last.Posr.x,SkidMarkManager.SkidBufferPositions[index*3+1]=last.Posr.y,SkidMarkManager.SkidBufferPositions[index*3+2]=last.Posr.z,index=SkidMarkManager.SkidMarkIndex*4+2,SkidMarkManager.SkidBufferPositions[index*3]=curr.Posl.x,SkidMarkManager.SkidBufferPositions[index*3+1]=curr.Posl.y,SkidMarkManager.SkidBufferPositions[index*3+2]=curr.Posl.z,index=SkidMarkManager.SkidMarkIndex*4+3,SkidMarkManager.SkidBufferPositions[index*3]=curr.Posr.x,SkidMarkManager.SkidBufferPositions[index*3+1]=curr.Posr.y,SkidMarkManager.SkidBufferPositions[index*3+2]=curr.Posr.z,index=SkidMarkManager.SkidMarkIndex*4+0,SkidMarkManager.SkidBufferNormals[index*3]=last.Normal.x,SkidMarkManager.SkidBufferNormals[index*3+1]=last.Normal.y,SkidMarkManager.SkidBufferNormals[index*3+2]=last.Normal.z,index=SkidMarkManager.SkidMarkIndex*4+1,SkidMarkManager.SkidBufferNormals[index*3]=last.Normal.x,SkidMarkManager.SkidBufferNormals[index*3+1]=last.Normal.y,SkidMarkManager.SkidBufferNormals[index*3+2]=last.Normal.z,index=SkidMarkManager.SkidMarkIndex*4+2,SkidMarkManager.SkidBufferNormals[index*3]=curr.Normal.x,SkidMarkManager.SkidBufferNormals[index*3+1]=curr.Normal.y,SkidMarkManager.SkidBufferNormals[index*3+2]=curr.Normal.z,index=SkidMarkManager.SkidMarkIndex*4+3,SkidMarkManager.SkidBufferNormals[index*3]=curr.Normal.x,SkidMarkManager.SkidBufferNormals[index*3+1]=curr.Normal.y,SkidMarkManager.SkidBufferNormals[index*3+2]=curr.Normal.z,index=SkidMarkManager.SkidMarkIndex*4+0,SkidMarkManager.SkidBufferTangents[index*4]=last.Tangent.x,SkidMarkManager.SkidBufferTangents[index*4+1]=last.Tangent.y,SkidMarkManager.SkidBufferTangents[index*4+2]=last.Tangent.z,SkidMarkManager.SkidBufferTangents[index*4+3]=last.Tangent.w,index=SkidMarkManager.SkidMarkIndex*4+1,SkidMarkManager.SkidBufferTangents[index*4]=last.Tangent.x,SkidMarkManager.SkidBufferTangents[index*4+1]=last.Tangent.y,SkidMarkManager.SkidBufferTangents[index*4+2]=last.Tangent.z,SkidMarkManager.SkidBufferTangents[index*4+3]=last.Tangent.w,index=SkidMarkManager.SkidMarkIndex*4+2,SkidMarkManager.SkidBufferTangents[index*4]=curr.Tangent.x,SkidMarkManager.SkidBufferTangents[index*4+1]=curr.Tangent.y,SkidMarkManager.SkidBufferTangents[index*4+2]=curr.Tangent.z,SkidMarkManager.SkidBufferTangents[index*4+3]=curr.Tangent.w,index=SkidMarkManager.SkidMarkIndex*4+3,SkidMarkManager.SkidBufferTangents[index*4]=curr.Tangent.x,SkidMarkManager.SkidBufferTangents[index*4+1]=curr.Tangent.y,SkidMarkManager.SkidBufferTangents[index*4+2]=curr.Tangent.z,SkidMarkManager.SkidBufferTangents[index*4+3]=curr.Tangent.w,index=SkidMarkManager.SkidMarkIndex*4+0,SkidMarkManager.SkidBufferColors[index*4]=1,SkidMarkManager.SkidBufferColors[index*4+1]=1,SkidMarkManager.SkidBufferColors[index*4+2]=1,SkidMarkManager.SkidBufferColors[index*4+3]=last.Intensity,index=SkidMarkManager.SkidMarkIndex*4+1,SkidMarkManager.SkidBufferColors[index*4]=1,SkidMarkManager.SkidBufferColors[index*4+1]=1,SkidMarkManager.SkidBufferColors[index*4+2]=1,SkidMarkManager.SkidBufferColors[index*4+3]=last.Intensity,index=SkidMarkManager.SkidMarkIndex*4+2,SkidMarkManager.SkidBufferColors[index*4]=1,SkidMarkManager.SkidBufferColors[index*4+1]=1,SkidMarkManager.SkidBufferColors[index*4+2]=1,SkidMarkManager.SkidBufferColors[index*4+3]=curr.Intensity,index=SkidMarkManager.SkidMarkIndex*4+3,SkidMarkManager.SkidBufferColors[index*4]=1,SkidMarkManager.SkidBufferColors[index*4+1]=1,SkidMarkManager.SkidBufferColors[index*4+2]=1,SkidMarkManager.SkidBufferColors[index*4+3]=curr.Intensity,index=SkidMarkManager.SkidMarkIndex*4+0,SkidMarkManager.SkidBufferUvs[index*2]=0,SkidMarkManager.SkidBufferUvs[index*2+1]=0,index=SkidMarkManager.SkidMarkIndex*4+1,SkidMarkManager.SkidBufferUvs[index*2]=1,SkidMarkManager.SkidBufferUvs[index*2+1]=0,index=SkidMarkManager.SkidMarkIndex*4+2,SkidMarkManager.SkidBufferUvs[index*2]=0,SkidMarkManager.SkidBufferUvs[index*2+1]=1,index=SkidMarkManager.SkidMarkIndex*4+3,SkidMarkManager.SkidBufferUvs[index*2]=1,SkidMarkManager.SkidBufferUvs[index*2+1]=1,SkidMarkManager.SkidBufferIndices[SkidMarkManager.SkidMarkIndex*6+0]=SkidMarkManager.SkidMarkIndex*4+0,SkidMarkManager.SkidBufferIndices[SkidMarkManager.SkidMarkIndex*6+2]=SkidMarkManager.SkidMarkIndex*4+1,SkidMarkManager.SkidBufferIndices[SkidMarkManager.SkidMarkIndex*6+1]=SkidMarkManager.SkidMarkIndex*4+2,SkidMarkManager.SkidBufferIndices[SkidMarkManager.SkidMarkIndex*6+3]=SkidMarkManager.SkidMarkIndex*4+2,SkidMarkManager.SkidBufferIndices[SkidMarkManager.SkidMarkIndex*6+5]=SkidMarkManager.SkidMarkIndex*4+1,SkidMarkManager.SkidBufferIndices[SkidMarkManager.SkidMarkIndex*6+4]=SkidMarkManager.SkidMarkIndex*4+3)},SkidMarkManager.UpdateSkidMarkManager=function(){SkidMarkManager.SkidMarkMesh!=null&&SkidMarkManager.SkidMarkUpdated===!0&&(SkidMarkManager.SkidMarkUpdated=!1,SkidMarkManager.SkidMarkMesh.geometry!=null&&(SkidMarkManager.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.PositionKind,SkidMarkManager.SkidBufferPositions,0,!1),SkidMarkManager.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.NormalKind,SkidMarkManager.SkidBufferNormals,0,!1),SkidMarkManager.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.TangentKind,SkidMarkManager.SkidBufferTangents,0,!1),SkidMarkManager.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.ColorKind,SkidMarkManager.SkidBufferColors,0,!1),SkidMarkManager.SkidMarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.UVKind,SkidMarkManager.SkidBufferUvs,0,!1),SkidMarkManager.SkidMarkMesh.geometry.updateIndices(SkidMarkManager.SkidBufferIndices,0,SkidMarkManager.GPU_TRIANGLES)))},SkidMarkManager.MAX_MARKS=1024,SkidMarkManager.GROUND_OFFSET=.01,SkidMarkManager.GPU_TRIANGLES=!0,SkidMarkManager.MARK_COLOR=BABYLON.Color3.Black(),SkidMarkManager.MARK_WIDTH=.3,SkidMarkManager.TEX_INTENSITY=1,SkidMarkManager.MIN_DISTANCE=.1,SkidMarkManager.MIN_SQR_DISTANCE=SkidMarkManager.MIN_DISTANCE*SkidMarkManager.MIN_DISTANCE,SkidMarkManager.TEXTURE_MARKS=null,SkidMarkManager.SkidBufferPositions=null,SkidMarkManager.SkidBufferNormals=null,SkidMarkManager.SkidBufferTangents=null,SkidMarkManager.SkidBufferColors=null,SkidMarkManager.SkidBufferUvs=null,SkidMarkManager.SkidBufferIndices=null,SkidMarkManager.SkidMarkSections=null,SkidMarkManager.SkidMarkIndex=0,SkidMarkManager.SkidMarkMesh=null,SkidMarkManager.SkidMarkUpdated=!1,SkidMarkManager.TempVector3_POS=new BABYLON.Vector3(0,0,0),SkidMarkManager.TempVector3_DIR=new BABYLON.Vector3(0,0,0),SkidMarkManager.TempVector3_XDIR=new BABYLON.Vector3(0,0,0),SkidMarkManager.TempVector3_SDIR=new BABYLON.Vector3(0,0,0),SkidMarkManager}(BABYLON.ScriptComponent);PROJECT.SkidMarkManager=SkidMarkManager}(PROJECT||(PROJECT={})),function(PROJECT){var StandardCarController=function(_super){function StandardCarController(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this._rigidbody=null,_this._engineAudioSource=null,_this._skidAudioSource=null,_this.gearIndex=0,_this.downShift=1e3,_this.shiftingTime=0,_this.engineForce=0,_this.handBraking=!1,_this.linearDamping=0,_this.angularDamping=0,_this.forwardSpeed=0,_this.absoluteSpeed=0,_this.americanSpeed=0,_this.normalizedSpeed=0,_this.frontWheelPower=0,_this.backWheelPower=0,_this.wheelBrakingForce=0,_this.visualSteerAngle=0,_this.physicsSteerAngle=0,_this.raycastVehicle=null,_this.brakeLightsMesh=null,_this.brakeLightsTrans=null,_this.reverseLightsMesh=null,_this.reverseLightsTrans=null,_this.frontLeftWheelTrans=null,_this.frontRightWheelTrans=null,_this.backLeftWheelTrans=null,_this.backRightWheelTrans=null,_this.frontLeftWheelMesh=null,_this.frontRightWheelMesh=null,_this.backLeftWheelMesh=null,_this.backRightWheelMesh=null,_this.frontLeftWheelEmitter=null,_this.frontRightWheelEmitter=null,_this.backLeftWheelEmitter=null,_this.backRightWheelEmitter=null,_this.frontLeftWheelParticle=null,_this.frontRightWheelParticle=null,_this.backLeftWheelParticle=null,_this.backRightWheelParticle=null,_this.frontLeftWheelCollider=null,_this.frontRightWheelCollider=null,_this.backLeftWheelCollider=null,_this.backRightWheelCollider=null,_this.engineTorqueCurve=null,_this.wheelRadius=0,_this.clutchSlip=0,_this.engineRPM=0,_this.pitchRPM=0,_this.shiftRPM=0,_this.SKID_FL=0,_this.SKID_FR=0,_this.SKID_RL=0,_this.SKID_RR=0,_this.FRONT_LEFT=-1,_this.FRONT_RIGHT=-1,_this.BACK_LEFT=-1,_this.BACK_RIGHT=-1,_this.smokeTexture=null,_this.skidThreashold=.55,_this.skidDrawVelocity=.02,_this.smokeIntensity=250,_this.smokeOpacity=.1,_this.smokeDonuts=2,_this.maxTurnAngle=20,_this.maxBurnAngle=40,_this.maxSteerBoost=3,_this.overSteerSpeed=1,_this.topEngineSpeed=125,_this.powerCoefficient=1,_this.frictionLerpSpeed=.5,_this.lowSpeedAngle=10,_this.highSpeedAngle=1,_this.lowSpeedTurning=.015,_this.highSpeedTurning=.005,_this.rayTestingType=0,_this.stableDownImpulse=5,_this.roadConnectAccel=5,_this.testPointCount=32,_this.sweepPenetration=0,_this.smoothFlyingForce=250,_this.transmissionRatio=.75,_this.differentialRatio=3.55,_this.maxFrontBraking=0,_this.maxReversePower=.25,_this.minBrakingForce=50,_this.maxBrakingForce=150,_this.handBrakingForce=2500,_this.linearBrakingForce=.25,_this.angularBrakingForce=0,_this.burnoutTimeDelay=1,_this.burnoutWheelPitch=.85,_this.burnoutCoefficient=10,_this.burnoutTriggerMark=10,_this.maxThrottleBurnouts=!1,_this.playVehicleSounds=!1,_this.wheelDriveType=0,_this.gearBoxMaxPitching=6500,_this.gearBoxShiftChange=4500,_this.gearBoxShiftDelay=.35,_this.gearBoxShiftRatios=[4.17,2.34,1.52,1.14,.89,.68],_this.gearBoxShiftRanges=[1e3,2400,2800,3200,3200,3200],_this.slideWhenFootBraking=!1,_this.throttleBrakingForce=0,_this.throttleEngineSpeed=0,_this.powerSlideFriction=1,_this.wheelSkidFriction=1,_this.skiddingLerpSpeed=.25,_this.burnoutLerpSpeed=.05,_this.m_physicsWorld=null,_this.m_frontLeftWheel=null,_this.m_frontRightWheel=null,_this.m_backLeftWheel=null,_this.m_backRightWheel=null,_this.m_frontLeftWheelSkid=-1,_this.m_frontRightWheelSkid=-1,_this.m_backLeftWheelSkid=-1,_this.m_backRightWheelSkid=-1,_this.m_velocityOffset=new BABYLON.Vector3(0,0,0),_this.m_angularDampener=new BABYLON.Vector3(1,1,1),_this.burnoutTimer=0,_this.restoreTimer=0,_this.cooldownTimer=0,_this.wheelDonuts=!1,_this.wheelBurnout=!1,_this.wheelSkidding=!1,_this.donutSpinTime=0,_this.currentForward=0,_this.currentTurning=0,_this.currentSkidding=!1,_this.currentDrifting=!1,_this.allowedTurningAngle=0,_this.allowedTurningIncement=0,_this}return __extends(StandardCarController,_super),StandardCarController.prototype.getFootBraking=function(){return this.currentForward<0&&this.forwardSpeed>1},StandardCarController.prototype.getHandBraking=function(){return this.handBraking},StandardCarController.prototype.getPowerSliding=function(){return this.getFootBraking()===!0&&this.slideWhenFootBraking===!0},StandardCarController.prototype.getCurrentForward=function(){return this.currentForward},StandardCarController.prototype.getCurrentTurning=function(){return this.currentTurning},StandardCarController.prototype.getCurrentSkidding=function(){return this.currentSkidding},StandardCarController.prototype.getcurrentDrifting=function(){return this.currentDrifting},StandardCarController.prototype.getReverseThrottle=function(){return this.currentForward<0&&this.forwardSpeed<0},StandardCarController.prototype.getFrontLeftSkid=function(){return this.SKID_FL},StandardCarController.prototype.getFrontRightSkid=function(){return this.SKID_FR},StandardCarController.prototype.getBackLeftSkid=function(){return this.SKID_RL},StandardCarController.prototype.getBackRightSkid=function(){return this.SKID_RR},StandardCarController.prototype.getRigidbodyPhysics=function(){return this._rigidbody},StandardCarController.prototype.getRaycastVehicle=function(){return this.raycastVehicle},StandardCarController.prototype.getForwardSpeed=function(){return this.absoluteSpeed},StandardCarController.prototype.getAbsoluteSpeed=function(){return this.forwardSpeed},StandardCarController.prototype.getAmericanSpeed=function(){return this.americanSpeed},StandardCarController.prototype.getNormalizedSpeed=function(){return this.normalizedSpeed},StandardCarController.prototype.getCurrentGearIndex=function(){return this.gearIndex},StandardCarController.prototype.getCurrentEngineRPM=function(){return this.engineRPM},StandardCarController.prototype.getCurrentEnginePitch=function(){return BABYLON.Scalar.Clamp(this.pitchRPM/this.gearBoxMaxPitching+.1)},StandardCarController.prototype.getGearShiftRatioCount=function(){return this.gearBoxShiftRatios!=null?this.gearBoxShiftRatios.length:0},StandardCarController.prototype.getSmokeTextureMask=function(){return this.smokeTexture},StandardCarController.prototype.getBrakeLightsMesh=function(){return this.brakeLightsMesh},StandardCarController.prototype.getReverseLightsMesh=function(){return this.reverseLightsMesh},StandardCarController.prototype.getFrontLeftWheelNode=function(){return this.frontLeftWheelMesh},StandardCarController.prototype.getFrontRightWheelNode=function(){return this.frontRightWheelMesh},StandardCarController.prototype.getBackLeftWheelNode=function(){return this.backLeftWheelMesh},StandardCarController.prototype.getBackRightWheelNode=function(){return this.backRightWheelMesh},StandardCarController.prototype.getWheelBurnoutEnabled=function(){return this.wheelBurnout},StandardCarController.prototype.getWheelDonutsEnabled=function(){return this.wheelDonuts},StandardCarController.prototype.getCurrentDonutSpinTime=function(){return this.donutSpinTime},StandardCarController.prototype.awake=function(){this.awakeVehicleState()},StandardCarController.prototype.start=function(){this.initVehicleState()},StandardCarController.prototype.destroy=function(){this.destroyVehicleState()},StandardCarController.prototype.awakeVehicleState=function(){var angularDampener,smokeTextureInfo,engineTorqueInfo;this.engineForce=0;this.frontWheelPower=0;this.backWheelPower=0;this.wheelBrakingForce=0;this.visualSteerAngle=0;this.physicsSteerAngle=0;this.m_physicsWorld=BABYLON.SceneManager.GetPhysicsWorld(this.scene);this.rayTestingType=this.getProperty("rayTestingType",this.rayTestingType);this.testPointCount=this.getProperty("testPointCount",this.testPointCount);this.sweepPenetration=this.getProperty("sweepPenetration",this.sweepPenetration);this.skidThreashold=this.getProperty("skidThreashold",this.skidThreashold);this.skidDrawVelocity=this.getProperty("skidDrawVelocity",this.skidDrawVelocity);this.smokeIntensity=this.getProperty("smokeIntensity",this.smokeIntensity);this.smokeOpacity=this.getProperty("smokeOpacity",this.smokeOpacity);this.smokeDonuts=this.getProperty("smokeDonuts",this.smokeDonuts);this.topEngineSpeed=this.getProperty("topEngineSpeed",this.topEngineSpeed);this.powerCoefficient=this.getProperty("powerCoefficient",this.powerCoefficient);this.maxFrontBraking=this.getProperty("maxFrontBraking",this.maxFrontBraking);this.maxReversePower=this.getProperty("maxReversePower",this.maxReversePower);this.stableDownImpulse=this.getProperty("stableDownImpulse",this.stableDownImpulse);this.roadConnectAccel=this.getProperty("roadConnectAccel",this.roadConnectAccel);this.smoothFlyingForce=this.getProperty("smoothFlyingForce",this.smoothFlyingForce);this.frictionLerpSpeed=this.getProperty("frictionLerpSpeed",this.frictionLerpSpeed);this.maxTurnAngle=this.getProperty("maxTurnAngle",this.maxTurnAngle);this.maxBurnAngle=this.getProperty("maxBurnAngle",this.maxBurnAngle);this.maxSteerBoost=this.getProperty("maxSteerBoost",this.maxSteerBoost);this.overSteerSpeed=this.getProperty("overSteerSpeed",this.overSteerSpeed);this.lowSpeedAngle=this.getProperty("lowSpeedAngle",this.lowSpeedAngle);this.highSpeedAngle=this.getProperty("highSpeedAngle",this.highSpeedAngle);this.wheelDriveType=this.getProperty("wheelDriveType",this.wheelDriveType);this.minBrakingForce=this.getProperty("minBrakingForce",this.minBrakingForce);this.maxBrakingForce=this.getProperty("maxBrakingForce",this.maxBrakingForce);this.handBrakingForce=this.getProperty("handBrakingForce",this.handBrakingForce);this.linearBrakingForce=this.getProperty("linearBrakingForce",this.linearBrakingForce);this.angularBrakingForce=this.getProperty("angularBrakingForce",this.angularBrakingForce);this.lowSpeedTurning=this.getProperty("lowSpeedTurning",this.lowSpeedTurning);this.highSpeedTurning=this.getProperty("highSpeedTurning",this.highSpeedTurning);this.brakeLightsTrans=this.getProperty("brakeLightsMesh",this.brakeLightsTrans);this.reverseLightsTrans=this.getProperty("reverseLightsMesh",this.reverseLightsTrans);this.frontLeftWheelTrans=this.getProperty("frontLeftWheelMesh",this.frontLeftWheelTrans);this.frontRightWheelTrans=this.getProperty("frontRightWheelMesh",this.frontRightWheelTrans);this.backLeftWheelTrans=this.getProperty("rearLeftWheelMesh",this.backLeftWheelTrans);this.backRightWheelTrans=this.getProperty("rearRightWheelMesh",this.backRightWheelTrans);this.frontLeftWheelCollider=this.getProperty("frontLeftWheelCollider",this.frontLeftWheelCollider);this.frontRightWheelCollider=this.getProperty("frontRightWheelCollider",this.frontRightWheelCollider);this.backLeftWheelCollider=this.getProperty("rearLeftWheelCollider",this.backLeftWheelCollider);this.backRightWheelCollider=this.getProperty("rearRightWheelCollider",this.backRightWheelCollider);this.burnoutTimeDelay=this.getProperty("burnoutTimeDelay",this.burnoutTimeDelay);this.burnoutWheelPitch=this.getProperty("burnoutWheelPitch",this.burnoutWheelPitch);this.burnoutCoefficient=this.getProperty("burnoutCoefficient",this.burnoutCoefficient);this.burnoutTriggerMark=this.getProperty("burnoutTriggerMark",this.burnoutTriggerMark);this.maxThrottleBurnouts=this.getProperty("maxThrottleBurnouts",this.maxThrottleBurnouts);this.playVehicleSounds=this.getProperty("playVehicleSounds",this.playVehicleSounds);this.differentialRatio=this.getProperty("gearBoxDifferential",this.differentialRatio);this.transmissionRatio=this.getProperty("gearBoxOverdrive",this.transmissionRatio);this.gearBoxMaxPitching=this.getProperty("gearBoxMaxPitching",this.gearBoxMaxPitching);this.gearBoxShiftChange=this.getProperty("gearBoxShiftChange",this.gearBoxShiftChange);this.gearBoxShiftDelay=this.getProperty("gearBoxShiftDelay",this.gearBoxShiftDelay);this.gearBoxShiftRatios=this.getProperty("gearBoxShiftRatios",this.gearBoxShiftRatios);this.gearBoxShiftRanges=this.getProperty("gearBoxShiftRanges",this.gearBoxShiftRanges);this.maxTurnAngle<=0&&(this.maxTurnAngle=20);this.maxBurnAngle<=0&&(this.maxBurnAngle=40);this.testPointCount<=0&&(this.testPointCount=32);this.sweepPenetration<=0&&(this.sweepPenetration=0);this.stableDownImpulse<=0&&(this.stableDownImpulse=0);this.roadConnectAccel<=0&&(this.roadConnectAccel=0);this.smoothFlyingForce<=0&&(this.smoothFlyingForce=0);this.maxFrontBraking<=0&&(this.maxFrontBraking=0);this.maxReversePower<=0&&(this.maxReversePower=.25);this.lowSpeedAngle<=0&&(this.lowSpeedAngle=10);this.highSpeedAngle<=0&&(this.highSpeedAngle=1);this.lowSpeedTurning<=0&&(this.lowSpeedTurning=.015);this.highSpeedTurning<=0&&(this.highSpeedTurning=.005);this.powerCoefficient<=0&&(this.powerCoefficient=1);this.topEngineSpeed<=0&&(this.topEngineSpeed=125);this.gearBoxMaxPitching<=0&&(this.gearBoxMaxPitching=6500);this.gearBoxShiftChange<=0&&(this.gearBoxShiftChange=4500);this.gearBoxShiftDelay<=0&&(this.gearBoxShiftDelay=.35);this.transmissionRatio<=0&&(this.transmissionRatio=1);this.differentialRatio<=0&&(this.differentialRatio=1);this.frictionLerpSpeed<=0&&(this.frictionLerpSpeed=1);this.skiddingLerpSpeed<=0&&(this.skiddingLerpSpeed=1);this.burnoutLerpSpeed<=0&&(this.burnoutLerpSpeed=1);this.burnoutTimeDelay<=0&&(this.burnoutTimeDelay=1);this.burnoutWheelPitch<=0&&(this.burnoutWheelPitch=1);angularDampener=this.getProperty("angularDampener");angularDampener!=null&&(this.m_angularDampener=BABYLON.Utilities.ParseVector3(angularDampener));smokeTextureInfo=this.getProperty("smokeTexture");smokeTextureInfo!=null&&(this.smokeTexture=BABYLON.Utilities.ParseTexture(smokeTextureInfo,this.scene));engineTorqueInfo=this.getProperty("engineTorque");engineTorqueInfo!=null&&engineTorqueInfo.animation!=null&&(this.engineTorqueCurve=BABYLON.Animation.Parse(engineTorqueInfo.animation));this.engineTorqueCurve==null&&BABYLON.Tools.Warn("Failed to parse engine torque curve for: "+this.transform.name)},StandardCarController.prototype.initVehicleState=function(){if(BABYLON.Utilities.ValidateTransformQuaternion(this.transform),this._engineAudioSource=this.getComponent("BABYLON.AudioSource"),this._engineAudioSource==null&&BABYLON.Tools.Warn("No engine audio source manager found for: "+this.transform.name),this._rigidbody=this.getComponent("BABYLON.RigidbodyPhysics"),this._rigidbody!=null)if(this.raycastVehicle=BABYLON.RaycastVehicle.GetInstance(this.scene,this._rigidbody,this.m_angularDampener),this.raycastVehicle!=null){this.linearDamping=this._rigidbody.getLinearDamping();this.angularDamping=this._rigidbody.getAngularDamping();var brakeLightslName=this.brakeLightsTrans!=null&&this.brakeLightsTrans.name!=null&&this.brakeLightsTrans.name!==""?this.brakeLightsTrans.name:null,reverseLightslName=this.reverseLightsTrans!=null&&this.reverseLightsTrans.name!=null&&this.reverseLightsTrans.name!==""?this.reverseLightsTrans.name:null,frontLeftWheelName=this.frontLeftWheelTrans!=null&&this.frontLeftWheelTrans.name!=null&&this.frontLeftWheelTrans.name!==""?this.frontLeftWheelTrans.name:null,frontRightWheelName=this.frontRightWheelTrans!=null&&this.frontRightWheelTrans.name!=null&&this.frontRightWheelTrans.name!==""?this.frontRightWheelTrans.name:null,backLeftWheelName=this.backLeftWheelTrans!=null&&this.backLeftWheelTrans.name!=null&&this.backLeftWheelTrans.name!==""?this.backLeftWheelTrans.name:null,backRightWheelName=this.backRightWheelTrans!=null&&this.backRightWheelTrans.name!=null&&this.backRightWheelTrans.name!==""?this.backRightWheelTrans.name:null,frontLeftWheelLabel=this.frontLeftWheelCollider!=null&&this.frontLeftWheelCollider.name!=null&&this.frontLeftWheelCollider.name!==""?this.frontLeftWheelCollider.name:null,frontRightWheelLabel=this.frontRightWheelCollider!=null&&this.frontRightWheelCollider.name!=null&&this.frontRightWheelCollider.name!==""?this.frontRightWheelCollider.name:null,backLeftWheelLabel=this.backLeftWheelCollider!=null&&this.backLeftWheelCollider.name!=null&&this.backLeftWheelCollider.name!==""?this.backLeftWheelCollider.name:null,backRightWheelLabel=this.backRightWheelCollider!=null&&this.backRightWheelCollider.name!=null&&this.backRightWheelCollider.name!==""?this.backRightWheelCollider.name:null;frontLeftWheelLabel!=null&&(this.FRONT_LEFT=this.raycastVehicle.getWheelIndexByName(frontLeftWheelLabel));frontRightWheelLabel!=null&&(this.FRONT_RIGHT=this.raycastVehicle.getWheelIndexByName(frontRightWheelLabel));backLeftWheelLabel!=null&&(this.BACK_LEFT=this.raycastVehicle.getWheelIndexByName(backLeftWheelLabel));backRightWheelLabel!=null&&(this.BACK_RIGHT=this.raycastVehicle.getWheelIndexByName(backRightWheelLabel));brakeLightslName!=null&&(this.brakeLightsMesh=this.getChildNode(brakeLightslName,BABYLON.SearchType.IndexOf,!1),this.brakeLightsMesh!=null&&(this.brakeLightsMesh.isVisible=!1));reverseLightslName!=null&&(this.reverseLightsMesh=this.getChildNode(reverseLightslName,BABYLON.SearchType.IndexOf,!1),this.reverseLightsMesh!=null&&(this.reverseLightsMesh.isVisible=!1));this.raycastVehicle.getNumWheels()>=4?(this.BACK_LEFT>=0&&backLeftWheelName!=null&&(this.m_backLeftWheel=this.raycastVehicle.getWheelInfo(this.BACK_LEFT),this.backLeftWheelMesh=this.getChildNode(backLeftWheelName,BABYLON.SearchType.IndexOf,!1),this.backLeftWheelMesh!=null&&(this.m_backLeftWheel.spinner=BABYLON.SceneManager.FindChildTransformNode(this.backLeftWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.BACK_LEFT,this.backLeftWheelMesh),this.backLeftWheelEmitter=new BABYLON.AbstractMesh("Emitter_RL"),this.backLeftWheelEmitter.parent=this.m_backLeftWheel.spinner||this.backLeftWheelMesh,this.backLeftWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.backLeftWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_RL",this.backLeftWheelEmitter),(this.wheelDriveType===0||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_backLeftWheel!=null&&(this.wheelRadius=this.m_backLeftWheel.get_m_wheelsRadius()))),this.BACK_RIGHT>=0&&backRightWheelName!=null&&(this.m_backRightWheel=this.raycastVehicle.getWheelInfo(this.BACK_RIGHT),this.backRightWheelMesh=this.getChildNode(backRightWheelName,BABYLON.SearchType.IndexOf,!1),this.backRightWheelMesh!=null&&(this.m_backRightWheel.spinner=BABYLON.SceneManager.FindChildTransformNode(this.backRightWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.BACK_RIGHT,this.backRightWheelMesh),this.backRightWheelEmitter=new BABYLON.AbstractMesh("Emitter_RR"),this.backRightWheelEmitter.parent=this.m_backRightWheel.spinner||this.backRightWheelMesh,this.backRightWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.backRightWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_RR",this.backRightWheelEmitter),(this.wheelDriveType===0||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_backRightWheel!=null&&(this.wheelRadius=this.m_backRightWheel.get_m_wheelsRadius()))),this.FRONT_LEFT>=0&&frontLeftWheelName!=null&&(this.m_frontLeftWheel=this.raycastVehicle.getWheelInfo(this.FRONT_LEFT),this.frontLeftWheelMesh=this.getChildNode(frontLeftWheelName,BABYLON.SearchType.IndexOf,!1),this.frontLeftWheelMesh!=null&&(this.m_frontLeftWheel.spinner=BABYLON.SceneManager.FindChildTransformNode(this.frontLeftWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.FRONT_LEFT,this.frontLeftWheelMesh),this.frontLeftWheelEmitter=new BABYLON.AbstractMesh("Emitter_FL"),this.frontLeftWheelEmitter.parent=this.m_frontLeftWheel.spinner||this.frontLeftWheelMesh,this.frontLeftWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.frontLeftWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_FL",this.frontLeftWheelEmitter),(this.wheelDriveType===1||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_frontLeftWheel!=null&&(this.wheelRadius=this.m_frontLeftWheel.get_m_wheelsRadius()))),this.FRONT_RIGHT>=0&&frontRightWheelName!=null&&(this.m_frontRightWheel=this.raycastVehicle.getWheelInfo(this.FRONT_RIGHT),this.frontRightWheelMesh=this.getChildNode(frontRightWheelName,BABYLON.SearchType.IndexOf,!1),this.frontRightWheelMesh!=null&&(this.m_frontRightWheel.spinner=BABYLON.SceneManager.FindChildTransformNode(this.frontRightWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.FRONT_RIGHT,this.frontRightWheelMesh),this.frontRightWheelEmitter=new BABYLON.AbstractMesh("Emitter_FR"),this.frontRightWheelEmitter.parent=this.m_frontRightWheel.spinner||this.frontRightWheelMesh,this.frontRightWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.frontRightWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_FR",this.frontRightWheelEmitter),(this.wheelDriveType===1||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_frontRightWheel!=null&&(this.wheelRadius=this.m_frontRightWheel.get_m_wheelsRadius()))),this.raycastVehicle.setShapeTestingMode(this.rayTestingType===1),this.raycastVehicle.setShapeTestingSize(this.wheelRadius*.5),this.raycastVehicle.setShapeTestingCount(this.testPointCount),this.raycastVehicle.setSweepPenetration(this.sweepPenetration),this.raycastVehicle.setEnableMultiRaycast(!0),this.raycastVehicle.setInterpolateNormals(!1),this.raycastVehicle.setMinimumWheelContacts(4),this.raycastVehicle.setSmoothFlyingImpulse(this.smoothFlyingForce),this.raycastVehicle.setTrackConnectionAccel(this.roadConnectAccel),this.raycastVehicle.setStabilizingForce(this.stableDownImpulse),this.raycastVehicle.setCollisionFilterGroup(BABYLON.CollisionFilters.DefaultFilter),this.raycastVehicle.setCollisionFilterMask(BABYLON.CollisionFilters.StaticFilter),this._skidAudioSource==null&&this.backRightWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.backRightWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&this.backLeftWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.backLeftWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&this.frontRightWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.frontRightWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&this.frontLeftWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.frontLeftWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&BABYLON.Tools.Warn("No skid audio source manager found for: "+this.transform.name)):BABYLON.Tools.Warn("Invalid vehicle controller wheel count info for: "+this.transform.name)}else BABYLON.Tools.Warn("No wheel collider information found for: "+this.transform.name);else BABYLON.Tools.Warn("Failed to get rigidbody component: "+this.transform.name)},StandardCarController.prototype.destroyVehicleState=function(){this._rigidbody=null;this._engineAudioSource=null;this._skidAudioSource=null;this.m_frontLeftWheel!=null&&(Ammo.destroy(this.m_frontLeftWheel),this.m_frontLeftWheel=null);this.m_frontRightWheel!=null&&(Ammo.destroy(this.m_frontRightWheel),this.m_frontRightWheel=null);this.m_backLeftWheel!=null&&(Ammo.destroy(this.m_backLeftWheel),this.m_backLeftWheel=null);this.m_backRightWheel!=null&&(Ammo.destroy(this.m_backRightWheel),this.m_backRightWheel=null);this.m_physicsWorld=null;this.raycastVehicle=null;this.frontLeftWheelMesh=null;this.frontRightWheelMesh=null;this.backLeftWheelMesh=null;this.backRightWheelMesh=null;this.frontLeftWheelTrans=null;this.frontRightWheelTrans=null;this.backLeftWheelTrans=null;this.backRightWheelTrans=null;this.frontLeftWheelCollider=null;this.frontRightWheelCollider=null;this.backLeftWheelCollider=null;this.backRightWheelCollider=null},StandardCarController.prototype.drive=function(throttle,steering,braking,drifting,assisted){var deltaTime,throttleSpeed,smoothVisualTurning,autoTurnAngle,smoothSteerAmount,updateFriction,frontSlipFactor;if(assisted===void 0&&(assisted=!0),this.currentForward=BABYLON.Scalar.Clamp(throttle,-1,1),this.currentTurning=BABYLON.Scalar.Clamp(steering,-1,1),this.currentSkidding=braking,this.currentDrifting=drifting,this.handBraking=this.getCurrentSkidding()===!0&&this.handBrakingForce>0,this._rigidbody!=null&&this.raycastVehicle!=null){if(this.FRONT_LEFT>=0&&this.FRONT_RIGHT>=0&&this.BACK_LEFT>=0&&this.BACK_RIGHT>=0){deltaTime=this.getDeltaSeconds();this.engineForce=0;this.wheelBrakingForce=0;this.frontWheelPower=0;this.backWheelPower=0;var gearShiftRatio=this.gearBoxShiftRatios!=null&&this.gearBoxShiftRatios.length>this.gearIndex?this.gearBoxShiftRatios[this.gearIndex]:1,finalGearRatio=gearShiftRatio*this.differentialRatio*this.transmissionRatio,engineMotorTorque=this.getVehicleEngineTorque(this.engineRPM)*Math.abs(this.currentForward),allowedEnginePower=engineMotorTorque*finalGearRatio,allowedBrakingForce=BABYLON.Scalar.Lerp(this.minBrakingForce,this.maxBrakingForce,this.normalizedSpeed)*Math.abs(this.currentForward);if(this.currentForward>0&&this.wheelBurnout===!0&&this.wheelDonuts===!0?this.engineForce=allowedEnginePower:this.currentForward>0?this.forwardSpeed<-1?this.wheelBrakingForce=allowedBrakingForce:this.engineForce=allowedEnginePower:this.currentForward<0?this.forwardSpeed>1?this.wheelBrakingForce=allowedBrakingForce:this.engineForce=-(allowedEnginePower*this.maxReversePower):(this.engineForce=0,this.wheelBrakingForce=10),throttleSpeed=this.throttleEngineSpeed>0?this.throttleEngineSpeed:this.topEngineSpeed,(this.shiftingTime>0||this.americanSpeed>throttleSpeed)&&(this.engineForce=0),assisted===!1?(smoothVisualTurning=0,this.americanSpeed>=10?(autoTurnAngle=BABYLON.Tools.ToRadians(BABYLON.Scalar.Lerp(this.lowSpeedAngle,this.highSpeedAngle,this.normalizedSpeed)),autoTurnAngle*=BABYLON.Scalar.Lerp(this.lowSpeedTurning,this.highSpeedTurning,this.normalizedSpeed)*100,this.physicsSteerAngle=this.currentTurning*autoTurnAngle,smoothVisualTurning=this.currentTurning*BABYLON.Tools.ToRadians(this.maxTurnAngle),this.maxSteerBoost>0&&Math.abs(this.currentTurning)>=.1&&(smoothVisualTurning+=BABYLON.Tools.ToRadians(this.maxSteerBoost)*Math.sign(this.currentTurning))):(this.physicsSteerAngle=this.currentTurning*BABYLON.Tools.ToRadians(this.maxTurnAngle),smoothVisualTurning=this.currentTurning*BABYLON.Tools.ToRadians(this.maxTurnAngle)),this.overSteerSpeed>0&&this.handBraking===!0&&(smoothVisualTurning*=-1),smoothSteerAmount=this.overSteerSpeed>0?this.overSteerSpeed:1,this.visualSteerAngle=BABYLON.Scalar.Lerp(this.visualSteerAngle,smoothVisualTurning,smoothSteerAmount*deltaTime*9)):(this.allowedTurningIncement=BABYLON.Scalar.Lerp(this.lowSpeedTurning,this.highSpeedTurning,this.normalizedSpeed),this.allowedTurningAngle=this.americanSpeed>=10?BABYLON.Scalar.Lerp(BABYLON.Tools.ToRadians(this.lowSpeedAngle),BABYLON.Tools.ToRadians(this.highSpeedAngle),this.normalizedSpeed):BABYLON.Tools.ToRadians(this.maxTurnAngle),this.wheelBurnout===!0&&this.wheelDonuts===!0&&(this.allowedTurningAngle=BABYLON.Tools.ToRadians(this.maxBurnAngle)),this.currentTurning>0?this.physicsSteerAngle<this.allowedTurningAngle&&(this.physicsSteerAngle+=this.allowedTurningIncement):this.currentTurning<0?this.physicsSteerAngle>-this.allowedTurningAngle&&(this.physicsSteerAngle-=this.allowedTurningIncement):this.physicsSteerAngle<-this.allowedTurningIncement?this.physicsSteerAngle+=this.allowedTurningIncement:this.physicsSteerAngle>this.allowedTurningIncement?this.physicsSteerAngle-=this.allowedTurningIncement:this.physicsSteerAngle=0,this.wheelBurnout===!0||this.wheelSkidding==!0?(this.allowedTurningAngle=BABYLON.Tools.ToRadians(this.maxTurnAngle),this.allowedTurningIncement=this.lowSpeedTurning):(this.allowedTurningIncement=BABYLON.Scalar.Lerp(this.lowSpeedTurning,this.highSpeedTurning,this.normalizedSpeed),this.allowedTurningAngle=BABYLON.Scalar.Lerp(BABYLON.Tools.ToRadians(this.lowSpeedAngle),BABYLON.Tools.ToRadians(this.highSpeedAngle),this.normalizedSpeed),this.maxSteerBoost>0&&Math.abs(this.currentTurning)>=.1&&(this.allowedTurningAngle+=BABYLON.Tools.ToRadians(this.maxSteerBoost))),this.overSteerSpeed>0&&this.handBraking===!0&&(this.currentTurning*=-1),this.currentTurning>0?this.visualSteerAngle<this.allowedTurningAngle&&(this.visualSteerAngle+=this.allowedTurningIncement):this.currentTurning<0?this.visualSteerAngle>-this.allowedTurningAngle&&(this.visualSteerAngle-=this.allowedTurningIncement):this.visualSteerAngle<-this.allowedTurningIncement?this.visualSteerAngle+=this.allowedTurningIncement:this.visualSteerAngle>this.allowedTurningIncement?this.visualSteerAngle-=this.allowedTurningIncement:this.visualSteerAngle=0),updateFriction=!0,this.handBraking===!0)this.wheelBurnout=!1,this.wheelDonuts=!1,this.burnoutTimer=0,this.raycastVehicle.lockedWheelIndexes==null&&(this.raycastVehicle.lockedWheelIndexes=[this.BACK_LEFT,this.BACK_RIGHT]),this.americanSpeed>=5&&this.wheelSkidding===!1&&(this.wheelSkidding=!0,this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.set_m_frictionSlip(this.wheelSkidFriction),this.m_frontRightWheel!=null&&this.m_frontRightWheel.set_m_frictionSlip(this.wheelSkidFriction),this.m_backLeftWheel!=null&&this.m_backLeftWheel.set_m_frictionSlip(this.wheelSkidFriction),this.m_backRightWheel!=null&&this.m_backRightWheel.set_m_frictionSlip(this.wheelSkidFriction),updateFriction=!1),this.updateCurrentBrakeDamping(this.linearBrakingForce,this.angularBrakingForce),updateFriction===!0&&this.updateCurrentFrictionSlip(deltaTime*this.skiddingLerpSpeed),this.updateCurrentRotationDelta(0),this.updateCurrentRotationBoost(0),this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_LEFT),this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_RIGHT),this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_LEFT),this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_RIGHT),this.raycastVehicle.setEngineForce(0,this.FRONT_LEFT),this.raycastVehicle.setEngineForce(0,this.FRONT_RIGHT),this.raycastVehicle.setEngineForce(0,this.BACK_LEFT),this.raycastVehicle.setEngineForce(0,this.BACK_RIGHT),this.raycastVehicle.setBrakingForce(0,this.FRONT_LEFT),this.raycastVehicle.setBrakingForce(0,this.FRONT_RIGHT),this.raycastVehicle.setBrakingForce(this.handBrakingForce,this.BACK_LEFT),this.raycastVehicle.setBrakingForce(this.handBrakingForce,this.BACK_RIGHT);else{this.raycastVehicle.lockedWheelIndexes!=null&&(this.raycastVehicle.lockedWheelIndexes=null,this.updateCurrentRotationDelta(0),this.updateCurrentRotationBoost(0));this.wheelSkidding=!1;this.burnoutCoefficient=BABYLON.Scalar.Clamp(this.burnoutCoefficient,1,20);this.burnoutTriggerMark=BABYLON.Scalar.Clamp(this.burnoutTriggerMark,1,20);var isBurnoutSpeed=this.americanSpeed<=this.burnoutTriggerMark,isFullThrottle=this.currentForward<-.9||this.currentForward>.9,isFullTurning=this.currentTurning<-.9||this.currentTurning>.9,wheelLerpSpeed=deltaTime*this.frictionLerpSpeed,wheelBoostSpeed=0;this.burnoutTimer<=0&&isFullThrottle===!0&&isBurnoutSpeed===!0&&this.maxThrottleBurnouts===!0&&(this.burnoutTimer=this.burnoutTimeDelay*.25,this.wheelDonuts=!1,this.wheelBurnout=!0);this.restoreTimer>0&&(this.restoreTimer-=deltaTime,this.restoreTimer<0&&(this.restoreTimer=0),wheelLerpSpeed*=this.burnoutLerpSpeed);this.cooldownTimer>0&&(this.cooldownTimer-=deltaTime,this.cooldownTimer<0&&(this.cooldownTimer=0));this.wheelDonuts===!0?(this.donutSpinTime+=deltaTime,isFullTurning===!1&&(this.burnoutTimer=0)):this.donutSpinTime=0;this.burnoutTimer>0&&isFullThrottle===!0?(wheelBoostSpeed=.1,frontSlipFactor=this.wheelDonuts===!0?1.25:1,this.burnoutCoefficient>=1&&(this.engineForce*=this.burnoutCoefficient),this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.set_m_frictionSlip(this.wheelSkidFriction*frontSlipFactor),this.m_frontRightWheel!=null&&this.m_frontRightWheel.set_m_frictionSlip(this.wheelSkidFriction*frontSlipFactor),this.m_backLeftWheel!=null&&this.m_backLeftWheel.set_m_frictionSlip(this.wheelSkidFriction),this.m_backRightWheel!=null&&this.m_backRightWheel.set_m_frictionSlip(this.wheelSkidFriction),updateFriction=!1,this.burnoutTimer-=deltaTime,this.burnoutTimer<=0&&isFullTurning===!0&&this.cooldownTimer<=0&&this.currentForward>0&&this.currentDrifting===!0&&(this.burnoutTimer=.01,this.wheelDonuts=!0)):(this.burnoutTimer=0,this.donutSpinTime=0,this.wheelDonuts===!0&&(this.wheelDonuts=!1,this.cooldownTimer=this.burnoutTimeDelay*2),this.wheelBurnout===!0&&(this.wheelBurnout=!1,this.restoreTimer=this.burnoutTimeDelay*.75));this.wheelBurnout===!0&&this.wheelDonuts===!0?this.frontWheelPower=this.engineForce*.2:(this.wheelDriveType===1||this.wheelDriveType===2)&&(this.frontWheelPower=this.engineForce);(this.wheelDriveType===0||this.wheelDriveType===2)&&(this.backWheelPower=this.engineForce);this.getFootBraking()===!0?this.updateCurrentBrakeDamping(this.linearBrakingForce*.2,this.angularBrakingForce*.2):this.throttleBrakingForce>0?this.updateCurrentBrakeDamping(this.throttleBrakingForce,this.angularDamping):this.updateCurrentBrakeDamping(this.linearDamping,this.angularDamping);updateFriction===!0&&this.updateCurrentFrictionSlip(wheelLerpSpeed);this.updateCurrentRotationBoost(wheelBoostSpeed);this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_LEFT);this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_RIGHT);this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_LEFT);this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_RIGHT);this.raycastVehicle.setEngineForce(this.frontWheelPower,this.FRONT_LEFT);this.raycastVehicle.setEngineForce(this.frontWheelPower,this.FRONT_RIGHT);this.raycastVehicle.setEngineForce(this.backWheelPower,this.BACK_LEFT);this.raycastVehicle.setEngineForce(this.backWheelPower,this.BACK_RIGHT);this.maxFrontBraking>0?(this.raycastVehicle.setBrakingForce(this.wheelBrakingForce*this.maxFrontBraking,this.FRONT_LEFT),this.raycastVehicle.setBrakingForce(this.wheelBrakingForce*this.maxFrontBraking,this.FRONT_RIGHT)):(this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.FRONT_LEFT),this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.FRONT_RIGHT));this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.BACK_LEFT);this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.BACK_RIGHT)}}this.syncVehicleState()}},StandardCarController.prototype.syncVehicleState=function(){var deltaTime=this.getDeltaSeconds(),gearCount=this.getGearShiftRatioCount(),deadSpeed,pitching,engineSoundClip,smokeIntensityFactor,wheelContactFL,smoke_FL,wheelContactFR,smoke_FR,wheelContactBL,smoke_RL,wheelContactBR,smoke_RR,skidding,skidSoundClip;if(this.shiftingTime>0&&(this.shiftingTime-=deltaTime,this.shiftingTime<0&&(this.shiftingTime=0)),this._rigidbody!=null&&this.raycastVehicle!=null&&(deadSpeed=.2,this.forwardSpeed=this.raycastVehicle.getRawCurrentSpeedKph(),Math.abs(this.forwardSpeed)<deadSpeed&&(this.forwardSpeed=0),this.absoluteSpeed=this.raycastVehicle.getAbsCurrentSpeedKph(),this.absoluteSpeed<deadSpeed&&(this.absoluteSpeed=0),this.americanSpeed=this.absoluteSpeed*BABYLON.System.Kph2Mph,this.normalizedSpeed=BABYLON.Scalar.Clamp(this.absoluteSpeed/this.topEngineSpeed),this.gearBoxShiftRatios!=null&&this.gearIndex>=0&&this.gearIndex<gearCount)){var minimumDelta=Math.min(Math.max(deltaTime,1/200),1),wheelDiameter=this.wheelRadius*2*BABYLON.System.Meter2Inch,finalGearRatio=this.gearBoxShiftRatios[this.gearIndex]*this.differentialRatio*this.transmissionRatio;this.downShift=this.gearBoxShiftRanges!=null&&this.gearBoxShiftRanges.length===this.gearBoxShiftRatios.length?this.gearBoxShiftRanges[this.gearIndex]:1e3;this.clutchSlip=BABYLON.Utilities.LerpClamp(this.clutchSlip,0,1-Math.pow(.01,minimumDelta));this.engineRPM=this.americanSpeed*finalGearRatio*336/wheelDiameter;this.pitchRPM=BABYLON.Utilities.LerpClamp(this.shiftRPM,this.engineRPM,1-this.clutchSlip)+StandardCarController.MIN_RPM;this.americanSpeed<5?this.gearIndex=0:this.engineRPM>this.gearBoxShiftChange?(this.shiftRPM=this.engineRPM,this.clutchSlip=1,this.shiftingTime=this.gearBoxShiftDelay,this.gearIndex<gearCount-1&&this.gearIndex++):this.engineRPM<this.downShift&&(this.shiftRPM=this.engineRPM,this.clutchSlip=1,this.shiftingTime=0,this.gearIndex>0&&this.gearIndex--);this.gearIndex<0?this.gearIndex=0:this.gearIndex>=gearCount&&(this.gearIndex=gearCount-1)}if(this.skidDrawVelocity>0&&this._rigidbody!=null&&(this.m_velocityOffset.copyFrom(this._rigidbody.getLinearVelocity()),this.m_velocityOffset.scaleInPlace(this.skidDrawVelocity)),pitching=0,this.playVehicleSounds===!0&&(pitching=this.getCurrentEnginePitch()*.75),this._engineAudioSource!=null&&(engineSoundClip=this._engineAudioSource.getSoundClip(),engineSoundClip!=null&&engineSoundClip.setPlaybackRate(pitching)),this.smokeDonuts=BABYLON.Scalar.Clamp(this.smokeDonuts,1,10),smokeIntensityFactor=this.smokeIntensity,this.wheelBurnout===!0&&this.wheelDonuts===!0&&(smokeIntensityFactor*=this.smokeDonuts),this.SKID_FL=0,this.SKID_FR=0,this.SKID_RL=0,this.SKID_RR=0,this.m_frontLeftWheel!=null)if(wheelContactFL=this.m_frontLeftWheel.get_m_raycastInfo().get_m_groundObject()!==0,this.SKID_FL=this.updateCurrentSkidInfo(this.m_frontLeftWheel),this.SKID_FL<this.skidThreashold&&(this.SKID_FL=0),this.SKID_FL>0&&wheelContactFL===!0){var contactPointFL=this.m_frontLeftWheel.get_m_raycastInfo().get_m_contactPointWS(),contactNormalFL=this.m_frontLeftWheel.get_m_raycastInfo().get_m_contactNormalWS(),skidPosFL=new BABYLON.Vector3(contactPointFL.x(),contactPointFL.y(),contactPointFL.z()),skidNormFL=new BABYLON.Vector3(contactNormalFL.x(),contactNormalFL.y(),contactNormalFL.z()),skidScaleFL=BABYLON.Scalar.Normalize(this.SKID_FL,this.skidThreashold,1);this.skidDrawVelocity>0&&skidPosFL.addInPlace(this.m_velocityOffset);this.m_frontLeftWheelSkid=PROJECT.SkidMarkManager.AddSkidMarkSegment(skidPosFL,skidNormFL,skidScaleFL,this.m_frontLeftWheelSkid);this.frontLeftWheelParticle!=null&&(this.frontLeftWheelParticle.isStarted()===!1&&this.frontLeftWheelParticle.start(),smoke_FL=this.SKID_FL*this.SKID_FL,this.frontLeftWheelParticle.emitRate=smokeIntensityFactor*smoke_FL,this.frontLeftWheelParticle.minSize=.2*smoke_FL+.2,this.frontLeftWheelParticle.maxSize=1.5*smoke_FL+1.2)}else this.frontLeftWheelParticle!=null&&(this.frontLeftWheelParticle.emitRate=0),this.m_frontLeftWheelSkid=-1;if(this.m_frontRightWheel!=null)if(wheelContactFR=this.m_frontRightWheel.get_m_raycastInfo().get_m_groundObject()!==0,this.SKID_FR=this.updateCurrentSkidInfo(this.m_frontRightWheel),this.SKID_FR<this.skidThreashold&&(this.SKID_FR=0),this.SKID_FR>0&&wheelContactFR===!0){var contactPointFR=this.m_frontRightWheel.get_m_raycastInfo().get_m_contactPointWS(),contactNormalFR=this.m_frontRightWheel.get_m_raycastInfo().get_m_contactNormalWS(),skidPosFR=new BABYLON.Vector3(contactPointFR.x(),contactPointFR.y(),contactPointFR.z()),skidNormFR=new BABYLON.Vector3(contactNormalFR.x(),contactNormalFR.y(),contactNormalFR.z()),skidScaleFR=BABYLON.Scalar.Normalize(this.SKID_FR,this.skidThreashold,1);this.skidDrawVelocity>0&&skidPosFR.addInPlace(this.m_velocityOffset);this.m_frontRightWheelSkid=PROJECT.SkidMarkManager.AddSkidMarkSegment(skidPosFR,skidNormFR,skidScaleFR,this.m_frontRightWheelSkid);this.frontRightWheelParticle!=null&&(this.frontRightWheelParticle.isStarted()===!1&&this.frontRightWheelParticle.start(),smoke_FR=this.SKID_FR*this.SKID_FR,this.frontRightWheelParticle.emitRate=smokeIntensityFactor*smoke_FR,this.frontRightWheelParticle.minSize=.2*smoke_FR+.2,this.frontRightWheelParticle.maxSize=1.5*smoke_FR+1.2)}else this.frontRightWheelParticle!=null&&(this.frontRightWheelParticle.emitRate=0),this.m_frontRightWheelSkid=-1;if((this.wheelBurnout==!0||this.restoreTimer>0)&&(this.SKID_FL*=this.burnoutWheelPitch,this.SKID_FR*=this.burnoutWheelPitch),this.SKID_FL*=.75,this.SKID_FR*=.75,this.m_backLeftWheel!=null)if(wheelContactBL=this.m_backLeftWheel.get_m_raycastInfo().get_m_groundObject()!==0,this.SKID_RL=this.updateCurrentSkidInfo(this.m_backLeftWheel),this.SKID_RL<this.skidThreashold&&(this.SKID_RL=0),this.SKID_RL>0&&wheelContactBL===!0){var contactPointRL=this.m_backLeftWheel.get_m_raycastInfo().get_m_contactPointWS(),contactNormalRL=this.m_backLeftWheel.get_m_raycastInfo().get_m_contactNormalWS(),skidPosRL=new BABYLON.Vector3(contactPointRL.x(),contactPointRL.y(),contactPointRL.z()),skidNormRL=new BABYLON.Vector3(contactNormalRL.x(),contactNormalRL.y(),contactNormalRL.z()),skidScaleRL=BABYLON.Scalar.Normalize(this.SKID_RL,this.skidThreashold,1);this.skidDrawVelocity>0&&skidPosRL.addInPlace(this.m_velocityOffset);this.m_backLeftWheelSkid=PROJECT.SkidMarkManager.AddSkidMarkSegment(skidPosRL,skidNormRL,skidScaleRL,this.m_backLeftWheelSkid);this.backLeftWheelParticle!=null&&(this.backLeftWheelParticle.isStarted()===!1&&this.backLeftWheelParticle.start(),smoke_RL=this.SKID_RL*this.SKID_RL,this.backLeftWheelParticle.emitRate=smokeIntensityFactor*smoke_RL,this.backLeftWheelParticle.minSize=.2*smoke_RL+.2,this.backLeftWheelParticle.maxSize=1.5*smoke_RL+1.2)}else this.backLeftWheelParticle!=null&&(this.backLeftWheelParticle.emitRate=0),this.m_backLeftWheelSkid=-1;if(this.m_backRightWheel!=null)if(wheelContactBR=this.m_backRightWheel.get_m_raycastInfo().get_m_groundObject()!==0,this.SKID_RR=this.updateCurrentSkidInfo(this.m_backRightWheel),this.SKID_RR<this.skidThreashold&&(this.SKID_RR=0),this.SKID_RR>0&&wheelContactBR===!0){var contactPointRR=this.m_backRightWheel.get_m_raycastInfo().get_m_contactPointWS(),contactNormalRR=this.m_backRightWheel.get_m_raycastInfo().get_m_contactNormalWS(),skidPosRR=new BABYLON.Vector3(contactPointRR.x(),contactPointRR.y(),contactPointRR.z()),skidNormRR=new BABYLON.Vector3(contactNormalRR.x(),contactNormalRR.y(),contactNormalRR.z()),skidScaleRR=BABYLON.Scalar.Normalize(this.SKID_RR,this.skidThreashold,1);this.skidDrawVelocity>0&&skidPosRR.addInPlace(this.m_velocityOffset);this.m_backRightWheelSkid=PROJECT.SkidMarkManager.AddSkidMarkSegment(skidPosRR,skidNormRR,skidScaleRR,this.m_backRightWheelSkid);this.backRightWheelParticle!=null&&(this.backRightWheelParticle.isStarted()===!1&&this.backRightWheelParticle.start(),smoke_RR=this.SKID_RR*this.SKID_RR,this.backRightWheelParticle.emitRate=smokeIntensityFactor*smoke_RR,this.backRightWheelParticle.minSize=.2*smoke_RR+.2,this.backRightWheelParticle.maxSize=1.5*smoke_RR+1.2)}else this.backRightWheelParticle!=null&&(this.backRightWheelParticle.emitRate=0),this.m_backRightWheelSkid=-1;(this.wheelBurnout==!0||this.restoreTimer>0)&&(this.SKID_RL*=this.burnoutWheelPitch,this.SKID_RR*=this.burnoutWheelPitch);skidding=0;this.playVehicleSounds===!0&&(this.SKID_FL>skidding&&(skidding=this.SKID_FL),this.SKID_FR>skidding&&(skidding=this.SKID_FR),this.SKID_RL>skidding&&(skidding=this.SKID_RL),this.SKID_RR>skidding&&(skidding=this.SKID_RR));this._skidAudioSource!=null&&(skidSoundClip=this._skidAudioSource.getSoundClip(),skidSoundClip!=null&&skidSoundClip.setPlaybackRate(skidding));this.brakeLightsMesh!=null&&(this.brakeLightsMesh.isVisible=this.getFootBraking()||this.getHandBraking());this.reverseLightsMesh!=null&&(this.reverseLightsMesh.isVisible=this.getReverseThrottle())},StandardCarController.prototype.getVehicleEngineTorque=function(rpm){var result=0;return this.engineTorqueCurve!=null&&(result=BABYLON.Utilities.SampleAnimationFloat(this.engineTorqueCurve,BABYLON.Scalar.Clamp(rpm,StandardCarController.MIN_RPM,StandardCarController.MAX_RPM))*this.powerCoefficient),result},StandardCarController.prototype.createSmokeParticleSystem=function(name,emitter){var result=new BABYLON.ParticleSystem(name,1e4,this.scene);return result.blendMode=BABYLON.ParticleSystem.BLENDMODE_STANDARD,result.particleTexture=this.smokeTexture,result.emitter=emitter,result.emitRate=0,result.updateSpeed=.01,result.minSize=.2,result.maxSize=1.3,result.minAngularSpeed=-1.5,result.maxAngularSpeed=1.5,result.minLifeTime=3,result.maxLifeTime=5,result.addVelocityGradient(0,1),result.addVelocityGradient(.1,.7),result.addVelocityGradient(.7,.2),result.addVelocityGradient(1,.05),result.gravity=new BABYLON.Vector3(0,-.1,0),result.minEmitBox=new BABYLON.Vector3(0,-.25,0),result.maxEmitBox=new BABYLON.Vector3(0,-.25,0),result.direction1=new BABYLON.Vector3(-1,-1,-1),result.direction2=new BABYLON.Vector3(1,1,1),result.color1=new BABYLON.Color4(.95,.95,.95,this.smokeOpacity),result.color2=new BABYLON.Color4(.85,.85,.85,this.smokeOpacity),result.colorDead=new BABYLON.Color4(.9,.9,.9,this.smokeOpacity*.5),result},StandardCarController.prototype.updateCurrentSkidInfo=function(wheel){return this.getPowerSliding()===!0?BABYLON.Scalar.Lerp(0,1,this.normalizedSpeed):BABYLON.Scalar.Clamp(1-wheel.get_m_skidInfo())},StandardCarController.prototype.updateCurrentBrakeDamping=function(linear,angular){this._rigidbody!=null&&this._rigidbody.setDamping(linear,angular)},StandardCarController.prototype.updateCurrentRotationDelta=function(delta){this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.set_m_deltaRotation(delta);this.m_frontRightWheel!=null&&this.m_frontRightWheel.set_m_deltaRotation(delta);this.m_backLeftWheel!=null&&this.m_backLeftWheel.set_m_deltaRotation(delta);this.m_backRightWheel!=null&&this.m_backRightWheel.set_m_deltaRotation(delta)},StandardCarController.prototype.updateCurrentRotationBoost=function(boost){(this.wheelDriveType===1||this.wheelDriveType===2)&&(this.m_frontLeftWheel!=null&&(this.m_frontLeftWheel.rotationBoost=boost),this.m_frontRightWheel!=null&&(this.m_frontRightWheel.rotationBoost=boost));(this.wheelDriveType===0||this.wheelDriveType===2)&&(this.m_backLeftWheel!=null&&(this.m_backLeftWheel.rotationBoost=boost),this.m_backRightWheel!=null&&(this.m_backRightWheel.rotationBoost=boost))},StandardCarController.prototype.updateCurrentFrictionSlip=function(lerpSpeed){var frontLeftFriction,frontRightFriction,backLeftFriction,backRightFriction;this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.defaultFriction!=null&&(frontLeftFriction=this.m_frontLeftWheel.get_m_frictionSlip(),frontLeftFriction<this.m_frontLeftWheel.defaultFriction?(frontLeftFriction=BABYLON.Scalar.Lerp(frontLeftFriction,this.m_frontLeftWheel.defaultFriction,lerpSpeed),this.m_frontLeftWheel.set_m_frictionSlip(frontLeftFriction)):frontLeftFriction>this.m_frontLeftWheel.defaultFriction&&this.m_frontLeftWheel.set_m_frictionSlip(this.m_frontLeftWheel.defaultFriction));this.m_frontRightWheel!=null&&this.m_frontRightWheel.defaultFriction!=null&&(frontRightFriction=this.m_frontRightWheel.get_m_frictionSlip(),frontRightFriction!==this.m_frontRightWheel.defaultFriction?(frontRightFriction=BABYLON.Scalar.Lerp(frontRightFriction,this.m_frontRightWheel.defaultFriction,lerpSpeed),this.m_frontRightWheel.set_m_frictionSlip(frontRightFriction)):frontRightFriction>this.m_frontRightWheel.defaultFriction&&this.m_frontRightWheel.set_m_frictionSlip(this.m_frontRightWheel.defaultFriction));this.m_backLeftWheel!=null&&this.m_backLeftWheel.defaultFriction!=null&&(backLeftFriction=this.m_backLeftWheel.get_m_frictionSlip(),backLeftFriction!==this.m_backLeftWheel.defaultFriction?(backLeftFriction=BABYLON.Scalar.Lerp(backLeftFriction,this.m_backLeftWheel.defaultFriction,lerpSpeed),this.m_backLeftWheel.set_m_frictionSlip(backLeftFriction)):backLeftFriction>this.m_backLeftWheel.defaultFriction&&this.m_backLeftWheel.set_m_frictionSlip(this.m_backLeftWheel.defaultFriction));this.m_backRightWheel!=null&&this.m_backRightWheel.defaultFriction!=null&&(backRightFriction=this.m_backRightWheel.get_m_frictionSlip(),backRightFriction!==this.m_backRightWheel.defaultFriction?(backRightFriction=BABYLON.Scalar.Lerp(backRightFriction,this.m_backRightWheel.defaultFriction,lerpSpeed),this.m_backRightWheel.set_m_frictionSlip(backRightFriction)):backRightFriction>this.m_backRightWheel.defaultFriction&&this.m_backRightWheel.set_m_frictionSlip(this.m_backRightWheel.defaultFriction))},StandardCarController.MIN_RPM=1e3,StandardCarController.MAX_RPM=6e3,StandardCarController}(BABYLON.ScriptComponent);PROJECT.StandardCarController=StandardCarController}(PROJECT||(PROJECT={})),function(PROJECT){var VehicleCameraManager=function(_super){function VehicleCameraManager(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.enableCamera=!1,_this.followHeight=1.75,_this.setCameraPitch=20,_this.rotationDamping=5,_this.minimumDistance=6,_this.maximumDistance=8,_this.buttonCamera=BABYLON.Xbox360Button.Y,_this.keyboardCamera=BABYLON.UserInputKey.P,_this.firstPerson=!1,_this.cameraPivot=null,_this.targetEulers=BABYLON.Vector3.Zero(),_this.cameraEulers=BABYLON.Vector3.Zero(),_this.cameraRotation=BABYLON.Quaternion.Zero(),_this.cameraPivotOffset=BABYLON.Vector3.Zero(),_this.cameraBoomPosition=BABYLON.Vector3.Zero(),_this.autoAttachCamera=!1,_this.m_cameraTransform=null,_this.m_inputController=null,_this.m_standardController=null,_this.m_donutCameraLock=new BABYLON.Vector3(0,.5,7.5),_this.m_firstPersonOffset=new BABYLON.Vector3(-.25,1,-.485),_this.smoothDeltaTime=0,_this}return __extends(VehicleCameraManager,_super),VehicleCameraManager.prototype.awake=function(){this.awakeCameraManager()},VehicleCameraManager.prototype.start=function(){this.initCameraManager()},VehicleCameraManager.prototype.update=function(){this.updateCameraManager()},VehicleCameraManager.prototype.destroy=function(){this.destroyCameraManager()},VehicleCameraManager.prototype.awakeCameraManager=function(){var donutCameraLock,firstPersonOffset;this.enableCamera=this.getProperty("enableCamera",this.enableCamera);this.followHeight=this.getProperty("followHeight",this.followHeight);this.setCameraPitch=this.getProperty("setCameraPitch",this.setCameraPitch);this.rotationDamping=this.getProperty("rotationDamping",this.rotationDamping);this.minimumDistance=this.getProperty("minimumDistance",this.minimumDistance);this.maximumDistance=this.getProperty("maximumDistance",this.maximumDistance);this.autoAttachCamera=this.getProperty("attachCamera",this.autoAttachCamera);donutCameraLock=this.getProperty("donutCameraLock");donutCameraLock!=null&&(this.m_donutCameraLock=BABYLON.Utilities.ParseVector3(donutCameraLock));firstPersonOffset=this.getProperty("firstPersonOffset");firstPersonOffset!=null&&(this.m_firstPersonOffset=BABYLON.Utilities.ParseVector3(firstPersonOffset));this.rotationDamping<=0&&(this.rotationDamping=3)},VehicleCameraManager.prototype.initCameraManager=function(){var _this=this;this.m_standardController=this.getComponent("PROJECT.StandardCarController");this.m_inputController=this.getComponent("PROJECT.VehicleInputController");this.m_inputController!=null&&(BABYLON.SceneManager.OnKeyboardPress(this.keyboardCamera,function(){_this.togglePlayerCamera()}),BABYLON.SceneManager.OnGamepadButtonPress(this.buttonCamera,function(){_this.togglePlayerCamera()}));this.cameraPivot=new BABYLON.TransformNode(this.transform.name+".CameraPivot",this.scene);this.cameraPivot.parent=null;this.cameraPivot.position=this.transform.position.clone();this.cameraPivot.rotationQuaternion=this.transform.rotationQuaternion.clone()},VehicleCameraManager.prototype.updateCameraManager=function(){this.m_cameraTransform==null&&this.autoAttachCamera===!0&&this.m_inputController!=null&&this.attachPlayerCamera(this.m_inputController.playerNumber);this.firstPerson===!0?this.firstPersonCamera():this.thirdPersonCamera()},VehicleCameraManager.prototype.destroyCameraManager=function(){this.m_donutCameraLock=null;this.m_standardController=null;this.m_cameraTransform=null},VehicleCameraManager.prototype.attachPlayerCamera=function(player){if(this.m_cameraTransform==null){var playerCamera=player<=0||player>4?1:player;this.m_cameraTransform=PROJECT.UniversalCameraSystem.GetCameraTransform(this.scene,playerCamera);this.m_cameraTransform!=null&&(this.m_cameraTransform.parent=this.cameraPivot,this.m_cameraTransform.position.copyFrom(this.cameraBoomPosition),this.m_cameraTransform.rotationQuaternion=BABYLON.Utilities.FromEuler(this.setCameraPitch,0,0))}},VehicleCameraManager.prototype.togglePlayerCamera=function(){this.firstPerson=!this.firstPerson},VehicleCameraManager.prototype.firstPersonCamera=function(){if(this.enableCamera===!0&&this.m_cameraTransform!=null&&this.m_standardController!=null){var target=this.transform;this.cameraPivot.rotationQuaternion.copyFrom(target.rotationQuaternion);BABYLON.Utilities.GetAbsolutePositionToRef(this.transform,this.cameraPivot.position);this.m_cameraTransform.position.copyFrom(this.m_firstPersonOffset);BABYLON.Utilities.FromEulerToRef(0,0,0,this.m_cameraTransform.rotationQuaternion)}},VehicleCameraManager.prototype.thirdPersonCamera=function(){var turnDampener,targetDistance;if(this.enableCamera===!0&&this.cameraPivot!=null&&this.m_cameraTransform!=null&&this.m_standardController!=null){this.cameraPivotOffset.set(0,this.followHeight,0);BABYLON.Utilities.GetAbsolutePositionToRef(this.transform,this.cameraPivot.position,this.cameraPivotOffset);var target=this.transform,deltaTime=this.getDeltaSeconds(),deltaFactor=BABYLON.System.SmoothDeltaFactor;this.smoothDeltaTime=deltaFactor*deltaTime+(1-deltaFactor)*this.smoothDeltaTime;turnDampener=this.smoothDeltaTime*this.rotationDamping;target.rotationQuaternion.toEulerAnglesToRef(this.targetEulers);this.cameraPivot.rotationQuaternion.toEulerAnglesToRef(this.cameraEulers);BABYLON.Quaternion.FromEulerAnglesToRef(this.cameraEulers.x,this.targetEulers.y,this.cameraEulers.z,this.cameraRotation);BABYLON.Quaternion.SlerpToRef(this.cameraPivot.rotationQuaternion,this.cameraRotation,turnDampener,this.cameraPivot.rotationQuaternion);targetDistance=BABYLON.Scalar.Lerp(this.minimumDistance,this.maximumDistance,this.m_standardController.getNormalizedSpeed());this.cameraBoomPosition.set(0,0,-targetDistance);this.m_cameraTransform.position.copyFrom(this.cameraBoomPosition);BABYLON.Utilities.FromEulerToRef(this.setCameraPitch,0,0,this.m_cameraTransform.rotationQuaternion)}},VehicleCameraManager}(BABYLON.ScriptComponent);PROJECT.VehicleCameraManager=VehicleCameraManager}(PROJECT||(PROJECT={})),function(PROJECT){var VehicleInputController=function(_super){function VehicleInputController(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.playerDeltaX=0,_this.playerDeltaY=0,_this.playerMouseX=0,_this.playerMouseY=0,_this.inBrakingZone=!1,_this.brakingZoneTag="",_this.waypointPosition=BABYLON.Vector3.Zero(),_this.waypointCount=0,_this.waypointIndex=0,_this.nextTargetSpeed=0,_this.prevTargetSpeed=0,_this.lastMovementTime=0,_this.vehicleResetCheck=0,_this.showChaseRabbit=!1,_this.showSensorLines=!1,_this.rabbitTrackerLine=null,_this.rabbitTrackerColor=new BABYLON.Color3(1,1,1),_this.greenTrackingColor=new BABYLON.Color3(0,1,0),_this.redTrackingColor=new BABYLON.Color3(1,0,0),_this.localTargetPosition=new BABYLON.Vector3(0,0,0),_this.mainCenterSensorLine=null,_this.mainRightSensorLine=null,_this.mainLeftSensorLine=null,_this.angleRightSensorLine=null,_this.angleLeftSensorLine=null,_this.sideRightSensorLine=null,_this.sideLeftSensorLine=null,_this.sensorStartPos=BABYLON.Vector3.Zero(),_this.sensorPointPos=BABYLON.Vector3.Zero(),_this.sensorAnglePos=BABYLON.Vector3.Zero(),_this.rsideStartPos=BABYLON.Vector3.Zero(),_this.rsidePointPos=BABYLON.Vector3.Zero(),_this.lsideStartPos=BABYLON.Vector3.Zero(),_this.lsidePointPos=BABYLON.Vector3.Zero(),_this.tempScaleVector=BABYLON.Vector3.Zero(),_this.trackVehiclePosition=BABYLON.Vector3.Zero(),_this.trackRabbitPosition=BABYLON.Vector3.Zero(),_this.enableInput=!1,_this.resetTiming=3,_this.playerNumber=BABYLON.PlayerNumber.One,_this.triggerForward=BABYLON.Xbox360Trigger.Right,_this.keyboardForawrd=BABYLON.UserInputKey.W,_this.auxKeyboardForawrd=BABYLON.UserInputKey.UpArrow,_this.triggerBackwards=BABYLON.Xbox360Trigger.Left,_this.keyboardBackwards=BABYLON.UserInputKey.S,_this.auxKeyboardBackwards=BABYLON.UserInputKey.DownArrow,_this.buttonHandbrake=BABYLON.Xbox360Button.X,_this.keyboardHandbrake=BABYLON.UserInputKey.SpaceBar,_this.buttonDonut=BABYLON.Xbox360Button.B,_this.keyboardDonut=BABYLON.UserInputKey.Shift,_this.raceLineNode=0,_this.minLookAhead=5,_this.maxLookAhead=50,_this.driverSkillLevel=1,_this.chaseRabbitSpeed=1,_this.throttleSensitivity=1,_this.steeringSensitivity=1,_this.brakingSensitivity=1,_this.brakingTurnAngle=20,_this.brakingSpeedLimit=40,_this.skiddingSpeedLimit=80,_this.linearDampenForce=.1,_this.driveSpeedMultiplier=5,_this.resetMovingTimeout=5,_this.maxRaceTrackSpeed=0,_this.handBrakeZoneTag="HandBrake",_this.trackManagerIdentity="TrackManager",_this.sensorLength=8,_this.spacerWidths=.85,_this.angleFactors=1.5,_this.initialOffsetX=1,_this.initialOffsetY=.5,_this.initialOffsetZ=2,_this.sidewaysLength=1,_this.avoidanceFactor=.5,_this.reversingFlag=!1,_this.reversingTime=0,_this.reversingWait=2,_this.reversingFor=1.5,_this.m_chaseRabbitMesh=null,_this.m_circuitInterfaces=null,_this.m_circuitRaceLine_1=null,_this.m_circuitRaceLine_2=null,_this.m_circuitRaceLine_3=null,_this.m_circuitRaceLine_4=null,_this.m_circuitRaceLine_5=null,_this.m_rigidbodyPhysics=null,_this.m_standardCarController=null,_this}return __extends(VehicleInputController,_super),VehicleInputController.prototype.getPlayerDeltaX=function(){return this.playerDeltaX},VehicleInputController.prototype.getPlayerDeltaY=function(){return this.playerDeltaY},VehicleInputController.prototype.getPlayerMouseX=function(){return this.playerMouseX},VehicleInputController.prototype.getPlayerMouseY=function(){return this.playerMouseY},VehicleInputController.prototype.getWaypointIndex=function(){return this.waypointIndex},VehicleInputController.prototype.getChaseRabbitMesh=function(){return this.m_chaseRabbitMesh},VehicleInputController.prototype.resetChaseRabbitMesh=function(){this.m_chaseRabbitMesh!=null&&(this.m_chaseRabbitMesh.position=this.transform.position.clone(),this.m_chaseRabbitMesh.rotationQuaternion=this.transform.rotationQuaternion.clone())},VehicleInputController.prototype.awake=function(){this.awakeVehicleController()},VehicleInputController.prototype.start=function(){this.initVehicleController()},VehicleInputController.prototype.update=function(){this.updateVehicleController()},VehicleInputController.prototype.destroy=function(){this.destroyVehicleController()},VehicleInputController.prototype.awakeVehicleController=function(){this.enableInput=this.getProperty("enableInput",this.enableInput);this.resetTiming=this.getProperty("resetTiming",this.resetTiming);this.playerNumber=this.getProperty("playerNumber",this.playerNumber);this.showChaseRabbit=this.getProperty("showChaseRabbit",this.showChaseRabbit);this.showSensorLines=this.getProperty("showSensorLines",this.showSensorLines);this.minLookAhead=this.getProperty("minLookAhead",this.minLookAhead);this.maxLookAhead=this.getProperty("maxLookAhead",this.maxLookAhead);this.handBrakeZoneTag=this.getProperty("handBrakeZoneTag",this.handBrakeZoneTag);this.driverSkillLevel=this.getProperty("driverSkillLevel",this.driverSkillLevel);this.throttleSensitivity=this.getProperty("throttleSensitivity",this.throttleSensitivity);this.steeringSensitivity=this.getProperty("steeringSensitivity",this.steeringSensitivity);this.brakingSensitivity=this.getProperty("brakingSensitivity",this.brakingSensitivity);this.brakingTurnAngle=this.getProperty("brakingTurnAngle",this.brakingTurnAngle);this.brakingSpeedLimit=this.getProperty("brakingSpeedLimit",this.brakingSpeedLimit);this.skiddingSpeedLimit=this.getProperty("skiddingSpeedLimit",this.skiddingSpeedLimit);this.linearDampenForce=this.getProperty("linearDampenForce",this.linearDampenForce);this.resetMovingTimeout=this.getProperty("resetMovingTimeout",this.resetMovingTimeout);this.driveSpeedMultiplier=this.getProperty("driveSpeedMultiplier",this.driveSpeedMultiplier);this.maxRaceTrackSpeed=this.getProperty("maxRaceTrackSpeed",this.maxRaceTrackSpeed);this.trackManagerIdentity=this.getProperty("trackManagerIdentity",this.trackManagerIdentity);this.sensorLength=this.getProperty("sensorLength",this.sensorLength);this.spacerWidths=this.getProperty("spacerWidths",this.spacerWidths);this.angleFactors=this.getProperty("angleFactors",this.angleFactors);this.initialOffsetX=this.getProperty("initialOffsetX",this.initialOffsetX);this.initialOffsetY=this.getProperty("initialOffsetY",this.initialOffsetY);this.initialOffsetZ=this.getProperty("initialOffsetZ",this.initialOffsetZ);this.sidewaysLength=this.getProperty("sidewaysLength",this.sidewaysLength);this.avoidanceFactor=this.getProperty("avoidanceFactor",this.avoidanceFactor);this.throttleSensitivity<=0&&(this.throttleSensitivity=1);this.steeringSensitivity<=0&&(this.steeringSensitivity=1);this.brakingSensitivity<=0&&(this.brakingSensitivity=1);this.linearDampenForce<=0&&(this.linearDampenForce=.1);this.angleFactors<=0&&(this.angleFactors=1.5);this.sensorLength<=0&&(this.sensorLength=8);this.sidewaysLength<=0&&(this.sidewaysLength=1);this.brakingSpeedLimit<=0&&(this.brakingSpeedLimit=40);this.skiddingSpeedLimit<=0&&(this.skiddingSpeedLimit=80);this.driveSpeedMultiplier<=1&&(this.driveSpeedMultiplier=1);(this.handBrakeZoneTag==null||this.handBrakeZoneTag==="")&&(this.handBrakeZoneTag="HandBrake");(this.trackManagerIdentity==null||this.trackManagerIdentity==="")&&(this.trackManagerIdentity="TrackManager");var initialRaceLineNode=this.getProperty("initialRaceLineNode",1);this.raceLineNode=initialRaceLineNode-1},VehicleInputController.prototype.initVehicleController=function(){var _this=this,waypointsTransform,raceTrackManager;this.m_rigidbodyPhysics=this.getComponent("BABYLON.RigidbodyPhysics");this.m_rigidbodyPhysics!=null?(this.m_rigidbodyPhysics.onCollisionEnterObservable.add(function(mesh){var tag=BABYLON.SceneManager.GetTransformTag(mesh);tag==="Vehicle"||tag===_this.handBrakeZoneTag&&(_this.inBrakingZone=!0,_this.brakingZoneTag=tag)}),this.m_rigidbodyPhysics.onCollisionStayObservable.add(function(mesh){if(mesh!=null){var tag=BABYLON.SceneManager.GetTransformTag(mesh);tag==="Vehicle"||tag===_this.handBrakeZoneTag}}),this.m_rigidbodyPhysics.onCollisionExitObservable.add(function(mesh){if(mesh!=null){var tag=BABYLON.SceneManager.GetTransformTag(mesh);tag==="Vehicle"||tag===_this.handBrakeZoneTag&&(_this.inBrakingZone=!1,_this.brakingZoneTag="")}})):BABYLON.Tools.Warn("Null rigidbody physics for: "+this.transform.name);this.m_standardCarController=this.getComponent("PROJECT.StandardCarController");this.m_standardCarController!=null?this.m_standardCarController.playVehicleSounds=!0:BABYLON.Tools.Warn("Null standard car controller for: "+this.transform.name);waypointsTransform=BABYLON.SceneManager.GetTransformNode(this.scene,this.trackManagerIdentity);waypointsTransform!=null?(raceTrackManager=BABYLON.SceneManager.FindScriptComponent(waypointsTransform,"PROJECT.RaceTrackManager"),raceTrackManager!=null?(this.waypointCount=0,this.waypointIndex=0,this.m_circuitInterfaces=raceTrackManager.getTrackNodes(),this.m_circuitRaceLine_1=raceTrackManager.getControlPoints(0),this.m_circuitRaceLine_2=raceTrackManager.getControlPoints(1),this.m_circuitRaceLine_3=raceTrackManager.getControlPoints(2),this.m_circuitRaceLine_4=raceTrackManager.getControlPoints(3),this.m_circuitRaceLine_5=raceTrackManager.getControlPoints(4),this.m_circuitInterfaces!=null&&this.m_circuitInterfaces.length>0&&(this.waypointCount=this.m_circuitInterfaces.length)):BABYLON.Tools.Warn("Fail to locate race track manager for: "+this.transform.name)):BABYLON.Tools.Warn("Fail to locate race track manager '"+this.trackManagerIdentity+"' for: "+this.transform.name)},VehicleInputController.prototype.updateVehicleController=function(){if(this.enableInput===!0&&(this.playerNumber===0?this.updateAutoPilotDrive():this.updateManualInputDrive()),this.resetTiming>0&&this.m_standardCarController!=null){var gameTime=BABYLON.SceneManager.GetGameTime();(this.transform.up.y>.5||this.m_standardCarController.getAbsoluteSpeed()>1)&&(this.vehicleResetCheck=gameTime);gameTime>this.vehicleResetCheck+this.resetTiming&&(this.transform.position.addInPlace(BABYLON.Vector3.Up().scale(.5)),BABYLON.Utilities.LookRotationToRef(this.transform.forward,this.transform.rotationQuaternion))}},VehicleInputController.prototype.updateManualInputDrive=function(){if(this.m_standardCarController!=null){this.playerDeltaX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Horizontal,this.playerNumber);this.playerDeltaY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Vertical,this.playerNumber);this.playerMouseX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseX,this.playerNumber);this.playerMouseY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseY,this.playerNumber);var auxForwardKeyboard=BABYLON.SceneManager.GetKeyboardInput(this.auxKeyboardForawrd),forwardKeyboard=BABYLON.SceneManager.GetKeyboardInput(this.keyboardForawrd),forwardTrigger=BABYLON.SceneManager.GetGamepadTriggerInput(this.triggerForward,this.playerNumber),auxBackwardKeyboard=BABYLON.SceneManager.GetKeyboardInput(this.auxKeyboardBackwards),backwardKeyboard=BABYLON.SceneManager.GetKeyboardInput(this.keyboardBackwards),backwardTrigger=BABYLON.SceneManager.GetGamepadTriggerInput(this.triggerBackwards,this.playerNumber),handbrakeKeyboard=BABYLON.SceneManager.GetKeyboardInput(this.keyboardHandbrake),handbrakeButton=BABYLON.SceneManager.GetGamepadButtonInput(this.buttonHandbrake,this.playerNumber),donutKeyboard=BABYLON.SceneManager.GetKeyboardInput(this.keyboardDonut),donutButton=BABYLON.SceneManager.GetGamepadButtonInput(this.buttonDonut,this.playerNumber),playerMovement=0,playerSteering=0,playerHandbrake=!1,playerDonuts=!1;forwardTrigger>.2?playerMovement=forwardTrigger:this.playerNumber===BABYLON.PlayerNumber.One&&(forwardKeyboard===!0||auxForwardKeyboard===!0)&&(playerMovement=1);backwardTrigger>.2?playerMovement=-backwardTrigger:this.playerNumber===BABYLON.PlayerNumber.One&&(backwardKeyboard===!0||auxBackwardKeyboard===!0)&&(playerMovement=-1);playerSteering=this.playerDeltaX;playerHandbrake=handbrakeKeyboard===!0||handbrakeButton===!0;playerDonuts=donutKeyboard===!0||donutButton===!0;this.m_standardCarController.throttleEngineSpeed=0;this.m_standardCarController.throttleBrakingForce=0;this.m_standardCarController.slideWhenFootBraking=!1;this.m_standardCarController.drive(playerMovement,playerSteering,playerHandbrake,playerDonuts,!0)}},VehicleInputController.prototype.updateAutoPilotDrive=function(){var gameTime,transformPosition,angleRightSensorContact,mainLeftSensorContact,angleLeftSensorContact,trackNode,controlPoint,waypointDistance,lowSpeedAvoidance,highSpeedAvoidance,handbraking;if(this.m_standardCarController!=null){gameTime=this.getGameTime();transformPosition=this.transform.getAbsolutePosition();this.driverSkillLevel=BABYLON.Scalar.Clamp(this.driverSkillLevel,1,10);this.raceLineNode=BABYLON.Scalar.Clamp(this.raceLineNode,0,4);this.m_chaseRabbitMesh==null&&(this.m_chaseRabbitMesh=BABYLON.MeshBuilder.CreateSphere(this.transform.name+".Rabbit",{segments:24,diameter:1},this.scene),this.m_chaseRabbitMesh.checkCollisions=!1,this.m_chaseRabbitMesh.receiveShadows=!1,this.m_chaseRabbitMesh.visibility=1,this.m_chaseRabbitMesh.isVisible=!1,this.resetChaseRabbitMesh());this.m_chaseRabbitMesh!=null&&(this.m_chaseRabbitMesh.isVisible===!0&&this.showChaseRabbit===!1&&(this.m_chaseRabbitMesh.isVisible=!1),this.m_chaseRabbitMesh.isVisible===!1&&this.showChaseRabbit===!0&&(this.m_chaseRabbitMesh.isVisible=!0));this.m_standardCarController.getAbsoluteSpeed()>=1&&(this.lastMovementTime=gameTime);var tagname="",contact=!1,raycast=null,avoidance=0;this.sensorStartPos.copyFrom(transformPosition);this.transform.up.scaleAndAddToRef(this.initialOffsetY,this.sensorStartPos);this.transform.forward.scaleAndAddToRef(this.initialOffsetZ,this.sensorStartPos);this.sensorPointPos.copyFrom(this.sensorStartPos);this.transform.forward.scaleAndAddToRef(this.sensorLength,this.sensorPointPos);this.sensorAnglePos.copyFrom(this.sensorPointPos);this.rsideStartPos.copyFrom(transformPosition);this.transform.up.scaleAndAddToRef(this.initialOffsetY,this.rsideStartPos);this.transform.right.scaleAndAddToRef(this.initialOffsetX,this.rsideStartPos);this.rsidePointPos.copyFrom(this.rsideStartPos);this.transform.right.scaleAndAddToRef(this.sidewaysLength,this.rsidePointPos);this.lsideStartPos.copyFrom(transformPosition);this.transform.up.scaleAndAddToRef(this.initialOffsetY,this.lsideStartPos);this.transform.right.scaleAndAddToRef(-this.initialOffsetX,this.lsideStartPos);this.lsidePointPos.copyFrom(this.lsideStartPos);this.transform.right.scaleAndAddToRef(-this.sidewaysLength,this.lsidePointPos);var firstSensorStartPos=this.sensorStartPos.clone(),firstSensorPointPos=this.sensorPointPos.clone(),mainRightSensorContact=!1;if(this.transform.right.scaleToRef(this.spacerWidths,this.tempScaleVector),this.sensorStartPos.addInPlace(this.tempScaleVector),this.sensorPointPos.addInPlace(this.tempScaleVector),tagname="",contact=!1,raycast=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.sensorStartPos,this.sensorPointPos),raycast.hasHit===!0&&raycast.collisionObject!=null&&raycast.collisionObject.entity!=null&&(tagname=BABYLON.SceneManager.GetTransformTag(raycast.collisionObject.entity),contact=tagname=="Vehicle"||tagname==="Obstacle",contact===!0&&(mainRightSensorContact=!0,avoidance-=1)),this.showSensorLines===!0&&(this.mainRightSensorLine==null&&(this.mainRightSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".MainRightSensorLine",this.scene)),contact===!0?this.mainRightSensorLine.drawLine([this.sensorStartPos,raycast.hitPoint],BABYLON.Color3.Yellow()):this.mainRightSensorLine.drawLine([this.sensorStartPos,this.sensorPointPos],BABYLON.Color3.Blue())),angleRightSensorContact=!1,this.transform.right.scaleToRef(this.spacerWidths*2*this.angleFactors,this.tempScaleVector),this.sensorAnglePos.addInPlace(this.tempScaleVector),tagname="",contact=!1,raycast=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.sensorStartPos,this.sensorAnglePos),mainRightSensorContact===!1&&raycast.hasHit===!0&&raycast.collisionObject!=null&&raycast.collisionObject.entity!=null&&(tagname=BABYLON.SceneManager.GetTransformTag(raycast.collisionObject.entity),contact=tagname=="Vehicle"||tagname==="Obstacle",contact===!0&&(angleRightSensorContact=!0,avoidance-=.5)),this.showSensorLines===!0&&(this.angleRightSensorLine==null&&(this.angleRightSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".AngleRightSensorLine",this.scene)),contact===!0?this.angleRightSensorLine.drawLine([this.sensorStartPos,raycast.hitPoint],BABYLON.Color3.Yellow()):this.angleRightSensorLine.drawLine([this.sensorStartPos,this.sensorAnglePos],BABYLON.Color3.Blue())),tagname="",contact=!1,raycast=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.rsideStartPos,this.rsidePointPos),mainRightSensorContact===!1&&angleRightSensorContact===!1&&raycast.hasHit===!0&&raycast.collisionObject!=null&&raycast.collisionObject.entity!=null&&(tagname=BABYLON.SceneManager.GetTransformTag(raycast.collisionObject.entity),contact=tagname=="Vehicle"||tagname==="Obstacle",contact===!0&&(avoidance-=.5)),this.showSensorLines===!0&&(this.sideRightSensorLine==null&&(this.sideRightSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".SideRightSensorLine",this.scene)),contact===!0?this.sideRightSensorLine.drawLine([this.rsideStartPos,raycast.hitPoint],BABYLON.Color3.Yellow()):this.sideRightSensorLine.drawLine([this.rsideStartPos,this.rsidePointPos],BABYLON.Color3.Blue())),mainLeftSensorContact=!1,this.transform.right.scaleToRef(-(this.spacerWidths*2),this.tempScaleVector),this.sensorStartPos.addInPlace(this.tempScaleVector),this.sensorPointPos.addInPlace(this.tempScaleVector),tagname="",contact=!1,raycast=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.sensorStartPos,this.sensorPointPos),raycast.hasHit===!0&&raycast.collisionObject!=null&&raycast.collisionObject.entity!=null&&(tagname=BABYLON.SceneManager.GetTransformTag(raycast.collisionObject.entity),contact=tagname=="Vehicle"||tagname==="Obstacle",contact===!0&&(mainLeftSensorContact=!0,avoidance+=1)),this.showSensorLines===!0&&(this.mainLeftSensorLine==null&&(this.mainLeftSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".MainLeftSensorLine",this.scene)),contact===!0?this.mainLeftSensorLine.drawLine([this.sensorStartPos,raycast.hitPoint],BABYLON.Color3.Yellow()):this.mainLeftSensorLine.drawLine([this.sensorStartPos,this.sensorPointPos],BABYLON.Color3.Blue())),angleLeftSensorContact=!1,this.transform.right.scaleToRef(-(this.spacerWidths*4)*this.angleFactors,this.tempScaleVector),this.sensorAnglePos.addInPlace(this.tempScaleVector),tagname="",contact=!1,raycast=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.sensorStartPos,this.sensorAnglePos),mainLeftSensorContact===!1&&raycast.hasHit===!0&&raycast.collisionObject!=null&&raycast.collisionObject.entity!=null&&(tagname=BABYLON.SceneManager.GetTransformTag(raycast.collisionObject.entity),contact=tagname=="Vehicle"||tagname==="Obstacle",contact===!0&&(angleLeftSensorContact=!0,avoidance+=.5)),this.showSensorLines===!0&&(this.angleLeftSensorLine==null&&(this.angleLeftSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".AngleLeftSensorLine",this.scene)),contact===!0?this.angleLeftSensorLine.drawLine([this.sensorStartPos,raycast.hitPoint],BABYLON.Color3.Yellow()):this.angleLeftSensorLine.drawLine([this.sensorStartPos,this.sensorAnglePos],BABYLON.Color3.Blue())),tagname="",contact=!1,raycast=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,this.lsideStartPos,this.lsidePointPos),mainLeftSensorContact===!1&&angleLeftSensorContact===!1&&raycast.hasHit===!0&&raycast.collisionObject!=null&&raycast.collisionObject.entity!=null&&(tagname=BABYLON.SceneManager.GetTransformTag(raycast.collisionObject.entity),contact=tagname=="Vehicle"||tagname==="Obstacle",contact===!0&&(avoidance+=.5)),this.showSensorLines===!0&&(this.sideLeftSensorLine==null&&(this.sideLeftSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".SideLeftSensorLine",this.scene)),contact===!0?this.sideLeftSensorLine.drawLine([this.lsideStartPos,raycast.hitPoint],BABYLON.Color3.Yellow()):this.sideLeftSensorLine.drawLine([this.lsideStartPos,this.lsidePointPos],BABYLON.Color3.Blue())),tagname="",contact=!1,raycast=BABYLON.SceneManager.PhysicsRaycastToPoint(this.scene,firstSensorStartPos,firstSensorPointPos),avoidance===0&&raycast.hasHit===!0&&raycast.collisionObject!=null&&raycast.collisionObject.entity!=null&&(tagname=BABYLON.SceneManager.GetTransformTag(raycast.collisionObject.entity),contact=tagname=="Vehicle"||tagname==="Obstacle",contact===!0&&(avoidance=raycast.hitNormal.x<0?-1:1)),this.showSensorLines===!0&&(this.mainCenterSensorLine==null&&(this.mainCenterSensorLine=new BABYLON.LinesMeshRenderer(this.transform.name+".MainCenterSensorLine",this.scene)),contact===!0?this.mainCenterSensorLine.drawLine([firstSensorStartPos,raycast.hitPoint],BABYLON.Color3.Yellow()):this.mainCenterSensorLine.drawLine([firstSensorStartPos,firstSensorPointPos],BABYLON.Color3.Blue())),trackNode=this.getCurrentTrackNode(this.waypointIndex),controlPoint=this.getCurrentControlPoint(this.raceLineNode,this.waypointIndex),this.m_chaseRabbitMesh!=null&&this.waypointCount>0&&trackNode!=null&&controlPoint!=null){this.waypointPosition.set(controlPoint.position.x,controlPoint.position.y,controlPoint.position.z);var targetSpeed=(controlPoint.speed>0?controlPoint.speed:100)*this.getDriverSkillFactor(),targetRadius=trackNode.radius*1,distToTarget=BABYLON.Vector3.Distance(this.waypointPosition,transformPosition);distToTarget<targetRadius?(this.prevTargetSpeed<=0&&(this.prevTargetSpeed=targetSpeed),this.nextTargetSpeed=BABYLON.Scalar.Lerp(this.prevTargetSpeed,targetSpeed,1-distToTarget/targetRadius),this.showChaseRabbit===!0&&(this.rabbitTrackerColor=this.redTrackingColor)):(this.nextTargetSpeed=targetSpeed,this.showChaseRabbit===!0&&(this.rabbitTrackerColor=this.greenTrackingColor));var normalizeSpeed=this.m_standardCarController.getNormalizedSpeed(),americanSpeed=this.m_standardCarController.getAmericanSpeed(),lookAhead=BABYLON.Scalar.Lerp(this.minLookAhead,this.maxLookAhead,normalizeSpeed),rabbitPosition=this.m_chaseRabbitMesh.getAbsolutePosition(),rabbitDistance=BABYLON.Vector3.Distance(transformPosition,rabbitPosition);rabbitDistance<=lookAhead&&(this.chaseRabbitSpeed=BABYLON.Scalar.Lerp(1,this.driveSpeedMultiplier,normalizeSpeed),this.m_chaseRabbitMesh.lookAt(this.waypointPosition),this.m_chaseRabbitMesh.translate(BABYLON.Axis.Z,this.chaseRabbitSpeed));this.showChaseRabbit===!0&&(this.trackVehiclePosition.set(transformPosition.x,transformPosition.y+.5,transformPosition.z),this.trackRabbitPosition.set(rabbitPosition.x,rabbitPosition.y+.25,rabbitPosition.z),this.rabbitTrackerLine==null&&(this.rabbitTrackerLine=new BABYLON.LinesMeshRenderer(this.transform.name+".TrackingLine",this.scene)),this.rabbitTrackerLine!=null&&this.rabbitTrackerLine.drawLine([this.trackVehiclePosition,this.trackRabbitPosition],this.rabbitTrackerColor));waypointDistance=BABYLON.Vector3.Distance(rabbitPosition,this.waypointPosition);waypointDistance<=5&&(this.prevTargetSpeed=this.nextTargetSpeed,this.waypointIndex++,this.waypointIndex>=this.waypointCount&&(this.waypointIndex=0));BABYLON.Utilities.InverseTransformPointToRef(this.transform,rabbitPosition,this.localTargetPosition);gameTime>this.lastMovementTime+this.resetMovingTimeout;var localTargetAngle=BABYLON.Tools.ToDegrees(Math.atan2(this.localTargetPosition.x,this.localTargetPosition.z)),cornerAngle=BABYLON.Scalar.Clamp(Math.abs(localTargetAngle),0,90),cornerFactor=cornerAngle/90,braking=0,slowdown=0,sliding=!1,topspeed=this.maxRaceTrackSpeed,throttle=1*this.throttleSensitivity,steering=BABYLON.Scalar.Clamp(this.localTargetPosition.x/this.localTargetPosition.length()*this.steeringSensitivity,-1,1);this.avoidanceFactor>0&&avoidance!==0&&(lowSpeedAvoidance=avoidance*.6*this.avoidanceFactor,highSpeedAvoidance=avoidance*.3*this.avoidanceFactor,steering+=BABYLON.Scalar.Lerp(lowSpeedAvoidance,highSpeedAvoidance,normalizeSpeed));handbraking=!1;this.nextTargetSpeed<=0&&(this.nextTargetSpeed=targetSpeed);americanSpeed>this.nextTargetSpeed&&(slowdown=BABYLON.Scalar.Lerp(0,this.linearDampenForce,normalizeSpeed),throttle*=.2);this.brakingTurnAngle>0&&cornerAngle>=this.brakingTurnAngle&&americanSpeed>=this.brakingSpeedLimit&&(braking=BABYLON.Scalar.Lerp(0,1+normalizeSpeed,cornerFactor),slowdown=0,sliding=!0,handbraking=braking>0&&this.inBrakingZone===!0&&this.brakingZoneTag===this.handBrakeZoneTag&&americanSpeed>=this.skiddingSpeedLimit,handbraking===!0&&(braking=1));braking>0&&(braking=BABYLON.Scalar.Clamp(braking*this.brakingSensitivity,0,1));braking>0&&(throttle=-braking);this.m_standardCarController.throttleEngineSpeed=topspeed;this.m_standardCarController.throttleBrakingForce=slowdown;this.m_standardCarController.slideWhenFootBraking=sliding;this.m_standardCarController.drive(throttle,steering,handbraking,!1,!1)}}},VehicleInputController.prototype.getDriverSkillFactor=function(){var result=.6;switch(this.driverSkillLevel){case 10:result=1;break;case 9:result=.98;break;case 8:result=.95;break;case 7:result=.9;break;case 6:result=.85;break;case 5:result=.8;break;case 4:result=.75;break;case 3:result=.7;break;case 2:result=.65;break;case 1:result=.6}return result},VehicleInputController.prototype.getCurrentTrackNode=function(index){var result=null;return index>=0&&index<this.waypointCount&&(result=this.m_circuitInterfaces[index]),result},VehicleInputController.prototype.getCurrentControlPoint=function(lane,index){var result=null;if(index>=0&&index<this.waypointCount)switch(lane){case 0:result=this.m_circuitRaceLine_1[index];break;case 1:result=this.m_circuitRaceLine_2[index];break;case 2:result=this.m_circuitRaceLine_3[index];break;case 3:result=this.m_circuitRaceLine_4[index];break;case 4:result=this.m_circuitRaceLine_5[index]}return result},VehicleInputController.prototype.destroyVehicleController=function(){this.m_circuitInterfaces=null;this.m_circuitRaceLine_1=null;this.m_circuitRaceLine_2=null;this.m_circuitRaceLine_3=null;this.m_circuitRaceLine_4=null;this.m_circuitRaceLine_5=null;this.m_rigidbodyPhysics=null;this.m_standardCarController=null;this.m_chaseRabbitMesh!=null&&(this.m_chaseRabbitMesh.dispose(),this.m_chaseRabbitMesh=null)},VehicleInputController}(BABYLON.ScriptComponent);PROJECT.VehicleInputController=VehicleInputController}(PROJECT||(PROJECT={})),function(MVRK){var CaptionManager=function(_super){function CaptionManager(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(CaptionManager,_super),CaptionManager.prototype.awake=function(){var DOMelement=this.getProperty("DomElement"),fontType=this.getProperty("fontType"),fontSize=this.getProperty("fontSize"),fontHexColor=this.getProperty("fontHexColor"),fontOutlineColor=this.getProperty("fontOutlineColor"),debugLanguageCode=this.getProperty("debugLanguageCode"),captionsDiv;debugLanguageCode!=null&&debugLanguageCode!==""&&BABYLON.SceneManager.SetWindowState("debugLocale",debugLanguageCode.toLowerCase());document.getElementById(DOMelement)||(captionsDiv=document.createElement("div"),captionsDiv.id=DOMelement,fontType&&(captionsDiv.style.fontFamily=fontType),fontSize&&(captionsDiv.style.fontSize=fontSize+"pt"),captionsDiv.style.zIndex="2",captionsDiv.style.position="absolute",captionsDiv.style.bottom="100px",captionsDiv.style.left="0",captionsDiv.style.right="0",captionsDiv.style.margin="0 auto",captionsDiv.style.textAlign="center",captionsDiv.style.fontWeight="bold",captionsDiv.style.userSelect="none",captionsDiv.style.pointerEvents="none",captionsDiv.style.color=fontHexColor,fontOutlineColor&&(captionsDiv.style.textShadow="0 0 1px "+fontOutlineColor+", 0 0 1px "+fontOutlineColor+", 0 0 1px "+fontOutlineColor+", 0 0 1px "+fontOutlineColor),document.body.append(captionsDiv))},CaptionManager}(BABYLON.ScriptComponent);MVRK.CaptionManager=CaptionManager}(MVRK||(MVRK={})),function(MVRK){var CaptionSystem=function(_super){function CaptionSystem(transform,scene,properties){var _this=_super.call(this,transform,scene,properties)||this;return _this.captionType=0,_this.displayTimer=5,_this.domElement=null,_this.textTracks=null,_this.userLocale="en",_this.logCaptions=!1,_this.m_captionSource=null,_this.m_captionTimer=0,_this.onUpdateCaptionObservable=new BABYLON.Observable,_this.transform.metadata==null&&(_this.transform.metadata={}),_this.transform.metadata.vtt=!0,_this}return __extends(CaptionSystem,_super),CaptionSystem.prototype.getUserLocale=function(){return this.userLocale},CaptionSystem.prototype.getCaptionType=function(){return this.captionType},CaptionSystem.prototype.awake=function(){this.awakeCaptionSystem()},CaptionSystem.prototype.start=function(){this.startCaptionSystem()},CaptionSystem.prototype.update=function(){this.updateCaptionSystem()},CaptionSystem.prototype.destroy=function(){this.destroyCaptionSystem()},CaptionSystem.prototype.awakeCaptionSystem=function(){var _a;this.captionType=this.getProperty("captionType",this.captionType);this.displayTimer=this.getProperty("displayTimer",this.displayTimer);this.domElement=this.getProperty("domElement",this.domElement);this.textTracks=this.getProperty("textTracks",this.textTracks);this.logCaptions=this.getProperty("logCaptions",this.logCaptions);this.userLocale=BABYLON.SceneManager.GetWindowState("debugLocale")||((_a=MVRK.System.GetUserInfo())===null||_a===void 0?void 0:_a.locale)||this.userLocale;this.userLocale==="zh"?this.userLocale="ch":this.userLocale==="ja"&&(this.userLocale="jp")},CaptionSystem.prototype.startCaptionSystem=function(){this.captionType===0?(this.m_captionSource=this.getComponent("BABYLON.WebVideoPlayer"),this.m_captionSource==null&&BABYLON.Tools.Warn("Failed to locate web video player component for: "+this.transform.name)):(this.m_captionSource=this.getComponent("BABYLON.AudioSource"),this.m_captionSource==null&&BABYLON.Tools.Warn("Failed to locate audio source component for: "+this.transform.name));this.m_captionSource!=null&&this.attachCaptionSystem();this.postCaptionMessage("")},CaptionSystem.prototype.updateCaptionSystem=function(){this.displayTimer>0&&this.m_captionTimer>0&&(this.m_captionTimer+=this.getDeltaSeconds(),this.m_captionTimer>=this.displayTimer&&this.postCaptionMessage(""))},CaptionSystem.prototype.destroyCaptionSystem=function(){this.textTracks=null;this.m_captionSource=null;this.m_captionElement=null;this.onUpdateCaptionObservable.clear();this.onUpdateCaptionObservable=null},CaptionSystem.prototype.attachCaptionSystem=function(){var _this=this,_a,_b,rootUrl=BABYLON.SceneManager.GetRootUrl(this.scene),index,textTrack,trackElement,video,audio;if(this.m_captionSource!=null&&this.userLocale!=null&&this.userLocale!==""&&this.textTracks!=null&&this.textTracks.length>0)for(index=0;index<this.textTracks.length;index++)if(textTrack=this.textTracks[index],textTrack.trackLanguage===this.userLocale){trackElement=document.createElement("track");trackElement.src=rootUrl+textTrack.trackAsset.filename;trackElement.kind=this.formatTextTrackKind(textTrack.trackKind);trackElement.label=textTrack.trackLabel;trackElement.srclang=textTrack.trackLanguage;trackElement.default=!1;trackElement.addEventListener("cuechange",function(event){var target=event.target,cue;target!=null&&target.track!=null&&target.track.activeCues!=null&&target.track.activeCues[0]!=null&&(cue=target.track.activeCues[0],cue.text!=null&&cue.text!==""&&(_this.logCaptions===!0&&console.log(cue.text),_this.postCaptionMessage(cue.text)))});this.m_captionSource instanceof BABYLON.WebVideoPlayer?(_a=this.m_captionSource.getVideoElement())===null||_a===void 0?void 0:_a.appendChild(trackElement):this.m_captionSource instanceof BABYLON.AudioSource&&((_b=this.m_captionSource.getAudioElement())===null||_b===void 0?void 0:_b.appendChild(trackElement));break}this.m_captionSource instanceof BABYLON.WebVideoPlayer?(video=this.m_captionSource.getVideoElement(),video!=null?MVRK.CaptionSystem.EnableDefaultTextTrack(video,!0):BABYLON.Tools.Warn("Null html video element for: "+this.transform.name)):this.m_captionSource instanceof BABYLON.AudioSource&&(audio=this.m_captionSource.getAudioElement(),audio!=null?MVRK.CaptionSystem.EnableDefaultTextTrack(audio,!0):BABYLON.Tools.Warn("Null html audio element for: "+this.transform.name))},CaptionSystem.prototype.postCaptionMessage=function(message){this.m_captionTimer=0;message!=null&&(this.onUpdateCaptionObservable.hasObservers()===!0&&this.onUpdateCaptionObservable.notifyObservers(message),this.domElement!=null&&(this.m_captionElement==null&&(this.m_captionElement=document.getElementById(this.domElement)),this.m_captionElement!=null&&(this.m_captionElement.innerHTML=message)),message!==""&&(this.m_captionTimer=1e-5))},CaptionSystem.prototype.formatTextTrackKind=function(kind){var result="subtitles";switch(kind){case 0:result="subtitles";break;case 1:result="captions";break;case 2:result="descriptions";break;case 3:result="chapters";break;case 4:result="metadata"}return result},CaptionSystem.EnableDefaultTextTrack=function(source,enable){source!=null&&source.textTracks!=null&&source.textTracks.length>0&&(source.textTracks[0].mode=enable===!0?"showing":"disabled")},CaptionSystem}(BABYLON.ScriptComponent);MVRK.CaptionSystem=CaptionSystem}(MVRK||(MVRK={})),function(MVRK){var SceneSoundSystem=function(_super){function SceneSoundSystem(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(SceneSoundSystem,_super),Object.defineProperty(SceneSoundSystem,"MUSIC",{get:function(){return SceneSoundSystem._MUSIC},enumerable:!1,configurable:!0}),Object.defineProperty(SceneSoundSystem,"SFX",{get:function(){return SceneSoundSystem._SFX},enumerable:!1,configurable:!0}),SceneSoundSystem.prototype.start=function(){var _a,musicNode=this.getChildNode("MUSIC"),soundNode,defaultMusicTrack;musicNode!=null&&(SceneSoundSystem._MUSIC=BABYLON.SceneManager.FindScriptComponent(musicNode,"MVRK.SoundManager"));soundNode=this.getChildNode("SFX");soundNode!=null&&(SceneSoundSystem._SFX=BABYLON.SceneManager.FindScriptComponent(soundNode,"MVRK.SoundManager"));defaultMusicTrack=this.getProperty("defaultMusicTrack");defaultMusicTrack!=null&&defaultMusicTrack!==""&&((_a=SceneSoundSystem.MUSIC)===null||_a===void 0?void 0:_a.playTrack(defaultMusicTrack))},SceneSoundSystem._MUSIC=null,SceneSoundSystem._SFX=null,SceneSoundSystem}(BABYLON.ScriptComponent);MVRK.SceneSoundSystem=SceneSoundSystem}(MVRK||(MVRK={})),function(MVRK){var SoundManager=function(_super){function SoundManager(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.isReady=!1,_this.groupName=null,_this.m_soundMap=null,_this.m_soundList=null,_this}return __extends(SoundManager,_super),SoundManager.prototype.getIsReady=function(){return this.isReady},SoundManager.prototype.getGroupName=function(){return this.groupName},SoundManager.prototype.awake=function(){this.groupName=this.getProperty("groupName",this.transform.name);this.m_soundMap=new Map;this.m_soundList=[];this.isReady=!1},SoundManager.prototype.start=function(){var audioTransforms=this.transform.getChildren(null,!0),index,audioTrackNode,audioSource;if(audioTransforms!=null&&audioTransforms.length>0)for(index=0;index<audioTransforms.length;index++)audioTrackNode=audioTransforms[index],audioSource=BABYLON.SceneManager.FindScriptComponent(audioTrackNode,"BABYLON.AudioSource"),audioSource!=null&&(this.m_soundMap.set(audioTrackNode.name,audioSource),this.m_soundList.push(audioSource))},SoundManager.prototype.update=function(){},SoundManager.prototype.destroy=function(){this.m_soundList=null;this.m_soundMap.clear();this.m_soundMap=null},SoundManager.prototype.playTrack=function(name,time,offset,length){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.play(time,offset,length)},SoundManager.prototype.pauseTrack=function(name){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.pause()},SoundManager.prototype.pauseAllTracks=function(){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.pause()},SoundManager.prototype.stopTrack=function(name,time){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.stop(time)},SoundManager.prototype.stopAllTracks=function(time){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.stop(time)},SoundManager.prototype.muteTrack=function(name,time){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.mute(time)},SoundManager.prototype.unmuteTrack=function(name,time){var _a;if((_a=this.getAudioSource(name))!==null&&_a!==void 0)return _a.unmute(time)},SoundManager.prototype.muteAllTracks=function(time){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.mute(time)},SoundManager.prototype.unmuteAllTracks=function(time){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.unmute(time)},SoundManager.prototype.setGroupVolume=function(volume,time){var _a,index;if(this.m_soundList!=null&&this.m_soundList.length>0)for(index=0;index<this.m_soundList.length;index++)(_a=this.m_soundList[index])===null||_a===void 0?void 0:_a.setVolume(volume,time)},SoundManager.prototype.getAudioSource=function(name){return this.m_soundMap.get(name)},SoundManager}(BABYLON.ScriptComponent);MVRK.SoundManager=SoundManager}(MVRK||(MVRK={})),function(MVRK){var VideoController=function(_super){function VideoController(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(VideoController,_super),VideoController.prototype.awake=function(){},VideoController.prototype.start=function(){},VideoController.prototype.update=function(){},VideoController.prototype.late=function(){},VideoController.prototype.after=function(){},VideoController.prototype.destroy=function(){},VideoController}(BABYLON.ScriptComponent);MVRK.VideoController=VideoController}(MVRK||(MVRK={})),function(MVRK){var InsideNotification=function(_super){function InsideNotification(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.abstractMesh=null,_this}return __extends(InsideNotification,_super),InsideNotification.prototype.awake=function(){this.abstractMesh=this.getAbstractMesh()},InsideNotification.prototype.update=function(){var cameraPos,JSON_1;MVRK.InsideNotification.CurrentRoom!==this.transform.name&&(cameraPos=this.scene.activeCamera.globalPosition,this.pointIsInside(cameraPos)&&(MVRK.InsideNotification.CurrentRoom=this.transform.name,JSON_1='{"command":"location","param1":"'+this.transform.name+'"}',BABYLON.SceneManager.PostWindowMessage(JSON_1,"*")))},InsideNotification.prototype.pointIsInside=function(point){if(this.abstractMesh!=null){var boundInfo=this.abstractMesh.getBoundingInfo(),max=boundInfo.boundingBox.maximumWorld,min=boundInfo.boundingBox.minimumWorld;if(point.x<min.x||point.x>max.x||point.y<min.y||point.y>max.y||point.z<min.z||point.z>max.z)return!1}return!0},InsideNotification.CurrentRoom="",InsideNotification}(BABYLON.ScriptComponent);MVRK.InsideNotification=InsideNotification}(MVRK||(MVRK={})),function(MVRK){var PopupTrigger=function(_super){function PopupTrigger(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.triggerType="vod",_this.triggerParam="defaultParam",_this.triggerFocus=null,_this.abstractMesh=null,_this.onPickTriggerObservable=new BABYLON.Observable,_this}return __extends(PopupTrigger,_super),PopupTrigger.prototype.awake=function(){var _this=this,nodeFocusData,JSON;this.triggerParam=this.getProperty("triggerParam",this.triggerParam);this.triggerType=this.getProperty("triggerType",this.triggerType);nodeFocusData=this.getProperty("triggerFocus");nodeFocusData!=null&&(this.triggerFocus=BABYLON.Utilities.ParseTransformByID(nodeFocusData,this.scene));this.abstractMesh=this.getAbstractMesh();JSON='{"command":"'+this.triggerType+'","param":"'+this.triggerParam+'"}';this.abstractMesh!=null&&(this.abstractMesh.actionManager=new BABYLON.ActionManager(this.scene));this.abstractMesh!=null&&this.abstractMesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPickTrigger},function(){_this.getComponent("PROJECT.LerpObject")==null&&(!_this.triggerFocus||_this.gradualFocus(),_this.onPickTriggerObservable.hasObservers()===!0&&_this.onPickTriggerObservable.notifyObservers(_this.abstractMesh),BABYLON.SceneManager.PostWindowMessage(JSON,"*"))}))},PopupTrigger.prototype.sendMessage=function(){var JSON='{"command":"'+this.triggerType+'","param":"'+this.triggerParam+'"}';BABYLON.SceneManager.PostWindowMessage(JSON,"*")},PopupTrigger.prototype.registerNewTrigger=function(){var _this=this,JSON='{"command":"'+this.triggerType+'","param":"'+this.triggerParam+'"}';this.abstractMesh!=null&&this.abstractMesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnPickTrigger},function(){!_this.triggerFocus||_this.gradualFocus();_this.onPickTriggerObservable.hasObservers()===!0&&_this.onPickTriggerObservable.notifyObservers(_this.abstractMesh);BABYLON.SceneManager.PostWindowMessage(JSON,"*")}))},PopupTrigger.prototype.gradualFocus=function(){var camera=this.scene.activeCamera,empty=new BABYLON.Mesh("empty",this.scene),vecSource,vecDest;empty.position=camera.position.clone();empty.rotation=camera.rotation.clone();empty.movePOV(0,0,-2);vecSource=empty.position.clone();vecDest=this.triggerFocus.absolutePosition;this.scene.activeCamera.lockedTarget=vecSource;empty.dispose();this.lerpCameraView(vecSource,vecDest,0)},PopupTrigger.prototype.lerpCameraView=function(vecSource,vecDest,amount){var _this=this,newVec=BABYLON.Vector3.Lerp(vecSource,vecDest,amount);amount<1?setTimeout(function(){var newAmount=amount+.01;_this.scene.activeCamera.lockedTarget=newVec;_this.lerpCameraView(vecSource,vecDest,newAmount)},5):this.scene.activeCamera.lockedTarget=null},PopupTrigger}(BABYLON.ScriptComponent);MVRK.PopupTrigger=PopupTrigger}(MVRK||(MVRK={})),function(MVRK){var State=function(){function State(){}return State.prototype.tick=function(){},State}(),StatefulScriptComponent;MVRK.State=State;StatefulScriptComponent=function(_super){function StatefulScriptComponent(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this._currentState=null,_this.onStateChangeObservable=new BABYLON.Observable,_this}return __extends(StatefulScriptComponent,_super),StatefulScriptComponent.prototype.getCurrentState=function(){return this._currentState},StatefulScriptComponent.prototype.setState=function(newState,forced){return this._currentState===newState?!1:forced!=null&&forced==!0?(this._currentState&&this._currentState.onExit(),this._currentState=newState,newState.onEnter(),this.onStateChangeObservable.hasObservers()===!0&&this.onStateChangeObservable.notifyObservers(this._currentState),!0):newState.canChangeState()?(this._currentState&&this._currentState.onExit(),this._currentState=newState,newState.onEnter(),this.onStateChangeObservable.hasObservers()===!0&&this.onStateChangeObservable.notifyObservers(this._currentState),!0):(newState.onStateChangeFail(),!1)},StatefulScriptComponent}(BABYLON.ScriptComponent);MVRK.StatefulScriptComponent=StatefulScriptComponent}(MVRK||(MVRK={})),function(MVRK){var BillboardMesh=function(_super){function BillboardMesh(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(BillboardMesh,_super),BillboardMesh.prototype.awake=function(){this.camera=this.scene.activeCamera},BillboardMesh.prototype.update=function(){var absCameraPos=this.camera.globalPosition,absTransformPos=this.transform.absolutePosition,lookDirection=absCameraPos.subtract(absTransformPos).normalize().scale(-1);this.transform.lookAt(absTransformPos.add(lookDirection),null,null,null,BABYLON.Space.WORLD)},BillboardMesh}(BABYLON.ScriptComponent);MVRK.BillboardMesh=BillboardMesh}(MVRK||(MVRK={})),function(MVRK){var BlinkManager=function(_super){function BlinkManager(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.enableBlinking=!1,_this.blinkingState=!1,_this.blinkingTimer=0,_this.blinkTimeout=.5,_this.onBlinkUpdateObservable=new BABYLON.Observable,_this}return __extends(BlinkManager,_super),BlinkManager.prototype.awake=function(){this.blinkTimeout=this.getProperty("blinkTimeout",this.blinkTimeout)},BlinkManager.prototype.update=function(){this.enableBlinking===!0&&(this.blinkingTimer+=this.getDeltaSeconds(),this.blinkingTimer>=this.blinkTimeout&&(this.blinkingTimer=0,this.blinkingState=!this.blinkingState,this.onBlinkUpdateObservable.hasObservers()===!0&&this.onBlinkUpdateObservable.notifyObservers(this.blinkingState)))},BlinkManager.prototype.destroy=function(){this.onBlinkUpdateObservable.clear();this.onBlinkUpdateObservable=null},BlinkManager.prototype.enableBlinkMode=function(blinking){this.blinkingTimer=0;this.blinkingState=!1;this.enableBlinking=blinking},BlinkManager}(BABYLON.ScriptComponent);MVRK.BlinkManager=BlinkManager}(MVRK||(MVRK={})),function(MVRK){var FloatingAnimation=function(_super){function FloatingAnimation(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.floatSpeed=1,_this.floatDistance=.2,_this.randomOffset=.1,_this.initPosition=new BABYLON.Vector3(0,0,0),_this.floatingVector=new BABYLON.Vector3(0,0,0),_this}return __extends(FloatingAnimation,_super),FloatingAnimation.prototype.awake=function(){this.floatSpeed=this.getProperty("floatSpeed",this.floatSpeed);this.floatDistance=this.getProperty("floatDistance",this.floatDistance);this.randomOffset=BABYLON.Scalar.RandomRange(-Math.PI,Math.PI);this.initPosition.copyFrom(this.transform.position)},FloatingAnimation.prototype.update=function(){var time=this.getGameTime();this.floatingVector.set(0,Math.sin((time+this.randomOffset)*this.floatSpeed)*this.floatDistance,0);this.floatingVector.addToRef(this.initPosition,this.transform.position)},FloatingAnimation.prototype.destroy=function(){this.initPosition=null;this.floatingVector=null},FloatingAnimation}(BABYLON.ScriptComponent);MVRK.FloatingAnimation=FloatingAnimation}(MVRK||(MVRK={})),function(MVRK){var RotateTransform=function(_super){function RotateTransform(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.rotateSpeedX=0,_this.rotateSpeedY=0,_this.rotateSpeedZ=1,_this}return __extends(RotateTransform,_super),RotateTransform.prototype.awake=function(){this.rotateSpeedX=this.getProperty("rotateSpeedX",this.rotateSpeedX);this.rotateSpeedY=this.getProperty("rotateSpeedY",this.rotateSpeedY);this.rotateSpeedZ=this.getProperty("rotateSpeedZ",this.rotateSpeedZ);this.transform.rotation==null&&(this.transform.rotation=new BABYLON.Vector3(0,0,0));this.transform.rotationQuaternion!=null&&(this.transform.rotationQuaternion.toEulerAnglesToRef(this.transform.rotation),this.transform.rotationQuaternion=null)},RotateTransform.prototype.update=function(){var deltaTime=this.getDeltaSeconds();this.rotateSpeedX!==0&&(this.transform.rotation.x+=this.rotateSpeedX*deltaTime);this.rotateSpeedY!==0&&(this.transform.rotation.y+=this.rotateSpeedY*deltaTime);this.rotateSpeedZ!==0&&(this.transform.rotation.z+=this.rotateSpeedZ*deltaTime)},RotateTransform}(BABYLON.ScriptComponent);MVRK.RotateTransform=RotateTransform}(MVRK||(MVRK={})),function(MVRK){var RuntimeTexture=function(_super){function RuntimeTexture(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.m_dynamicTexture=null,_this.m_dynamicMaterial=null,_this}return __extends(RuntimeTexture,_super),RuntimeTexture.prototype.awake=function(){var textureUrl=this.getProperty("textureUrl"),invertAxis=this.getProperty("invertAxis",!1),genMipmaps=this.getProperty("genMipmaps",!1),materialIndex=this.getProperty("materialIndex",0),abstractMesh=this.getAbstractMesh(),mmat1;abstractMesh!=null&&(abstractMesh.material instanceof BABYLON.MultiMaterial?(mmat1=abstractMesh.material.clone(abstractMesh.material.name+"."+abstractMesh.name),this.m_dynamicMaterial=mmat1.subMaterials[materialIndex].clone(mmat1.subMaterials[materialIndex].name+"_"+abstractMesh.name),mmat1.subMaterials[materialIndex]=this.m_dynamicMaterial,abstractMesh.material=mmat1):(this.m_dynamicMaterial=abstractMesh.material.clone(abstractMesh.material.name+"."+abstractMesh.name),abstractMesh.material=this.m_dynamicMaterial),this.m_dynamicMaterial.unfreeze());textureUrl!=null&&textureUrl!==""&&this.setTextureUrl(textureUrl,invertAxis,genMipmaps)},RuntimeTexture.prototype.destroy=function(){this.m_dynamicTexture!=null&&(this.m_dynamicTexture.dispose(),this.m_dynamicTexture=null);this.m_dynamicMaterial!=null&&(this.m_dynamicMaterial.dispose(),this.m_dynamicMaterial=null)},RuntimeTexture.prototype.setTextureUrl=function(url,invertY,createMipmaps){invertY===void 0&&(invertY=!1);createMipmaps===void 0&&(createMipmaps=!1);this.m_dynamicTexture!=null&&(this.m_dynamicTexture.dispose(),this.m_dynamicTexture=null);this.m_dynamicTexture=new BABYLON.Texture(url,this.scene,!createMipmaps,invertY);this.m_dynamicMaterial!=null&&(this.m_dynamicMaterial instanceof BABYLON.PBRMaterial?this.m_dynamicMaterial.albedoTexture=this.m_dynamicTexture:this.m_dynamicMaterial instanceof BABYLON.StandardMaterial&&(this.m_dynamicMaterial.diffuseTexture=this.m_dynamicTexture))},RuntimeTexture}(BABYLON.ScriptComponent);MVRK.RuntimeTexture=RuntimeTexture}(MVRK||(MVRK={})),function(MVRK){var SpriteAnimation=function(_super){function SpriteAnimation(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.gridCols=1,_this.gridRows=1,_this.startRow=1,_this.bottomUp=!1,_this.timeInSeconds=1,_this.colWidth=0,_this.rowHeight=0,_this.animTimer=0,_this.tileIndex=0,_this.tileReset=0,_this.baseTexture=null,_this}return __extends(SpriteAnimation,_super),SpriteAnimation.prototype.awake=function(){var totalTiles,maxTileCount,mesh,pbrMaterial,stdMaterial,startRowOffset;this.gridCols=this.getProperty("gridCols",this.gridCols);this.gridRows=this.getProperty("gridRows",this.gridRows);this.startRow=this.getProperty("startRow",this.startRow);this.bottomUp=this.getProperty("bottomUp",this.bottomUp);this.timeInSeconds=this.getProperty("timeInSeconds",this.timeInSeconds);this.colWidth=1/this.gridCols;this.rowHeight=1/this.gridRows;this.tileIndex=0;this.tileReset=0;totalTiles=this.gridCols*this.gridRows;maxTileCount=this.getProperty("maxTileCount",0);maxTileCount>0&&maxTileCount<totalTiles&&(this.tileReset=maxTileCount);mesh=this.getAbstractMesh();mesh!=null&&mesh.material!=null&&(mesh.material instanceof BABYLON.PBRMaterial?(pbrMaterial=mesh.material.clone(mesh.name+"."+mesh.material.name),this.baseTexture=pbrMaterial.albedoTexture,mesh.material=pbrMaterial):mesh.material instanceof BABYLON.StandardMaterial&&(stdMaterial=mesh.material.clone(mesh.name+"."+mesh.material.name),this.baseTexture=stdMaterial.diffuseTexture,mesh.material=stdMaterial));this.baseTexture!=null&&(this.baseTexture.uScale=this.colWidth,this.baseTexture.vScale=this.rowHeight,startRowOffset=BABYLON.Scalar.Clamp((this.startRow-1)*this.rowHeight),this.baseTexture.uOffset=0,this.baseTexture.vOffset=this.bottomUp===!0?startRowOffset:1-startRowOffset-this.rowHeight,this.startRow>1&&(this.tileIndex=(this.startRow-1)*this.gridCols))},SpriteAnimation.prototype.start=function(){this.animTimer=0},SpriteAnimation.prototype.reset=function(){this.baseTexture!=null&&(this.baseTexture.uOffset=0,this.baseTexture.vOffset=this.bottomUp===!0?0:1-this.rowHeight)},SpriteAnimation.prototype.update=function(){this.timeInSeconds>0&&(this.animTimer+=this.getDeltaSeconds(),this.animTimer>=this.timeInSeconds&&(this.animTimer=0,this.animate()))},SpriteAnimation.prototype.animate=function(){this.baseTexture!=null&&(this.baseTexture.uOffset>=1-this.colWidth?(this.baseTexture.uOffset=0,this.bottomUp===!0?this.baseTexture.vOffset>=1-this.rowHeight?this.baseTexture.vOffset=0:this.baseTexture.vOffset+=this.rowHeight:this.baseTexture.vOffset<=0?this.baseTexture.vOffset=1-this.rowHeight:this.baseTexture.vOffset-=this.rowHeight,(this.baseTexture.vOffset<0||this.baseTexture.vOffset>0)&&(this.baseTexture.vOffset=BABYLON.Scalar.Clamp(this.baseTexture.vOffset))):this.baseTexture.uOffset+=this.colWidth,(this.baseTexture.uOffset<0||this.baseTexture.uOffset>0)&&(this.baseTexture.uOffset=BABYLON.Scalar.Clamp(this.baseTexture.uOffset)));this.tileReset>0&&(this.tileIndex++,this.tileIndex>=this.tileReset&&(this.tileIndex=0,this.reset()))},SpriteAnimation.prototype.destroy=function(){this.baseTexture=null},SpriteAnimation}(BABYLON.ScriptComponent);MVRK.SpriteAnimation=SpriteAnimation}(MVRK||(MVRK={})),function(MVRK){var SceneLoader=function(){function SceneLoader(){}return SceneLoader.SwitchScene=function(sceneFile){MVRK.SceneLoader.TeleFade.SceneFile=sceneFile;BABYLON.SceneManager.RegisterOnShowSceneLoader(function(){});var blanket=parent.window.document.getElementById("blanket");blanket==null&&(blanket=parent.window.document.createElement("div"),blanket.id="blanket",blanket.style.position="absolute",blanket.style.minHeight="100%",blanket.style.width="100%",blanket.style.height="100%",blanket.style.padding="0px",blanket.style.margin="0px",blanket.style.top="0",blanket.style.left="0",blanket.style.display="none",blanket.style.outline="none",blanket.style.overflow="hidden",blanket.style.opacity="0",blanket.style.zIndex="-1",blanket.style.backgroundColor="black",parent.window.document.body.appendChild(blanket));blanket!=null&&(blanket.style.zIndex="2001",blanket.style.display="block",blanket.style.opacity="0",MVRK.SceneLoader.FadeToBlack(blanket,MVRK.SceneLoader.TeleFade.Speed))},SceneLoader.FadeToBlack=function(blanket,speed){blanket!=null&&(speed<MVRK.SceneLoader.TeleFade.Limit?BABYLON.SceneManager.SetTimeout(MVRK.SceneLoader.TeleFade.Timeout,function(){blanket.style.opacity=(speed/(MVRK.SceneLoader.TeleFade.Limit-speed)).toString();MVRK.SceneLoader.FadeToBlack(blanket,speed*MVRK.SceneLoader.TeleFade.Multiplier)}):(blanket.style.zIndex="2001",blanket.style.display="block",blanket.style.opacity="1",BABYLON.SceneManager.ShowParentLoader(!0),BABYLON.SceneManager.LoadSceneFile(MVRK.SceneLoader.TeleFade.SceneFile)))},SceneLoader.FadeToScene=function(blanket,speed){blanket!=null&&(speed>.001?BABYLON.SceneManager.SetTimeout(MVRK.SceneLoader.TeleFade.Timeout,function(){blanket.style.opacity=(speed/(MVRK.SceneLoader.TeleFade.Limit-speed)).toString();MVRK.SceneLoader.FadeToScene(blanket,speed/MVRK.SceneLoader.TeleFade.Multiplier)}):(blanket.style.zIndex="-1",blanket.style.display="none",blanket.style.opacity="0"))},SceneLoader.LoadSceneComplete=function(){BABYLON.SceneManager.ShowParentLoader(!1);var blanket=parent.window.document.getElementById("blanket");blanket!=null&&MVRK.SceneLoader.FadeToScene(blanket,MVRK.SceneLoader.TeleFade.Limit)},SceneLoader.TeleFade={Speed:.01,Timeout:50,Multiplier:1.8,Limit:.4,SceneFile:null},SceneLoader}();MVRK.SceneLoader=SceneLoader}(MVRK||(MVRK={})),function(MVRK){var System=function(){function System(){}return System.GetUserInfo=function(){var result=null;return window.frameElement!=null&&parent!=null&&parent.window!=null?parent.window.getMVRKUser&&(result=parent.window.getMVRKUser()):window.getMVRKUser&&(result=window.getMVRKUser()),result==null&&(result={firstName:"Default",lastName:"Player",locale:"en",email:null}),result},System.GetGameLobbyInfo=function(){var result=null;return window.frameElement!=null&&parent!=null&&parent.window!=null?parent.window.getGameLobbyInfo&&(result=parent.window.getGameLobbyInfo()):window.getGameLobbyInfo&&(result=window.getGameLobbyInfo()),result==null&&(result={id:"12345"}),result},System}();MVRK.System=System}(MVRK||(MVRK={})),function(PROJECT){var AnchorInSpot=function(_super){function AnchorInSpot(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(AnchorInSpot,_super),AnchorInSpot.prototype.update=function(){this.getAbstractMesh().setPositionWithLocalVector(BABYLON.Vector3.Zero())},AnchorInSpot}(BABYLON.ScriptComponent);PROJECT.AnchorInSpot=AnchorInSpot}(PROJECT||(PROJECT={})),function(PROJECT){var Animator=function(){function Animator(name,animator){this.name=name;this.animator=animator}return Animator}(),AnimatorManager;PROJECT.Animator=Animator;AnimatorManager=function(_super){function AnimatorManager(transform,scene,properties){properties===void 0&&(properties={});var _this=_super.call(this,transform,scene,properties)||this;return _this.animators=[],_this.draggables=[],PROJECT.AnimatorManager._instance==null&&(PROJECT.AnimatorManager._instance=_this),_this}return __extends(AnimatorManager,_super),Object.defineProperty(AnimatorManager,"Instance",{get:function(){return AnimatorManager._instance},enumerable:!1,configurable:!0}),AnimatorManager.prototype.awake=function(){var _this=this,animatorObjectMetaData,draggables;BABYLON.SceneManager.SetWindowState("AnimatorManager",AnimatorManager.Instance);animatorObjectMetaData=this.getProperty("animators");draggables=this.getProperty("draggables");draggables.forEach(function(object){var node=_this.scene.getNodeByID(object.id);_this.draggables.push(node)});animatorObjectMetaData.forEach(function(object){var node=_this.scene.getNodeByID(object.id),animatorComponent=BABYLON.SceneManager.FindScriptComponent(node,"BABYLON.AnimationState"),animator=new Animator(node.name,animatorComponent);_this.animators.push(animator)});this.BindEndAnimationMessages(this.animators)},AnimatorManager.prototype.GetAnimator=function(name){var animator=null;return this.animators.forEach(function(object){if(object.name===name)return animator=object}),animator},AnimatorManager.prototype.BindEndAnimationMessages=function(){},AnimatorManager.prototype.ResetDraggables=function(){this.draggables.forEach(function(draggable){draggable.setPositionWithLocalVector(new BABYLON.Vector3(0,0,0))})},AnimatorManager}(BABYLON.ScriptComponent);PROJECT.AnimatorManager=AnimatorManager}(PROJECT||(PROJECT={})),function(PROJECT){var LimitedDrag=function(_super){function LimitedDrag(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.drag=null,_this.leftBound=0,_this.rightBound=1,_this.canDrag=!1,_this}return __extends(LimitedDrag,_super),LimitedDrag.prototype.awake=function(){var _this=this,abstractMesh=this.getAbstractMesh(),initialPosition=this.transform.absolutePosition;this.leftBound=this.getProperty("leftBound",this.leftBound);this.rightBound=this.getProperty("rightBound",this.rightBound);this.canDrag=this.getProperty("canDrag",this.canDrag);this.drag=new BABYLON.PointerDragBehavior({dragPlaneNormal:new BABYLON.Vector3(0,0,1)});abstractMesh!=null&&this.canDrag&&(abstractMesh.addBehavior(this.drag),this.drag.validateDrag=function(targetPosition){var localPosition=BABYLON.Utilities.InverseTransformPoint(_this.transform.parent,targetPosition),normalizedDragValue=BABYLON.Scalar.Normalize(_this.transform.getPositionExpressedInLocalSpace().x,0,1),drag={dragValue:normalizedDragValue};return(BABYLON.SceneManager.PostWindowMessage(JSON.stringify(drag),"*"),targetPosition.y!=initialPosition.y&&(targetPosition.y=initialPosition.y),localPosition.x<_this.leftBound)?!1:localPosition.x>_this.rightBound?!1:!0})},LimitedDrag.prototype.start=function(){},LimitedDrag.prototype.update=function(){},LimitedDrag.prototype.late=function(){},LimitedDrag.prototype.after=function(){},LimitedDrag.prototype.destroy=function(){this.drag=null},LimitedDrag}(BABYLON.ScriptComponent);PROJECT.LimitedDrag=LimitedDrag}(PROJECT||(PROJECT={})),function(PROJECT){var Pickable=function(_super){function Pickable(transform,scene,properties){return properties===void 0&&(properties={}),_super.call(this,transform,scene,properties)||this}return __extends(Pickable,_super),Pickable.prototype.awake=function(){},Pickable.prototype.start=function(){},Pickable.prototype.update=function(){},Pickable.prototype.late=function(){},Pickable.prototype.after=function(){},Pickable.prototype.destroy=function(){},Pickable}(BABYLON.ScriptComponent);PROJECT.Pickable=Pickable}(PROJECT||(PROJECT={})),function(PROJECT){var Rotator=function(_super){function Rotator(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.inertiaFactor=1,_this.speed=0,_this.drag=.86,_this.max=.05,_this.min=.0001,_this.lastSafePoint=null,_this._mouseObs=null,_this}return __extends(Rotator,_super),Rotator.prototype.awake=function(){this.inertiaFactor=this.getProperty("inertiaFactor",this.inertiaFactor);this.drag=this.getProperty("drag",this.drag);this.max=this.getProperty("maxSpeed",this.max);this.min=Math.PI*.0001;globalThis.rotator=this},Rotator.prototype.start=function(){if(this._abm=this.getAbstractMesh(),this._abm){var originalRotation=this._abm.rotationQuaternion.toEulerAngles();this._abm.rotationQuaternion=null;this._abm.rotation=originalRotation}this._animatior=PROJECT.AnimatorManager.Instance.GetAnimator("ThriveAnimator").animator},Rotator.prototype.update=function(){if(this._animatior.getInteger("State")!==6){this._mouseObs&&this._removeMouseObs();return}this._mouseObs||this._addMouseObs();this._abm&&(this._abm.setPositionWithLocalVector(BABYLON.Vector3.Zero()),this._abm.rotation.y+=this.speed*this.getDeltaSeconds(),this.speed*=this.drag,Math.abs(this.speed)<this.min&&(this.speed=0))},Rotator.prototype._addMouseObs=function(){var _this=this;this._mouseObs=this.scene.onPointerObservable.add(function(pointerInfo){var dir,xFactor,tS;switch(pointerInfo.type){case BABYLON.PointerEventTypes.POINTERDOWN:_this.lastSafePoint=new BABYLON.Vector2(pointerInfo.event.offsetX,pointerInfo.event.offsetY);break;case BABYLON.PointerEventTypes.POINTERUP:_this.lastSafePoint=null;break;case BABYLON.PointerEventTypes.POINTERMOVE:_this.lastSafePoint!==null&&(dir=_this.lastSafePoint.subtract(new BABYLON.Vector2(pointerInfo.event.offsetX,pointerInfo.event.offsetY)),xFactor=dir.x*_this.inertiaFactor,_this.lastSafePoint=new BABYLON.Vector2(pointerInfo.event.offsetX,pointerInfo.event.offsetY),tS=_this.speed+xFactor,_this.speed=Math.min(Math.max(tS,-_this.max),_this.max))}})},Rotator.prototype._removeMouseObs=function(){this.scene.onPointerObservable.remove(this._mouseObs)},Rotator.prototype.destroy=function(){this._removeMouseObs()},Rotator}(BABYLON.ScriptComponent);PROJECT.Rotator=Rotator}(PROJECT||(PROJECT={})),function(PROJECT){var SessionDetail=function(_super){function SessionDetail(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.sessionTexture=null,_this}return __extends(SessionDetail,_super),SessionDetail.prototype.getSessionTexture=function(){return this.sessionTexture},SessionDetail.prototype.awake=function(){this.sessionTexture=this.getProperty("sessionTexture")},SessionDetail.prototype.destroy=function(){this.sessionTexture=null},SessionDetail}(BABYLON.ScriptComponent);PROJECT.SessionDetail=SessionDetail}(PROJECT||(PROJECT={})),function(PROJECT){var SessionManager=function(_super){function SessionManager(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.runtimeTexture=null,_this}return __extends(SessionManager,_super),SessionManager.prototype.awake=function(){var _this=this,monoliths;this.runtimeTexture=this.getComponent("MVRK.RuntimeTexture");monoliths=this.getProperty("monoliths");monoliths!=null&&monoliths.forEach(function(trigger){var monolith=BABYLON.Utilities.ParseTransformByID(trigger,_this.scene),popupTrigger;monolith!=null&&(popupTrigger=BABYLON.SceneManager.FindScriptComponent(monolith,"MVRK.PopupTrigger"),popupTrigger!=null&&popupTrigger.onPickTriggerObservable.add(function(eventData){_this.handleTriggerPick(eventData)}))})},SessionManager.prototype.destroy=function(){this.runtimeTexture=null},SessionManager.prototype.handleTriggerPick=function(mesh){var sessionDetail,textureData,rootUrl,texUrl;this.runtimeTexture!=null&&(sessionDetail=BABYLON.SceneManager.FindScriptComponent(mesh,"PROJECT.SessionDetail"),sessionDetail!=null&&(textureData=sessionDetail.getSessionTexture(),textureData!=null&&(rootUrl=BABYLON.SceneManager.GetRootUrl(this.scene),texUrl=rootUrl+textureData.filename,this.runtimeTexture.setTextureUrl(texUrl))))},SessionManager}(BABYLON.ScriptComponent);PROJECT.SessionManager=SessionManager}(PROJECT||(PROJECT={})),function(BABYLON){var AnimationState=function(_super){function AnimationState(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this._frametime=0,_this._layercount=0,_this._updatemode=0,_this._hasrootmotion=!1,_this._processmotion=!0,_this._initialtargetblending=!1,_this._hastransformhierarchy=!1,_this._leftfeetbottomheight=0,_this._rightfeetbottomheight=0,_this._runtimecontroller=null,_this._executed=!1,_this._checkers=new BABYLON.TransitionCheck,_this._source="",_this._machine=null,_this._deltaPosition=new BABYLON.Vector3(0,0,0),_this._deltaRotation=new BABYLON.Quaternion(0,0,0,1),_this._deltaAngleY=0,_this._positionWeight=!1,_this._rootBoneWeight=!1,_this._rotationWeight=!1,_this._rootQuatWeight=!1,_this._positionHolder=new BABYLON.Vector3(0,0,0),_this._rootBoneHolder=new BABYLON.Vector3(0,0,0),_this._rotationHolder=new BABYLON.Quaternion(0,0,0,1),_this._rootQuatHolder=new BABYLON.Quaternion(0,0,0,1),_this._rootMotionMatrix=BABYLON.Matrix.Zero(),_this._rootMotionScaling=new BABYLON.Vector3(0,0,0),_this._rootMotionRotation=new BABYLON.Quaternion(0,0,0,1),_this._rootMotionPosition=new BABYLON.Vector3(0,0,0),_this._lastMotionRotation=new BABYLON.Quaternion(0,0,0,1),_this._lastMotionPosition=new BABYLON.Vector3(0,0,0),_this._quatRotationDiff=new BABYLON.Quaternion(0,0,0,1),_this._quatRotateVector=new BABYLON.Vector3(0,0,0),_this._dirtyMotionMatrix=null,_this._dirtyBlenderMatrix=null,_this._targetPosition=new BABYLON.Vector3(0,0,0),_this._targetRotation=new BABYLON.Quaternion(0,0,0,1),_this._targetScaling=new BABYLON.Vector3(1,1,1),_this._updateMatrix=BABYLON.Matrix.Zero(),_this._blenderMatrix=BABYLON.Matrix.Zero(),_this._blendWeights=new BABYLON.BlendingWeights,_this._data=new Map,_this._anims=new Map,_this._numbers=new Map,_this._booleans=new Map,_this._triggers=new Map,_this._parameters=new Map,_this.speedRatio=1,_this.applyRootMotion=!1,_this.enableAnimation=!0,_this.m_avatarMask=null,_this.m_defaultGroup=null,_this.m_animationTargets=null,_this.onAnimationIKObservable=new BABYLON.Observable,_this.onAnimationEndObservable=new BABYLON.Observable,_this.onAnimationLoopObservable=new BABYLON.Observable,_this.onAnimationEventObservable=new BABYLON.Observable,_this.onAnimationUpdateObservable=new BABYLON.Observable,_this}return __extends(AnimationState,_super),AnimationState.prototype.hasRootMotion=function(){return this._hasrootmotion},AnimationState.prototype.getAnimationTime=function(){return this._frametime},AnimationState.prototype.getDeltaPosition=function(){return this._deltaPosition},AnimationState.prototype.getDeltaRotation=function(){return this._deltaRotation},AnimationState.prototype.getRuntimeController=function(){return this._runtimecontroller},AnimationState.prototype.awake=function(){this.awakeStateMachine()},AnimationState.prototype.late=function(){this.lateStateMachine()},AnimationState.prototype.destroy=function(){this.destroyStateMachine()},AnimationState.prototype.playAnimation=function(state,transitionDuration,animationLayer,frameRate){var result;if(transitionDuration===void 0&&(transitionDuration=0),animationLayer===void 0&&(animationLayer=0),frameRate===void 0&&(frameRate=null),result=!1,this._machine.layers!=null&&this._machine.layers.length>animationLayer){var layer=this._machine.layers[animationLayer],blendFrameRate=layer.animationStateMachine!=null?layer.animationStateMachine.rate||BABYLON.AnimationState.FPS:BABYLON.AnimationState.FPS,blendingSpeed=transitionDuration>0?BABYLON.Utilities.ComputeBlendingSpeed(frameRate||blendFrameRate,transitionDuration):0;this.setCurrentAnimationState(layer,state,blendingSpeed);result=!0}else BABYLON.Tools.Warn("No animation state layers on "+this.transform.name);return result},AnimationState.prototype.getBool=function(name){return this._booleans.get(name)||!1},AnimationState.prototype.setBool=function(name,value){this._booleans.set(name,value)},AnimationState.prototype.getFloat=function(name){return this._numbers.get(name)||0},AnimationState.prototype.setFloat=function(name,value){this._numbers.set(name,value)},AnimationState.prototype.getInteger=function(name){return this._numbers.get(name)||0},AnimationState.prototype.setInteger=function(name,value){this._numbers.set(name,value)},AnimationState.prototype.getTrigger=function(name){return this._triggers.get(name)||!1},AnimationState.prototype.setTrigger=function(name){this._triggers.set(name,!0)},AnimationState.prototype.resetTrigger=function(name){this._triggers.set(name,!1)},AnimationState.prototype.getMachineState=function(name){return this._data.get(name)},AnimationState.prototype.setMachineState=function(name,value){this._data.set(name,value)},AnimationState.prototype.getCurrentState=function(layer){return this._machine.layers!=null&&this._machine.layers.length>layer?this._machine.layers[layer].animationStateMachine:null},AnimationState.prototype.getAnimationGroup=function(name){return this._anims.get(name)},AnimationState.prototype.getAnimationGroups=function(){return this._anims},AnimationState.prototype.setAnimationGroups=function(groups,remapTargets){var _this=this;remapTargets===void 0&&(remapTargets=!1);groups!=null&&groups.length>0&&(this._anims=new Map,this.m_animationTargets=[],this.m_defaultGroup=groups[0],groups.forEach(function(group){var agroup=group;try{group.stop()}catch(_a){}group.targetedAnimations!=null&&group.targetedAnimations.length>0&&group.targetedAnimations.forEach(function(targetedAnimation){for(var layerMixers,layerMixer,morphLayerMixers,index,morphLayerMixer,indexOfTarget=-1,i=0;i<_this.m_animationTargets.length;i++)if(_this.m_animationTargets[i].target===targetedAnimation.target){indexOfTarget=i;break}if(indexOfTarget<0)if(_this.m_animationTargets.push(targetedAnimation),targetedAnimation.target.metadata==null&&(targetedAnimation.target.metadata={}),targetedAnimation.target instanceof BABYLON.TransformNode){for(BABYLON.Utilities.ValidateTransformQuaternion(targetedAnimation.target),layerMixers=[],index=0;index<_this._layercount;index++)layerMixer=new BABYLON.AnimationMixer,layerMixer.positionBuffer=null,layerMixer.rotationBuffer=null,layerMixer.scalingBuffer=null,layerMixer.originalMatrix=null,layerMixer.blendingFactor=0,layerMixer.blendingSpeed=0,layerMixer.rootPosition=null,layerMixer.rootRotation=null,layerMixers.push(layerMixer);targetedAnimation.target.metadata.mixer=layerMixers}else if(targetedAnimation.target instanceof BABYLON.MorphTarget){for(morphLayerMixers=[],index=0;index<_this._layercount;index++)morphLayerMixer=new BABYLON.AnimationMixer,morphLayerMixer.influenceBuffer=null,morphLayerMixers.push(morphLayerMixer);targetedAnimation.target.metadata.mixer=morphLayerMixers}});agroup!=null&&agroup.metadata!=null&&agroup.metadata.unity!=null&&agroup.metadata.unity.clip!=null&&agroup.metadata.unity.clip!==""&&_this._anims.set(agroup.metadata.unity.clip,group)}))},AnimationState.prototype.getRootMotionAngle=function(){return this._deltaAngleY},AnimationState.prototype.getRootMotionSpeed=function(){var length=this._deltaPosition.length();return length>=BABYLON.AnimationState.MOTION?length:0},AnimationState.prototype.getForwardMoveSpeed=function(absolute){return absolute===void 0&&(absolute=!0),absolute?Math.abs(this._deltaPosition.z):this._deltaPosition.z},AnimationState.prototype.awakeStateMachine=function(){var _this=this,plist,sourceanims_1;this.m_animationTargets=[];this.m_defaultGroup=null;this.m_avatarMask=new Map;this._machine=this.getProperty("machine",this._machine);this._updatemode=this.getProperty("updatemode",this._updatemode);this._hasrootmotion=this.getProperty("hasrootmotion",this._hasrootmotion);this._processmotion=this.getProperty("parserootmotion",this._processmotion);this._runtimecontroller=this.getProperty("runtimecontroller",this._runtimecontroller);this._hastransformhierarchy=this.getProperty("hastransformhierarchy",this._hastransformhierarchy);this._leftfeetbottomheight=this.getProperty("leftfeetbottomheight",this._leftfeetbottomheight);this._rightfeetbottomheight=this.getProperty("rightfeetbottomheight",this._rightfeetbottomheight);this.applyRootMotion=this.getProperty("applyrootmotion",this.applyRootMotion);this._source=this.transform.metadata!=null&&this.transform.metadata.unity!=null&&this.transform.metadata.unity.animator!=null&&this.transform.metadata.unity.animator!==""?this.transform.metadata.unity.animator:null;this._machine!=null&&(this._machine.speed!=null&&(this.speedRatio=this._machine.speed),this._machine.parameters!=null&&this._machine.parameters.length>0&&(plist=this._machine.parameters,plist.forEach(function(parameter){var name=parameter.name,type=parameter.type,curve=parameter.curve,defaultFloat=parameter.defaultFloat,defaultBool=parameter.defaultBool,defaultInt=parameter.defaultInt;_this._parameters.set(name,type);type===BABYLON.AnimatorParameterType.Bool?_this.setBool(name,defaultBool):type===BABYLON.AnimatorParameterType.Float?_this.setFloat(name,defaultFloat):type===BABYLON.AnimatorParameterType.Int?_this.setInteger(name,defaultInt):type===BABYLON.AnimatorParameterType.Trigger&&_this.resetTrigger(name)})),this._machine.layers!=null&&this._machine.layers.length>0&&(this._layercount=this._machine.layers.length,this._machine.layers.sort(function(left,right){return left.index<right.index?-1:left.index>right.index?1:0}),this._machine.layers.forEach(function(layer){if(layer.avatarMask!=null&&layer.avatarMask.transformPaths!=null&&layer.avatarMask.transformPaths.length>0)for(var i=0;i<layer.avatarMask.transformPaths.length;i++)_this.m_avatarMask.set(layer.avatarMask.transformPaths[i],i)})));this._source!=null&&this._source!==""&&this.scene.animationGroups!=null&&(sourceanims_1=null,this.scene.animationGroups.forEach(function(group){var agroup=group;agroup!=null&&agroup.metadata!=null&&agroup.metadata.unity!=null&&agroup.metadata.unity.source!=null&&agroup.metadata.unity.source!==""&&agroup.metadata.unity.source===_this._source&&(sourceanims_1==null&&(sourceanims_1=[]),sourceanims_1.push(group))}),sourceanims_1!=null&&sourceanims_1.length>0&&this.setAnimationGroups(sourceanims_1));this._machine!=null&&this._machine.states!=null&&this._machine.states.length>0&&this._machine.states.forEach(function(state){state!=null&&state.name!=null&&(_this.setupTreeBranches(state.blendtree),_this.setMachineState(state.name,state))})},AnimationState.prototype.lateStateMachine=function(deltaTime){var _this=this,frameDeltaTime;deltaTime===void 0&&(deltaTime=null);this._executed===!1&&(this._executed=!0,this._machine.layers!=null&&this._machine.layers.length>0&&this._machine.layers.forEach(function(layer){_this.setCurrentAnimationState(layer,layer.entry,0)}));this.enableAnimation===!0&&(frameDeltaTime=deltaTime||this.getDeltaSeconds(),this.updateAnimationState(frameDeltaTime),this.updateAnimationCurves(frameDeltaTime),this.updateAnimationTargets(frameDeltaTime),this.onAnimationUpdateObservable.hasObservers()===!0&&this.onAnimationUpdateObservable.notifyObservers(this.transform))},AnimationState.prototype.destroyStateMachine=function(){this._data=null;this._anims=null;this._numbers=null;this._booleans=null;this._triggers=null;this._parameters=null;this._checkers=null;this._machine=null;this.onAnimationIKObservable.clear();this.onAnimationIKObservable=null;this.onAnimationEndObservable.clear();this.onAnimationEndObservable=null;this.onAnimationLoopObservable.clear();this.onAnimationLoopObservable=null;this.onAnimationEventObservable.clear();this.onAnimationEventObservable=null;this.onAnimationUpdateObservable.clear();this.onAnimationUpdateObservable=null},AnimationState.prototype.updateAnimationState=function(deltaTime){var _this=this;this._machine.layers!=null&&this._machine.layers.length>0&&this._machine.layers.forEach(function(layer){_this.checkStateMachine(layer,deltaTime)})},AnimationState.prototype.updateAnimationCurves=function(){},AnimationState.prototype.updateAnimationTargets=function(deltaTime){var _this=this;this.transform.rotationQuaternion!=null||this.transform.rotation!=null;this._machine.layers!=null&&this._machine.layers.length>0&&this._machine.layers.forEach(function(layer){var layerState,primaryBlendTree,animationTrack,formattedTime_1,scaledWeightList,primaryBlendTree_1,frameRatio,validateTime,formattedTime_2,blendingNormalTime,masterAnimationTrack,targetCount,targetIndex,masterAnimimation,blendTarget,targetRootBone,blendTargetMixer;if(layer.index===0&&(_this._frametime=layer.animationTime),layer.animationStateMachine!=null&&layer.animationStateMachine.blendtree!=null&&(layer.iKPass===!0&&_this.onAnimationIKObservable.hasObservers()===!0&&_this.onAnimationIKObservable.notifyObservers(layer.index),layerState=layer.animationStateMachine,layerState.type===BABYLON.MotionType.Clip&&layerState.played!==-1&&(layerState.played+=deltaTime),layerState.blendtree.children!=null&&layerState.blendtree.children.length>0&&(primaryBlendTree=layerState.blendtree.children[0],primaryBlendTree!=null)))if(layerState.blendtree.blendType==BABYLON.BlendTreeType.Clip){if(animationTrack=primaryBlendTree.track,animationTrack!=null){frameRatio=BABYLON.AnimationState.TIME/animationTrack.to;layer.animationNormal=layer.animationTime/BABYLON.AnimationState.TIME;validateTime=layer.animationNormal>.99?1:layer.animationNormal;formattedTime_1=Math.round(validateTime*100)/100;layerState.speed<0&&(layer.animationNormal=1-layer.animationNormal);var animationFrameTime_1=animationTrack.to*layer.animationNormal,level_1=0,looptime=!1,loopblend=!1,cycleoffset=0,heightfromfeet=!1,orientationoffsety_1=0,keeporiginalorientation=!1,keeporiginalpositionxz=!1,keeporiginalpositiony=!1,loopblendorientation_1=!1,loopblendpositiony_1=!1,loopblendpositionxz_1=!1,agroup=animationTrack;agroup.metadata!=null&&agroup.metadata.unity!=null&&agroup.metadata.unity.settings!=null&&(level_1=agroup.metadata.unity.settings.level!=null?agroup.metadata.unity.settings.level:0,looptime=agroup.metadata.unity.settings.looptime!=null?agroup.metadata.unity.settings.looptime:!1,loopblend=agroup.metadata.unity.settings.loopblend!=null?agroup.metadata.unity.settings.loopblend:!1,cycleoffset=agroup.metadata.unity.settings.cycleoffset!=null?agroup.metadata.unity.settings.cycleoffset:0,heightfromfeet=agroup.metadata.unity.settings.heightfromfeet!=null?agroup.metadata.unity.settings.heightfromfeet:!1,orientationoffsety_1=agroup.metadata.unity.settings.orientationoffsety!=null?agroup.metadata.unity.settings.orientationoffsety:0,keeporiginalorientation=agroup.metadata.unity.settings.keeporiginalorientation!=null?agroup.metadata.unity.settings.keeporiginalorientation:!1,keeporiginalpositionxz=agroup.metadata.unity.settings.keeporiginalpositionxz!=null?agroup.metadata.unity.settings.keeporiginalpositionxz:!1,keeporiginalpositiony=agroup.metadata.unity.settings.keeporiginalpositiony!=null?agroup.metadata.unity.settings.keeporiginalpositiony:!1,loopblendorientation_1=agroup.metadata.unity.settings.loopblendorientation!=null?agroup.metadata.unity.settings.loopblendorientation:!1,loopblendpositiony_1=agroup.metadata.unity.settings.loopblendpositiony!=null?agroup.metadata.unity.settings.loopblendpositiony:!1,loopblendpositionxz_1=agroup.metadata.unity.settings.loopblendpositionxz!=null?agroup.metadata.unity.settings.loopblendpositionxz:!1);orientationoffsety_1=BABYLON.Tools.ToRadians(orientationoffsety_1);orientationoffsety_1*=-1;level_1*=-1;layer.animationTime>=BABYLON.AnimationState.TIME&&(layer.animationFirstRun=!1,layer.animationLoopFrame=!0,looptime===!0?_this.onAnimationLoopObservable.hasObservers()===!0&&_this.onAnimationLoopObservable.notifyObservers(layer.index):layer.animationEndFrame===!1&&(layer.animationEndFrame=!0,_this.onAnimationEndObservable.hasObservers()===!0&&_this.onAnimationEndObservable.notifyObservers(layer.index)));(layer.animationFirstRun===!0||looptime===!0)&&animationTrack.targetedAnimations.forEach(function(targetedAnim){var clipTarget,targetRootBone,clipTargetMixer,eulerAngle,orientationAngleY,morphTarget,morphTargetMixer,floatValue;targetedAnim.target instanceof BABYLON.TransformNode?(clipTarget=targetedAnim.target,(layer.index===0||layer.avatarMask==null||_this.filterTargetAvatarMask(layer,clipTarget))&&(targetRootBone=clipTarget.metadata!=null&&clipTarget.metadata.unity!=null&&clipTarget.metadata.unity.rootbone!=null?clipTarget.metadata.unity.rootbone:!1,clipTarget.metadata!=null&&clipTarget.metadata.mixer!=null&&(clipTargetMixer=clipTarget.metadata.mixer[layer.index],clipTargetMixer!=null&&(targetedAnim.animation.targetProperty==="position"?(_this._targetPosition=BABYLON.Utilities.SampleAnimationVector3(targetedAnim.animation,animationFrameTime_1),targetRootBone===!0?(_this._positionWeight=!1,_this._positionHolder.set(0,0,0),_this._rootBoneWeight=!1,_this._rootBoneHolder.set(0,0,0),_this.applyRootMotion===!0?loopblendpositiony_1===!0&&loopblendpositionxz_1===!0?(_this._positionWeight=!0,_this._positionHolder.set(_this._targetPosition.x,_this._targetPosition.y+level_1,_this._targetPosition.z)):loopblendpositiony_1===!1&&loopblendpositionxz_1===!1?(_this._rootBoneWeight=!0,_this._rootBoneHolder.set(_this._targetPosition.x,_this._targetPosition.y+level_1,_this._targetPosition.z)):loopblendpositiony_1===!0&&loopblendpositionxz_1===!1?(_this._positionWeight=!0,_this._positionHolder.set(0,_this._targetPosition.y+level_1,0),_this._rootBoneWeight=!0,_this._rootBoneHolder.set(_this._targetPosition.x,0,_this._targetPosition.z)):loopblendpositionxz_1===!0&&loopblendpositiony_1===!1&&(_this._positionWeight=!0,_this._positionHolder.set(_this._targetPosition.x,0,_this._targetPosition.z),_this._rootBoneWeight=!0,_this._rootBoneHolder.set(0,_this._targetPosition.y+level_1,0)):_this._processmotion===!0?(_this._positionWeight=!0,_this._positionHolder.set(0,_this._targetPosition.y+level_1,0),_this._rootBoneWeight=!0,_this._rootBoneHolder.set(0,0,0)):(_this._positionWeight=!0,_this._positionHolder.set(_this._targetPosition.x,_this._targetPosition.y+level_1,_this._targetPosition.z)),_this._positionWeight===!0&&(clipTargetMixer.positionBuffer==null&&(clipTargetMixer.positionBuffer=new BABYLON.Vector3(0,0,0)),BABYLON.Utilities.BlendVector3Value(clipTargetMixer.positionBuffer,_this._positionHolder,1)),_this._rootBoneWeight===!0&&(clipTargetMixer.rootPosition==null&&(clipTargetMixer.rootPosition=new BABYLON.Vector3(0,0,0)),BABYLON.Utilities.BlendVector3Value(clipTargetMixer.rootPosition,_this._rootBoneHolder,1))):(clipTargetMixer.positionBuffer==null&&(clipTargetMixer.positionBuffer=new BABYLON.Vector3(0,0,0)),BABYLON.Utilities.BlendVector3Value(clipTargetMixer.positionBuffer,_this._targetPosition,1))):targetedAnim.animation.targetProperty==="rotationQuaternion"?(_this._targetRotation=BABYLON.Utilities.SampleAnimationQuaternion(targetedAnim.animation,animationFrameTime_1),targetRootBone===!0?(_this._rotationWeight=!1,_this._rotationHolder.set(0,0,0,0),_this._rootQuatWeight=!1,_this._rootQuatHolder.set(0,0,0,0),eulerAngle=_this._targetRotation.toEulerAngles(),orientationAngleY=eulerAngle.y,_this.applyRootMotion===!0?loopblendorientation_1===!0?(_this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(eulerAngle.x,orientationAngleY+orientationoffsety_1,eulerAngle.z,_this._rotationHolder)):(_this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(eulerAngle.x,0,eulerAngle.z,_this._rotationHolder),_this._rootQuatWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(0,orientationAngleY+orientationoffsety_1,0,_this._rootQuatHolder)):(_this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(eulerAngle.x,orientationAngleY+orientationoffsety_1,eulerAngle.z,_this._rotationHolder)),_this._rotationWeight===!0&&(clipTargetMixer.rotationBuffer==null&&(clipTargetMixer.rotationBuffer=new BABYLON.Quaternion(0,0,0,1)),BABYLON.Utilities.BlendQuaternionValue(clipTargetMixer.rotationBuffer,_this._rotationHolder,1)),_this._rootQuatWeight===!0&&(clipTargetMixer.rootRotation==null&&(clipTargetMixer.rootRotation=new BABYLON.Quaternion(0,0,0,1)),BABYLON.Utilities.BlendQuaternionValue(clipTargetMixer.rootRotation,_this._rootQuatHolder,1))):(clipTargetMixer.rotationBuffer==null&&(clipTargetMixer.rotationBuffer=new BABYLON.Quaternion(0,0,0,1)),BABYLON.Utilities.BlendQuaternionValue(clipTargetMixer.rotationBuffer,_this._targetRotation,1))):targetedAnim.animation.targetProperty==="scaling"&&(_this._targetScaling=BABYLON.Utilities.SampleAnimationVector3(targetedAnim.animation,animationFrameTime_1),clipTargetMixer.scalingBuffer==null&&(clipTargetMixer.scalingBuffer=new BABYLON.Vector3(1,1,1)),BABYLON.Utilities.BlendVector3Value(clipTargetMixer.scalingBuffer,_this._targetScaling,1)))))):targetedAnim.target instanceof BABYLON.MorphTarget&&(morphTarget=targetedAnim.target,morphTarget.metadata!=null&&morphTarget.metadata.mixer!=null&&(morphTargetMixer=morphTarget.metadata.mixer[layer.index],targetedAnim.animation.targetProperty==="influence"&&(floatValue=BABYLON.Utilities.SampleAnimationFloat(targetedAnim.animation,animationFrameTime_1),morphTargetMixer.influenceBuffer==null&&(morphTargetMixer.influenceBuffer=0),morphTargetMixer.influenceBuffer=BABYLON.Utilities.BlendFloatValue(morphTargetMixer.influenceBuffer,floatValue,1))))});layer.animationStateMachine.events!=null&&layer.animationStateMachine.events.length>0&&layer.animationStateMachine.events.forEach(function(animatorEvent){animatorEvent.time===formattedTime_1&&_this.onAnimationEventObservable.hasObservers()===!0&&_this.onAnimationEventObservable.notifyObservers(animatorEvent)});layer.animationLoopFrame===!0?(layer.animationTime=0,layer.animationNormal=0,layer.animationLoopFrame=!1):(layer.animationTime+=deltaTime*frameRatio*Math.abs(layerState.speed)*Math.abs(_this.speedRatio),layer.animationTime=BABYLON.Scalar.Clamp(layer.animationTime,0,BABYLON.AnimationState.TIME))}}else{if(_this._blendWeights.primary=null,_this._blendWeights.secondary=null,scaledWeightList=[],primaryBlendTree_1=layerState.blendtree,_this.parseTreeBranches(layer,primaryBlendTree_1,1,scaledWeightList),frameRatio=_this.computeWeightedFrameRatio(scaledWeightList),layer.animationNormal=layer.animationTime/BABYLON.AnimationState.TIME,validateTime=layer.animationNormal>.99?1:layer.animationNormal,formattedTime_2=Math.round(validateTime*100)/100,layerState.speed<0&&(layer.animationNormal=1-layer.animationNormal),blendingNormalTime=layer.animationNormal,layer.animationTime>=BABYLON.AnimationState.TIME&&(layer.animationLoopFrame=!0),masterAnimationTrack=scaledWeightList!=null&&scaledWeightList.length>0&&scaledWeightList[0].track!=null?scaledWeightList[0].track:null,masterAnimationTrack!=null)for(targetCount=masterAnimationTrack.targetedAnimations.length,targetIndex=0;targetIndex<targetCount;targetIndex++)masterAnimimation=masterAnimationTrack.targetedAnimations[targetIndex],masterAnimimation.target instanceof BABYLON.TransformNode&&(blendTarget=masterAnimimation.target,(layer.index===0||layer.avatarMask==null||_this.filterTargetAvatarMask(layer,blendTarget))&&(targetRootBone=blendTarget.metadata!=null&&blendTarget.metadata.unity!=null&&blendTarget.metadata.unity.rootbone!=null?blendTarget.metadata.unity.rootbone:!1,blendTarget.metadata!=null&&blendTarget.metadata.mixer!=null&&(_this._initialtargetblending=!0,blendTargetMixer=blendTarget.metadata.mixer[layer.index],_this.updateBlendableTargets(deltaTime,layer,primaryBlendTree_1,masterAnimimation,targetIndex,blendTargetMixer,blendingNormalTime,targetRootBone))));layer.animationStateMachine.events!=null&&layer.animationStateMachine.events.length>0&&layer.animationStateMachine.events.forEach(function(animatorEvent){animatorEvent.time===formattedTime_2&&_this.onAnimationEventObservable.hasObservers()===!0&&_this.onAnimationEventObservable.notifyObservers(animatorEvent)});layer.animationLoopFrame===!0?(layer.animationTime=0,layer.animationNormal=0,layer.animationLoopFrame=!1):(layer.animationTime+=deltaTime*frameRatio*Math.abs(layerState.speed)*Math.abs(_this.speedRatio),layer.animationTime=BABYLON.Scalar.Clamp(layer.animationTime,0,BABYLON.AnimationState.TIME))}});this.finalizeAnimationTargets()},AnimationState.prototype.updateBlendableTargets=function(deltaTime,layer,tree,masterAnimation,targetIndex,targetMixer,normalizedFrameTime,targetRootBone){var index,child,blendableAnim,blendableWeight,adjustedFrameTime,animationFrameTime,eulerAngle,orientationAngleY;if(targetMixer!=null&&tree.children!=null&&tree.children.length>0)for(index=0;index<tree.children.length;index++)if(child=tree.children[index],child.weight>0)if(child.type===BABYLON.MotionType.Clip){if(child.track!=null){var level=0,loopblend=!1,cycleoffset=0,heightfromfeet=!1,orientationoffsety=0,keeporiginalorientation=!1,keeporiginalpositionxz=!1,keeporiginalpositiony=!1,loopblendorientation=!1,loopblendpositiony=!1,loopblendpositionxz=!1,agroup=child.track;agroup.metadata!=null&&agroup.metadata.unity!=null&&agroup.metadata.unity.settings!=null&&(level=agroup.metadata.unity.settings.level!=null?agroup.metadata.unity.settings.level:0,loopblend=agroup.metadata.unity.settings.loopblend!=null?agroup.metadata.unity.settings.loopblend:!1,cycleoffset=agroup.metadata.unity.settings.cycleoffset!=null?agroup.metadata.unity.settings.cycleoffset:0,heightfromfeet=agroup.metadata.unity.settings.heightfromfeet!=null?agroup.metadata.unity.settings.heightfromfeet:!1,orientationoffsety=agroup.metadata.unity.settings.orientationoffsety!=null?agroup.metadata.unity.settings.orientationoffsety:0,keeporiginalorientation=agroup.metadata.unity.settings.keeporiginalorientation!=null?agroup.metadata.unity.settings.keeporiginalorientation:!1,keeporiginalpositionxz=agroup.metadata.unity.settings.keeporiginalpositionxz!=null?agroup.metadata.unity.settings.keeporiginalpositionxz:!1,keeporiginalpositiony=agroup.metadata.unity.settings.keeporiginalpositiony!=null?agroup.metadata.unity.settings.keeporiginalpositiony:!1,loopblendorientation=agroup.metadata.unity.settings.loopblendorientation!=null?agroup.metadata.unity.settings.loopblendorientation:!1,loopblendpositiony=agroup.metadata.unity.settings.loopblendpositiony!=null?agroup.metadata.unity.settings.loopblendpositiony:!1,loopblendpositionxz=agroup.metadata.unity.settings.loopblendpositionxz!=null?agroup.metadata.unity.settings.loopblendpositionxz:!1);orientationoffsety=BABYLON.Tools.ToRadians(orientationoffsety);orientationoffsety*=-1;level*=-1;blendableAnim=child.track.targetedAnimations[targetIndex];blendableWeight=this._initialtargetblending===!0?1:parseFloat(child.weight.toFixed(2));this._initialtargetblending=!1;blendableAnim.target===masterAnimation.target&&blendableAnim.animation.targetProperty===masterAnimation.animation.targetProperty?(adjustedFrameTime=normalizedFrameTime,child.timescale<0&&(adjustedFrameTime=1-adjustedFrameTime),animationFrameTime=child.track.to*adjustedFrameTime,masterAnimation.animation.targetProperty==="position"?(this._targetPosition=BABYLON.Utilities.SampleAnimationVector3(blendableAnim.animation,animationFrameTime),targetRootBone===!0?(this._positionWeight=!1,this._positionHolder.set(0,0,0),this._rootBoneWeight=!1,this._rootBoneHolder.set(0,0,0),this.applyRootMotion===!0?loopblendpositiony===!0&&loopblendpositionxz===!0?(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+level,this._targetPosition.z)):loopblendpositiony===!1&&loopblendpositionxz===!1?(this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,this._targetPosition.y+level,this._targetPosition.z)):loopblendpositiony===!0&&loopblendpositionxz===!1?(this._positionWeight=!0,this._positionHolder.set(0,this._targetPosition.y+level,0),this._rootBoneWeight=!0,this._rootBoneHolder.set(this._targetPosition.x,0,this._targetPosition.z)):loopblendpositionxz===!0&&loopblendpositiony===!1&&(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,0,this._targetPosition.z),this._rootBoneWeight=!0,this._rootBoneHolder.set(0,this._targetPosition.y+level,0)):this._processmotion===!0?(this._positionWeight=!0,this._positionHolder.set(0,this._targetPosition.y+level,0),this._rootBoneWeight=!0,this._rootBoneHolder.set(0,0,0)):(this._positionWeight=!0,this._positionHolder.set(this._targetPosition.x,this._targetPosition.y+level,this._targetPosition.z)),this._positionWeight===!0&&(targetMixer.positionBuffer==null&&(targetMixer.positionBuffer=new BABYLON.Vector3(0,0,0)),BABYLON.Utilities.BlendVector3Value(targetMixer.positionBuffer,this._positionHolder,blendableWeight)),this._rootBoneWeight===!0&&(targetMixer.rootPosition==null&&(targetMixer.rootPosition=new BABYLON.Vector3(0,0,0)),BABYLON.Utilities.BlendVector3Value(targetMixer.rootPosition,this._rootBoneHolder,blendableWeight))):(targetMixer.positionBuffer==null&&(targetMixer.positionBuffer=new BABYLON.Vector3(0,0,0)),BABYLON.Utilities.BlendVector3Value(targetMixer.positionBuffer,this._targetPosition,blendableWeight))):masterAnimation.animation.targetProperty==="rotationQuaternion"?(this._targetRotation=BABYLON.Utilities.SampleAnimationQuaternion(blendableAnim.animation,animationFrameTime),targetRootBone===!0?(this._rotationWeight=!1,this._rotationHolder.set(0,0,0,0),this._rootQuatWeight=!1,this._rootQuatHolder.set(0,0,0,0),eulerAngle=this._targetRotation.toEulerAngles(),orientationAngleY=eulerAngle.y,this.applyRootMotion===!0?loopblendorientation===!0?(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(eulerAngle.x,orientationAngleY+orientationoffsety,eulerAngle.z,this._rotationHolder)):(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(eulerAngle.x,0,eulerAngle.z,this._rotationHolder),this._rootQuatWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(0,orientationAngleY+orientationoffsety,0,this._rootQuatHolder)):(this._rotationWeight=!0,BABYLON.Quaternion.FromEulerAnglesToRef(eulerAngle.x,orientationAngleY+orientationoffsety,eulerAngle.z,this._rotationHolder)),this._rotationWeight===!0&&(targetMixer.rotationBuffer==null&&(targetMixer.rotationBuffer=new BABYLON.Quaternion(0,0,0,1)),BABYLON.Utilities.BlendQuaternionValue(targetMixer.rotationBuffer,this._rotationHolder,blendableWeight)),this._rootQuatWeight===!0&&(targetMixer.rootRotation==null&&(targetMixer.rootRotation=new BABYLON.Quaternion(0,0,0,1)),BABYLON.Utilities.BlendQuaternionValue(targetMixer.rootRotation,this._rootQuatHolder,blendableWeight))):(targetMixer.rotationBuffer==null&&(targetMixer.rotationBuffer=new BABYLON.Quaternion(0,0,0,1)),BABYLON.Utilities.BlendQuaternionValue(targetMixer.rotationBuffer,this._targetRotation,blendableWeight))):masterAnimation.animation.targetProperty==="scaling"&&(this._targetScaling=BABYLON.Utilities.SampleAnimationVector3(blendableAnim.animation,animationFrameTime),targetMixer.scalingBuffer==null&&(targetMixer.scalingBuffer=new BABYLON.Vector3(1,1,1)),BABYLON.Utilities.BlendVector3Value(targetMixer.scalingBuffer,this._targetScaling,blendableWeight))):BABYLON.Tools.Warn(tree.name+" - "+child.track.name+" blend tree mismatch ("+targetIndex+"): "+masterAnimation.target.name+" >>> "+blendableAnim.target.name)}}else child.type===BABYLON.MotionType.Tree&&this.updateBlendableTargets(deltaTime,layer,child.subtree,masterAnimation,targetIndex,targetMixer,normalizedFrameTime,targetRootBone)},AnimationState.prototype.finalizeAnimationTargets=function(){var _this=this;this._deltaAngleY=0;this._deltaPosition.set(0,0,0);this._deltaRotation.set(0,0,0,1);this._dirtyMotionMatrix=null;this.m_animationTargets!=null&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(targetedAnim){var animationTarget=targetedAnim.target;animationTarget.metadata!=null&&animationTarget.metadata.mixer!=null&&_this._machine.layers!=null&&_this._machine.layers.length>0&&(_this._blenderMatrix.reset(),_this._dirtyBlenderMatrix=null,_this._machine.layers.forEach(function(layer){var animationTargetMixer=animationTarget.metadata.mixer[layer.index];animationTargetMixer!=null&&(animationTarget instanceof BABYLON.TransformNode?((animationTargetMixer.positionBuffer!=null||animationTargetMixer.rotationBuffer!=null||animationTargetMixer.scalingBuffer!=null)&&(BABYLON.Matrix.ComposeToRef(animationTargetMixer.scalingBuffer||animationTarget.scaling,animationTargetMixer.rotationBuffer||animationTarget.rotationQuaternion,animationTargetMixer.positionBuffer||animationTarget.position,_this._updateMatrix),animationTargetMixer.blendingSpeed>0&&(animationTargetMixer.blendingFactor<=1&&animationTargetMixer.originalMatrix==null&&(animationTargetMixer.originalMatrix=BABYLON.Matrix.Compose(animationTarget.scaling,animationTarget.rotationQuaternion,animationTarget.position)),animationTargetMixer.blendingFactor<=1&&animationTargetMixer.originalMatrix!=null&&(BABYLON.Utilities.FastMatrixSlerp(animationTargetMixer.originalMatrix,_this._updateMatrix,animationTargetMixer.blendingFactor,_this._updateMatrix),animationTargetMixer.blendingFactor+=animationTargetMixer.blendingSpeed)),BABYLON.Utilities.FastMatrixSlerp(_this._blenderMatrix,_this._updateMatrix,layer.defaultWeight,_this._blenderMatrix),_this._dirtyBlenderMatrix=!0,animationTargetMixer.positionBuffer=null,animationTargetMixer.rotationBuffer=null,animationTargetMixer.scalingBuffer=null),(animationTargetMixer.rootPosition!=null||animationTargetMixer.rootRotation!=null)&&(BABYLON.Matrix.ComposeToRef(_this.transform.scaling,animationTargetMixer.rootRotation||_this.transform.rotationQuaternion,animationTargetMixer.rootPosition||_this.transform.position,_this._updateMatrix),BABYLON.Utilities.FastMatrixSlerp(_this._rootMotionMatrix,_this._updateMatrix,layer.defaultWeight,_this._rootMotionMatrix),_this._dirtyMotionMatrix=!0,animationTargetMixer.rootPosition=null,animationTargetMixer.rootRotation=null)):animationTarget instanceof BABYLON.MorphTarget&&animationTargetMixer.influenceBuffer!=null&&(animationTarget.influence=BABYLON.Scalar.Lerp(animationTarget.influence,animationTargetMixer.influenceBuffer,layer.defaultWeight),animationTargetMixer.influenceBuffer=null))}),_this._dirtyBlenderMatrix!=null&&_this._blenderMatrix.decompose(animationTarget.scaling,animationTarget.rotationQuaternion,animationTarget.position))});this._dirtyMotionMatrix!=null&&(this._rootMotionMatrix.decompose(this._rootMotionScaling,this._rootMotionRotation,this._rootMotionPosition),this._frametime===0&&(this._lastMotionPosition.copyFrom(this._rootMotionPosition),this._lastMotionRotation.copyFrom(this._rootMotionRotation)),this.applyRootMotion!=null&&(this._rootMotionPosition.subtractToRef(this._lastMotionPosition,this._deltaPosition),BABYLON.Utilities.QuaternionDiffToRef(this._lastMotionRotation,this._rootMotionRotation,this._quatRotationDiff),this._quatRotationDiff.toEulerAnglesToRef(this._quatRotateVector),this._deltaAngleY=this._quatRotateVector.y,BABYLON.Quaternion.FromEulerAnglesToRef(0,this._deltaAngleY,0,this._deltaRotation),this._lastMotionPosition.addInPlace(this._deltaPosition),this._lastMotionRotation.multiplyInPlace(this._deltaRotation)))},AnimationState.prototype.checkStateMachine=function(layer){var _this=this;this._checkers.result=null;this._checkers.offest=0;this._checkers.blending=0;this._checkers.triggered=[];layer.animationStateMachine!=null&&(this.checkStateTransitions(layer,layer.animationStateMachine.transitions,layer.animationStateMachine.time,layer.animationStateMachine.length,layer.animationStateMachine.rate),this._checkers.result==null&&this._machine.transitions!=null&&this.checkStateTransitions(layer,this._machine.transitions,layer.animationStateMachine.time,layer.animationStateMachine.length,layer.animationStateMachine.rate));this._checkers.triggered!=null&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(trigger){_this.resetTrigger(trigger)}),this._checkers.triggered=null);this._checkers.result!=null&&(this._checkers.offest>0?BABYLON.SceneManager.SetTimeout(this._checkers.offest*1e3,function(){_this.setCurrentAnimationState(layer,_this._checkers.result,_this._checkers.blending)}):this.setCurrentAnimationState(layer,this._checkers.result,this._checkers.blending))},AnimationState.prototype.checkStateTransitions=function(layer,transitions,time,length,rate){var _this=this,_loop_1,this_1,state_1;if(transitions!=null&&transitions.length>0){for(var i=0,solo=-1,i=0;i<transitions.length;i++)if(transitions[i].solo===!0&&transitions[i].mute===!1){solo=i;break}for(_loop_1=function(){var transition=transitions[i],passed_1,checks;if(transition.layerIndex!==layer.index||transition.mute===!0||solo>=0&&solo!==i)return"continue";var transitionOk=!1,exitTimeSecs=BABYLON.Scalar.Denormalize(transition.exitTime,0,length),exitTimeExpired=BABYLON.SceneManager.GetGameTime()-time>=exitTimeSecs;if(transition.hasExitTime===!0&&transition.intSource==BABYLON.InterruptionSource.None&&exitTimeExpired===!1)return"continue";if(transition.conditions!=null&&transition.conditions.length>0?(passed_1=0,checks=transition.conditions.length,transition.conditions.forEach(function(condition){var ptype=_this._parameters.get(condition.parameter),numValue,boolValue,triggerValue,indexOfTrigger,i_1;if(ptype!=null)if(ptype==BABYLON.AnimatorParameterType.Float||ptype==BABYLON.AnimatorParameterType.Int)numValue=parseFloat(_this.getFloat(condition.parameter).toFixed(2)),condition.mode===BABYLON.ConditionMode.Greater&&numValue>condition.threshold?passed_1++:condition.mode===BABYLON.ConditionMode.Less&&numValue<condition.threshold?passed_1++:condition.mode===BABYLON.ConditionMode.Equals&&numValue===condition.threshold?passed_1++:condition.mode===BABYLON.ConditionMode.NotEqual&&numValue!==condition.threshold&&passed_1++;else if(ptype==BABYLON.AnimatorParameterType.Bool)boolValue=_this.getBool(condition.parameter),condition.mode===BABYLON.ConditionMode.If&&boolValue===!0?passed_1++:condition.mode===BABYLON.ConditionMode.IfNot&&boolValue===!1&&passed_1++;else if(ptype==BABYLON.AnimatorParameterType.Trigger&&(triggerValue=_this.getTrigger(condition.parameter),triggerValue===!0)){for(passed_1++,indexOfTrigger=-1,i_1=0;i_1<_this._checkers.triggered.length;i_1++)if(_this._checkers.triggered[i_1]===condition.parameter){indexOfTrigger=i_1;break}indexOfTrigger<0&&_this._checkers.triggered.push(condition.parameter)}}),transitionOk=transition.hasExitTime===!0?exitTimeExpired===!0&&passed_1===checks:passed_1===checks):transitionOk=transition.hasExitTime===!0&&exitTimeExpired===!0,transitionOk===!0){var blendSize=length>0?length:1,blendRate=rate>0?rate:BABYLON.AnimationState.FPS,destState=transition.isExit===!1?transition.destination:BABYLON.AnimationState.EXIT,offsetSecs=transition.fixedDuration===!0?transition.offset:BABYLON.Scalar.Denormalize(transition.offset,0,blendSize),durationSecs=transition.fixedDuration===!0?transition.duration:BABYLON.Scalar.Denormalize(transition.duration,0,blendSize),blendingSpeed=BABYLON.Utilities.ComputeBlendingSpeed(blendRate,durationSecs);return this_1._checkers.result=destState,this_1._checkers.offest=offsetSecs,this_1._checkers.blending=blendingSpeed,"break"}},this_1=this,i=0;i<transitions.length;i++)if(state_1=_loop_1(),state_1==="break")break}},AnimationState.prototype.setCurrentAnimationState=function(layer,name,blending){if(name!=null&&name!==""&&name!==BABYLON.AnimationState.EXIT&&(layer.animationStateMachine==null||layer.animationStateMachine.name!==name)){var state=this.getMachineState(name);this.m_animationTargets!=null&&this.m_animationTargets.length>0&&this.m_animationTargets.forEach(function(targetedAnim){var animationTarget=targetedAnim.target,animationTargetMixer;animationTarget.metadata!=null&&animationTarget.metadata.mixer!=null&&(animationTargetMixer=animationTarget.metadata.mixer[layer.index],animationTargetMixer!=null&&(animationTargetMixer.originalMatrix=null,animationTargetMixer.blendingFactor=0,animationTargetMixer.blendingSpeed=blending))});state!=null&&state.layerIndex===layer.index&&(state.time=0,state.played=0,state.interrupted=!1,layer.animationTime=0,layer.animationNormal=0,layer.animationFirstRun=!0,layer.animationEndFrame=!1,layer.animationLoopFrame=!1,layer.animationStateMachine=state,layer.animationStateMachine.time=BABYLON.SceneManager.GetGameTime())}},AnimationState.prototype.checkAvatarTransformPath=function(layer,transformPath){var result=!1,transformIndex;return this.m_avatarMask!=null&&(transformIndex=this.m_avatarMask.get(transformPath),transformIndex!=null&&transformIndex>=0&&(result=!0)),result},AnimationState.prototype.filterTargetAvatarMask=function(layer,target){var result=!1,transformPath;return target.metadata!=null&&target.metadata.unity!=null&&target.metadata.unity.bone!=null&&target.metadata.unity.bone!==""&&(transformPath=target.metadata.unity.bone,result=this.checkAvatarTransformPath(layer,transformPath)),result},AnimationState.prototype.sortWeightedBlendingList=function(weightList){weightList!=null&&weightList.length>0&&weightList.sort(function(left,right){return left.weight<right.weight?1:left.weight>right.weight?-1:0})},AnimationState.prototype.computeWeightedFrameRatio=function(weightList){var result=1,primaryWeight,frameWeightDelta;return weightList!=null&&weightList.length>0&&(this.sortWeightedBlendingList(weightList),this._blendWeights.primary=weightList[0],primaryWeight=this._blendWeights.primary.weight,primaryWeight<1&&weightList.length>1&&(this._blendWeights.secondary=weightList[1]),this._blendWeights.primary!=null&&this._blendWeights.secondary!=null?(frameWeightDelta=BABYLON.Scalar.Clamp(this._blendWeights.primary.weight),result=BABYLON.Scalar.Lerp(this._blendWeights.secondary.ratio,this._blendWeights.primary.ratio,frameWeightDelta)):this._blendWeights.primary!=null&&this._blendWeights.secondary==null&&(result=this._blendWeights.primary.ratio)),result},AnimationState.prototype.setupTreeBranches=function(tree){var _this=this;tree!=null&&tree.children!=null&&tree.children.length>0&&tree.children.forEach(function(child){child.type===BABYLON.MotionType.Tree?_this.setupTreeBranches(child.subtree):child.type===BABYLON.MotionType.Clip&&child.motion!=null&&child.motion!==""&&(child.weight=0,child.ratio=0,child.track=_this.getAnimationGroup(child.motion),child.track!=null&&(child.ratio=BABYLON.AnimationState.TIME/child.track.to))})},AnimationState.prototype.parseTreeBranches=function(layer,tree,parentWeight,weightList){if(tree!=null){tree.valueParameterX=tree.blendParameterX!=null?parseFloat(this.getFloat(tree.blendParameterX).toFixed(2)):0;tree.valueParameterY=tree.blendParameterY!=null?parseFloat(this.getFloat(tree.blendParameterY).toFixed(2)):0;switch(tree.blendType){case BABYLON.BlendTreeType.Simple1D:this.parse1DSimpleTreeBranches(layer,tree,parentWeight,weightList);break;case BABYLON.BlendTreeType.SimpleDirectional2D:this.parse2DSimpleDirectionalTreeBranches(layer,tree,parentWeight,weightList);break;case BABYLON.BlendTreeType.FreeformDirectional2D:this.parse2DFreeformDirectionalTreeBranches(layer,tree,parentWeight,weightList);break;case BABYLON.BlendTreeType.FreeformCartesian2D:this.parse2DFreeformCartesianTreeBranches(layer,tree,parentWeight,weightList)}}},AnimationState.prototype.parse1DSimpleTreeBranches=function(layer,tree,parentWeight,weightList){var _this=this,blendTreeArray_1;tree!=null&&tree.children!=null&&tree.children.length>0&&(blendTreeArray_1=[],tree.children.forEach(function(child){child.weight=0;var item={source:child,motion:child.motion,posX:child.threshold,posY:child.threshold,weight:child.weight};blendTreeArray_1.push(item)}),BABYLON.BlendTreeSystem.Calculate1DSimpleBlendTree(tree.valueParameterX,blendTreeArray_1),blendTreeArray_1.forEach(function(element){element.source!=null&&(element.source.weight=element.weight)}),tree.children.forEach(function(child){child.weight*=parentWeight;child.type===BABYLON.MotionType.Clip&&child.weight>0&&weightList.push(child);child.type===BABYLON.MotionType.Tree&&_this.parseTreeBranches(layer,child.subtree,child.weight,weightList)}))},AnimationState.prototype.parse2DSimpleDirectionalTreeBranches=function(layer,tree,parentWeight,weightList){var _this=this,blendTreeArray_2;tree!=null&&tree.children!=null&&tree.children.length>0&&(blendTreeArray_2=[],tree.children.forEach(function(child){child.weight=0;var item={source:child,motion:child.motion,posX:child.positionX,posY:child.positionY,weight:child.weight};blendTreeArray_2.push(item)}),BABYLON.BlendTreeSystem.Calculate2DFreeformDirectional(tree.valueParameterX,tree.valueParameterY,blendTreeArray_2),blendTreeArray_2.forEach(function(element){element.source!=null&&(element.source.weight=element.weight)}),tree.children.forEach(function(child){child.weight*=parentWeight;child.type===BABYLON.MotionType.Clip&&child.weight>0&&weightList.push(child);child.type===BABYLON.MotionType.Tree&&_this.parseTreeBranches(layer,child.subtree,child.weight,weightList)}))},AnimationState.prototype.parse2DFreeformDirectionalTreeBranches=function(layer,tree,parentWeight,weightList){var _this=this,blendTreeArray_3;tree!=null&&tree.children!=null&&tree.children.length>0&&(blendTreeArray_3=[],tree.children.forEach(function(child){child.weight=0;var item={source:child,motion:child.motion,posX:child.positionX,posY:child.positionY,weight:child.weight};blendTreeArray_3.push(item)}),BABYLON.BlendTreeSystem.Calculate2DFreeformDirectional(tree.valueParameterX,tree.valueParameterY,blendTreeArray_3),blendTreeArray_3.forEach(function(element){element.source!=null&&(element.source.weight=element.weight)}),tree.children.forEach(function(child){child.weight*=parentWeight;child.type===BABYLON.MotionType.Clip&&child.weight>0&&weightList.push(child);child.type===BABYLON.MotionType.Tree&&_this.parseTreeBranches(layer,child.subtree,child.weight,weightList)}))},AnimationState.prototype.parse2DFreeformCartesianTreeBranches=function(layer,tree,parentWeight,weightList){var _this=this,blendTreeArray_4;tree!=null&&tree.children!=null&&tree.children.length>0&&(blendTreeArray_4=[],tree.children.forEach(function(child){child.weight=0;var item={source:child,motion:child.motion,posX:child.positionX,posY:child.positionY,weight:child.weight};blendTreeArray_4.push(item)}),BABYLON.BlendTreeSystem.Calculate2DFreeformCartesian(tree.valueParameterX,tree.valueParameterY,blendTreeArray_4),blendTreeArray_4.forEach(function(element){element.source!=null&&(element.source.weight=element.weight)}),tree.children.forEach(function(child){child.weight*=parentWeight;child.type===BABYLON.MotionType.Clip&&child.weight>0&&weightList.push(child);child.type===BABYLON.MotionType.Tree&&_this.parseTreeBranches(layer,child.subtree,child.weight,weightList)}))},AnimationState.FPS=30,AnimationState.TIME=1,AnimationState.EXIT="[EXIT]",AnimationState.MOTION=.001,AnimationState}(BABYLON.ScriptComponent),BlendTreeValue,BlendTreeUtils,BlendTreeSystem,MachineState,TransitionCheck,AnimationMixer,BlendingWeights,MotionType,ConditionMode,InterruptionSource,BlendTreeType,BlendTreePosition,AnimatorParameterType;BABYLON.AnimationState=AnimationState;BlendTreeValue=function(){function BlendTreeValue(config){this.source=config.source;this.motion=config.motion;this.posX=config.posX||0;this.posY=config.posY||0;this.weight=config.weight||0}return BlendTreeValue}();BABYLON.BlendTreeValue=BlendTreeValue;BlendTreeUtils=function(){function BlendTreeUtils(){}return BlendTreeUtils.ClampValue=function(num,min,max){return num<=min?min:num>=max?max:num},BlendTreeUtils.GetSignedAngle=function(a,b){return Math.atan2(a.x*b.y-a.y*b.x,a.x*b.x+a.y*b.y)},BlendTreeUtils.GetLinearInterpolation=function(x0,y0,x1,y1,x){return y0+(x-x0)*((y1-y0)/(x1-x0))},BlendTreeUtils.GetRightNeighbourIndex=function(inputX,blendTreeArray){blendTreeArray.sort(function(a,b){return a.posX-b.posX});for(var i=0;i<blendTreeArray.length;++i)if(blendTreeArray[i].posX>inputX)return i;return-1},BlendTreeUtils}();BABYLON.BlendTreeUtils=BlendTreeUtils;BlendTreeSystem=function(){function BlendTreeSystem(){}return BlendTreeSystem.Calculate1DSimpleBlendTree=function(inputX,blendTreeArray){var firstBlendTree=blendTreeArray[0],lastBlendTree=blendTreeArray[blendTreeArray.length-1];if(inputX<=firstBlendTree.posX)firstBlendTree.weight=1;else if(inputX>=lastBlendTree.posX)lastBlendTree.weight=1;else{var rightNeighbourBlendTreeIndex=BABYLON.BlendTreeUtils.GetRightNeighbourIndex(inputX,blendTreeArray),leftNeighbour=blendTreeArray[rightNeighbourBlendTreeIndex-1],rightNeighbour=blendTreeArray[rightNeighbourBlendTreeIndex],interpolatedValue=BABYLON.BlendTreeUtils.GetLinearInterpolation(leftNeighbour.posX,1,rightNeighbour.posX,0,inputX);leftNeighbour.weight=interpolatedValue;rightNeighbour.weight=1-leftNeighbour.weight}},BlendTreeSystem.Calculate2DFreeformDirectional=function(inputX,inputY,blendTreeArray){var i,j,lenSqIJ,newWeight,_i,blendTreeArray_5,blendTree;BABYLON.BlendTreeSystem.TempVector2_IP.set(inputX,inputY);BABYLON.BlendTreeSystem.TempVector2_POSI.set(0,0);BABYLON.BlendTreeSystem.TempVector2_POSJ.set(0,0);BABYLON.BlendTreeSystem.TempVector2_POSIP.set(0,0);BABYLON.BlendTreeSystem.TempVector2_POSIJ.set(0,0);var kDirScale=2,totalWeight=0,inputLength=BABYLON.BlendTreeSystem.TempVector2_IP.length();for(i=0;i<blendTreeArray.length;++i){blendTree=blendTreeArray[i];BABYLON.BlendTreeSystem.TempVector2_POSI.set(blendTree.posX,blendTree.posY);var posILength=BABYLON.BlendTreeSystem.TempVector2_POSI.length(),inputToPosILength=inputLength-posILength,posIToInputAngle=BABYLON.BlendTreeUtils.GetSignedAngle(BABYLON.BlendTreeSystem.TempVector2_POSI,BABYLON.BlendTreeSystem.TempVector2_IP),weight=1;for(j=0;j<blendTreeArray.length;++j)if(j===i)continue;else{BABYLON.BlendTreeSystem.TempVector2_POSJ.set(blendTreeArray[j].posX,blendTreeArray[j].posY);var posJLength=BABYLON.BlendTreeSystem.TempVector2_POSJ.length(),averageLengthOfIJ=(posILength+posJLength)/2,magOfPosIToInputPos=inputToPosILength/averageLengthOfIJ,magOfIJ=(posJLength-posILength)/averageLengthOfIJ,angleIJ=BABYLON.BlendTreeUtils.GetSignedAngle(BABYLON.BlendTreeSystem.TempVector2_POSI,BABYLON.BlendTreeSystem.TempVector2_POSJ);BABYLON.BlendTreeSystem.TempVector2_POSIP.set(magOfPosIToInputPos,posIToInputAngle*kDirScale);BABYLON.BlendTreeSystem.TempVector2_POSIJ.set(magOfIJ,angleIJ*kDirScale);lenSqIJ=BABYLON.BlendTreeSystem.TempVector2_POSIJ.lengthSquared();newWeight=BABYLON.Vector2.Dot(BABYLON.BlendTreeSystem.TempVector2_POSIP,BABYLON.BlendTreeSystem.TempVector2_POSIJ)/lenSqIJ;newWeight=1-newWeight;newWeight=BABYLON.BlendTreeUtils.ClampValue(newWeight,0,1);weight=Math.min(newWeight,weight)}blendTree.weight=weight;totalWeight+=weight}for(_i=0,blendTreeArray_5=blendTreeArray;_i<blendTreeArray_5.length;_i++)blendTree=blendTreeArray_5[_i],blendTree.weight/=totalWeight},BlendTreeSystem.Calculate2DFreeformCartesian=function(inputX,inputY,blendTreeArray){var totalWeight,i,weight,j,lenSqIJ,newWeight,_i,blendTreeArray_6,blendTree;for(BABYLON.BlendTreeSystem.TempVector2_IP.set(inputX,inputY),BABYLON.BlendTreeSystem.TempVector2_POSI.set(0,0),BABYLON.BlendTreeSystem.TempVector2_POSJ.set(0,0),BABYLON.BlendTreeSystem.TempVector2_POSIP.set(0,0),BABYLON.BlendTreeSystem.TempVector2_POSIJ.set(0,0),totalWeight=0,i=0;i<blendTreeArray.length;++i){for(blendTree=blendTreeArray[i],BABYLON.BlendTreeSystem.TempVector2_POSI.set(blendTree.posX,blendTree.posY),BABYLON.BlendTreeSystem.TempVector2_IP.subtractToRef(BABYLON.BlendTreeSystem.TempVector2_POSI,BABYLON.BlendTreeSystem.TempVector2_POSIP),weight=1,j=0;j<blendTreeArray.length;++j)if(j===i)continue;else BABYLON.BlendTreeSystem.TempVector2_POSJ.set(blendTreeArray[j].posX,blendTreeArray[j].posY),BABYLON.BlendTreeSystem.TempVector2_POSJ.subtractToRef(BABYLON.BlendTreeSystem.TempVector2_POSI,BABYLON.BlendTreeSystem.TempVector2_POSIJ),lenSqIJ=BABYLON.BlendTreeSystem.TempVector2_POSIJ.lengthSquared(),newWeight=BABYLON.Vector2.Dot(BABYLON.BlendTreeSystem.TempVector2_POSIP,BABYLON.BlendTreeSystem.TempVector2_POSIJ)/lenSqIJ,newWeight=1-newWeight,newWeight=BABYLON.BlendTreeUtils.ClampValue(newWeight,0,1),weight=Math.min(weight,newWeight);blendTree.weight=weight;totalWeight+=weight}for(_i=0,blendTreeArray_6=blendTreeArray;_i<blendTreeArray_6.length;_i++)blendTree=blendTreeArray_6[_i],blendTree.weight/=totalWeight},BlendTreeSystem.TempVector2_IP=new BABYLON.Vector2(0,0),BlendTreeSystem.TempVector2_POSI=new BABYLON.Vector2(0,0),BlendTreeSystem.TempVector2_POSJ=new BABYLON.Vector2(0,0),BlendTreeSystem.TempVector2_POSIP=new BABYLON.Vector2(0,0),BlendTreeSystem.TempVector2_POSIJ=new BABYLON.Vector2(0,0),BlendTreeSystem}();BABYLON.BlendTreeSystem=BlendTreeSystem;MachineState=function(){function MachineState(){}return MachineState}();BABYLON.MachineState=MachineState;TransitionCheck=function(){function TransitionCheck(){}return TransitionCheck}();BABYLON.TransitionCheck=TransitionCheck;AnimationMixer=function(){function AnimationMixer(){}return AnimationMixer}();BABYLON.AnimationMixer=AnimationMixer;BlendingWeights=function(){function BlendingWeights(){}return BlendingWeights}();BABYLON.BlendingWeights=BlendingWeights,function(MotionType){MotionType[MotionType.Clip=0]="Clip";MotionType[MotionType.Tree=1]="Tree"}(MotionType=BABYLON.MotionType||(BABYLON.MotionType={})),function(ConditionMode){ConditionMode[ConditionMode.If=1]="If";ConditionMode[ConditionMode.IfNot=2]="IfNot";ConditionMode[ConditionMode.Greater=3]="Greater";ConditionMode[ConditionMode.Less=4]="Less";ConditionMode[ConditionMode.Equals=6]="Equals";ConditionMode[ConditionMode.NotEqual=7]="NotEqual"}(ConditionMode=BABYLON.ConditionMode||(BABYLON.ConditionMode={})),function(InterruptionSource){InterruptionSource[InterruptionSource.None=0]="None";InterruptionSource[InterruptionSource.Source=1]="Source";InterruptionSource[InterruptionSource.Destination=2]="Destination";InterruptionSource[InterruptionSource.SourceThenDestination=3]="SourceThenDestination";InterruptionSource[InterruptionSource.DestinationThenSource=4]="DestinationThenSource"}(InterruptionSource=BABYLON.InterruptionSource||(BABYLON.InterruptionSource={})),function(BlendTreeType){BlendTreeType[BlendTreeType.Simple1D=0]="Simple1D";BlendTreeType[BlendTreeType.SimpleDirectional2D=1]="SimpleDirectional2D";BlendTreeType[BlendTreeType.FreeformDirectional2D=2]="FreeformDirectional2D";BlendTreeType[BlendTreeType.FreeformCartesian2D=3]="FreeformCartesian2D";BlendTreeType[BlendTreeType.Direct=4]="Direct";BlendTreeType[BlendTreeType.Clip=5]="Clip"}(BlendTreeType=BABYLON.BlendTreeType||(BABYLON.BlendTreeType={})),function(BlendTreePosition){BlendTreePosition[BlendTreePosition.Lower=0]="Lower";BlendTreePosition[BlendTreePosition.Upper=1]="Upper"}(BlendTreePosition=BABYLON.BlendTreePosition||(BABYLON.BlendTreePosition={})),function(AnimatorParameterType){AnimatorParameterType[AnimatorParameterType.Float=1]="Float";AnimatorParameterType[AnimatorParameterType.Int=3]="Int";AnimatorParameterType[AnimatorParameterType.Bool=4]="Bool";AnimatorParameterType[AnimatorParameterType.Trigger=9]="Trigger"}(AnimatorParameterType=BABYLON.AnimatorParameterType||(BABYLON.AnimatorParameterType={}))}(BABYLON||(BABYLON={})),function(BABYLON){var AudioSource=function(_super){function AudioSource(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this._audio=null,_this._name=null,_this._file=null,_this._loop=!1,_this._mute=!1,_this._volume=1,_this._pitch=1,_this._priority=128,_this._panstereo=0,_this._mindistance=1,_this._maxdistance=50,_this._rolloffmode="linear",_this._rollofffactor=1,_this._playonawake=!0,_this._spatialblend=0,_this._reverbzonemix=1,_this._lastmutedvolume=null,_this._bypasseffects=!1,_this._bypassreverbzones=!1,_this._bypasslistenereffects=!1,_this._initializedReadyInstance=!1,_this.onReadyObservable=new BABYLON.Observable,_this}return __extends(AudioSource,_super),AudioSource.prototype.getSoundClip=function(){return this._audio},AudioSource.prototype.getAudioElement=function(){return this._audio!=null?this._audio._htmlAudioElement:null},AudioSource.prototype.awake=function(){this.awakeAudioSource()},AudioSource.prototype.destroy=function(){this.destroyAudioSource()},AudioSource.prototype.awakeAudioSource=function(){var _this=this,htmlAudioElementRequired;if(this._name=this.getProperty("name",this._name),this._file=this.getProperty("file",this._file),this._loop=this.getProperty("loop",this._loop),this._mute=this.getProperty("mute",this._mute),this._volume=this.getProperty("volume",this._volume),this._pitch=this.getProperty("pitch",this._pitch),this._priority=this.getProperty("priority",this._priority),this._panstereo=this.getProperty("panstereo",this._panstereo),this._playonawake=this.getProperty("playonawake",this._playonawake),this._mindistance=this.getProperty("mindistance",this._mindistance),this._maxdistance=this.getProperty("maxdistance",this._maxdistance),this._rolloffmode=this.getProperty("rolloffmode",this._rolloffmode),this._rollofffactor=this.getProperty("rollofffactor",this._rollofffactor),this._spatialblend=this.getProperty("spatialblend",this._spatialblend),this._reverbzonemix=this.getProperty("reverbzonemix",this._reverbzonemix),this._bypasseffects=this.getProperty("bypasseffects",this._bypasseffects),this._bypassreverbzones=this.getProperty("bypassreverbzones",this._bypassreverbzones),this._bypasslistenereffects=this.getProperty("bypasslistenereffects",this._bypasslistenereffects),htmlAudioElementRequired=this.transform.metadata!=null&&this.transform.metadata.vtt!=null&&this.transform.metadata.vtt===!0,(this._name==null||this._name==="")&&(this._name="Unknown"),this._file!=null&&this._file!==""){var rootUrl=BABYLON.SceneManager.GetRootUrl(this.scene),spatialBlend=this._spatialblend>=.1,distanceModel=this._rolloffmode==="logarithmic"?"exponential":"linear";this._audio=new BABYLON.Sound(this._name,rootUrl+this._file,this.scene,function(){_this._mute===!0?(_this._lastmutedvolume=_this._volume,_this._audio.setVolume(0)):_this._audio.setVolume(_this._volume);_this._audio.setVolume(_this._mute===!0?0:_this._volume);_this._audio.setPlaybackRate(_this._pitch);_this._initializedReadyInstance=!0;_this.onReadyObservable.hasObservers()===!0&&_this.onReadyObservable.notifyObservers(_this._audio)},{loop:this._loop,autoplay:this._playonawake,refDistance:this._mindistance,maxDistance:this._maxdistance,rolloffFactor:this._rollofffactor,spatialSound:spatialBlend,distanceModel:distanceModel,streaming:htmlAudioElementRequired});this._audio.setPosition(this.transform.position.clone());spatialBlend===!0&&this._audio.attachToMesh(this.transform)}},AudioSource.prototype.destroyAudioSource=function(){this.onReadyObservable.clear();this.onReadyObservable=null;this._audio!=null&&(this._audio.dispose(),this._audio=null)},AudioSource.prototype.isReady=function(){var result=!1;return this._audio!=null&&(result=this._audio.isReady()),result},AudioSource.prototype.isPlaying=function(){var result=!1;return this._audio!=null&&(result=this._audio.isPlaying),result},AudioSource.prototype.isPaused=function(){var result=!1;return this._audio!=null&&(result=this._audio.isPaused),result},AudioSource.prototype.play=function(time,offset,length){var _this=this,result=!1;return this._audio!=null&&(this._initializedReadyInstance===!0?this._audio.play(time,offset,length):this.onReadyObservable.addOnce(function(){_this._audio.play(time,offset,length)}),result=!0),result},AudioSource.prototype.pause=function(){var result=!1;return this._audio!=null&&(this._audio.pause(),result=!0),result},AudioSource.prototype.stop=function(time){var result=!1;return this._audio!=null&&(this._audio.stop(time),result=!0),result},AudioSource.prototype.mute=function(time){return this._audio!=null&&(this._lastmutedvolume=this._audio.getVolume(),this._audio.setVolume(0,time)),!1},AudioSource.prototype.unmute=function(time){return this._audio!=null&&this._lastmutedvolume!=null&&(this._audio.setVolume(this._lastmutedvolume,time),this._lastmutedvolume=null),!1},AudioSource.prototype.getVolume=function(){var result=0;return this._audio!=null&&(result=this._audio.getVolume()),result},AudioSource.prototype.setVolume=function(volume,time){var result=!1;return this._audio!=null&&(this._audio.setVolume(volume,time),result=!0),result},AudioSource.prototype.getSpatialSound=function(){var result=!1;return this._audio!=null&&(result=this._audio.spatialSound),result},AudioSource.prototype.setSpatialSound=function(value){this._audio!=null&&(this._audio.spatialSound=value)},AudioSource.prototype.setPlaybackSpeed=function(rate){this._audio!=null&&this._audio.setPlaybackRate(rate)},AudioSource.prototype.getCurrentTrackTime=function(){var result=0;return this._audio!=null&&(result=this._audio.currentTime),result},AudioSource}(BABYLON.ScriptComponent);BABYLON.AudioSource=AudioSource}(BABYLON||(BABYLON={})),function(BABYLON){var CharacterController=function(_super){function CharacterController(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this._abstractMesh=null,_this._avatarRadius=.5,_this._avatarHeight=2,_this._centerOffset=new BABYLON.Vector3(0,0,0),_this._skinWidth=.08,_this._stepOffset=.3,_this._slopeLimit=45,_this._capsuleSegments=16,_this._minMoveDistance=.001,_this._isPhysicsReady=!1,_this._maxCollisions=4,_this._useGhostSweepTest=!1,_this._tmpCollisionContacts=null,_this.updatePosition=!0,_this.m_character=null,_this.m_ghostShape=null,_this.m_ghostObject=null,_this.m_ghostCollision=null,_this.m_ghostTransform=null,_this.m_ghostPosition=null,_this.m_startPosition=null,_this.m_startTransform=null,_this.m_walkDirection=null,_this.m_warpPosition=null,_this.m_turningRate=0,_this.m_moveDeltaX=0,_this.m_moveDeltaZ=0,_this.m_physicsEngine=null,_this.m_collisionPosition=BABYLON.Vector3.Zero(),_this.onUpdatePositionObservable=new BABYLON.Observable,_this.onCollisionEnterObservable=new BABYLON.Observable,_this.onCollisionStayObservable=new BABYLON.Observable,_this.onCollisionExitObservable=new BABYLON.Observable,_this}return __extends(CharacterController,_super),CharacterController.prototype.getInternalCharacter=function(){return this.m_character},CharacterController.prototype.getAvatarRadius=function(){return this._avatarRadius},CharacterController.prototype.getAvatarHeight=function(){return this._avatarHeight},CharacterController.prototype.getSkinWidth=function(){return this._skinWidth},CharacterController.prototype.getStepOffset=function(){return this._stepOffset},CharacterController.prototype.getUseSweepTest=function(){return this._useGhostSweepTest},CharacterController.prototype.getMinMoveDistance=function(){return this._minMoveDistance},CharacterController.prototype.setMinMoveDistance=function(distance){this._minMoveDistance=distance},CharacterController.prototype.getVerticalVelocity=function(){return this.m_character!=null&&this.m_character.getVerticalVelocity?this.m_character.getVerticalVelocity():0},CharacterController.prototype.getAddedMargin=function(){return this.m_character!=null&&this.m_character.getAddedMargin?this.m_character.getAddedMargin():0},CharacterController.prototype.setAddedMargin=function(margin){this.m_character!=null&&this.m_character.getAddedMargin&&this.m_character.setAddedMargin(margin)},CharacterController.prototype.setMaxJumpHeight=function(maxJumpHeight){this.m_character!=null&&this.m_character.setMaxJumpHeight(maxJumpHeight)},CharacterController.prototype.setFallingSpeed=function(fallSpeed){this.m_character!=null&&this.m_character.setFallSpeed(fallSpeed)},CharacterController.prototype.getSlopeLimit=function(){return this.m_character!=null?this.m_character.getMaxSlope():0},CharacterController.prototype.setSlopeLimit=function(slopeRadians){this.m_character!=null&&this.m_character.setMaxSlope(slopeRadians)},CharacterController.prototype.setUpAxis=function(axis){this.m_character!=null&&this.m_character.setUpAxis(axis)},CharacterController.prototype.getGravity=function(){return this.m_character!=null?this.m_character.getGravity():0},CharacterController.prototype.setGravity=function(gravity){this.m_character!=null&&this.m_character.setGravity(gravity)},CharacterController.prototype.isGrounded=function(){return this.m_character!=null?this.m_character.onGround():!1},CharacterController.prototype.isReady=function(){return this.m_character!=null},CharacterController.prototype.canJump=function(){return this.m_character!=null?this.m_character.canJump():!1},CharacterController.prototype.internalWarp=function(position){this.m_character!=null&&this.m_character.warp(position)},CharacterController.prototype.internalJump=function(){this.m_character!=null&&this.m_character.jump()},CharacterController.prototype.internalSetJumpSpeed=function(speed){this.m_character!=null&&this.m_character.setJumpSpeed(speed)},CharacterController.prototype.internalSetWalkDirection=function(direction){this.m_character!=null&&this.m_character.setWalkDirection(direction)},CharacterController.prototype.internalSetVelocityForTimeInterval=function(velocity,interval){this.m_character!=null&&this.m_character.setVelocityForTimeInterval(velocity,interval)},CharacterController.prototype.awake=function(){this.awakeMovementState()},CharacterController.prototype.start=function(){this.startMovementState()},CharacterController.prototype.update=function(){this.updateMovementState()},CharacterController.prototype.destroy=function(){this.destroyMovementState()},CharacterController.prototype.awakeMovementState=function(){var centerOffsetData,world,startingPos,showDebugColliders,colliderVisibility,capsuleSize,debugName,debugCapsule;this._abstractMesh=this.getAbstractMesh();this._avatarRadius=this.getProperty("avatarRadius",this._avatarRadius);this._avatarHeight=this.getProperty("avatarHeight",this._avatarHeight);this._skinWidth=this.getProperty("skinWidth",this._skinWidth);this._slopeLimit=this.getProperty("slopeLimit",this._slopeLimit);this._stepOffset=this.getProperty("stepOffset",this._stepOffset);this._minMoveDistance=this.getProperty("minMoveDistance",this._minMoveDistance);this._capsuleSegments=this.getProperty("capsuleSegments",this._capsuleSegments);this._useGhostSweepTest=this.getProperty("useGhostSweepTest",this._useGhostSweepTest);this.m_warpPosition=new Ammo.btVector3(0,0,0);this.m_walkDirection=new Ammo.btVector3(0,0,0);this.m_physicsEngine=BABYLON.SceneManager.GetPhysicsEngine(this.scene);centerOffsetData=this.getProperty("centerOffset");centerOffsetData!=null&&(this._centerOffset=BABYLON.Utilities.ParseVector3(centerOffsetData));this.setMaxNotifications(this._maxCollisions);world=BABYLON.SceneManager.GetPhysicsWorld(this.scene);world!=null?(startingPos=BABYLON.Utilities.GetAbsolutePosition(this.transform,this._centerOffset),this.m_startPosition=new Ammo.btVector3(startingPos.x,startingPos.y,startingPos.z),this.m_startTransform=new Ammo.btTransform,this.m_startTransform.setIdentity(),this.m_startTransform.setOrigin(this.m_startPosition),showDebugColliders=BABYLON.Utilities.ShowDebugColliders(),colliderVisibility=BABYLON.Utilities.ColliderVisibility(),showDebugColliders===!0&&this.transform._debugCollider==null&&(capsuleSize=new BABYLON.Vector3(this._avatarRadius,this._avatarHeight,1),capsuleSize.x*=Math.max(Math.abs(this.transform.scaling.x),Math.abs(this.transform.scaling.z)),capsuleSize.y*=this.transform.scaling.y,debugName=this.transform.name+".Debug",debugCapsule=BABYLON.MeshBuilder.CreateCapsule(debugName,{tessellation:this._capsuleSegments,subdivisions:8,capSubdivisions:16,height:capsuleSize.y,radius:capsuleSize.x},this.scene),debugCapsule.position.set(0,0,0),debugCapsule.rotationQuaternion=this.transform.rotationQuaternion.clone(),debugCapsule.setParent(this.transform),debugCapsule.position.copyFrom(this._centerOffset),debugCapsule.visibility=colliderVisibility,debugCapsule.material=BABYLON.Utilities.GetColliderMaterial(this.scene),debugCapsule.checkCollisions=!1,debugCapsule.isPickable=!1,this.transform._debugCollider=debugCapsule),this.m_ghostShape=new Ammo.btCapsuleShape(this._avatarRadius,this._avatarHeight/2),this.m_ghostShape.setMargin(this._skinWidth+BABYLON.CharacterController.MARGIN_FACTOR),this.m_ghostObject=new Ammo.btPairCachingGhostObject,this.m_ghostObject.setWorldTransform(this.m_startTransform),this.m_ghostObject.setCollisionShape(this.m_ghostShape),this.m_ghostObject.setCollisionFlags(BABYLON.CollisionFlags.CF_CHARACTER_OBJECT),this.m_ghostCollision=Ammo.castObject(this.m_ghostObject,Ammo.btCollisionObject),this.m_ghostCollision.entity=this._abstractMesh,this.m_character=new Ammo.btKinematicCharacterController(this.m_ghostObject,this.m_ghostShape,this._stepOffset),this.m_character.setUseGhostSweepTest(this._useGhostSweepTest),this.m_character.setUpInterpolate(!0),this.m_character.setMaxSlope(BABYLON.Tools.ToRadians(this._slopeLimit)),this.m_character.setGravity(BABYLON.System.Gravity3G),world.addCollisionObject(this.m_ghostObject,BABYLON.CollisionFilters.CharacterFilter,BABYLON.CollisionFilters.StaticFilter|BABYLON.CollisionFilters.DefaultFilter|BABYLON.CollisionFilters.CharacterFilter),world.addAction(this.m_character)):BABYLON.Tools.Warn("Null physics world detected. Failed to create character controller: "+this.transform.name);this._isPhysicsReady=this.m_physicsEngine!=null&&this._tmpCollisionContacts!=null&&this.m_ghostObject!=null&&this._abstractMesh!=null},CharacterController.prototype.startMovementState=function(){this.updateMovementState()},CharacterController.prototype.syncMovementState=function(){this._isPhysicsReady===!0&&(this.m_ghostTransform=this.m_ghostObject.getWorldTransform(),this.m_ghostPosition=this.m_ghostTransform!=null?this.m_ghostTransform.getOrigin():null)},CharacterController.prototype.updateMovementState=function(){this.syncMovementState();this._isPhysicsReady===!0&&this.m_ghostPosition!=null&&(this.updatePosition===!0?(this.m_collisionPosition.set(this.m_ghostPosition.x(),this.m_ghostPosition.y(),this.m_ghostPosition.z()),this._centerOffset!=null&&this.m_collisionPosition.subtractInPlace(this._centerOffset),this.transform.position.copyFrom(this.m_collisionPosition)):this.setGhostWorldPosition(this.transform.position),this.onUpdatePositionObservable.hasObservers()===!0&&this.onUpdatePositionObservable.notifyObservers(this.transform));this.parseGhostCollisionContacts()},CharacterController.prototype.parseGhostCollisionContacts=function(){var index,contacts,contactObject,contactBody,foundindex,contactMesh,check,insert,info;if(this._isPhysicsReady===!0){var hasEnterObservers=this.onCollisionEnterObservable.hasObservers(),hasStayObservers=this.onCollisionStayObservable.hasObservers(),hasExitObservers=this.onCollisionExitObservable.hasObservers();if(hasEnterObservers||hasStayObservers||hasExitObservers){for(index=0,index=0;index<this._tmpCollisionContacts.length;index++)this._tmpCollisionContacts[index].reset=!0;if(contacts=this.m_ghostObject.getNumOverlappingObjects(),contacts>this._maxCollisions&&(contacts=this._maxCollisions),contacts>0)for(index=0;index<contacts;index++)if(contactObject=this.m_ghostObject.getOverlappingObject(index),contactObject!=null&&(contactBody=Ammo.castObject(contactObject,Ammo.btCollisionObject),contactBody!=null&&contactBody.entity!=null&&contactBody.isActive())){for(foundindex=-1,contactMesh=contactBody.entity,index=0;index<this._tmpCollisionContacts.length;index++)if(check=this._tmpCollisionContacts[index],check.mesh!=null&&check.mesh===contactMesh){check.state=1;check.reset=!1;foundindex=index;break}if(foundindex===-1)for(index=0;index<this._tmpCollisionContacts.length;index++)if(insert=this._tmpCollisionContacts[index],insert.mesh==null){insert.mesh=contactMesh;insert.state=0;insert.reset=!1;break}}for(index=0;index<this._tmpCollisionContacts.length;index++)info=this._tmpCollisionContacts[index],info.reset===!0?(hasExitObservers&&info.mesh!=null&&this.onCollisionExitObservable.notifyObservers(info.mesh),info.mesh=null,info.state=0,info.reset=!1):info.state===0?hasEnterObservers&&info.mesh!=null&&this.onCollisionEnterObservable.notifyObservers(info.mesh):hasStayObservers&&info.mesh!=null&&this.onCollisionStayObservable.notifyObservers(info.mesh)}}},CharacterController.prototype.destroyMovementState=function(){this.m_physicsEngine=null;this.m_character!=null&&(Ammo.destroy(this.m_character),this.m_character=null);this.m_ghostObject!=null&&(Ammo.destroy(this.m_ghostObject),this.m_ghostObject=null);this.m_ghostShape!=null&&(Ammo.destroy(this.m_ghostShape),this.m_ghostShape=null);this.m_ghostCollision!=null&&(Ammo.destroy(this.m_ghostCollision),this.m_ghostCollision=null);this.m_ghostPosition!=null&&(Ammo.destroy(this.m_ghostPosition),this.m_ghostPosition=null);this.m_ghostTransform!=null&&(Ammo.destroy(this.m_ghostTransform),this.m_ghostTransform=null);this.m_startPosition!=null&&(Ammo.destroy(this.m_startPosition),this.m_startPosition=null);this.m_startTransform!=null&&(Ammo.destroy(this.m_startTransform),this.m_startTransform=null);this.m_warpPosition!=null&&(Ammo.destroy(this.m_warpPosition),this.m_warpPosition=null);this.m_walkDirection!=null&&(Ammo.destroy(this.m_walkDirection),this.m_walkDirection=null);this.onUpdatePositionObservable.clear();this.onUpdatePositionObservable=null;this.onCollisionEnterObservable.clear();this.onCollisionEnterObservable=null;this.onCollisionStayObservable.clear();this.onCollisionStayObservable=null;this.onCollisionExitObservable.clear();this.onCollisionExitObservable=null;this._tmpCollisionContacts=null;this._abstractMesh=null},CharacterController.prototype.setMaxNotifications=function(max){this._maxCollisions=max;this._tmpCollisionContacts=[];for(var index=0;index<this._maxCollisions;index++)this._tmpCollisionContacts.push(new BABYLON.CollisionContactInfo)},CharacterController.prototype.setActivationState=function(state){this.m_ghostCollision!=null&&this.m_ghostCollision.setActivationState&&this.m_ghostCollision.setActivationState(state)},CharacterController.prototype.getCollisionFilterGroup=function(){var result=-1;return this.m_ghostCollision!=null&&this.m_ghostCollision.getBroadphaseHandle&&(result=this.m_ghostCollision.getBroadphaseHandle().get_m_collisionFilterGroup()),result},CharacterController.prototype.setCollisionFilterGroup=function(group){this.m_ghostCollision!=null&&this.m_ghostCollision.getBroadphaseHandle&&this.m_ghostCollision.getBroadphaseHandle().set_m_collisionFilterGroup(group)},CharacterController.prototype.getCollisionFilterMask=function(){var result=-1;return this.m_ghostCollision!=null&&this.m_ghostCollision.getBroadphaseHandle&&(result=this.m_ghostCollision.getBroadphaseHandle().get_m_collisionFilterMask()),result},CharacterController.prototype.setCollisionFilterMask=function(mask){this.m_ghostCollision!=null&&this.m_ghostCollision.getBroadphaseHandle&&this.m_ghostCollision.getBroadphaseHandle().set_m_collisionFilterMask(mask)},CharacterController.prototype.getContactProcessingThreshold=function(){return this.m_ghostCollision!=null&&this.m_ghostCollision.getContactProcessingThreshold&&this.m_ghostCollision.getContactProcessingThreshold(),-1},CharacterController.prototype.setContactProcessingThreshold=function(threshold){this.m_ghostCollision!=null&&this.m_ghostCollision.setContactProcessingThreshold&&this.m_ghostCollision.setContactProcessingThreshold(threshold)},CharacterController.prototype.setGhostWorldPosition=function(position){this.m_ghostObject!=null&&this.m_ghostTransform!=null&&(this.m_ghostPosition!=null&&position!=null&&(this.m_ghostPosition.setValue(position.x,position.y,position.z),this.m_ghostTransform.setOrigin(this.m_ghostPosition)),this.m_ghostObject.setWorldTransform(this.m_ghostTransform))},CharacterController.prototype.move=function(velocity){velocity!=null&&(this.m_moveDeltaX=velocity.x,this.m_moveDeltaZ=velocity.z,Math.abs(velocity.x)<this._minMoveDistance&&(velocity.x>0?this.m_moveDeltaX=this._minMoveDistance:velocity.x<0&&(this.m_moveDeltaX=-this._minMoveDistance)),Math.abs(velocity.z)<this._minMoveDistance&&(velocity.z>0?this.m_moveDeltaZ=this._minMoveDistance:velocity.z<0&&(this.m_moveDeltaZ=-this._minMoveDistance)),this.m_walkDirection!=null&&(this.m_walkDirection.setValue(this.m_moveDeltaX,0,this.m_moveDeltaZ),this.internalSetWalkDirection(this.m_walkDirection)))},CharacterController.prototype.jump=function(speed){this.internalSetJumpSpeed(speed);this.internalJump()},CharacterController.prototype.warp=function(position){this.m_warpPosition!=null&&(this.m_warpPosition.setValue(position.x,position.y,position.z),this.internalWarp(this.m_warpPosition))},CharacterController.MARGIN_FACTOR=-.04,CharacterController}(BABYLON.ScriptComponent);BABYLON.CharacterController=CharacterController}(BABYLON||(BABYLON={})),function(BABYLON){var NavigationAgent=function(_super){function NavigationAgent(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.distanceToTarget=0,_this.moveDirection=new BABYLON.Vector3(0,0,0),_this.resetPosition=new BABYLON.Vector3(0,0,0),_this.lastPosition=new BABYLON.Vector3(0,0,0),_this.currentPosition=new BABYLON.Vector3(0,0,0),_this.currentVelocity=new BABYLON.Vector3(0,0,0),_this.currentWaypoint=new BABYLON.Vector3(0,0,0),_this.heightOffset=0,_this.angularSpeed=0,_this.updatePosition=!0,_this.distanceEpsilon=.1,_this.velocityEpsilon=1,_this.stoppingDistance=0,_this.m_agentState=0,_this.m_agentIndex=-1,_this.m_agentTrans=null,_this.m_agentParams=null,_this.m_agentRotation=new BABYLON.Quaternion(0,0,0,1),_this.m_agentMovement=new BABYLON.Vector3(0,0,0),_this.m_agentDirection=new BABYLON.Vector3(0,0,1),_this.m_agentQuaternion=new BABYLON.Quaternion(0,0,0,1),_this.m_agentDestination=null,_this.onPreUpdateObservable=new BABYLON.Observable,_this.onPostUpdateObservable=new BABYLON.Observable,_this.onNavCompleteObservable=new BABYLON.Observable,_this}return __extends(NavigationAgent,_super),NavigationAgent.prototype.isNavigating=function(){return this.m_agentDestination!=null},NavigationAgent.prototype.getAgentType=function(){return this.type},NavigationAgent.prototype.getAgentState=function(){return this.m_agentState},NavigationAgent.prototype.getAgentIndex=function(){return this.m_agentIndex},NavigationAgent.prototype.getAgentRadius=function(){return this.avoidRadius},NavigationAgent.prototype.getAgentHeight=function(){return this.avoidHeight},NavigationAgent.prototype.getAgentSpeed=function(){return this.speed},NavigationAgent.prototype.getAgentOffset=function(){return this.baseOffset},NavigationAgent.prototype.getTargetDistance=function(){return this.distanceToTarget},NavigationAgent.prototype.awake=function(){this.awakeNavigationAgent()},NavigationAgent.prototype.late=function(){this.updateNavigationAgent()},NavigationAgent.prototype.destroy=function(){this.destroyNavigationAgent()},NavigationAgent.prototype.awakeNavigationAgent=function(){this.type=this.getProperty("type",this.type);this.speed=this.getProperty("speed",this.speed);this.baseOffset=this.getProperty("offset",this.baseOffset);this.angularSpeed=this.getProperty("angularspeed",this.angularSpeed);this.acceleration=this.getProperty("acceleration",this.acceleration);this.stoppingDistance=this.getProperty("stoppingdistance",this.stoppingDistance);this.autoBraking=this.getProperty("autobraking",this.autoBraking);this.avoidRadius=this.getProperty("avoidradius",this.avoidRadius);this.avoidHeight=this.getProperty("avoidheight",this.avoidHeight);this.obstacleAvoidanceType=this.getProperty("avoidquality",this.obstacleAvoidanceType);this.avoidancePriority=this.getProperty("avoidpriority",this.avoidancePriority);this.autoTraverseOffMeshLink=this.getProperty("autotraverse",this.autoTraverseOffMeshLink);this.autoRepath=this.getProperty("autopepath",this.autoRepath);this.areaMask=this.getProperty("areamask",this.areaMask);BABYLON.Utilities.ValidateTransformQuaternion(this.transform);this.m_agentTrans=new BABYLON.TransformNode(this.transform.name+".Agent",this.scene);this.m_agentTrans.position=new BABYLON.Vector3(0,0,0);this.m_agentTrans.rotation=new BABYLON.Vector3(0,0,0);BABYLON.Utilities.ValidateTransformQuaternion(this.m_agentTrans);this.lastPosition.copyFrom(this.transform.position)},NavigationAgent.prototype.updateNavigationAgent=function(){var crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene),rotateFactor,targetAngle;crowd!=null&&(this.m_agentIndex<0&&(this.m_agentParams={radius:this.avoidRadius,height:this.avoidHeight,maxSpeed:this.speed,maxAcceleration:this.acceleration,collisionQueryRange:.5,pathOptimizationRange:0,separationWeight:1},BABYLON.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition),this.m_agentIndex=crowd.addAgent(this.resetPosition,this.m_agentParams,this.m_agentTrans)),this.m_agentState=crowd.getAgentState(this.m_agentIndex),this.getAgentWaypointToRef(this.currentWaypoint),this.getAgentPositionToRef(this.currentPosition),this.m_agentState===BABYLON.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH?(this.currentPosition.subtractToRef(this.lastPosition,this.currentVelocity),this.currentVelocity.scaleInPlace(this.speed*1.5)):this.getAgentVelocityToRef(this.currentVelocity),this.m_agentDestination!=null?(this.distanceToTarget=BABYLON.Vector3.Distance(this.currentPosition,this.m_agentDestination),(this.updatePosition===!0||this.angularSpeed>0)&&(this.onPreUpdateObservable.hasObservers()===!0&&this.onPreUpdateObservable.notifyObservers(this.transform),this.angularSpeed>0&&this.currentVelocity.length()>=this.velocityEpsilon&&(this.currentVelocity.normalize(),rotateFactor=this.angularSpeed*BABYLON.NavigationAgent.ANGULAR_SPEED_RATIO*this.getDeltaSeconds(),this.m_agentState===BABYLON.CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH?(this.moveDirection.copyFrom(this.m_agentDirection),this.m_agentDirection.set(this.moveDirection.x+(this.currentVelocity.x-this.moveDirection.x),this.moveDirection.y+(this.currentVelocity.y-this.moveDirection.y),this.moveDirection.z+(this.currentVelocity.z-this.moveDirection.z)),this.m_agentDirection.normalize(),targetAngle=BABYLON.NavigationAgent.TARGET_ANGLE_FACTOR-Math.atan2(this.m_agentDirection.z,this.m_agentDirection.x),BABYLON.Quaternion.FromEulerAnglesToRef(0,targetAngle,0,this.m_agentRotation),BABYLON.Quaternion.SlerpToRef(this.transform.rotationQuaternion,this.m_agentRotation,rotateFactor,this.transform.rotationQuaternion)):(this.m_agentQuaternion.copyFrom(this.transform.rotationQuaternion),this.transform.lookAt(this.currentWaypoint),this.transform.rotationQuaternion.toEulerAnglesToRef(this.m_agentDirection),BABYLON.Quaternion.FromEulerAnglesToRef(0,this.m_agentDirection.y,0,this.m_agentRotation),BABYLON.Quaternion.SlerpToRef(this.m_agentQuaternion,this.m_agentRotation,rotateFactor,this.transform.rotationQuaternion))),this.updatePosition===!0&&this.transform.position.set(this.currentPosition.x,this.currentPosition.y+this.baseOffset+this.heightOffset,this.currentPosition.z),this.onPostUpdateObservable.hasObservers()===!0&&this.onPostUpdateObservable.notifyObservers(this.transform)),this.distanceToTarget<=Math.max(this.distanceEpsilon,this.stoppingDistance)&&(this.cancelNavigation(),this.onNavCompleteObservable.hasObservers()===!0&&this.onNavCompleteObservable.notifyObservers(this.transform))):this.distanceToTarget=0,this.lastPosition.copyFrom(this.transform.position))},NavigationAgent.prototype.destroyNavigationAgent=function(){this.m_agentIndex=-1;this.m_agentRotation=null;this.m_agentMovement=null;this.m_agentDirection=null;this.m_agentDestination=null;this.moveDirection=null;this.resetPosition=null;this.lastPosition=null;this.currentPosition=null;this.currentVelocity=null;this.currentWaypoint=null;this.onPreUpdateObservable.clear();this.onPreUpdateObservable=null;this.onPostUpdateObservable.clear();this.onPostUpdateObservable=null;this.onNavCompleteObservable.clear();this.onNavCompleteObservable=null;this.m_agentTrans!=null&&(this.m_agentTrans.dispose(),this.m_agentTrans=null)},NavigationAgent.prototype.move=function(offset,closetPoint){closetPoint===void 0&&(closetPoint=!0);var plugin=BABYLON.SceneManager.GetNavigationTools(),crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);plugin!=null&&crowd!=null?(crowd.getAgentPosition(this.m_agentIndex).addToRef(offset,this.m_agentMovement),this.m_agentDestination=closetPoint===!0?plugin.getClosestPoint(this.m_agentMovement):this.m_agentMovement.clone(),this.m_agentIndex>=0&&crowd.agentGoto(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},NavigationAgent.prototype.teleport=function(destination,closetPoint){closetPoint===void 0&&(closetPoint=!0);var plugin=BABYLON.SceneManager.GetNavigationTools(),crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);plugin!=null&&crowd!=null?(this.m_agentDestination=closetPoint===!0?plugin.getClosestPoint(destination):destination.clone(),this.m_agentIndex>=0&&crowd.agentTeleport(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},NavigationAgent.prototype.setDestination=function(destination,closetPoint,resetAgent){closetPoint===void 0&&(closetPoint=!0);resetAgent===void 0&&(resetAgent=!0);var plugin=BABYLON.SceneManager.GetNavigationTools(),crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);plugin!=null&&crowd!=null?(resetAgent===!0&&this.resetAgentPosition(),this.m_agentDestination=closetPoint===!0?plugin.getClosestPoint(destination):destination.clone(),this.m_agentIndex>=0&&crowd.agentGoto(this.m_agentIndex,this.m_agentDestination)):BABYLON.Tools.Warn("No recast navigation mesh or crowd interface data available!")},NavigationAgent.prototype.getAgentVelocity=function(){var crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);return crowd!=null&&this.m_agentIndex>=0?crowd.getAgentVelocity(this.m_agentIndex):null},NavigationAgent.prototype.getAgentVelocityToRef=function(result){var crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);crowd!=null&&this.m_agentIndex>=0&&crowd.getAgentVelocityToRef(this.m_agentIndex,result)},NavigationAgent.prototype.getAgentPosition=function(){var crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);return crowd!=null&&this.m_agentIndex>=0?crowd.getAgentPosition(this.m_agentIndex):null},NavigationAgent.prototype.getAgentPositionToRef=function(result){var crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);crowd!=null&&this.m_agentIndex>=0&&crowd.getAgentPositionToRef(this.m_agentIndex,result)},NavigationAgent.prototype.getAgentWaypoint=function(){var crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);return crowd!=null&&this.m_agentIndex>=0?crowd.getAgentNextTargetPath(this.m_agentIndex):null},NavigationAgent.prototype.getAgentWaypointToRef=function(result){var crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);crowd!=null&&this.m_agentIndex>=0&&crowd.getAgentNextTargetPathToRef(this.m_agentIndex,result)},NavigationAgent.prototype.resetAgentPosition=function(){this.m_agentDestination=null;BABYLON.Utilities.GetAbsolutePositionToRef(this.transform,this.resetPosition);var crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene);crowd!=null&&this.m_agentIndex>=0&&crowd.agentTeleport(this.m_agentIndex,this.resetPosition)},NavigationAgent.prototype.cancelNavigation=function(){this.m_agentDestination=null;var crowd=BABYLON.SceneManager.GetCrowdInterface(this.scene),position=this.getAgentPosition();position!=null&&crowd!=null&&this.m_agentIndex>=0&&(crowd.agentTeleport(this.m_agentIndex,position),position.y+=this.baseOffset+this.heightOffset,this.transform.position.copyFrom(position))},NavigationAgent.TARGET_ANGLE_FACTOR=Math.PI*.5,NavigationAgent.ANGULAR_SPEED_RATIO=.1,NavigationAgent}(BABYLON.ScriptComponent),CrowdAgentState;BABYLON.NavigationAgent=NavigationAgent,function(CrowdAgentState){CrowdAgentState[CrowdAgentState.DT_CROWDAGENT_STATE_INVALID=0]="DT_CROWDAGENT_STATE_INVALID";CrowdAgentState[CrowdAgentState.DT_CROWDAGENT_STATE_WALKING=1]="DT_CROWDAGENT_STATE_WALKING";CrowdAgentState[CrowdAgentState.DT_CROWDAGENT_STATE_OFFMESH=2]="DT_CROWDAGENT_STATE_OFFMESH"}(CrowdAgentState=BABYLON.CrowdAgentState||(BABYLON.CrowdAgentState={}))}(BABYLON||(BABYLON={})),function(BABYLON){var RaycastVehicle=function(){function RaycastVehicle(entity,world,center,defaultAngularFactor){defaultAngularFactor===void 0&&(defaultAngularFactor=null);this._centerMass=new BABYLON.Vector3(0,0,0);this._chassisMesh=null;this._tempVectorPos=new BABYLON.Vector3(0,0,0);this.lockedWheelIndexes=null;this.m_vehicle=null;this.m_vehicleTuning=null;this.m_vehicleRaycaster=null;this.m_vehicleColliders=null;this.m_tempTransform=null;this.m_tempPosition=null;this.m_wheelDirectionCS0=null;this.m_wheelAxleCS=null;this._chassisMesh=entity;this._centerMass=center;this.m_vehicleTuning=new Ammo.btVehicleTuning;this.m_vehicleRaycaster=Ammo.btSmoothVehicleRaycaster!=null?new Ammo.btSmoothVehicleRaycaster(world):new Ammo.btDefaultVehicleRaycaster(world);this.m_vehicleColliders=this._chassisMesh.metadata!=null&&this._chassisMesh.metadata.unity!=null&&this._chassisMesh.metadata.unity.wheels!=null?this._chassisMesh.metadata.unity.wheels:null;this.m_vehicle=new Ammo.btRaycastVehicle(this.m_vehicleTuning,this._chassisMesh.physicsImpostor.physicsBody,this.m_vehicleRaycaster);this.m_vehicle.setCoordinateSystem(0,1,2);this.m_wheelDirectionCS0=new Ammo.btVector3(0,-1,0);this.m_wheelAxleCS=new Ammo.btVector3(-1,0,0);this.m_tempPosition=null;this.m_tempTransform=null;this.setupWheelInformation(defaultAngularFactor);world.addAction(this.m_vehicle);Ammo.btSmoothVehicleRaycaster==null&&BABYLON.Tools.Warn("Using Default Vehicle Raycaster For:"+entity.name)}return RaycastVehicle.prototype.getInternalVehicle=function(){return this.m_vehicle},RaycastVehicle.prototype.getUpAxis=function(){if(this.m_vehicle!=null)return this.m_vehicle.getUpAxis()},RaycastVehicle.prototype.getRightAxis=function(){if(this.m_vehicle!=null)return this.m_vehicle.getRightAxis()},RaycastVehicle.prototype.getForwardAxis=function(){if(this.m_vehicle!=null)return this.m_vehicle.getForwardAxis()},RaycastVehicle.prototype.getForwardVector=function(){if(this.m_vehicle!=null)return this.m_vehicle.getForwardVector()},RaycastVehicle.prototype.getNumWheels=function(){if(this.m_vehicle!=null)return this.m_vehicle.getNumWheels()},RaycastVehicle.prototype.getWheelInfo=function(wheel){if(this.m_vehicle!=null)return this.m_vehicle.getWheelInfo(wheel)},RaycastVehicle.prototype.resetSuspension=function(){this.m_vehicle!=null&&this.m_vehicle.resetSuspension()},RaycastVehicle.prototype.setPitchControl=function(pitch){this.m_vehicle!=null&&this.m_vehicle.setPitchControl(pitch)},RaycastVehicle.prototype.setEngineForce=function(power,wheel){this.m_vehicle!=null&&this.m_vehicle.applyEngineForce(power,wheel)},RaycastVehicle.prototype.setBrakingForce=function(brake,wheel){this.m_vehicle!=null&&this.m_vehicle.setBrake(brake,wheel)},RaycastVehicle.prototype.getWheelTransform=function(wheel){if(this.m_vehicle!=null)return this.m_vehicle.getWheelTransformWS(wheel)},RaycastVehicle.prototype.updateWheelTransform=function(wheel,interpolate){this.m_vehicle!=null&&this.m_vehicle.updateWheelTransform(wheel,interpolate)},RaycastVehicle.prototype.getUserConstraintType=function(){if(this.m_vehicle!=null)return this.m_vehicle.getUserConstraintType()},RaycastVehicle.prototype.setUserConstraintType=function(userConstraintType){this.m_vehicle!=null&&this.m_vehicle.setUserConstraintType(userConstraintType)},RaycastVehicle.prototype.setUserConstraintId=function(uid){this.m_vehicle!=null&&this.m_vehicle.setUserConstraintId(uid)},RaycastVehicle.prototype.getUserConstraintId=function(){if(this.m_vehicle!=null)return this.m_vehicle.getUserConstraintId()},RaycastVehicle.prototype.getRawCurrentSpeedKph=function(){if(this.m_vehicle!=null)return this.m_vehicle.getCurrentSpeedKmHour()},RaycastVehicle.prototype.getRawCurrentSpeedMph=function(){if(this.m_vehicle!=null)return this.m_vehicle.getCurrentSpeedKmHour()*BABYLON.System.Kph2Mph},RaycastVehicle.prototype.getAbsCurrentSpeedKph=function(){if(this.m_vehicle!=null)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())},RaycastVehicle.prototype.getAbsCurrentSpeedMph=function(){if(this.m_vehicle!=null)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())*BABYLON.System.Kph2Mph},RaycastVehicle.prototype.getVehicleTuningSystem=function(){return this.m_vehicleTuning},RaycastVehicle.prototype.getChassisWorldTransform=function(){if(this.m_vehicle!=null)return this.m_vehicle.getChassisWorldTransform()},RaycastVehicle.prototype.dispose=function(){this.deleteWheelInformation();this.m_vehicle!=null&&(Ammo.destroy(this.m_vehicle),this.m_vehicle=null);this.m_vehicleTuning!=null&&(Ammo.destroy(this.m_vehicleTuning),this.m_vehicleTuning=null);this.m_vehicleRaycaster!=null&&(Ammo.destroy(this.m_vehicleRaycaster),this.m_vehicleRaycaster=null);this.m_wheelDirectionCS0!=null&&(Ammo.destroy(this.m_wheelDirectionCS0),this.m_wheelDirectionCS0=null);this.m_wheelAxleCS!=null&&(Ammo.destroy(this.m_wheelAxleCS),this.m_wheelAxleCS=null);this.m_tempPosition!=null&&(Ammo.destroy(this.m_tempPosition),this.m_tempPosition=null);this.m_tempTransform!=null&&(Ammo.destroy(this.m_tempTransform),this.m_tempTransform=null);this.m_vehicleColliders=null},RaycastVehicle.GetInstance=function(scene,rigidbody,defaultAngularFactor){var anybody,rightHanded;return defaultAngularFactor===void 0&&(defaultAngularFactor=null),anybody=rigidbody,anybody.m_raycastVehicle==null&&(rigidbody.hasWheelColliders()?(rightHanded=BABYLON.SceneManager.GetRightHanded(scene),rightHanded===!0&&BABYLON.Tools.Warn("Raycast vehicle not supported for right handed scene: "+anybody._abstractMesh.name),anybody.m_raycastVehicle=new BABYLON.RaycastVehicle(anybody._abstractMesh,anybody.m_physicsWorld,anybody._centerOfMass,defaultAngularFactor)):BABYLON.Tools.Warn("No wheel collider metadata found for: "+anybody._abstractMesh.name)),anybody.m_raycastVehicle},RaycastVehicle.prototype.getEnableMultiRaycast=function(){var result=!1;return this.m_vehicle!=null&&this.m_vehicle.get_m_enableMultiRaycast&&(result=this.m_vehicle.get_m_enableMultiRaycast()),result},RaycastVehicle.prototype.setEnableMultiRaycast=function(flag){this.m_vehicle!=null&&this.m_vehicle.set_m_enableMultiRaycast&&this.m_vehicle.set_m_enableMultiRaycast(flag)},RaycastVehicle.prototype.getStabilizingForce=function(){var result=-1;return this.m_vehicle!=null&&this.m_vehicle.get_m_stabilizingForce&&(result=this.m_vehicle.get_m_stabilizingForce()),result},RaycastVehicle.prototype.setStabilizingForce=function(force){this.m_vehicle!=null&&this.m_vehicle.set_m_stabilizingForce&&this.m_vehicle.set_m_stabilizingForce(force)},RaycastVehicle.prototype.getSmoothFlyingImpulse=function(){var result=-1;return this.m_vehicle!=null&&this.m_vehicle.get_m_smoothFlyingImpulse&&(result=this.m_vehicle.get_m_smoothFlyingImpulse()),result},RaycastVehicle.prototype.setSmoothFlyingImpulse=function(impulse){this.m_vehicle!=null&&this.m_vehicle.set_m_smoothFlyingImpulse&&this.m_vehicle.set_m_smoothFlyingImpulse(impulse)},RaycastVehicle.prototype.getTrackConnectionAccel=function(){var result=-1;return this.m_vehicle!=null&&this.m_vehicle.get_m_trackConnectionAccel&&(result=this.m_vehicle.get_m_trackConnectionAccel()),result},RaycastVehicle.prototype.setTrackConnectionAccel=function(force){this.m_vehicle!=null&&this.m_vehicle.set_m_trackConnectionAccel&&this.m_vehicle.set_m_trackConnectionAccel(force)},RaycastVehicle.prototype.getMinimumWheelContacts=function(){var result=-1;return this.m_vehicle!=null&&this.m_vehicle.get_m_minimumWheelContacts&&(result=this.m_vehicle.get_m_minimumWheelContacts()),result},RaycastVehicle.prototype.setMinimumWheelContacts=function(force){this.m_vehicle!=null&&this.m_vehicle.set_m_minimumWheelContacts&&this.m_vehicle.set_m_minimumWheelContacts(force)},RaycastVehicle.prototype.getInterpolateNormals=function(){var result=!1;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_interpolateNormals&&(result=this.m_vehicleRaycaster.get_m_interpolateNormals()),result},RaycastVehicle.prototype.setInterpolateNormals=function(flag){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_interpolateNormals&&this.m_vehicleRaycaster.set_m_interpolateNormals(flag)},RaycastVehicle.prototype.getShapeTestingMode=function(){var result=!1;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_shapeTestingMode&&(result=this.m_vehicleRaycaster.get_m_shapeTestingMode()),result},RaycastVehicle.prototype.setShapeTestingMode=function(mode){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_shapeTestingMode&&this.m_vehicleRaycaster.set_m_shapeTestingMode(mode)},RaycastVehicle.prototype.getShapeTestingSize=function(){var result=0;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_shapeTestingSize&&(result=this.m_vehicleRaycaster.get_m_shapeTestingSize()),result},RaycastVehicle.prototype.setShapeTestingSize=function(size){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_shapeTestingSize&&this.m_vehicleRaycaster.set_m_shapeTestingSize(size)},RaycastVehicle.prototype.getShapeTestingCount=function(){var result=0;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_testPointCount&&(result=this.m_vehicleRaycaster.get_m_testPointCount()),result},RaycastVehicle.prototype.setShapeTestingCount=function(count){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_testPointCount&&this.m_vehicleRaycaster.set_m_testPointCount(count)},RaycastVehicle.prototype.getSweepPenetration=function(){var result=0;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_sweepPenetration&&(result=this.m_vehicleRaycaster.get_m_sweepPenetration()),result},RaycastVehicle.prototype.setSweepPenetration=function(amount){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_sweepPenetration&&this.m_vehicleRaycaster.set_m_sweepPenetration(amount)},RaycastVehicle.prototype.getCollisionFilterGroup=function(){var result=-1;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_collisionFilterGroup&&(result=this.m_vehicleRaycaster.get_m_collisionFilterGroup()),result},RaycastVehicle.prototype.setCollisionFilterGroup=function(group){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_collisionFilterGroup&&this.m_vehicleRaycaster.set_m_collisionFilterGroup(group)},RaycastVehicle.prototype.getCollisionFilterMask=function(){var result=-1;return this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.get_m_collisionFilterMask&&(result=this.m_vehicleRaycaster.get_m_collisionFilterMask()),result},RaycastVehicle.prototype.setCollisionFilterMask=function(mask){this.m_vehicleRaycaster!=null&&this.m_vehicleRaycaster.set_m_collisionFilterMask&&this.m_vehicleRaycaster.set_m_collisionFilterMask(mask)},RaycastVehicle.prototype.getWheelIndexByID=function(id){var result=-1,index,wheel;if(this.m_vehicleColliders!=null&&this.m_vehicleColliders.length>0)for(index=0;index<this.m_vehicleColliders.length;index++)if(wheel=this.m_vehicleColliders[index],id.toLowerCase()===wheel.id.toLowerCase()){result=index;break}return result},RaycastVehicle.prototype.getWheelIndexByName=function(name){var result=-1,index,wheel;if(this.m_vehicleColliders!=null&&this.m_vehicleColliders.length>0)for(index=0;index<this.m_vehicleColliders.length;index++)if(wheel=this.m_vehicleColliders[index],name.toLowerCase()===wheel.name.toLowerCase()){result=index;break}return result},RaycastVehicle.prototype.getWheelColliderInfo=function(wheel){var result=-1;return this.m_vehicleColliders!=null&&this.m_vehicleColliders.length>0&&this.m_vehicleColliders.length>wheel&&(result=this.m_vehicleColliders[wheel]),result},RaycastVehicle.prototype.setWheelTransformMesh=function(wheel,transform){if(transform!=null){var wheelinfo=this.getWheelInfo(wheel);wheelinfo!=null&&(wheelinfo.transform=transform)}},RaycastVehicle.prototype.getVisualSteeringAngle=function(wheel){var result=0,wheelinfo=this.getWheelInfo(wheel);return wheelinfo!=null&&wheelinfo.steeringAngle!=null&&(result=wheelinfo.steeringAngle),result},RaycastVehicle.prototype.setVisualSteeringAngle=function(angle,wheel){var wheelinfo=this.getWheelInfo(wheel);wheelinfo!=null&&(wheelinfo.steeringAngle=angle)},RaycastVehicle.prototype.getPhysicsSteeringAngle=function(wheel){if(this.m_vehicle!=null)return Math.abs(this.m_vehicle.getSteeringValue(wheel))},RaycastVehicle.prototype.setPhysicsSteeringAngle=function(angle,wheel){this.m_vehicle!=null&&this.m_vehicle.setSteeringValue(angle,wheel)},RaycastVehicle.prototype.setupWheelInformation=function(defaultAngularFactor){var index;if(defaultAngularFactor===void 0&&(defaultAngularFactor=null),this._chassisMesh!=null&&this._chassisMesh.physicsImpostor!=null&&this._chassisMesh.physicsImpostor.physicsBody!=null&&(defaultAngularFactor!=null&&this._chassisMesh.physicsImpostor.physicsBody.setAngularFactor(new Ammo.btVector3(defaultAngularFactor.x,defaultAngularFactor.y,defaultAngularFactor.z)),this._chassisMesh.physicsImpostor.physicsBody.setActivationState(BABYLON.CollisionState.DISABLE_DEACTIVATION)),this.m_vehicle!=null&&this.m_vehicleColliders!=null&&this.m_vehicleColliders.length>0){for(index=-1,index=0;index<this.m_vehicleColliders.length;index++){var wheel=this.m_vehicleColliders[index],wheelName=wheel.name!=null?wheel.name:"Unknown",wheelRadius=wheel.radius!=null?wheel.radius:.35,wheelHalfTrack=wheel.position!=null&&wheel.position.length>=3?wheel.position[0]:1,wheelAxisPosition=wheel.position!=null&&wheel.position.length>=3?wheel.position[2]:-1,wheelConnectionPoint=wheel.wheelconnectionpoint!=null?wheel.wheelconnectionpoint:.5,suspensionRestLength=wheel.suspensionrestlength!=null?wheel.suspensionrestlength:.3,isfrontwheel=wheel.frontwheel!=null?!0:wheelName.toLowerCase().indexOf("front")>=0,wheelposition=wheelAxisPosition,wheeltracking=wheelHalfTrack,centermassx=-this._centerMass.x,centermassz=-this._centerMass.z;this.m_vehicle.addWheel(new Ammo.btVector3(wheeltracking+centermassx,wheelConnectionPoint,wheelposition+centermassz),this.m_wheelDirectionCS0,this.m_wheelAxleCS,suspensionRestLength,wheelRadius,this.m_vehicleTuning,isfrontwheel)}if(this.m_vehicle.getNumWheels()===this.m_vehicleColliders.length)for(index=0;index<this.m_vehicleColliders.length;index++){var wheel=this.m_vehicleColliders[index],defaultForce=wheel.totalsuspensionforces!=null?wheel.totalsuspensionforces:1e6,defaultTravel=wheel.suspensiontravelcm!=null?wheel.suspensiontravelcm:25,defaultRolling=wheel.rollinfluence!=null?wheel.rollinfluence:.2,defaultFriction=wheel.frictionslip!=null?wheel.frictionslip:10,suspensionStiffness=wheel.suspensionstiffness!=null?wheel.suspensionstiffness:50,suspensionCompression=wheel.dampingcompression!=null?wheel.dampingcompression:3.5,suspensionDamping=wheel.dampingrelaxation!=null?wheel.dampingrelaxation:4.5,wheelinfo=this.m_vehicle.getWheelInfo(index);wheelinfo!=null&&(wheelinfo.steeringAngle=0,wheelinfo.rotationBoost=0,wheelinfo.defaultFriction=defaultFriction,wheelinfo.set_m_frictionSlip(defaultFriction),wheelinfo.set_m_rollInfluence(defaultRolling),wheelinfo.set_m_maxSuspensionForce(defaultForce),wheelinfo.set_m_maxSuspensionTravelCm(defaultTravel),wheelinfo.set_m_suspensionStiffness(suspensionStiffness),wheelinfo.set_m_wheelsDampingCompression(suspensionCompression),wheelinfo.set_m_wheelsDampingRelaxation(suspensionDamping))}else BABYLON.Tools.Warn("Failed to create proper number of wheels for: "+this._chassisMesh.name)}},RaycastVehicle.prototype.updateWheelInformation=function(){var wheels=this.getNumWheels(),index,wheelinfo,locked,transform,steeringAngle;if(wheels>0)for(index=0;index<wheels;index++)if(wheelinfo=this.getWheelInfo(index),wheelinfo!=null&&(locked=this.lockedWheelInformation(index),this.updateWheelTransform(index,!1),this.m_tempTransform=this.getWheelTransform(index),this.m_tempPosition=this.m_tempTransform.getOrigin(),wheelinfo.transform!=null&&(transform=wheelinfo.transform,transform.parent!=null&&(BABYLON.Utilities.ConvertAmmoVector3ToRef(this.m_tempPosition,this._tempVectorPos),BABYLON.Utilities.InverseTransformPointToRef(transform.parent,this._tempVectorPos,this._tempVectorPos),transform.position.y=this._tempVectorPos.y,steeringAngle=wheelinfo.steeringAngle!=null?wheelinfo.steeringAngle:0,BABYLON.Quaternion.FromEulerAnglesToRef(0,steeringAngle,0,transform.rotationQuaternion),wheelinfo.spinner!=null&&wheelinfo.spinner.addRotation&&locked===!1)))){var wheelrotation=0,deltaRotation=wheelinfo.get_m_deltaRotation!=null?wheelinfo.get_m_deltaRotation():0,rotationBoost=wheelinfo.rotationBoost!=null?wheelinfo.rotationBoost:0;wheelrotation=deltaRotation<0?deltaRotation+-rotationBoost:deltaRotation+rotationBoost;wheelinfo.spinner.addRotation(wheelrotation,0,0)}},RaycastVehicle.prototype.lockedWheelInformation=function(wheel){var result=!1,index;if(this.lockedWheelIndexes!=null&&this.lockedWheelIndexes.length>0)for(index=0;index<this.lockedWheelIndexes.length;index++)if(this.lockedWheelIndexes[index]===wheel){result=!0;break}return result},RaycastVehicle.prototype.deleteWheelInformation=function(){var wheels=this.getNumWheels(),index,info;if(wheels>0)for(index=0;index<wheels;index++)info=this.getWheelInfo(index),info!=null&&(info.transform!=null&&delete info.transform,info.spinner!=null&&delete info.spinner,info.steeringAngle!=null&&delete info.steeringAngle,info.rotationBoost!=null&&delete info.rotationBoost,info.defaultFriction!=null&&delete info.defaultFriction)},RaycastVehicle}();BABYLON.RaycastVehicle=RaycastVehicle}(BABYLON||(BABYLON={})),function(BABYLON){var RealtimeReflection=function(_super){function RealtimeReflection(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(RealtimeReflection,_super),RealtimeReflection.prototype.awake=function(){},RealtimeReflection.prototype.start=function(){},RealtimeReflection.prototype.update=function(){},RealtimeReflection.prototype.late=function(){},RealtimeReflection.prototype.after=function(){},RealtimeReflection.prototype.destroy=function(){},RealtimeReflection}(BABYLON.ScriptComponent);BABYLON.RealtimeReflection=RealtimeReflection}(BABYLON||(BABYLON={})),function(BABYLON){var RigidbodyPhysics=function(_super){function RigidbodyPhysics(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this._abstractMesh=null,_this._isKinematic=!1,_this._maxCollisions=4,_this._isPhysicsReady=!1,_this._centerOfMass=new BABYLON.Vector3(0,0,0),_this._tmpLinearFactor=new BABYLON.Vector3(0,0,0),_this._tmpAngularFactor=new BABYLON.Vector3(0,0,0),_this._tmpCenterOfMass=new BABYLON.Vector3(0,0,0),_this._tmpGravityVector=null,_this._tmpCollisionContacts=null,_this.m_physicsWorld=null,_this.m_physicsEngine=null,_this.m_raycastVehicle=null,_this.onCollisionEnterObservable=new BABYLON.Observable,_this.onCollisionStayObservable=new BABYLON.Observable,_this.onCollisionExitObservable=new BABYLON.Observable,_this}return __extends(RigidbodyPhysics,_super),Object.defineProperty(RigidbodyPhysics.prototype,"isKinematic",{get:function(){return this._isKinematic},enumerable:!1,configurable:!0}),Object.defineProperty(RigidbodyPhysics.prototype,"centerOfMass",{get:function(){return this._centerOfMass},enumerable:!1,configurable:!0}),RigidbodyPhysics.prototype.awake=function(){this.awakeRigidbodyState()},RigidbodyPhysics.prototype.update=function(){this.updateRigidbodyState()},RigidbodyPhysics.prototype.after=function(){this.afterRigidbodyState()},RigidbodyPhysics.prototype.destroy=function(){this.destroyRigidbodyState()},RigidbodyPhysics.prototype.awakeRigidbodyState=function(){this._abstractMesh=this.getAbstractMesh();this._isKinematic=this.getProperty("isKinematic",this._isKinematic);this.m_physicsWorld=BABYLON.SceneManager.GetPhysicsWorld(this.scene);this.m_physicsEngine=BABYLON.SceneManager.GetPhysicsEngine(this.scene);this.transform.metadata!=null&&this.transform.metadata.unity!=null&&this.transform.metadata.unity.physics!=null&&(this._centerOfMass=this.transform.metadata.unity.physics.center!=null?BABYLON.Utilities.ParseVector3(this.transform.metadata.unity.physics.center,this._centerOfMass):this._centerOfMass);this.setMaxNotifications(this._maxCollisions);BABYLON.Utilities.ValidateTransformQuaternion(this.transform);this._isPhysicsReady=this.m_physicsEngine!=null&&this._tmpCollisionContacts!=null&&this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null;var collisionGroup=this._isKinematic===!0?BABYLON.CollisionFilters.StaticFilter:BABYLON.CollisionFilters.DefaultFilter,collisionMask=this._isKinematic===!0?BABYLON.CollisionFilters.AllFilter^BABYLON.CollisionFilters.StaticFilter:BABYLON.CollisionFilters.AllFilter;this.setCollisionFilterGroup(collisionGroup);this.setCollisionFilterMask(collisionMask);this.resetBodyCollisionContacts()},RigidbodyPhysics.prototype.updateRigidbodyState=function(){this.syncronizeVehicleController()},RigidbodyPhysics.prototype.afterRigidbodyState=function(){this.parseBodyCollisionContacts();this.resetBodyCollisionContacts()},RigidbodyPhysics.prototype.destroyRigidbodyState=function(){this.m_physicsWorld=null;this.m_physicsEngine=null;this.m_raycastVehicle!=null&&(this.m_raycastVehicle.dispose&&this.m_raycastVehicle.dispose(),this.m_raycastVehicle=null);this._tmpGravityVector!=null&&(Ammo.destroy(this._tmpGravityVector),this._tmpGravityVector=null);this.onCollisionEnterObservable.clear();this.onCollisionEnterObservable=null;this.onCollisionStayObservable.clear();this.onCollisionStayObservable=null;this.onCollisionExitObservable.clear();this.onCollisionExitObservable=null;this._tmpCollisionContacts=null;this._abstractMesh=null},RigidbodyPhysics.prototype.syncronizeVehicleController=function(){this.m_raycastVehicle!=null&&this.m_raycastVehicle.updateWheelInformation&&this.m_raycastVehicle.updateWheelInformation()},RigidbodyPhysics.prototype.parseBodyCollisionContacts=function(){var index,collisionCount,tmpCollisionObjectMap,contactKey,foundindex,contactMesh,check,insert,info;if(this._isPhysicsReady===!0){var hasEnterObservers=this.onCollisionEnterObservable.hasObservers(),hasStayObservers=this.onCollisionStayObservable.hasObservers(),hasExitObservers=this.onCollisionExitObservable.hasObservers();if(hasEnterObservers||hasStayObservers||hasExitObservers){for(index=0,index=0;index<this._tmpCollisionContacts.length;index++)this._tmpCollisionContacts[index].reset=!0;if(collisionCount=0,this._abstractMesh.physicsImpostor.tmpCollisionObjects!=null){tmpCollisionObjectMap=this._abstractMesh.physicsImpostor.tmpCollisionObjects;for(contactKey in tmpCollisionObjectMap){for(foundindex=-1,contactMesh=tmpCollisionObjectMap[contactKey],index=0;index<this._tmpCollisionContacts.length;index++)if(check=this._tmpCollisionContacts[index],check.mesh!=null&&check.mesh===contactMesh){check.state=1;check.reset=!1;foundindex=index;break}if(foundindex===-1)for(index=0;index<this._tmpCollisionContacts.length;index++)if(insert=this._tmpCollisionContacts[index],insert.mesh==null){insert.mesh=contactMesh;insert.state=0;insert.reset=!1;break}if(collisionCount++,collisionCount>this._maxCollisions)break}}for(index=0;index<this._tmpCollisionContacts.length;index++)info=this._tmpCollisionContacts[index],info.reset===!0?(hasExitObservers&&info.mesh!=null&&this.onCollisionExitObservable.notifyObservers(info.mesh),info.mesh=null,info.state=0,info.reset=!1):info.state===0?hasEnterObservers&&info.mesh!=null&&this.onCollisionEnterObservable.notifyObservers(info.mesh):hasStayObservers&&info.mesh!=null&&this.onCollisionStayObservable.notifyObservers(info.mesh)}}},RigidbodyPhysics.prototype.resetBodyCollisionContacts=function(){if(this._isPhysicsReady===!0){var hasEnterObservers=this.onCollisionEnterObservable.hasObservers(),hasStayObservers=this.onCollisionStayObservable.hasObservers(),hasExitObservers=this.onCollisionExitObservable.hasObservers();this._abstractMesh.physicsImpostor.tmpCollisionObjects=hasEnterObservers||hasStayObservers||hasExitObservers?{}:null}},RigidbodyPhysics.prototype.setGravity=function(gravity){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setGravity&&gravity!=null&&(this._tmpGravityVector==null&&(this._tmpGravityVector=new Ammo.btVector3(0,0,0)),this._tmpGravityVector.setValue(gravity.x,gravity.y,gravity.z),this._abstractMesh.physicsImpostor.physicsBody.setGravity(this._tmpGravityVector))},RigidbodyPhysics.prototype.getGravity=function(){var result=new BABYLON.Vector3(0,0,0);return this.getGravityToRef(result),result},RigidbodyPhysics.prototype.getGravityToRef=function(result){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getGravity){var gravity=this._abstractMesh.physicsImpostor.physicsBody.getGravity();BABYLON.Utilities.ConvertAmmoVector3ToRef(gravity,result)}},RigidbodyPhysics.prototype.getMass=function(){var result=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(result=this._abstractMesh.physicsImpostor.mass),result},RigidbodyPhysics.prototype.setMass=function(mass){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.mass!==mass&&(this._abstractMesh.physicsImpostor.mass=mass)},RigidbodyPhysics.prototype.getFriction=function(){var result=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(result=this._abstractMesh.physicsImpostor.friction),result},RigidbodyPhysics.prototype.setFriction=function(friction){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.friction!==friction&&(this._abstractMesh.physicsImpostor.friction=friction)},RigidbodyPhysics.prototype.getRestitution=function(){var result=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(result=this._abstractMesh.physicsImpostor.restitution),result},RigidbodyPhysics.prototype.setRestitution=function(restitution){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.restitution!==restitution&&(this._abstractMesh.physicsImpostor.restitution=restitution)},RigidbodyPhysics.prototype.getLinearVelocity=function(){var result=null;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(result=this._abstractMesh.physicsImpostor.getLinearVelocity()),result},RigidbodyPhysics.prototype.setLinearVelocity=function(velocity){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&velocity!=null&&this._abstractMesh.physicsImpostor.setLinearVelocity(velocity)},RigidbodyPhysics.prototype.getAngularVelocity=function(){var result=null;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&(result=this._abstractMesh.physicsImpostor.getAngularVelocity()),result},RigidbodyPhysics.prototype.setAngularVelocity=function(velocity){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&velocity!=null&&this._abstractMesh.physicsImpostor.setAngularVelocity(velocity)},RigidbodyPhysics.prototype.getWorldTransform=function(){var result=null,collisionObject;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),collisionObject!=null&&collisionObject.getWorldTransform&&(result=collisionObject.getWorldTransform())),result},RigidbodyPhysics.prototype.getTransformPositionToRef=function(result){var btTransform=this.getWorldTransform(),btPosition;btTransform!=null&&result!=null&&(btPosition=btTransform.getOrigin(),BABYLON.Utilities.ConvertAmmoVector3ToRef(btPosition,result))},RigidbodyPhysics.prototype.getTransformRotationToRef=function(result){var btTransform=this.getWorldTransform(),btRotation;btTransform!=null&&result!=null&&(btRotation=btTransform.getRotation(),BABYLON.Utilities.ConvertAmmoQuaternionToRef(btRotation,result))},RigidbodyPhysics.prototype.clearForces=function(){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.clearForces&&this._abstractMesh.physicsImpostor.physicsBody.clearForces()},RigidbodyPhysics.prototype.applyTorque=function(torque){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyTorque&&torque!=null&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(torque.x,torque.y,torque.z),this._abstractMesh.physicsImpostor.physicsBody.applyTorque(BABYLON.RigidbodyPhysics.TempAmmoVector))},RigidbodyPhysics.prototype.applyLocalTorque=function(torque){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyLocalTorque&&torque!=null&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(torque.x,torque.y,torque.z),this._abstractMesh.physicsImpostor.physicsBody.applyLocalTorque(BABYLON.RigidbodyPhysics.TempAmmoVector))},RigidbodyPhysics.prototype.applyImpulse=function(impulse,rel_pos){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyImpulse&&impulse!=null&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVectorAux==null&&(BABYLON.RigidbodyPhysics.TempAmmoVectorAux=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(impulse.x,impulse.y,impulse.z),BABYLON.RigidbodyPhysics.TempAmmoVectorAux.setValue(rel_pos.x,rel_pos.y,rel_pos.z),this._abstractMesh.physicsImpostor.physicsBody.applyImpulse(BABYLON.RigidbodyPhysics.TempAmmoVector,BABYLON.RigidbodyPhysics.TempAmmoVectorAux))},RigidbodyPhysics.prototype.applyCentralImpulse=function(impulse){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralImpulse&&impulse!=null&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(impulse.x,impulse.y,impulse.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralImpulse(BABYLON.RigidbodyPhysics.TempAmmoVector))},RigidbodyPhysics.prototype.applyTorqueImpulse=function(torque){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyTorqueImpulse&&torque!=null&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(torque.x,torque.y,torque.z),this._abstractMesh.physicsImpostor.physicsBody.applyTorqueImpulse(BABYLON.RigidbodyPhysics.TempAmmoVector))},RigidbodyPhysics.prototype.applyForce=function(force,rel_pos){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyForce&&force!=null&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVectorAux==null&&(BABYLON.RigidbodyPhysics.TempAmmoVectorAux=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(force.x,force.y,force.z),BABYLON.RigidbodyPhysics.TempAmmoVectorAux.setValue(rel_pos.x,rel_pos.y,rel_pos.z),this._abstractMesh.physicsImpostor.physicsBody.applyForce(BABYLON.RigidbodyPhysics.TempAmmoVector,BABYLON.RigidbodyPhysics.TempAmmoVectorAux))},RigidbodyPhysics.prototype.applyCentralForce=function(force){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralForce&&force!=null&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(force.x,force.y,force.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralForce(BABYLON.RigidbodyPhysics.TempAmmoVector))},RigidbodyPhysics.prototype.applyCentralLocalForce=function(force){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralLocalForce&&force!=null&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(force.x,force.y,force.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralLocalForce(BABYLON.RigidbodyPhysics.TempAmmoVector))},RigidbodyPhysics.prototype.getCenterOfMassTransform=function(){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getCenterOfMassTransform){var bttransform=this._abstractMesh.physicsImpostor.physicsBody.getCenterOfMassTransform(),btposition=bttransform.getOrigin();this._tmpCenterOfMass.set(btposition.x(),btposition.y(),btposition.z())}return this._tmpCenterOfMass},RigidbodyPhysics.prototype.setCenterOfMassTransform=function(center){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setCenterOfMassTransform&&center!=null&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(center.x,center.y,center.z),BABYLON.RigidbodyPhysics.TempCenterTransform==null&&(BABYLON.RigidbodyPhysics.TempCenterTransform=new Ammo.btTransform),BABYLON.RigidbodyPhysics.TempCenterTransform.setIdentity(),BABYLON.RigidbodyPhysics.TempCenterTransform.setOrigin(BABYLON.RigidbodyPhysics.TempAmmoVector),this._abstractMesh.physicsImpostor.physicsBody.setCenterOfMassTransform(BABYLON.RigidbodyPhysics.TempCenterTransform))},RigidbodyPhysics.prototype.getLinearFactor=function(){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getLinearFactor){var linearFactor=this._abstractMesh.physicsImpostor.physicsBody.getLinearFactor();this._tmpLinearFactor.set(linearFactor.x(),linearFactor.y(),linearFactor.z())}return this._tmpLinearFactor},RigidbodyPhysics.prototype.setLinearFactor=function(factor){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setLinearFactor&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(factor.x,factor.y,factor.z),this._abstractMesh.physicsImpostor.physicsBody.setLinearFactor(BABYLON.RigidbodyPhysics.TempAmmoVector))},RigidbodyPhysics.prototype.getAngularFactor=function(){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getAngularFactor){var angularFactor=this._abstractMesh.physicsImpostor.physicsBody.getAngularFactor();this._tmpAngularFactor.set(angularFactor.x(),angularFactor.y(),angularFactor.z())}return this._tmpAngularFactor},RigidbodyPhysics.prototype.setAngularFactor=function(factor){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setAngularFactor&&(BABYLON.RigidbodyPhysics.TempAmmoVector==null&&(BABYLON.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),BABYLON.RigidbodyPhysics.TempAmmoVector.setValue(factor.x,factor.y,factor.z),this._abstractMesh.physicsImpostor.physicsBody.setAngularFactor(BABYLON.RigidbodyPhysics.TempAmmoVector))},RigidbodyPhysics.prototype.getAngularDamping=function(){var result=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getAngularDamping&&(result=this._abstractMesh.physicsImpostor.physicsBody.getAngularDamping()),result},RigidbodyPhysics.prototype.getLinearDamping=function(){var result=0;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getLinearDamping&&(result=this._abstractMesh.physicsImpostor.physicsBody.getLinearDamping()),result},RigidbodyPhysics.prototype.setDamping=function(linear,angular){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setDamping&&this._abstractMesh.physicsImpostor.physicsBody.setDamping(linear,angular)},RigidbodyPhysics.prototype.setSleepingThresholds=function(linear,angular){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.setSleepingThresholds&&this._abstractMesh.physicsImpostor.physicsBody.setSleepingThresholds(linear,angular)},RigidbodyPhysics.prototype.hasWheelColliders=function(){return this._isPhysicsReady===!0&&this._abstractMesh.metadata!=null&&this._abstractMesh.metadata.unity!=null&&this._abstractMesh.metadata.unity.wheels!=null},RigidbodyPhysics.prototype.setMaxNotifications=function(max){this._maxCollisions=max;this._tmpCollisionContacts=[];for(var index=0;index<this._maxCollisions;index++)this._tmpCollisionContacts.push(new CollisionContactInfo)},RigidbodyPhysics.prototype.setActivationState=function(state){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null){var collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject);collisionObject!=null&&collisionObject.setActivationState&&collisionObject.setActivationState(state)}},RigidbodyPhysics.prototype.getCollisionFilterGroup=function(){var result=-1;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&(result=this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().get_m_collisionFilterGroup()),result},RigidbodyPhysics.prototype.setCollisionFilterGroup=function(group){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().set_m_collisionFilterGroup(group)},RigidbodyPhysics.prototype.getCollisionFilterMask=function(){var result=-1;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&(result=this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().get_m_collisionFilterMask()),result},RigidbodyPhysics.prototype.setCollisionFilterMask=function(mask){this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().set_m_collisionFilterMask(mask)},RigidbodyPhysics.prototype.getCollisionShapeType=function(){var result=-1,collisionObject,collisionShape;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),collisionObject!=null&&(collisionShape=collisionObject.getCollisionShape(),collisionShape!=null&&collisionShape.getShapeType&&(result=collisionShape.getShapeType()))),result},RigidbodyPhysics.prototype.getCollisionShapeMargin=function(){var result=-1,collisionObject,collisionShape;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),collisionObject!=null&&(collisionShape=collisionObject.getCollisionShape(),collisionShape!=null&&collisionShape.getMargin&&(result=collisionShape.getMargin()))),result},RigidbodyPhysics.prototype.setCollisionShapeMargin=function(margin){var collisionObject,collisionShape;this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),collisionObject!=null&&(collisionShape=collisionObject.getCollisionShape(),collisionShape!=null&&collisionShape.setMargin&&collisionShape.setMargin(margin)))},RigidbodyPhysics.prototype.getContactProcessingThreshold=function(){var result=-1,collisionObject;return this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null&&(collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),collisionObject!=null&&collisionObject.getContactProcessingThreshold&&(result=collisionObject.getContactProcessingThreshold())),result},RigidbodyPhysics.prototype.setContactProcessingThreshold=function(threshold){if(this._abstractMesh!=null&&this._abstractMesh.physicsImpostor!=null&&this._abstractMesh.physicsImpostor.physicsBody!=null){var collisionObject=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject);collisionObject!=null&&collisionObject.setContactProcessingThreshold&&collisionObject.setContactProcessingThreshold(threshold)}},RigidbodyPhysics.CreatePhysicsMetadata=function(mass,drag,angularDrag,centerMass){drag===void 0&&(drag=0);angularDrag===void 0&&(angularDrag=.05);centerMass===void 0&&(centerMass=null);var center=centerMass!=null?centerMass:new BABYLON.Vector3(0,0,0);return{type:"rigidbody",mass:mass,ldrag:drag,adrag:angularDrag,center:{x:center.x,y:center.y,z:center.z}}},RigidbodyPhysics.CreateCollisionMetadata=function(type,trigger,convexmesh,restitution,dynamicfriction,staticfriction){return trigger===void 0&&(trigger=!1),convexmesh===void 0&&(convexmesh=!1),restitution===void 0&&(restitution=0),dynamicfriction===void 0&&(dynamicfriction=.6),staticfriction===void 0&&(staticfriction=.6),{type:type,trigger:trigger,convexmesh:convexmesh,restitution:restitution,dynamicfriction:dynamicfriction,staticfriction:staticfriction,wheelinformation:null}},RigidbodyPhysics.CreatePhysicsProperties=function(mass,drag,angularDrag,useGravity,isKinematic){return drag===void 0&&(drag=0),angularDrag===void 0&&(angularDrag=.05),useGravity===void 0&&(useGravity=!0),isKinematic===void 0&&(isKinematic=!1),{mass:mass,drag:drag,angularDrag:angularDrag,useGravity:useGravity,isKinematic:isKinematic}},RigidbodyPhysics.SetupPhysicsComponent=function(scene,entity){var metadata=entity.metadata!=null&&entity.metadata.unity!=null?entity.metadata.unity:null;if(metadata!=null&&(metadata.physics!=null||metadata.collision!=null)){var hasphysics=metadata.physics!=null,isroot=metadata.physics!=null&&metadata.physics.root!=null?metadata.physics.root:!1,mass=metadata.physics!=null&&metadata.physics.mass!=null?metadata.physics.mass:0,isstatic=mass===0,hascollision=metadata.collision!=null,collider=metadata.collision!=null&&metadata.collision.type!=null?metadata.collision.type:"BoxCollider",convexmesh=metadata.collision!=null&&metadata.collision.convexmesh!=null?metadata.collision.convexmesh:!1,dynamicfriction=metadata.collision!=null&&metadata.collision.dynamicfriction!=null?metadata.collision.dynamicfriction:.6,staticfriction=metadata.collision!=null&&metadata.collision.staticfriction!=null?metadata.collision.staticfriction:.6,restitution=metadata.collision!=null&&metadata.collision.restitution!=null?metadata.collision.restitution:0,istrigger=metadata.collision!=null&&metadata.collision.trigger!=null?metadata.collision.trigger:!1,impostortype=BABYLON.PhysicsImpostor.BoxImpostor;if(impostortype=collider==="MeshCollider"?convexmesh===!0?BABYLON.PhysicsImpostor.ConvexHullImpostor:BABYLON.PhysicsImpostor.MeshImpostor:collider==="CapsuleCollider"?BABYLON.PhysicsImpostor.CapsuleImpostor:collider==="SphereCollider"?BABYLON.PhysicsImpostor.SphereImpostor:BABYLON.PhysicsImpostor.BoxImpostor,hasphysics===!0)if(isroot){var fnodes_1=null,fwheels_1=null,childnodes=entity.getChildren(null,!1);childnodes!=null&&childnodes.length>0&&childnodes.forEach(function(childnode){if(childnode.metadata!=null&&childnode.metadata.unity!=null&&childnode.metadata.unity.collision!=null){var ccollision=childnode.metadata.unity.collision,cwheelinformation=ccollision.wheelinformation!=null?ccollision.wheelinformation:null;cwheelinformation!=null?(fwheels_1==null&&(fwheels_1=[]),fwheels_1.push(cwheelinformation)):(fnodes_1==null&&(fnodes_1=[]),fnodes_1.push(childnode))}});fwheels_1!=null&&fwheels_1.length>0&&(entity.metadata==null&&(entity.metadata={}),entity.metadata.unity==null&&(entity.metadata.unity={}),entity.metadata.unity.wheels=fwheels_1);fnodes_1!=null&&fnodes_1.length>0&&(hascollision===!0&&fnodes_1.unshift(entity),entity._compoundNodes=fnodes_1,BABYLON.SceneManager.CreatePhysicsImpostor(scene,entity,BABYLON.PhysicsImpostor.NoImpostor,{mass:mass,friction:dynamicfriction,restitution:restitution}),BABYLON.RigidbodyPhysics.ConfigRigidbodyPhysics(scene,entity,!1,istrigger,metadata.physics));childnodes=null}else hascollision===!0&&(BABYLON.SceneManager.CreatePhysicsImpostor(scene,entity,impostortype,{mass:mass,friction:isstatic?staticfriction:dynamicfriction,restitution:restitution}),BABYLON.RigidbodyPhysics.ConfigRigidbodyPhysics(scene,entity,!1,istrigger,metadata.physics))}},RigidbodyPhysics.ConfigRigidbodyPhysics=function(scene,entity,child,trigger,physics){entity!=null&&(entity.physicsImpostor!=null?entity.physicsImpostor.executeNativeFunction(function(word,body){var colobj,world,collisionShape,shapeType,triangleShape,gravity,ldrag,adrag,freeze;if(body.activate&&body.activate(),colobj=Ammo.castObject(body,Ammo.btCollisionObject),colobj.entity=entity,world=BABYLON.SceneManager.GetPhysicsWorld(scene),world!=null&&world.generateInternalEdgeInfo&&(collisionShape=colobj.getCollisionShape(),collisionShape!=null&&collisionShape.getShapeType&&(shapeType=collisionShape.getShapeType(),shapeType===21&&(triangleShape=Ammo.castObject(collisionShape,Ammo.btBvhTriangleMeshShape),colobj.triangleMapInfo=new Ammo.btTriangleInfoMap,world.generateInternalEdgeInfo(triangleShape,colobj.triangleMapInfo)))),gravity=physics!=null&&physics.gravity!=null?physics.gravity:!0,gravity===!1&&(body.setGravity?body.setGravity(new Ammo.btVector3(0,0,0)):BABYLON.Tools.Warn("Physics engine set gravity override not supported for: "+entity.name)),body.setDamping?(ldrag=physics!=null&&physics.ldrag!=null?physics.ldrag:0,adrag=physics!=null&&physics.adrag!=null?physics.adrag:.05,body.setDamping(ldrag,adrag)):BABYLON.Tools.Warn("Physics engine set drag damping not supported for: "+entity.name),body.setCollisionFlags&&body.getCollisionFlags?trigger===!0?body.setCollisionFlags(body.getCollisionFlags()|BABYLON.CollisionFlags.CF_NO_CONTACT_RESPONSE|BABYLON.CollisionFlags.CF_CUSTOM_MATERIAL_CALLBACK):body.setCollisionFlags(body.getCollisionFlags()|BABYLON.CollisionFlags.CF_CUSTOM_MATERIAL_CALLBACK):BABYLON.Tools.Warn("Physics engine set collision flags not supported for: "+entity.name),freeze=physics!=null&&physics.freeze!=null?physics.freeze:null,freeze!=null){if(body.setLinearFactor){var freeze_pos_x=freeze.positionx!=null&&freeze.positionx===!0?0:1,freeze_pos_y=freeze.positiony!=null&&freeze.positiony===!0?0:1,freeze_pos_z=freeze.positionz!=null&&freeze.positionz===!0?0:1;body.setLinearFactor(new Ammo.btVector3(freeze_pos_x,freeze_pos_y,freeze_pos_z))}else BABYLON.Tools.Warn("Physics engine set linear factor not supported for: "+entity.name);if(body.setAngularFactor){var freeze_rot_x=freeze.rotationx!=null&&freeze.rotationx===!0?0:1,freeze_rot_y=freeze.rotationy!=null&&freeze.rotationy===!0?0:1,freeze_rot_z=freeze.rotationz!=null&&freeze.rotationz===!0?0:1;body.setAngularFactor(new Ammo.btVector3(freeze_rot_x,freeze_rot_y,freeze_rot_z))}else BABYLON.Tools.Warn("Physics engine set angular factor not supported for: "+entity.name)}}):BABYLON.Tools.Warn("No valid physics impostor to setup for "+entity.name))},RigidbodyPhysics.TempAmmoVector=null,RigidbodyPhysics.TempAmmoVectorAux=null,RigidbodyPhysics.TempCenterTransform=null,RigidbodyPhysics}(BABYLON.ScriptComponent),CollisionContactInfo;BABYLON.RigidbodyPhysics=RigidbodyPhysics;CollisionContactInfo=function(){function CollisionContactInfo(){this.mesh=null;this.state=0;this.reset=!1}return CollisionContactInfo}();BABYLON.CollisionContactInfo=CollisionContactInfo}(BABYLON||(BABYLON={})),function(BABYLON){var ShurikenParticles=function(_super){function ShurikenParticles(){return _super!==null&&_super.apply(this,arguments)||this}return __extends(ShurikenParticles,_super),ShurikenParticles.prototype.awake=function(){},ShurikenParticles.prototype.start=function(){},ShurikenParticles.prototype.update=function(){},ShurikenParticles.prototype.late=function(){},ShurikenParticles.prototype.after=function(){},ShurikenParticles.prototype.destroy=function(){},ShurikenParticles}(BABYLON.ScriptComponent);BABYLON.ShurikenParticles=ShurikenParticles}(BABYLON||(BABYLON={})),function(BABYLON){var SocketController=function(){function SocketController(){}return SocketController.RegisterOnSocketConnect=function(func){BABYLON.SceneManager.SetWindowState("onSocketConnect",func)},SocketController.RegisterOnSocketDisconnect=function(func){BABYLON.SceneManager.SetWindowState("onSocketDisconnect",func)},SocketController.ConnectWindowSocket=function(connection){var socket=null;return window.frameElement!=null&&parent!=null&&parent.window!=null&&parent.window.socketConnect?socket=parent.window.socketConnect(connection):window.socketConnect&&(socket=window.socketConnect(connection)),socket},SocketController.GetWindowSocket=function(){return BABYLON.SceneManager.GetWindowState("socket")},SocketController}();BABYLON.SocketController=SocketController}(BABYLON||(BABYLON={})),function(BABYLON){var WebVideoPlayer=function(_super){function WebVideoPlayer(){var _this=_super!==null&&_super.apply(this,arguments)||this;return _this.m_abstractMesh=null,_this.m_videoTexture=null,_this.m_videoMaterial=null,_this}return __extends(WebVideoPlayer,_super),WebVideoPlayer.prototype.getVideoMaterial=function(){return this.m_videoMaterial},WebVideoPlayer.prototype.getVideoTexture=function(){return this.m_videoTexture},WebVideoPlayer.prototype.getVideoElement=function(){return this.m_videoTexture!=null?this.m_videoTexture.video:null},WebVideoPlayer.prototype.getVideoScreen=function(){return this.m_abstractMesh},WebVideoPlayer.prototype.awake=function(){this.awakeWebVideoPlayer()},WebVideoPlayer.prototype.destroy=function(){this.destroyWebVideoPlayer()},WebVideoPlayer.prototype.awakeWebVideoPlayer=function(){var rootUrl;if(this.m_abstractMesh=this.getAbstractMesh(),this.m_abstractMesh!=null){this.m_videoMaterial=new BABYLON.StandardMaterial(this.transform.name+".VideoMat",this.scene);this.m_videoMaterial.roughness=1;this.m_videoMaterial.emissiveColor=new BABYLON.Color3(1,1,1);this.m_abstractMesh.material=this.m_videoMaterial;var videoUrl=this.getProperty("url",null),videoSrc=this.getProperty("source",null),playUrl=videoUrl;if(videoSrc!=null&&videoSrc.filename!=null&&videoSrc.filename!==""&&(rootUrl=BABYLON.SceneManager.GetRootUrl(this.scene),playUrl=rootUrl+videoSrc.filename),playUrl!=null&&playUrl!==""){var videoMuted=this.getProperty("muted",!1),videoPoster=this.getProperty("poster",null),videoInvert=this.getProperty("inverty",!0),videoSample=this.getProperty("sampling",3),videoMipmaps=this.getProperty("mipmaps",!1),videoLooping=this.getProperty("looping",!1),videoPlayOnAwake=this.getProperty("playonawake",!0),videoVolume=this.getProperty("volume",1),videoPlayback=this.getProperty("playbackspeed",1),videoSettings={autoUpdateTexture:!0,autoPlay:videoPlayOnAwake,loop:videoLooping,muted:videoMuted,poster:videoPoster};this.setVideoSource(playUrl,videoMipmaps,videoInvert,videoSample,videoSettings,videoVolume,videoPlayback)}}else BABYLON.Tools.Warn("No video mesh available for: "+this.transform.name)},WebVideoPlayer.prototype.destroyWebVideoPlayer=function(){this.m_abstractMesh=null;this.m_videoTexture!=null&&(this.m_videoTexture.dispose(),this.m_videoTexture=null);this.m_videoMaterial!=null&&(this.m_videoMaterial.dispose(),this.m_videoMaterial=null)},WebVideoPlayer.prototype.setVideoSource=function(src,generateMipMaps,invertY,samplingMode,settings,volume,speed){generateMipMaps===void 0&&(generateMipMaps=!1);invertY===void 0&&(invertY=!0);samplingMode===void 0&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE);volume===void 0&&(volume=1);speed===void 0&&(speed=1);this.m_abstractMesh!=null&&this.m_videoMaterial!=null?(this.m_videoMaterial.diffuseTexture=null,this.m_videoTexture!=null&&(this.m_videoTexture.dispose(),this.m_videoTexture=null),this.m_videoTexture=new BABYLON.VideoTexture(this.transform.name+".VideoTex",src,this.scene,generateMipMaps,invertY,samplingMode,settings),this.m_videoTexture!=null&&this.m_videoTexture.video!=null&&(this.m_videoTexture.video.volume=volume,this.m_videoTexture.video.playbackRate=speed),this.m_videoMaterial.diffuseTexture=this.m_videoTexture):BABYLON.Tools.Warn("No video mesh or material available for: "+this.transform.name)},WebVideoPlayer}(BABYLON.ScriptComponent);BABYLON.WebVideoPlayer=WebVideoPlayer}(BABYLON||(BABYLON={}))

// Project Shader Fixes
if (BABYLON.Effect.IncludesShadersStore["pbrBlockFinalColorComposition"]) BABYLON.Effect.IncludesShadersStore["pbrBlockFinalColorComposition"] = BABYLON.Effect.IncludesShadersStore["pbrBlockFinalColorComposition"].replace("finalColor.rgb*=lightmapColor.rgb", "finalColor.rgb*=(lightmapColor.rgb+finalEmissive.rgb)");
if (BABYLON.Effect.ShadersStore["defaultPixelShader"]) BABYLON.Effect.ShadersStore["defaultPixelShader"] = BABYLON.Effect.ShadersStore["defaultPixelShader"].replace("color.rgb *= lightmapColor.rgb", "color.rgb *= (lightmapColor.rgb + finalEmissive.rgb)");
